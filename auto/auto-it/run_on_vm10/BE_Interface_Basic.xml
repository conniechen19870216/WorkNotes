<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- edited with XMLSPY v2004 rel. 3 (http://www.xmlspy.com) by valerie le ny (Alcatel CIT) -->
<OAM xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="D:/xsd/srv.xsd">
    <Application name="HSS">
        <Domain name="SUB">
            <SubDomain name="Subscription">
                <BusinessEntity entityType="OAM_Interface_Entity" name="SUB_OAM_BasicSubscription">
                    <Description>
                        <Summary>Management of the Basic Subscription. This is the master interface dealing with subscriber's data of the highest level : subscriber's identity, with the International Mobile Subscriber Number (IMSI), subscriber's user equipment identification number, with the Mobile ISDN Number (MSISDN), network acces mode, Bearer Services and Teleservices, informations for notification of servie node change</Summary>
                        <Context>Basic Subscription management</Context>
                        <Actor>OAM_MS</Actor>
                    </Description>
<!-- modify for feature 69834, author: shshi, time: 2009/10/22 -->
                    <DNSyntaxReference name="GsmServiceProfile_DN" entityNameOfRequestList="HSS.SUB.Subscription.SUB_OAM_DNconverter" requestList="GsmToAutoImsiChange">
<!-- modify for feature 69834 end -->
                        <DNSyntaxVirtual name="DN_By_IMSI_For_Basic" entityName="HSS.SUB.Subscription.SUB_OAM_DNconverter" request="IMSItoGsmServiceProfile" requestList="IMSItoGsmSeviceList" />
                        <DNSyntaxVirtual name="DN_By_MSISDN_For_Basic" entityName="HSS.SUB.Subscription.SUB_OAM_DNconverter" request="MSISDNtoGsmServiceProfile" requestList="MSISDNtoGsmSeviceList" />
                        <DNSyntaxVirtual name="Official_DN_By_IMSI_For_Basic" entityName="HSS.SUB.Subscription.SUB_OAM_DNconverter" request="IMSItoGsmServiceProfile" requestList="IMSItoGsmSeviceList" />
                        <DNSyntaxVirtual name="Official_DN_By_MSISDN_For_Basic" entityName="HSS.SUB.Subscription.SUB_OAM_DNconverter" request="MSISDNtoGsmServiceProfile" requestList="MSISDNtoGsmSeviceList" />
                    </DNSyntaxReference>
                    <LockReference name="Basic" />
                    <Request name="create">
                        <Description>
                            <Summary>The create Operation enables to create a new subscriber with common subscription characteristics to a CSService and/or PSService subscription if any, and optionally specific CSService characteristics, a PSService subscription, a CAMEL subscription, a Supplementary Service subscription, .....</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
<!--
                        ***************************************************************************************
                        * 1. Create Request 
                        *   1.0.1 Add logic for Twin-IMSI via subscriberType check ( FFRD 73118)   
                        *   1.0.2 Add logic for create subscriberType ( FFRD 67393 )
                        *   1.1   NAM
                        *       1.1.1   set networkAccessMode to defaultvalue (noGPRS)
                        *       1.1.2   control on networkAccessMode(allowed if F_GPRS_001 true) 
                        *   1.2   valorize local data GPRSsub to know if GPRS subscription
                        *   1.3 Check SuMSubscriberProfileId, extract SuMSubscriberProfileId from input DN
                        *       1.3.1     Check suMSubscriberProfileId
                        *       1.3.2   Save input DN in local data DN_BasicSubscription
                        *   1.4   associatedIMSI build
                        *       1.4.1 build  MSubIdentificationNumber_DN from mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId 
                        *       1.4.2 check AUC is available and the auc is not used by a subscriber then create the IMSI_DN
                        *       NGHLR1CAG159458_1 create entry MSubIdentificationNumber
                        *   1.5   associatedSubscriptionProfile build
                        *   1.6   treatment of MainSNwithBearerService parameter
                        *       1.6.1  extract countryCodeId, nationalDestinationCodeId, subscriberNumberId and BearerCapabilityName
                        *       1.6.2  BSN uniqueness control
                        *       1.6.3  check if GPRS provided (GPRSprovidedOnMain and BSotherthanGPRSprovided local data)
                        *       1.6.5  SMSMTAL not allowed on Main
                        *       1.6.6  build associatedMainMsisdn
                        *       1.6.7  build associatedBasicServices
                        *       NGHLR1FAG165519_1 Add check thatassociatedBasicServices must be autorized WITH SN 
                        *       1.6.8  Subscription Type OC+TC mandatory except for SMSMT                       
                        *       1.6.9  Incrementation of 1 of MSISDN counter                        
                        *       1.6.10  if BOTH at least one BS other than GPRS on Main
                        *       1.6.11  if GPRS subscription, GPRS BS must be provided.Otherwise automatically set to main
                        *       1.6.12 control on  associatedBasicServices (only one authorized when no GPRS)
                        *       1.6.13 create Entry SubscriberNumber on associatedMainMsisdn
                        *       1.6.14 create Entry suMSubscriptionProfile
                        * 1.7   treatment of SNwithBearerServiceList parameter
                        *       1.7.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName
                        *       1.7.2  BSN uniqueness control
                        *       1.7.3  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data)
                        *       1.7.4  check if BS other than SMSMT or SMSMO provided (BSotherthanSMSprovided local data)
                        *       1.7.5  create DN BSC corresponding to BearerCapabilityName
                        *       1.7.6  create DN MSISDN
                        *       1.7.7  if SMSMTAL fill alertMSISDN
                        *       1.7.8  create Entry MobileStationInternalISDN with associatedBasicServices if new 
                        *       1.7.9  modify Entry MobileStationInternalISDN if already created (complete associatedBasicServices)
                        *       1.7.10  Subscription Type OC+TC mandatory except for SMSMT
                        *       NGHLR1FAG165519_2 Add check thatassociatedBasicServicesmust be autorized WITH SN 
                        *       1.7.11  Incrementation of 1 of MSISDN counter                       
                        * 1.8   Control: Maximun number of MSISDN per subscription is not reached
                        * 1.9   Control: Maximun number of MSISDN is not reached
                        *   1.9.1   Control: Maximun number of subscriptions is not reached 
                        * 1.10      Control with SMSMTAL on SN (another BS is mandatory)
                        *   1.11  Modify Entry MSubIdentificationNumber 
                        * 1.12  treatement of BearerServiceWithoutSNList parameter
                        *       1.12.1  BSN uniqueness control
                        *       1.12.2  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data)
                        *       1.12.3  SMSMTAL not allowed on BSwithoutSN
                        *       1.12.4  create DN BSC corresponding to BearerCapabilityName
                        *       1.12.5  set bscWithoutSN
                        *   1.12.6  Subscription Type OC+TC mandatory except for SMSMT                      
                        *       NGHLR1FAG165519_3 Add check thatassociatedBasicServicesmust be autorized WITHOUT SN 
                        * 1.13  controls on BS
                        *   1.13.1 if GPRSonly, only SMS BS allowed  
                        *       1.13.2 if noGPRS, BS GPRS not allowed
                        *   1.14  treatement of ServiceNodeNotificationList parameter 
                        *       1.14.1  control(conditioned by fLR017)
                        *       1.14.2  foreach ServiceNodeNotification
                        *           1.14.2.1  extract trigger and SNaddress
                        *           1.14.2.2  control that the triggeringType is allowed
                        *           1.14.2.3  set serverAddress
                        *           1.14.2.4  search if corresponding entry ServiceNodeAddress already exists
                        *           1.14.2.5  create ServiceNodeAddress entry if doest not exist
                        *           1.14.2.6  valorize vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
                        *           1.14.2.7  Check smsRouteViaHNetwRoam
                        *           1.14.2.8  Check serviceProviderReference
                        *   1.15  create Entry GsmServiceProfile 
                        * 1.16  call create CsServiceProfile if NAM equals noGPRS or BOTH
                        * 1.17  call create PServiceProfile if NAM equals GPRSonly or BOTH
                        * 1.18  call create RoamingRestriction
                        * 1.19  call create CAMEL if CamelServiceProfile equals true
                        * 1.21  call create CallBarring if CallBarringServiceProfile equals true
                        * 1.22  call create CallForwrding if CallForwrdingServiceProfile equals true
                        * 1.23  call create GCS if GcsServiceProfile equals true
                        * 1.24  call create CUG if ClosedUserGroupProfile equals true
                        * 1.25  call create LCS if LcsServiceProfile equals true
                        * 1.26  call create eMLPP if eMLPPServiceProfile equals true
                        * 1.20  call create ODB if OdbServiceProfile equals true(deal with FR SDMA01FAG214141, create ODB after other supplement service.)
                        * 1.27  call create ADD if fADD001 equals true
                        * 1.28  call create MdtDomain if fEPS111 is turn on, add for feature 71037
                        *************************************************************************************** -->
                        <ReqParameters>
                            <Mandatory name="mobileCountryCodeId" />
                            <Mandatory name="mobileNetworkCodeId" />
                            <Mandatory name="mSubIdentificationNumberId" />
<!--Feature 723320 begin, modified by qiangfw, 20110525-->
                            <Optional name="MainSNwithBearerService" />
<!--Feature 723320 end, modified by qiangfw, 20110525-->
<!-- timeStamp -->
<!--    <Optional name="deactivatedSubscription"/> -->
<!-- timeStamp End -->
                            <Optional name="SNwithBearerServiceList" />
                            <Optional name="BearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 begin-->
                            <Optional name="ExtendedBearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 end-->
                            <Optional name="ServiceNodeNotificationList" />
                            <Optional name="networkAccessMode" />
                            <Optional name="accessRestrictionData" />
<!--Add for 71037 qdiao begin-->
                            <Optional name="icsIndicator" />
<!--Add for 71037 qdiao end-->
<!-- 67386 Feature -->
                            <Optional name="addService" />
<!--prepay paramters -->
                            <Optional name="prepay" />
                            <Optional name="prepayCommonGroupId" />
<!-- add for feature 67393 Start-->
                            <Optional name="subscriberType" />
<!-- add for feature 67393 End-->
<!-- CS parameters -->
                            <Optional name="msCategory" />
                            <Optional name="opSpecificCategory" />
                            <Optional name="singleNumbering" />
                            <Optional name="IpreferedCarrier" />
                            <Optional name="csAllocationRetentionPriority" />
<!-- add for feature 67398 Start-->
                            <Optional name="smsRouteViaHNetwRoam" />
<!-- add for feature 67398 End-->
<!-- add for feature 67435 Start-->
                            <Optional name="serviceProviderReference" />
<!-- add for feature 67435 End-->
<!--PS parameters-->
                            <Optional name="transferOfSmOption" />
                            <Optional name="packetMsAddressList" />
                            <Optional name="chargingCharacteristics" />
<!-- Add begin by Guangli for 69915 on 20100201-->
                            <Optional name="authVisitedPlmnNIDId" />
<!-- Add end by Guangli for 69915 on 20100201-->
<!-- ZTX | 2009/08/24 | Added for 69596/69597 EPS ServiceProfile Part -->
<!--EPS ServiceProfile parameters -->
                            <Optional name="epsServiceProfile" />
                            <Optional name="epsApnContextSetList" />
                            <Optional name="framedPoolSetList" />
                            <Optional name="maxRequestedBandwidthDL" />
                            <Optional name="maxRequestedBandwidthUL" />
<!-- Add begin by nian for 72989 on 20120229-->
                            <Optional name="selfActivationStatus" />
<!-- Add end by nian for 72989 on 20120229-->
<!-- Added for 73247 on 20121224-->
                            <Optional name="sqn4AAAIPv6" />
                            <Optional name="imsSubNum4AAAIPv6" />
<!-- Added for 73247 on 20121224-->
                            <Optional name="epsAccessSubscriptionType" />
                            <Optional name="apnOiReplacement" />
                            <Optional name="stnSrData" />
                            <Optional name="ratFreqSelectPriorityId" />
<!-- Add begin by nian for 72989 on 20120614 -->
                            <Optional name="S6aRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
<!--Begin added by F71037, Austin, 2012-11-27 -->
                            <Optional name="s6aRegRestrictionList" />
                            <Optional name="mpsPriority" />
                            <Optional name="relayNodeIndicator" />
<!--End added by F71037, Austin, 2012-11-27 -->
                            <Optional name="RauTauTimer" />
                            <Optional name="authLipaVplmnId" />
                            <Optional name="mdtUserConsent" />
                            <Optional name="roamRstrD2UFeat" />
<!--Add for 71037 qdiao end-->
<!-- Add end by nian for 72989 on 20120614 -->
<!-- Add begin by qigangx for 4.2 f73801 on 20121210 -->
                            <Optional name="eps3gppRestrictionListNum" />
<!-- Add end by qigangx for 4.2 f73801 on 20121210 -->
<!-- Add begin by Guangli for 69915 on 20100201-->
                            <Optional name="non3gppApnOiReplacement" />
<!-- Add end by Guangli for 69915 on 20100201-->
                            <Optional name="non3gppAccessRestrictionData" />
                            <Optional name="non3gppAuthenSesTimeout" />
                            <Optional name="non3gppIpAccess" />
                            <Optional name="non3gppIpAccessApn" />
                            <Optional name="chargingGatewayFuncHost" />
                            <Optional name="chargingGroup" />
                            <Optional name="non3gppGwMobileIpCapability" />
                            <Optional name="authVisitedNIDIdx" />
<!-- Add for 71910 begin, Liu, Yang W 20121204 -->
                            <Optional name="pprIpAddress" />
                            <Optional name="gmlcIpAddress" />
<!-- Add for 71910 end, Liu, Yang W 20121204 -->
<!-- Add begin by qigangx for 4.2 f73246 on 20121210 -->
                            <Optional name="allowMmeTableId" />
                            <Optional name="allowSgsnTableId" />
<!-- Add end by qigangx for 4.2 f73246 on 20121210 -->
<!-- Roaming parameters -->
<!-- 73118begin Wayne -->
                            <Optional name="RoamingServiceProfile" />
<!-- 73118begin Wayne -->
                            <Optional name="RoamingRestrictionType" />
                            <Optional name="csRestrictionListNum" />
                            <Optional name="psRestrictionListNum" />
                            <Optional name="regSubscriptionListId" />
<!-- General CAMEL parameters -->
                            <Optional name="CamelServiceProfile" />
                            <Optional name="camelLocationRequestFlag" />
                            <Optional name="camelStatusRequestFlag" />
                            <Optional name="camelMarkActivationRoamers" />
                            <Optional name="camelMarkInhibitionRoamersCs" />
<!--***O_CSI parameters***-->
                            <Optional name="OcsiServiceProfile" />
                            <Optional name="ocsiCamelSubState" />
                            <Optional name="ocsiCamelCapabilityHandling" />
                            <Optional name="ocsiCamelVlrNotSuppDfltHandl" />
                            <Optional name="ocsiCamelGmscNotSuppDfltHdl" />
                            <Optional name="tifcsiTransformationInformFlag" />
                            <Optional name="ocsiCollectedInfoTdpServKey" />
                            <Optional name="ocsiCollectedInfoTdpScpIsdn" />
                            <Optional name="ocsiCollectedInfoTdpDfltCalH" />
                            <Optional name="callTypeCriteria" />
                            <Optional name="destinationNumberCritList" />
                            <Optional name="matchType" />
                            <Optional name="destNbLengthCriteriaList" />
                            <Optional name="originBscCritList" />
                            <Optional name="originBsgCritList" />
                            <Optional name="ocsiRouteSelectFailTdpServKey" />
                            <Optional name="ocsiRouteSelectFailTdpScpIsdn" />
                            <Optional name="ocsiRouteSelectFailTdpDfltCalH" />
                            <Optional name="routeSelectFailTdpCauVCritList" />
                            <Optional name="oickKey" />
<!--***T_CSI parameters***-->
                            <Optional name="TcsiServiceProfile" />
                            <Optional name="tcsiCamelSubState" />
                            <Optional name="tcsiCamelCapabilityHandling" />
                            <Optional name="tcsiCamelGmscNotSuppDfltHandl" />
                            <Optional name="tcsiTermAttemptTdpServKey" />
                            <Optional name="tcsiTermAttemptTdpScpIsdn" />
                            <Optional name="tcsiTermAttemptTdpDfltCalH" />
                            <Optional name="terminBscCritList" />
                            <Optional name="terminBsgCritList" />
                            <Optional name="tcsiTBusyTdpServKey" />
                            <Optional name="tcsiTBusyTdpScpIsdn" />
                            <Optional name="tcsiTBusyTdpDfltCalH" />
                            <Optional name="tbusyTdpCauseValueCritList" />
                            <Optional name="tcsiTNoAnswTdpServKey" />
                            <Optional name="tcsiTNoAnswTdpScpIsdn" />
                            <Optional name="tcsiTNoAnswTdpDfltCalH" />
                            <Optional name="tnoAnswTdpCauseValueCritList" />
                            <Optional name="homeTickKey" />
                            <Optional name="roamTickKey" />
<!--***M_CSI parameters***-->
                            <Optional name="McsiServiceProfile" />
                            <Optional name="mobilityTriggers" />
                            <Optional name="mcsiServKey" />
                            <Optional name="mcsiScpIsdn" />
                            <Optional name="mcsiCamelSubState" />
                            <Optional name="mcsiCamelVlrNotSuppDfltHdl" />
<!--***SS_CSI parameters***-->
                            <Optional name="SscsiServiceProfile" />
                            <Optional name="sscsiScpIsdn" />
                            <Optional name="sscsiCheckSSindicator" />
                            <Optional name="sscsiCamelSubState" />
                            <Optional name="sscsiCamelVlrNotSuppDfltHdl" />
<!--***U_CSI parameters***-->
                            <Optional name="UcsiServiceProfile" />
                            <Optional name="ucsiCamelServiceList" />
<!--***SMO_CSI parameters***-->
                            <Optional name="SmocsiServiceProfile" />
                            <Optional name="smocsiCamelSubState" />
                            <Optional name="smocsiCamelCapabilityHandling" />
                            <Optional name="smocsiCamelNotSuppDfltHdl" />
                            <Optional name="smocsiCollectedInfoTdpServKey" />
                            <Optional name="smocsiCollectedInfoTdpScpIsdn" />
                            <Optional name="smocsiCollectedInfoTdpDfltCalH" />
<!-- begin 70186guowei -->
<!--***SMT_CSI parameters*** -->
                            <Optional name="SmtcsiServiceProfile" />
                            <Optional name="smtcsiCamelSubState" />
                            <Optional name="smtcsiCamelCapabilityHandling" />
                            <Optional name="smtcsiCamelNotSuppDfltHdl" />
                            <Optional name="smtcsiDeliveryReqTdpServKey" />
                            <Optional name="smtcsiDeliveryReqTdpScpIsdn" />
                            <Optional name="smtcsiDeliveryReqTdpDfltSmsHdl" />
                            <Optional name="smtcsiTpduSmsDelivCrit" />
                            <Optional name="smtcsiTpduSmsStatusRepCrit" />
<!-- begin 70186guowei -->
<!--***GPRS_CSI parameters***-->
                            <Optional name="GprscsiServiceProfile" />
                            <Optional name="gprscsiCamelSubState" />
                            <Optional name="gprscsiCamelCapabilityHandling" />
                            <Optional name="gprscsiCamelSgsnNotSuppDfltHdl" />
                            <Optional name="camelMarkInhibitionRoamersPs" />
                            <Optional name="gprscsiPdpConChgPosTdpServKey" />
                            <Optional name="gprscsiPdpConChgPosTdpScpIsdn" />
                            <Optional name="gprscsiPdpConChgPosTdpDfltCalH" />
                            <Optional name="gprscsiAttachProcTdpServKey" />
                            <Optional name="gprscsiAttachProcTdpScpIsdn" />
                            <Optional name="gprscsiAttachProcTdpDfltCalH" />
                            <Optional name="gprscsiChgPositionTdpServKey" />
                            <Optional name="gprscsiChgPositionTdpScpIsdn" />
                            <Optional name="gprscsiChgPositionTdpDfltCalH" />
                            <Optional name="gprscsiPdpConEstabTdpServKey" />
                            <Optional name="gprscsiPdpConEstabTdpScpIsdn" />
                            <Optional name="gprscsiPdpConEstabTdpDfltCalH" />
                            <Optional name="gprscsiPdpConEstAckTdpServKey" />
                            <Optional name="gprscsiPdpConEstAckTdpScpIsdn" />
                            <Optional name="gprscsiPdpConEstAckTdpDfltCalH" />
<!-- D_CSI parameters -->
                            <Optional name="DcsiServiceProfile" />
                            <Optional name="dcsiCamelSubState" />
                            <Optional name="dcsiCamelCapabilityHandling" />
                            <Optional name="dcsiCamelGmscNotSuppDfltHdl" />
                            <Optional name="dcsiCamelVlrNotSuppDfltHandl" />
                            <Optional name="dcsiCamelServiceList" />
<!-- VT_CSI parameters -->
                            <Optional name="VTcsiServiceProfile" />
                            <Optional name="vtcsiCamelSubState" />
                            <Optional name="vtcsiCamelCapabilityHandling" />
                            <Optional name="vtcsiCamelVlrNotSuppDfltHandl" />
<!-- Parameters relative to vtcsiTermAttemptTdp  -->
                            <Optional name="vtcsiTermAttemptTdpServKey" />
                            <Optional name="vtcsiTermAttemptTdpScpIsdn" />
                            <Optional name="vtcsiTermAttemptTdpDfltCalH" />
                            <Optional name="vterminBscCritList" />
                            <Optional name="vterminBsgCritList" />
<!--Parameters relative to vtcsiTBusyTdp   -->
                            <Optional name="vtcsiTBusyTdpServKey" />
                            <Optional name="vtcsiTBusyTdpScpIsdn" />
                            <Optional name="vtcsiTBusyTdpDfltCalH" />
                            <Optional name="vtbusyTdpCauseValueCritList" />
<!--Parameters relative to vtcsiTNoAnswTdp    -->
                            <Optional name="vtcsiTNoAnswTdpServKey" />
                            <Optional name="vtcsiTNoAnswTdpScpIsdn" />
                            <Optional name="vtcsiTNoAnswTdpDfltCalH" />
                            <Optional name="vtnoAnswTdpCauseValueCritList" />
<!-- Odb parameters ********** -->
                            <Optional name="OdbServiceProfile" />
                            <Optional name="odbOutgoingCalls" />
                            <Optional name="odbIncomingCalls" />
                            <Optional name="odbRoaming" />
                            <Optional name="odbSpecificHPLMN" />
                            <Optional name="barringForLockingReason" />
                            <Optional name="odbPremiumRateCalls" />
                            <Optional name="odbSuplServiceMngt" />
                            <Optional name="odbCfFTNRegistration" />
                            <Optional name="odbECTInvocation" />
                            <Optional name="odbECTDoublyChargeable" />
                            <Optional name="odbMultipleECT" />
                            <Optional name="odbSpecificToPs" />
<!-- begin 67390 ODB by qzg 20090403 -->
                            <Optional name="odbCustoSmsCalls" />
                            <Optional name="odbCustoPremRateCalls" />
                            <Optional name="odbRouteToSPBar" />
<!-- end 67390 20090403 -->
<!--add odb for prepay -->
                            <Optional name="odbPrepayIcBar" />
<!-- Call Barring parameters -->
                            <Optional name="CallBarringServiceProfile" />
                            <Optional name="barOutCallProv" />
                            <Optional name="barOutInterCallProv" />
                            <Optional name="barOutIntCallExceptToHplmnProv" />
                            <Optional name="barIncCallProvisioned" />
                            <Optional name="barIncCallRoamFCountryProv" />
                            <Optional name="BSGofBAOClist" />
                            <Optional name="BSGofBOIClist" />
                            <Optional name="BSGofBOICEXHClist" />
                            <Optional name="BSGofBAIClist" />
                            <Optional name="BSGofBICROAMlist" />
                            <Optional name="msCbAbility" />
                            <Optional name="callBarringPassword" />
<!-- Call Forwarding parameters -->
                            <Optional name="CallForwardingServiceProfile" />
                            <Optional name="typeOfCallForwardingList" />
                            <Optional name="msCfNoAbility" />
                            <Optional name="destinationProfile" />
                            <Optional name="cfuCallForwardingNumberList" />
                            <Optional name="cfbusyCallForwardingNumberList" />
                            <Optional name="cfnreplyCallForwardingNumberList" />
                            <Optional name="cfnreachCallForwardingNumberList" />
                            <Optional name="cfdCallForwardingNumberList" />
                            <Optional name="cfdcfbusyCallForwardingNumberList" />
                            <Optional name="cfdcfnreplyCallForwardingNumberList" />
                            <Optional name="cfdcfnreachCallForwardingNumberList" />
                            <Optional name="allCallForwardingNumberList" />
                            <Optional name="cfuNotifToFwdPartyFlag" />
                            <Optional name="cfbusyNotifToFwdPartyFlag" />
                            <Optional name="cfnreplyNotifToFwdPartyFlag" />
                            <Optional name="cfnreachNotifToFwdPartyFlag" />
                            <Optional name="allNotifToFwdPartyFlag" />
                            <Optional name="cfuNotifToCallingPartyFlag" />
                            <Optional name="cfbusyNotifToCallingPartyFlag" />
                            <Optional name="cfnreplyNotifToCallingPartFlag" />
                            <Optional name="cfnreachNotifToCallingPartFlag" />
                            <Optional name="allNotifToCallingPartyFlag" />
<!-- GCS parameters -->
                            <Optional name="GcsServiceProfile" />
                            <Optional name="colpProvisionedFlag" />
                            <Optional name="colpOverrideCategoryState" />
                            <Optional name="clipProvisionedFlag" />
                            <Optional name="clipOverrideCategoryState" />
                            <Optional name="clirProvisionedFlag" />
                            <Optional name="presentationMode" />
<!-- Begin SDMA01FAG222609 -->
                            <Optional name="cnapProvisionedFlag" />
                            <Optional name="cnapOverrideCategoryState" />
<!-- End SDMA01FAG222609 -->
                            <Optional name="callHoldProvisionedFlag" />
                            <Optional name="mptyProvisionedFlag" />
                            <Optional name="aoccProvisionedFlag" />
                            <Optional name="aociProvisionedFlag" />
                            <Optional name="callTransferProvisionedFlag" />
                            <Optional name="maliciousCallProvisionedFlag" />
                            <Optional name="colrProvisionedFlag" />
                            <Optional name="osss1ProvisionedFlag" />
                            <Optional name="osss1ActivationFlag" />
                            <Optional name="osss2ProvisionedFlag" />
                            <Optional name="osss2ActivationFlag" />
                            <Optional name="osss3ProvisionedFlag" />
                            <Optional name="osss3ActivationFlag" />
                            <Optional name="osss4ProvisionedFlag" />
                            <Optional name="osss4ActivationFlag" />
                            <Optional name="osss5ProvisionedFlag" />
                            <Optional name="osss5ActivationFlag" />
                            <Optional name="osss6ProvisionedFlag" />
                            <Optional name="osss6ActivationFlag" />
                            <Optional name="osss7ProvisionedFlag" />
                            <Optional name="osss7ActivationFlag" />
                            <Optional name="osss8ProvisionedFlag" />
                            <Optional name="osss8ActivationFlag" />
                            <Optional name="osss9ProvisionedFlag" />
                            <Optional name="osss9ActivationFlag" />
                            <Optional name="osss10ProvisionedFlag" />
                            <Optional name="osss10ActivationFlag" />
                            <Optional name="osss11ProvisionedFlag" />
                            <Optional name="osss11ActivationFlag" />
                            <Optional name="osss12ProvisionedFlag" />
                            <Optional name="osss12ActivationFlag" />
                            <Optional name="osss13ProvisionedFlag" />
                            <Optional name="osss13ActivationFlag" />
                            <Optional name="osss14ProvisionedFlag" />
                            <Optional name="osss14ActivationFlag" />
                            <Optional name="osss15ProvisionedFlag" />
                            <Optional name="osss15ActivationFlag" />
                            <Optional name="callWaitingProvisionedFlag" />
                            <Optional name="cwTSSpeechActivationFlag" />
                            <Optional name="cwTSFaxActivationFlag" />
                            <Optional name="cwBSG20ActivationFlag" />
                            <Optional name="cwBSG30ActivationFlag" />
<!-- Add for 67396 start -->
                            <Optional name="acrProvisionedFlag" />
                            <Optional name="acrActivationFlag" />
<!-- Add for 67396 end -->
<!-- CUG parameters -->
                            <Optional name="ClosedUserGroupProfile" />
                            <Optional name="cugInterlockCodeInd1" />
                            <Optional name="cugInterlockCodeInd2" />
                            <Optional name="cugInterlockCodeInd3" />
                            <Optional name="cugInterlockCodeInd4" />
                            <Optional name="cugInterlockCodeInd5" />
                            <Optional name="cugInterlockCodeInd6" />
                            <Optional name="cugInterlockCodeInd7" />
                            <Optional name="cugInterlockCodeInd8" />
                            <Optional name="cugInterlockCodeInd9" />
                            <Optional name="cugInterlockCodeInd10" />
                            <Optional name="intraCugOptionInd1" />
                            <Optional name="intraCugOptionInd2" />
                            <Optional name="intraCugOptionInd3" />
                            <Optional name="intraCugOptionInd4" />
                            <Optional name="intraCugOptionInd5" />
                            <Optional name="intraCugOptionInd6" />
                            <Optional name="intraCugOptionInd7" />
                            <Optional name="intraCugOptionInd8" />
                            <Optional name="intraCugOptionInd9" />
                            <Optional name="intraCugOptionInd10" />
                            <Optional name="AllassociatedBsgString1" />
                            <Optional name="AllassociatedBsgString2" />
                            <Optional name="AllassociatedBsgString3" />
                            <Optional name="AllassociatedBsgString4" />
                            <Optional name="AllassociatedBsgString5" />
                            <Optional name="AllassociatedBsgString6" />
                            <Optional name="AllassociatedBsgString7" />
                            <Optional name="AllassociatedBsgString8" />
                            <Optional name="AllassociatedBsgString9" />
                            <Optional name="AllassociatedBsgString10" />
                            <Optional name="prefCugIndexForSpeech" />
                            <Optional name="prefCugIndexForFax" />
                            <Optional name="prefCugIndexForBsg20" />
                            <Optional name="prefCugIndexForBsg30" />
                            <Optional name="interCugRestForSpeech" />
                            <Optional name="interCugRestForFax" />
                            <Optional name="interCugRestForBsg20" />
                            <Optional name="interCugRestForBsg30" />
<!-- LCS create parameters added by zhx ,2006-6-5 for lcs service into basic-->
<!-- Begin for feature:67403
                             Comment: Add two parameters: pai and paiControl
                             Author: Shen Xin
                             Date: 2009/3/13
                         -->
                            <Optional name="pai" />
                            <Optional name="paiControl" />
<!-- End for feature:67403-->
                            <Optional name="LcsServiceProfile" />
                            <Optional name="originatingLcs" />
                            <Optional name="terminatingLcs" />
                            <Optional name="callRelatedNotification" />
                            <Optional name="callUnrelatedNotification" />
                            <Optional name="externalClientProfileId" />
                            <Optional name="plmnClientList" />
<!--eMLPP-->
                            <Optional name="eMLPPServiceProfile" />
                            <Optional name="emlppMaxEntitledPriority" />
                            <Optional name="emlppDefaultPriority" />
<!-- Add for feature (MapScreening) Start -->
                            <Optional name="mapScreeningCategory" />
<!-- Add for feature (MapScreening) End -->
<!-- For feature 67401 Start -->
                            <Optional name="cfDestinationProfileList" />
                            <Optional name="specificCfType" />
<!-- For feature 67401 End -->
<!-- For feature 67441 Start -->
                            <Optional name="voiceMailIndex" />
                            <Optional name="SetDivertWithVM" />
<!-- For feature 67441 End -->
<!-- For feature 69834 begin -->
                            <Optional name="localMobileStationIdentity" />
                            <Optional name="vlrIsdn" />
                            <Optional name="mscIsdn" />
                            <Optional name="roamingRestrictionFlags" />
                            <Optional name="vlrUpdateFlag" />
                            <Optional name="roamingCharactsFlags" />
                            <Optional name="flagCffPlmn" />
                            <Optional name="supOfLocRegCount" />
                            <Optional name="locRegSubsPeriod" />
                            <Optional name="gsmCamelPhase" />
                            <Optional name="gsmNegocCamelPhases" />
                            <Optional name="odbUnsuppFeaturesFlags" />
                            <Optional name="vlrBasServUnsuppFeaturesFlags" />
                            <Optional name="vlrGenUnsuppFeaturesFlags" />
                            <Optional name="inducedCbocBsg" />
                            <Optional name="inducedCboiBsg" />
                            <Optional name="inducedCboehBsg" />
                            <Optional name="vlrLastGlobalUpdateTime" />
                            <Optional name="currentMapScreeningProfile" />
                            <Optional name="inducedCbicBsg" />
                            <Optional name="inducedCbicroamBsg" />
                            <Optional name="roamingCapabilityFlags" />
                            <Optional name="sgsnUpdateFlag" />
                            <Optional name="gprsEnhancementIndicator" />
                            <Optional name="sgsnGenUnsuppFeaturesFlags" />
                            <Optional name="sgsnIsdn" />
                            <Optional name="sgsnIp" />
                            <Optional name="gprsCamelPhase" />
                            <Optional name="gprsNegocCamelPhases" />
                            <Optional name="sgsnRoamingRestriction" />
                            <Optional name="gprsNotReachableFlag" />
                            <Optional name="gprsNotReachableReason" />
                            <Optional name="sgsnLastGlobalUpdateTime" />
                            <Optional name="smscIsdn" />
                            <Optional name="gsmNotReachableSMSFlag" />
                            <Optional name="gsmNotReachableReason" />
                            <Optional name="memoryCapacityExceededFlag" />
                            <Optional name="timeStampWaitingSms" />
                            <Optional name="voiceMailOrigin" />
<!-- 73282-05,62 begin-->
                            <Optional name="scAddress4IPSM" />
                            <Optional name="IPSMGWRegisterAddress" />
<!-- 73282-05,62 end-->
                            <Optional name="smscIsdnForExtMWD" />
                            <Optional name="timeStampWaitingSmsForExtMWD" />
                            <Optional name="voiceMailOriginForExtMWD" />
                            <Optional name="addSource" />
                            <Optional name="addRecache" />
                            <Optional name="addCsCurrent" />
                            <Optional name="addPsCurrent" />
                            <Optional name="addImeiSv" />
<!--69915 begin-->
                            <Optional name="add3gpp2Meid" />
                            <Optional name="addEpsMMECurrent" />
                            <Optional name="addEpsAAACurrent" />
<!--69915 end-->
                            <Optional name="addTimeStamp" />
                            <Optional name="cbPwdSuccErroneousAttempts" />
                            <Optional name="mmeIdentity" />
                            <Optional name="uePurgedInMme" />
                            <Optional name="mmeUpdateFlag" />
                            <Optional name="mmeLastGlobalUpdateTime" />
                            <Optional name="aaaIdentity" />
                            <Optional name="non3gppIpAccRegStatus" />
                            <Optional name="aaaUpdateFlag" />
                            <Optional name="aaaLastGlobalUpdateTime" />
<!-- For feature 69834 end -->
<!-- begin feature 69582, zeyangy, 2010-03-17 -->
                            <Optional name="msStatusInCS" />
                            <Optional name="msStatusInPS" />
<!-- end feature 69582, zeyangy, 2010-03-17 -->
<!-- Add for 70018, Shi Qin, 2010-06-18-->
                            <Optional name="urrpMmeFlag" />
                            <Optional name="visitedMmePlmnId" />
<!-- Add for 70018 End, Shi Qin, 2010-06-18-->
<!-- Add begin by fucong for 70018 on 20100729 -->
                            <Optional name="pcscfServerName" />
<!-- Add begin by nian for 72989 on 20120614 -->
                            <Optional name="SWxRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
                            <Optional name="csgContextList" />
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- begin 70186guowei -->
                            <Optional name="gsmNegocCamelPhasesExt" />
                            <Optional name="gprsNegocCamelPhasesExt" />
                            <Optional name="gsmOfferedCAMEL4CSIs" />
                            <Optional name="gprsOfferedCAMEL4CSIs" />
                            <Optional name="inducedGsmSMSBAR" />
                            <Optional name="inducedGprsSMSBAR" />
<!-- begin 70186guowei -->
<!-- SDMA01CAG258860 begin -->
                            <Optional name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
<!-- Add begin by xiaozhxu for 68733 on 20101206 -->
                            <Optional name="notificationToCseFlag" />
                            <Optional name="cfGsmSCF1" />
                            <Optional name="cfGsmSCF2" />
                            <Optional name="cfGsmSCF3" />
                            <Optional name="cbGsmSCF1" />
                            <Optional name="cbGsmSCF2" />
                            <Optional name="cbGsmSCF3" />
                            <Optional name="odbGsmSCF1" />
                            <Optional name="odbGsmSCF2" />
                            <Optional name="odbGsmSCF3" />
                            <Optional name="csiGsmSCF1" />
                            <Optional name="csiGsmSCF2" />
                            <Optional name="csiGsmSCF3" />
<!-- Add end by xiaozhxu for 68733 on 20101206 -->
<!--add by zhao nannan for 71037 begin -->
                            <Optional name="mdtDomainIdEps" />
                            <Optional name="jobTypeEps" />
                            <Optional name="areaScopeEps" />
                            <Optional name="eutranCGIStrListEps" />
                            <Optional name="lteTAStrListEps" />
                            <Optional name="listMeasurement4LteEps" />
                            <Optional name="reportingTriggerEps" />
                            <Optional name="reportIntervalEps" />
                            <Optional name="reportAmountEps" />
                            <Optional name="eventThresholdRSRPEps" />
                            <Optional name="eventThresholdRSRQEps" />
                            <Optional name="loggingIntervalEps" />
                            <Optional name="loggingDurationEps" />
                            <Optional name="mdtDomainIdPs" />
                            <Optional name="jobTypePs" />
                            <Optional name="areaScopePs" />
                            <Optional name="eutranCGIStrListPs" />
                            <Optional name="lteTAStrListPs" />
                            <Optional name="listMeasurement4LtePs" />
                            <Optional name="reportingTriggerPs" />
                            <Optional name="reportIntervalPs" />
                            <Optional name="reportAmountPs" />
                            <Optional name="eventThresholdRSRPPs" />
                            <Optional name="eventThresholdRSRQPs" />
                            <Optional name="loggingIntervalPs" />
                            <Optional name="loggingDurationPs" />
                            <Optional name="mdtDomainIdCs" />
                            <Optional name="jobTypeCs" />
                            <Optional name="areaScopeCs" />
                            <Optional name="eutranCGIStrListCs" />
                            <Optional name="lteTAStrListCs" />
                            <Optional name="listMeasurement4LteCs" />
                            <Optional name="reportingTriggerCs" />
                            <Optional name="reportIntervalCs" />
                            <Optional name="reportAmountCs" />
                            <Optional name="eventThresholdRSRPCs" />
                            <Optional name="eventThresholdRSRQCs" />
                            <Optional name="loggingIntervalCs" />
                            <Optional name="loggingDurationCs" />
<!--add by zhao nannan for 71037 end -->
                        </ReqParameters>
<!--add for 70200-->
                        <CallBE name="getR30upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                            <Description>build DN from SuMSubscriberProfile entry</Description>
                            <Out>
                                <Parameter name="Upgradeflag" />
                            </Out>
                        </CallBE>
<!--end for 70200-->
<!--begin for dual logic by guowei in F70186-->
                        <CallBE name="getR31upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                            <Description>build DN from SuMSubscriberProfile entry</Description>
                            <Out>
                                <Parameter name="Upgradeflag31">
                                    <Ref name="Upgradeflag" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!--end for dual logic by guowei in F70186-->
<!--add begin for SDMA01FAG277891 SDMA01FAG279264-->
                        <Set name="isSubCreate">
                            <Val>true</Val>
                        </Set>
                        <CallBE entityName="PostCommitBeContext" name="modify">
                            <Description>Save epsServiceProfile</Description>
                            <In>
                                <Parameter name="epsServiceProfile" />
                                <Parameter name="mobileCountryCodeId_create">
                                    <Ref name="mobileCountryCodeId" />
                                </Parameter>
                                <Parameter name="mobileNetworkCodeId_create">
                                    <Ref name="mobileNetworkCodeId" />
                                </Parameter>
                                <Parameter name="mSubIdentificationNumberId_create">
                                    <Ref name="mSubIdentificationNumberId" />
                                </Parameter>
                                <Parameter name="isSubCreate" />
                            </In>
                            <Out />
                        </CallBE>
<!--end for SDMA01FAG277891 SDMA01FAG279264-->
<!-- add for 73118 by Weichung -->
<!--
        ****************************************************************************************
        *   Initialize twin_Imsi to be None for normal subscriber create case.
        ****************************************************************************************-->
                        <Set name="twin_Imsi">
                            <Val>None</Val>
                        </Set>
<!--
        ****************************************************************************************
        *   If subscriberType contains SHARED_SUBS OR SHARED_SUBS_SLAVE,
        *   call checkTwinImsi to process Twin-Imsi member create.
        *   Else proceed with normal subscriber create.
        ****************************************************************************************-->
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="subscriberType" />
                                    <Null />
                                </Condition>
                                <OR>
                                    <Condition operator="notNullIntersection">
                                        <Ref name="subscriberType" />
                                        <Val>SHARED_SUBS</Val>
                                    </Condition>
                                    <Condition operator="notNullIntersection">
                                        <Ref name="subscriberType" />
                                        <Val>SHARED_SUBS_SLAVE</Val>
                                    </Condition>
                                </OR>
                            </AND>
                            <Then>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkTwinImsi">
                                    <Description />
                                    <In>
                                        <Parameter name="mobileCountryCodeId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="subscriberType" />
                                        <Parameter name="twin_Imsi" />
                                        <Parameter name="MainSNwithBearerService" />
                                        <Parameter name="SNwithBearerServiceList" />
                                        <Parameter name="BearerServiceWithoutSNList" />
                                        <Parameter name="ServiceNodeNotificationList" />
                                        <Parameter name="networkAccessMode" />
                                        <Parameter name="accessRestrictionData" />
                                        <Parameter name="addService" />
                                        <Parameter name="prepay" />
                                        <Parameter name="prepayCommonGroupId" />
                                        <Parameter name="msCategory" />
                                        <Parameter name="smsRouteViaHNetwRoam" />
                                        <Parameter name="serviceProviderReference" />
                                        <Parameter name="csgContextList" />
                                        <Parameter name="epsServiceProfile" />
                                        <Parameter name="RoamingServiceProfile" />
                                        <Parameter name="CamelServiceProfile" />
                                        <Parameter name="CallBarringServiceProfile" />
                                        <Parameter name="CallForwardingServiceProfile" />
                                        <Parameter name="GcsServiceProfile" />
                                        <Parameter name="ClosedUserGroupProfile" />
                                        <Parameter name="LcsServiceProfile" />
                                        <Parameter name="eMLPPServiceProfile" />
                                        <Parameter name="OdbServiceProfile" />
                                        <Parameter name="transferOfSmOption" />
                                        <Parameter name="packetMsAddressList" />
                                        <Parameter name="chargingCharacteristics" />
                                        <Parameter name="authVisitedPlmnNIDId" />
                                        <Parameter name="stnSrData" />
                                        <Parameter name="ExtendedBearerServiceWithoutSNList" />
                                        <Parameter name="mapScreeningCategory" />
                                        <Parameter name="portoutFlag" />
                                        <Parameter name="RoamingRestrictionType" />
                                        <Parameter name="csRestrictionListNum" />
                                        <Parameter name="psRestrictionListNum" />
                                        <Parameter name="regSubscriptionListId" />
<!-- 73251 b -->
                                        <Parameter name="camelLocationRequestFlag" />
                                        <Parameter name="camelStatusRequestFlag" />
                                        <Parameter name="camelMarkActivationRoamers" />
                                        <Parameter name="camelMarkInhibitionRoamersCs" />
                                        <Parameter name="OcsiServiceProfile" />
                                        <Parameter name="ocsiCamelSubState" />
                                        <Parameter name="ocsiCamelCapabilityHandling" />
                                        <Parameter name="ocsiCamelVlrNotSuppDfltHandl" />
                                        <Parameter name="ocsiCamelGmscNotSuppDfltHdl" />
                                        <Parameter name="tifcsiTransformationInformFlag" />
                                        <Parameter name="ocsiCollectedInfoTdpServKey" />
                                        <Parameter name="ocsiCollectedInfoTdpScpIsdn" />
                                        <Parameter name="ocsiCollectedInfoTdpDfltCalH" />
                                        <Parameter name="callTypeCriteria" />
                                        <Parameter name="destinationNumberCritList" />
                                        <Parameter name="matchType" />
                                        <Parameter name="destNbLengthCriteriaList" />
                                        <Parameter name="originBscCritList" />
                                        <Parameter name="originBsgCritList" />
                                        <Parameter name="ocsiRouteSelectFailTdpServKey" />
                                        <Parameter name="ocsiRouteSelectFailTdpScpIsdn" />
                                        <Parameter name="ocsiRouteSelectFailTdpDfltCalH" />
                                        <Parameter name="routeSelectFailTdpCauVCritList" />
                                        <Parameter name="oickKey" />
<!-- just for check -->
                                        <Parameter name="notificationToCseFlag" />
                                        <Parameter name="cfGsmSCF1" />
                                        <Parameter name="cfGsmSCF2" />
                                        <Parameter name="cfGsmSCF3" />
                                        <Parameter name="cbGsmSCF1" />
                                        <Parameter name="cbGsmSCF2" />
                                        <Parameter name="cbGsmSCF3" />
                                        <Parameter name="odbGsmSCF1" />
                                        <Parameter name="odbGsmSCF2" />
                                        <Parameter name="odbGsmSCF3" />
                                        <Parameter name="csiGsmSCF1" />
                                        <Parameter name="csiGsmSCF2" />
                                        <Parameter name="csiGsmSCF3" />
<!-- 73251 e -->
                                    </In>
                                    <Out>
                                        <Parameter name="twin_Imsi" />
                                    </Out>
                                </CallBE>
                            </Then>
                        </If>
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="twin_Imsi" />
                                    <Val>None</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="twin_Imsi" />
                                    <Val>Master</Val>
                                </Condition>
                            </OR>
                            <Then>
<!-- continue normal create logic.  -->
<!-- end for 73118 by Weichung -->
<!--Feature 723320 begin, added by qiangfw, 20110529-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Remove name="MainSNwithBearerService" />
                                        <Set name="IsFirstSNwithBearerService">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="IsFindMainSNwithBearerService">
                                            <Val>false</Val>
                                        </Set>
                                        <Foreach name="SNwithBearerService">
                                            <MultiValue>
                                                <Ref name="SNwithBearerServiceList" />
                                            </MultiValue>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="IsFirstSNwithBearerService" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="IsFirstSNwithBearerService">
                                                        <Val>true</Val>
                                                    </Set>
                                                    <Remove name="newSNwithBearerServiceList" />
                                                    <Set name="newSNwithBearerServiceList">
                                                        <MultiValue>
                                                            <Ref name="newSNwithBearerServiceList" />
                                                            <Ref name="SNwithBearerService" />
                                                        </MultiValue>
                                                    </Set>
                                                </Then>
                                            </If>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                <Description />
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>SNwithBearerService</Val>
                                                    </Parameter>
                                                    <Parameter name="SNwithBearerService" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                    <Parameter name="BearerCapabilityName" />
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="BearerCapabilityName" />
                                                        <Val>GPRS</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="21">
                                                            <Frame FrameId="18250">
                                                                <StringAttributeType>
                                                                    <Val>GPRS</Val>
                                                                </StringAttributeType>
                                                                <StringAttributeType>
                                                                    <Val>Bearer Service</Val>
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                </Condition>
                                                <Then>
                                                    <Set name="IsGPRSonly">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                            </If>
                                            <If>
                                                <OR>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="IsGPRSonly" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>TELEPHON</Val>
                                                        </Condition>
                                                        <OR>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Val>BOTH</Val>
                                                            </Condition>
                                                        </OR>
                                                    </AND>
                                                </OR>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MainSNwithBearerServiceElement</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                            </Parameter>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                            <Parameter name="BearerCapabilityName" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MainSNwithBearerServiceElement" />
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="MainSNwithBearerService">
                                                        <MultiValue>
                                                            <Ref name="MainSNwithBearerService" />
                                                            <Ref name="MainSNwithBearerServiceElement" />
                                                        </MultiValue>
                                                    </Set>
                                                    <Remove name="SNwithBearerServiceList">
                                                        <Ref name="SNwithBearerService" />
                                                    </Remove>
                                                    <Set name="IsFindMainSNwithBearerService">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                            </If>
                                        </Foreach>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="IsGPRSonly" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="IsFindMainSNwithBearerService" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="21">
                                                        <Frame FrameId="12138" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="IsFirstSNwithBearerService" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="IsFindMainSNwithBearerService" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="MainSNwithBearerService">
                                                    <MultiValue>
                                                        <Ref name="MainSNwithBearerService" />
                                                        <Ref name="newSNwithBearerServiceList" />
                                                    </MultiValue>
                                                </Set>
                                                <Remove name="SNwithBearerServiceList">
                                                    <Ref name="newSNwithBearerServiceList" />
                                                </Remove>
                                                <Remove name="newSNwithBearerServiceList" />
                                                <Set name="IsFirstSNwithBearerService">
                                                    <Val>false</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!--Feature 723320 end, added by qiangfw, 20110529-->
<!-- Start of F67405 MVNO update, by Qi 2009/04/15 -->
<!-- If the operator is not authorized to access the IMSI, throw an exception -->
                                <If>
<!--Begin add for feature 66935, wangying-->
                                    <OR>
<!--End add for feature 66935, wangying-->
                                        <Condition operator="eq">
                                            <Ref name="fMVN001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
<!--Begin add for feature 66935, wangying-->
                                        <Condition operator="eq">
                                            <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
<!--End add for feature 66935, wangying-->
                                    <Then>
                                        <Set name="gsmExist">
                                            <Ref name="__EXIST_ENTRY" DN="__DISTINGUISH_NAME" />
                                        </Set>
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_IMSI" name="verifyMVNOAuth">
                                            <Description />
                                            <In>
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="isChangeIMSI">
                                                    <Val>false</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="__MVNO_INDEX" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="gsmExist" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
<!--begin SDMA01FAG261706-->
                                                <Set name="subscriptionMvnoIndex">
                                                    <Ref name="subscriptionMvnoIndex" entityName="gdmiContext" DN="__DISTINGUISH_NAME" />
                                                </Set>
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="subscriptionMvnoIndex" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="subscriptionMvnoIndex">
                                                            <Val>1</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!--end SDMA01FAG261706-->
                                                <If>
                                                    <Condition operator="neq">
<!--begin SDMA01FAG261706-->
                                                        <Ref name="subscriptionMvnoIndex" />
<!--end SDMA01FAG261706-->
                                                        <Ref name="__MVNO_INDEX" />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>Build IMSI</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="associatedIMSI">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <ThrowException>
                                                            <Error ErrorId="23">
                                                                <Frame FrameId="33004">
                                                                    <StringAttributeType>
                                                                        <Ref name="associatedIMSI" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!--check the new IMSI and the gsm subscription belong to same plmn -->
<!-- 2009-07-01 SDMA01FAG237252 -->
<!-- set __MVNO_INDEX for GOAM -->
                                        <CallBE entityName="HSS.SUB.*.BeMvnoProfile" name="setMVNOIndex">
                                            <In>
                                                <Parameter name="__MVNO_INDEX" />
                                            </In>
                                            <Out />
                                        </CallBE>
<!-- 2009-07-01 SDMA01FAG237252 End-->
                                        <Set name="subscriptionMvnoIndex">
                                            <Ref name="__MVNO_INDEX" />
                                        </Set>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="subscriptionMvnoIndex" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="subscriptionMvnoIndex">
                                                    <Null />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                    <Else>
                                        <Set name="subscriptionMvnoIndex">
                                            <Null />
                                        </Set>
                                    </Else>
                                </If>
<!-- End of F67405 MVNO update, by Qi 2009/04/15 -->
<!-- SDMA01CAG258860 begin -->
                                <If>
                                    <AND>
                                        <Condition operator="neq">
                                            <Ref name="fNPO101" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="portoutFlag" />
                                            <Null />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="portoutFlag" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="32">
                                                        <Frame FrameId="10134">
                                                            <StringAttributeType>
                                                                <Val>portoutFlag</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>fNPO101</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                            <Else>
                                                <Remove name="portoutFlag" />
                                            </Else>
                                        </If>
                                    </Then>
                                </If>
<!--
        <If>
            <Condition operator="eq">
            <Ref name="portoutFlag" />
            <Val>true</Val>
            </Condition>
            <Then>
            <Set name="appListActivateTracingMsisdn">
                <MultiValue>
                <Ref name="appListActivateTracingMsisdn" />
                <Val>subPortOut</Val>
                </MultiValue>
            </Set>
            </Then>
        </If>
        -->
<!-- SDMA01CAG258860 end -->
                                <Set name="requestName">
                                    <Ref name="__CALLED_METHOD_NAME" />
                                </Set>
<!--Begin add with feature 66935, wangying-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeMultiCountry" name="getCountryIndexByMCC">
                                            <Description>get countryCodeId by MCC</Description>
                                            <In>
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out>
                                                <Parameter name="countryIndex" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="countryIndex" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="33045">
                                                            <StringAttributeType>
                                                                <Ref name="mobileCountryCodeId" />
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                        <CallBE entityName="HSS.SUB.*.BeMvnoProfile" name="setCountryIndex">
                                            <Description>set countryCode index</Description>
                                            <In>
                                                <Parameter name="countryIndex" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeMultiCountry" name="getHostedCCByMCC">
                                            <Description>get host CC by MCC</Description>
                                            <In>
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out>
                                                <Parameter name="hostedCC" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeMultiCountry" name="getDummyCCByMCC">
                                                    <Description>get per country dummyCC by MCC</Description>
                                                    <In>
                                                        <Parameter name="mobileCountryCodeId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="countryDummyCC" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>Shared_M2M</Val>
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="fSA113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="203">
                                                    <StringAttributeType>
                                                        <Val>subscriberType</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>Shared_M2M</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>when fSA113 is not active</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSA113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="__EXIST_ENTRY" DN="__DISTINGUISH_NAME" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="subscriberType" entityName="gdmiContext" DN="__DISTINGUISH_NAME" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="m2mHandle">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                        <Set name="numberOfSet">
                                            <Ref name="subscriberType" defaultValue="occurs" />
                                        </Set>
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="subscriberType" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                                <Condition operator="greater">
                                                    <Ref name="numberOfSet" />
                                                    <Val>1</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="12129" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BeMultiCountry" name="getRightDummyCC">
                                    <In>
                                        <Parameter name="countryDummyCC" />
                                    </In>
                                    <Out>
                                        <Parameter name="realDummyCC" />
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="m2mHandle" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.BeM2MSub" name="create">
                                            <Description />
                                            <In>
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="MainSNwithBearerService" />
                                                <Parameter name="realDummyCC" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                    <Else>
<!--End add for feature 66935, wangying-->
<!-- add for feature 67393 Start -->
<!-- for 70719 Start -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fSS110" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractAuc" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="subscriberType">
                                                    <Ref name="subscriberType" defaultValue="ifNoValue" />
                                                </Set>
                                            </Then>
                                        </If>
<!-- for 70719 End -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fSS110" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractAuc" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="subscriberType" />
                                                    <Val>FMC</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="32">
                                                        <Frame FrameId="14006">
                                                            <StringAttributeType>
                                                                <Val>FMC</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>fSS110</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- add for feature 67393 End -->
<!--begin SDMA01FAG234830 BPQ, 2009/04/24-->
<!--isMultiAppSupported inactive, subscriber cannot have both GSM and IMS profile -->
<!--begin with SDMA01FAG262129, handle dummyCC first, then handle subscriberId=default, build the new interface DN. -->
<!--Begin SDMA01FAG222615 -->
                                        <Foreach name="MainSNwithBearerServiceElement">
                                            <MultiValue>
                                                <Ref name="MainSNwithBearerService" />
                                            </MultiValue>
<!-- 
        ***************************************************************************************
        *   1.6.1  extract countryCodeId, nationalDestinationCodeId, subscriberNumberId and BearerCapabilityName 
        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                <Description />
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>MainSNwithBearerServiceElement</Val>
                                                    </Parameter>
                                                    <Parameter name="MainSNwithBearerServiceElement" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                    <Parameter name="BearerCapabilityName" />
                                                </Out>
                                            </CallBE>
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!--
            If fPs100=true and NAM=namPsKey and mainMSISDN can be optional
            CC=dummyCC,NDC=MNC,SN=MSIN
            -->
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="countryCodeId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="nationalDestinationCodeId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="subscriberNumberId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setGreater">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                        <Null />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="countryCodeId">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                    </Set>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Ref name="mobileNetworkCodeId" />
                                                    </Set>
                                                    <Set name="subscriberNumberId">
                                                        <Ref name="mSubIdentificationNumberId" />
                                                    </Set>
                                                </Then>
                                            </If>
<!--
            If fPs100=true and NAM=BOTH or namCsKey, mainMSISDN cann't be dummy MSISDN
            countryCodeId cann't be equal to dummyCC
            -->
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <OR>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                        </Condition>
                                                    </OR>
                                                </AND>
                                                <Then>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="countryCodeId" />
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                            <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="32">
                                                                    <Frame FrameId="12127">
                                                                        <StringAttributeType>
                                                                            <Val>countryCodeId</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Ref name="countryCodeId" />
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>networkAccessMode</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Ref name="networkAccessMode" />
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>fPs100</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!-- modify for feature 69004 end -->
<!--Begin add for feature 66935, wangying-->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <OR>
                                                            <Condition operator="eq">
                                                                <Ref name="countryCodeId" />
                                                                <Ref name="hostedCC" />
                                                            </Condition>
                                                            <AND>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="realDummyCC" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="countryCodeId" />
                                                                    <Ref name="realDummyCC" />
                                                                </Condition>
                                                            </AND>
                                                        </OR>
                                                        <Then />
                                                        <Else>
                                                            <ThrowException>
                                                                <Error ErrorId="31">
                                                                    <Frame FrameId="12128" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Else>
                                                    </If>
                                                </Then>
                                            </If>
<!--End add for feature 66935, wangying-->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="nationalDestinationCodeId" />
                                                    <NotExist />
                                                </Condition>
                                                <Then>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Val />
                                                    </Set>
                                                </Then>
                                            </If>
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!--
            If fPs100 is true and countryCodeId is equal to dummyCC, check whether the entry already exist.
            If exist, throw a new exception: dummy MSISDN already exist 
            -->
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="countryCodeId" />
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                    </Condition>
                                                    <Condition operator="setGreater">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                        <Null />
                                                    </Condition>
                                                </AND>
                                                <Then>
<!-- build nowMainMSISDN by countryCodeId, nationalDestinationCodeId, subscriberNumberId -->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                        <In>
                                                            <Parameter name="subscriberNumberId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>SubscriberNumber_DN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="nowMainMsisdn">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!-- check whether this newMainMSISDN already exist -->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="nowMainMsisdn" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="32">
                                                                    <Frame FrameId="12126">
                                                                        <StringAttributeType>
                                                                            <Ref name="nowMainMsisdn" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!-- modify for feature 69004 end -->
                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkMSISDN">
                                                <Description />
                                                <In>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out />
                                            </CallBE>
<!--SDMA01FAG228582  begin-->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>Build Msisdn</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>SubscriberNumber_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_TEMP_check">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <Set name="DN_MSISDNList_check">
                                                <MultiValue>
                                                    <Ref name="DN_MSISDNList_check" />
                                                    <Ref name="DN_TEMP_check" />
                                                </MultiValue>
                                            </Set>
<!--SDMA01FAG228582  end-->
                                            <Break />
                                        </Foreach>
<!-- End SDMA01FAG222615 -->
<!-- 
        ***************************************************************************************
        1.3 Check SuMSubscriberProfileId, extract SuMSubscriberProfileId from input DN                      *   1.3   get default SuMSubscriberProfileId 
        *************************************************************************************** -->
<!--begin SDMA01FAG220584 sining wang 2008/09/11-->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId</Description>
                                            <In />
                                            <Out>
                                                <Parameter name="suMSubscriberProfileId" />
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeDataChecker" name="checkSpace">
                                            <Description />
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>suMSubscriberProfileId</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>false</Val>
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="12001">
                                                        <Frame FrameId="12030">
                                                            <StringAttributeType>
                                                                <Ref name="suMSubscriberProfileId" />
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--end SDMA01FAG220584 sining wang 2008/09/11-->
<!-- Begin Feature 66999 -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="suMSubscriberProfileId" />
                                                <Val>default</Val>
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="defaultSubscriberProfRule" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                        <Val>PROVIDED</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="21">
                                                                <Frame FrameId="12025" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                    <Else>
                                                        <Set name="MappingIncrement">
                                                            <Val>1</Val>
                                                        </Set>
                                                        <Set name="MappingOperation">
                                                            <Val>-</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                            <Description>Incrementation of 1 of MSISDN counter</Description>
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>MappingIncrement</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>rankForSuMSubscriptionProfileId</Val>
                                                                </Parameter>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>MappingOperation</Val>
                                                                </Parameter>
                                                                <Parameter name="rankForSuMSubscriptionProfileId">
                                                                    <Ref name="rankForDefaultRDN" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                </Parameter>
                                                                <Parameter name="MappingIncrement" />
                                                                <Parameter name="MappingOperation" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="rankForSuMSubscriptionProfileId" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="defaultSubscriberProfRule" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                <Val>FROM_IMSI</Val>
                                                            </Condition>
                                                            <Then>
<!--  build strToExtractForSuMSubscriberProfileId = MCC+MNC+MSIN -->
                                                                <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                                    <In>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="joinParameters">
                                                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId" />
                                                                        <Parameter name="mobileNetworkCodeId" />
                                                                        <Parameter name="mSubIdentificationNumberId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                    </Out>
                                                                </CallBE>
<!--Get the length of strToExtractForSuMSubscriberProfileId-->
                                                                <CallBE entityName="HSS.SUB.*.BeStrOperation" name="length">
                                                                    <Description>- get the lenth of strToExtractForSuMSubscriberProfileId</Description>
                                                                    <In>
                                                                        <Parameter name="__SOURCE_NAME">
                                                                            <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>lengthStr</Val>
                                                                        </Parameter>
                                                                        <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="lengthStr" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="less">
                                                                        <Ref name="lengthStr" />
                                                                        <Ref name="rankForSuMSubscriptionProfileId" />
                                                                    </Condition>
                                                                    <Then>
                                                                        <ThrowException>
                                                                            <Error ErrorId="21">
<!-- SDMA01FAG249967  begin -->
                                                                                <Frame FrameId="10132">
                                                                                    <StringAttributeType>
                                                                                        <Val>SuMSubscriberProfileId</Val>
<!-- Modified by Guangli for SDMA01FAG256071 on 20100611 -->
                                                                                    </StringAttributeType>
                                                                                    <StringAttributeType>
                                                                                        <Val>6</Val>
                                                                                    </StringAttributeType>
                                                                                    <StringAttributeType>
                                                                                        <Val>16</Val>
                                                                                    </StringAttributeType>
                                                                                </Frame>
<!--end SDMA01FAG249967 end-->
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Then>
                                                                </If>
<!--Check the length of newSubscriberProfileId which will be builded-->
                                                                <Set name="MappingIncrement">
                                                                    <Ref name="rankForSuMSubscriptionProfileId" />
                                                                </Set>
                                                                <Set name="MappingOperation">
                                                                    <Val>-</Val>
                                                                </Set>
                                                                <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                                    <Description>lengthStr - rankForSuMSubscriptionProfileId</Description>
                                                                    <In>
                                                                        <Parameter name="__SOURCE_NAME">
                                                                            <Val>MappingIncrement</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>lengthStr</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__SYNTAX">
                                                                            <Val>MappingOperation</Val>
                                                                        </Parameter>
                                                                        <Parameter name="MappingIncrement" />
                                                                        <Parameter name="lengthStr" />
                                                                        <Parameter name="MappingOperation" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="lengthStr" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="greater">
                                                                            <Ref name="lengthStr" />
                                                                            <Val>16</Val>
                                                                        </Condition>
                                                                        <Condition operator="less">
                                                                            <Ref name="lengthStr" />
                                                                            <Val>6</Val>
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <ThrowException>
                                                                            <Error ErrorId="21">
<!-- SDMA01FAG249967  begin -->
                                                                                <Frame FrameId="10132">
                                                                                    <StringAttributeType>
                                                                                        <Val>SuMSubscriberProfileId</Val>
<!-- Modified by Guangli for SDMA01FAG256071 on 20100611 -->
                                                                                    </StringAttributeType>
                                                                                    <StringAttributeType>
                                                                                        <Val>6</Val>
                                                                                    </StringAttributeType>
                                                                                    <StringAttributeType>
                                                                                        <Val>16</Val>
                                                                                    </StringAttributeType>
                                                                                </Frame>
<!--end SDMA01FAG249967 end-->
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Then>
                                                                </If>
<!-- get substring "newSuMSubscriberProfileId" in strNewImsi with contract data "rankForDefaultRDN" -->
                                                                <CallBE entityName="HSS.SUB.*.BeStrOperation" name="substr">
                                                                    <In>
                                                                        <Parameter name="__SOURCE_NAME">
                                                                            <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                        <Parameter name="posStr">
                                                                            <Ref name="rankForSuMSubscriptionProfileId" />
                                                                        </Parameter>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>newSuMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="newSuMSubscriberProfileId" />
                                                                    </Out>
                                                                </CallBE>
<!-- modify __DISTINGUISH_NAME with "newSuMSubscriberProfileId" -->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="modify">
                                                                    <In>
                                                                        <Parameter name="suMSubscriberProfileId">
                                                                            <Ref name="newSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="__DISTINGUISH_NAME" />
                                                                    </Out>
                                                                </CallBE>
                                                                <Set name="suMSubscriberProfileId">
                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="defaultSubscriberProfRule" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                        <Val>FROM_MSISDN</Val>
                                                                    </Condition>
                                                                    <Then>
<!--  build strToExtractForSuMSubscriberProfileId = CC+NDC+SN -->
                                                                        <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                                            <In>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="joinParameters">
                                                                                    <Val>countryCodeId,nationalDestinationCodeId,subscriberNumberId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="subscriberNumberId" />
                                                                                <Parameter name="nationalDestinationCodeId" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                            </Out>
                                                                        </CallBE>
<!--Get the length of strToExtractForSuMSubscriberProfileId-->
                                                                        <CallBE entityName="HSS.SUB.*.BeStrOperation" name="length">
                                                                            <Description>- get the lenth of strToExtractForSuMSubscriberProfileId</Description>
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>lengthStr</Val>
                                                                                </Parameter>
                                                                                <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="lengthStr" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="less">
                                                                                <Ref name="lengthStr" />
                                                                                <Ref name="rankForSuMSubscriptionProfileId" />
                                                                            </Condition>
                                                                            <Then>
                                                                                <ThrowException>
                                                                                    <Error ErrorId="21">
<!-- SDMA01FAG249967  begin -->
                                                                                        <Frame FrameId="10132">
                                                                                            <StringAttributeType>
                                                                                                <Val>SuMSubscriberProfileId</Val>
<!-- Modified by Guangli for SDMA01FAG256071 on 20100611 -->
                                                                                            </StringAttributeType>
                                                                                            <StringAttributeType>
                                                                                                <Val>6</Val>
                                                                                            </StringAttributeType>
                                                                                            <StringAttributeType>
                                                                                                <Val>16</Val>
                                                                                            </StringAttributeType>
                                                                                        </Frame>
<!--end SDMA01FAG249967 end-->
                                                                                    </Error>
                                                                                </ThrowException>
                                                                            </Then>
                                                                        </If>
<!--Check the length of newSubscriberProfileId which will be builded-->
                                                                        <Set name="MappingIncrement">
                                                                            <Ref name="rankForSuMSubscriptionProfileId" />
                                                                        </Set>
                                                                        <Set name="MappingOperation">
                                                                            <Val>-</Val>
                                                                        </Set>
                                                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                                            <Description>lengthStr - rankForSuMSubscriptionProfileId</Description>
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>MappingIncrement</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>lengthStr</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__SYNTAX">
                                                                                    <Val>MappingOperation</Val>
                                                                                </Parameter>
                                                                                <Parameter name="MappingIncrement" />
                                                                                <Parameter name="lengthStr" />
                                                                                <Parameter name="MappingOperation" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="lengthStr" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <OR>
                                                                                <Condition operator="greater">
                                                                                    <Ref name="lengthStr" />
                                                                                    <Val>16</Val>
                                                                                </Condition>
                                                                                <Condition operator="less">
                                                                                    <Ref name="lengthStr" />
                                                                                    <Val>6</Val>
                                                                                </Condition>
                                                                            </OR>
                                                                            <Then>
                                                                                <ThrowException>
                                                                                    <Error ErrorId="21">
<!-- SDMA01FAG249967  begin -->
                                                                                        <Frame FrameId="10132">
                                                                                            <StringAttributeType>
                                                                                                <Val>SuMSubscriberProfileId</Val>
<!-- Modified by Guangli for SDMA01FAG256071 on 20100611 -->
                                                                                            </StringAttributeType>
                                                                                            <StringAttributeType>
                                                                                                <Val>6</Val>
                                                                                            </StringAttributeType>
                                                                                            <StringAttributeType>
                                                                                                <Val>16</Val>
                                                                                            </StringAttributeType>
                                                                                        </Frame>
<!--end SDMA01FAG249967 end-->
                                                                                    </Error>
                                                                                </ThrowException>
                                                                            </Then>
                                                                        </If>
<!-- get substring "newSuMSubscriberProfileId" in strNewImsi with contract data "rankForDefaultRDN" -->
                                                                        <CallBE entityName="HSS.SUB.*.BeStrOperation" name="substr">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>strToExtractForSuMSubscriberProfileId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="strToExtractForSuMSubscriberProfileId" />
                                                                                <Parameter name="posStr">
                                                                                    <Ref name="rankForSuMSubscriptionProfileId" />
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>newSuMSubscriberProfileId</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="newSuMSubscriberProfileId" />
                                                                            </Out>
                                                                        </CallBE>
<!-- modify __DISTINGUISH_NAME with "newSuMSubscriberProfileId" -->
                                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="modify">
                                                                            <In>
                                                                                <Parameter name="suMSubscriberProfileId">
                                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="__DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <Set name="suMSubscriberProfileId">
                                                                            <Ref name="newSuMSubscriberProfileId" />
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- End Feature 66999 -->
                                        <Set name="DN_BasicSubscription">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Set>
<!-- Begin for 72874, subscriberType=Shared_PROFILE, by Austin 2012-6-11  -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fSAApp" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                                <Val>0</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE name="subscriberTypeConstr4fSAAppOff" entityName="HSS.SUB.*.BeSaGpConstr">
                                                    <Description>When fSAApp is disabled, it is not allowed to provision Shared_PROFILE, or Shared_PROFILE plus other subscriberTypes.</Description>
                                                    <In>
                                                        <Parameter name="subscriberType" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fSAApp" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE name="subscriberTypeConstraint" entityName="HSS.SUB.*.BeSaGpConstr">
                                                    <Description>When fSAApp is enabled and Shared_PROFILE is provisioned, it is not allowed to provision other subscriberTypes at the same time.</Description>
                                                    <In>
                                                        <Parameter name="subscriberType" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                                <CallBE name="query" entityName="HSS.SUB.*.DnHandler">
                                                    <Description>- query GsmServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>suMSubscriberProfileId</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build IMS DN by suMSubscriberProfileId</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>ImsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                        <Parameter name="imsServiceProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_ImsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ImsServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="subscriberType" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="subscriberType" />
                                                            <Val>Shared_PROFILE</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <CallBE name="basicSubscriptionCreateConstraint" entityName="HSS.SUB.*.BeSaGpConstr">
                                                            <Description>call basicSubscriptionCreateConstraint to check the IMSServiceProfile for the same suMSubscriptionProfile exist</Description>
                                                            <In>
                                                                <Parameter name="DN_BasicSubscription" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- End for 72874, subscriberType=Shared_PROFILE, by Austin 2012-6-11  -->
<!--end with SDMA01FAG262129-->
<!--begin SDMA01FAG227273 peijuand du 2008/12/12 -->
<!--SDMA01FAG228582 removed into BePreQuery.CheckEntryExistence-->
                                        <Set name="DN_GsmserviceProfile_check">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Set>
<!--end SDMA01FAG227273-->
<!-- SDMA01FAG261076: move this part to the top, begin, zeyangy-->
<!-- test the existence of SuMSubscriberProfile entry -->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <Description>build SuMSubscriberProfile DN via suMSubscriberProfileId</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>SuMSubscriberProfile_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_SuMSubscriberProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <Description>test the existence of DN_SuMSubscriberProfile entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry_SuMSubscriber">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!--  70719, zeyangy, 2010-08-23, begin-->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry_SuMSubscriber" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="getNRGKey">
                                                    <Description>get the NRG key where the DN_SuMSubscriberProfile located</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_SuMSubscriberProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="SuMSubscriberProfile_NRGKey">
                                                            <Ref name="__NRG_KEY" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                            <Else>
                                                <CallBE name="getR21upgradeflag" entityName="HSS.SUB.*.BeUpgradeFlag">
                                                    <Description>get getR21upgradeflag</Description>
                                                    <Out>
                                                        <Parameter name="Upgradeflag2" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <OR>
                                                        <Condition operator="eq">
                                                            <Ref name="Upgradeflag2" />
                                                            <Val>Old</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="Upgradeflag2" />
                                                            <Val>Converting</Val>
                                                        </Condition>
                                                    </OR>
                                                    <Then>
                                                        <CallBE name="getSubscriptionNrg" entityName="HSS.SUB.Subscription.BasicUpgrade_R31">
                                                            <In>
                                                                <Parameter name="DN_SuMSubscriberProfile" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="targetNrg" />
                                                                <Parameter name="subFound" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="subFound" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="SuMSubscriberProfile_NRGKey">
                                                                    <Ref name="targetNrg" />
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
<!-- 70719, zeyangy, 2010-08-23, end -->
<!-- SDMA01FAG261076: move this part to the top, end, zeyangy-->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isMultiAppSupported" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" />
                                                <Val>false</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build IMS DN by suMSubscriberProfileId</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>ImsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                        <Parameter name="imsServiceProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_ImsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ImsServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="24">
                                                                <Frame FrameId="12056" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!--end SDMA01FAG234830 BPQ, 2009/04/24-->
<!--begin SDMA01FAG220643-->
                                        <Set name="IsSMSMTProvided">
                                            <Val>false</Val>
                                        </Set>
<!--end SDMA01FAG220643-->
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <Description>Save RequestName</Description>
                                            <In>
                                                <Parameter name="SubProfileLoad_Done">
                                                    <Val>true</Val>
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                        <Set name="maxPdpContextPerMsValue">
                                            <Ref name="maxPdpContextPerMs" entityName="HSS.SystemData.SystemData.Sys_OAM_SysGprs" />
                                        </Set>
<!--only if contract data fCF025 is true, suMSubscriptionProfileId can equal to 2~15-->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <Description>Test tao extract fields from input DN BasicSubscription : SuMSubscriberProfileId,suMSubscriptionProfileId</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME" />
                                            </In>
                                            <Out>
<!--Description>         suMSubscriberProfileId,suMSubscriptionProfileId valorized        </Description-->
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </Out>
                                        </CallBE>
<!-- Add for feature 67807, register null entry -->
                                        <CallBE entityName="HSS.SUB.*.BeRegisterNullEntry" name="AddNullEntry">
                                            <Description>test tao Register null entry</Description>
                                            <In>
                                                <Parameter name="DN_GsmserviceProfile_check" />
                                                <Parameter name="maxPdpContextPerMsValue" />
<!-- ZTX | 2009-08-31 | Add for maxApnContextPerMsValue -->
                                                <Parameter name="maxEpsContextPerMsValue">
                                                    <Ref name="maxEpsContextPerMs" entityName="HSS.SystemData.SystemData.Sys_OAM_SysEps" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!-- End for feature 67807 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fSA025" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>1</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12018">
                                                            <StringAttributeType>
                                                                <Val>fSA025</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <Description>Save RequestName</Description>
                                            <In>
                                                <Parameter name="requestName" />
                                            </In>
                                            <Out />
                                        </CallBE>
<!--NGHLR1FAG195601  set default value for networkAccessMode should be before control on networkAccessMode -->
<!-- 
        ***************************************************************************************
        *   1.1.1   set networkAccessMode to defaultvalue (noGPRS) 
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="networkAccessMode" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="networkAccessMode">
                                                    <Ref name="networkAccessMode" defaultValue="force" />
                                                </Set>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.1.2   control on networkAccessMode(allowed if F_GPRS_001 true) 
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="fGprs001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGprs" />
                                                    <Val>1</Val>
                                                </Condition>
<!-- NGHLR1FAG189593 begin -->
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
<!--Val>GPRSonly</Val-->
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </OR>
<!-- NGHLR1FAG189593 end -->
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>NetworkAccessMode</Val>
                                                            </StringAttributeType>
                                                        </Frame>
<!-- NGHLR1FAG189593 begin -->
                                                        <Frame FrameId="10067">
<!-- NGHLR1FAG189593 end -->
                                                            <StringAttributeType>
                                                                <Val>fGprs001</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- control on accessRestrictionData(allowed if F_SA_018 true) for R2.3 -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="accessRestrictionData" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>accessRestrictionData</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fSA018</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- control on non3gppAccessRestrictionData(allowed if F_SA_018 true) for R2.3 -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="non3gppAccessRestrictionData" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>non3gppAccessRestrictionData</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fSA018</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--Feature 67386:Attribute :addService not allowed,Functional option:fADD001 is not active.   -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="fADD001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
<!--<Condition operator="neq">
                <Ref name="addService"/>
                <NotExist/>
            </Condition>  -->
                                                <Condition operator="eq">
                                                    <Ref name="addService" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>addService</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fADD001</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.2   valorize local data GPRSsub to know if GPRS subscription 
        *************************************************************************************** -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Val>BOTH</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
<!--Val>GPRSonly</Val-->
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <Set name="GPRSsub">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
<!--add for NGHLR1CAG194779 -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
<!--Val>noGPRS</Val-->
                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                            </Condition>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <MultiValue>
                                                        <Val>transferOfSmOption</Val>
                                                        <Val>packetMsAddressList</Val>
                                                        <Val>chargingCharacteristics</Val>
<!--fix CR SDMA01CAG248408 begin, BPQ, 20100322 -->
                                                        <Val>stnSrData</Val>
<!--fix CR SDMA01CAG248408 end, BPQ, 20100322 -->
<!-- Add begin by Guangli for 69915 on 20100201-->
                                                        <Val>authVisitedPlmnNIDId</Val>
<!-- Add end by Guangli for 69915 on 20100201-->
                                                    </MultiValue>
                                                </TestAttribute>
<!-- ZTX | 2009/08/24 | EpsServiceProfile attribute is not allowed if NAM = CSOnly -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="epsServiceProfile" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="203">
                                                                    <StringAttributeType>
                                                                        <Val>epsServiceProfile</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>true</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>Current networkAccessMode not consistent with epsServiceProfile</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                                <TestAttribute type="notExist">
                                                    <Ref name="EpsCommon_Params" defaultValue="force" />
                                                </TestAttribute>
                                                <TestAttribute type="notExist">
                                                    <Ref name="EpsSwx_Params" defaultValue="force" />
                                                </TestAttribute>
                                                <TestAttribute type="notExist">
                                                    <Ref name="EpsS6a_Params" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                            </Condition>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <MultiValue>
                                                        <Val>msCategory</Val>
                                                        <Val>opSpecificCategory</Val>
                                                        <Val>singleNumbering</Val>
                                                        <Val>IpreferedCarrier</Val>
                                                        <Val>csAllocationRetentionPriority</Val>
                                                    </MultiValue>
                                                </TestAttribute>
                                            </Then>
                                        </If>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                    <Val>psCsRestrictionListProvision</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Val>psRestrictionListNum</Val>
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                    <Val>psCsRestrictionListProvision</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Val>csRestrictionListNum</Val>
                                                </TestAttribute>
                                            </Then>
                                        </If>
<!-- update end for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="CamelServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="CamelServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="CAMEL_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="OcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="OcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="O_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="TcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="TcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="T_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="McsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="McsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="M_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="SscsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="SscsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="SS_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="UcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="UcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="U_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="DcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="DcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="D_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="VTcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="VTcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="VT_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="SmocsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="SmocsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="SMO_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
<!-- begin 70186guowei -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="SmtcsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="SmtcsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="SMT_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
<!-- end 70186guowei -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="GprscsiServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="GprscsiServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="GPRS_CSI_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="OdbServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="OdbServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="ODB_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="CallBarringServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="CallBarringServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="Call_Barring_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="CallForwardingServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="CallForwardingServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="Call_Forwarding_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="GcsServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="GcsServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="GCS_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="ClosedUserGroupProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ClosedUserGroupProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="CUG_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="LcsServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="LcsServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="LCS_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="eMLPPServiceProfile" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="eMLPPServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <TestAttribute type="notExist">
                                                    <Ref name="eMLPP_parameters" defaultValue="force" />
                                                </TestAttribute>
                                            </Then>
                                        </If>
<!--FR NGHLR1CAG194779 end -->
<!--  Remove SDMA01FAG255161 begin -->
<!--begin FR SDMA01FAG228628 -->
<!--If>
            <AND>
            <OR>
                <Condition operator="eq">
                <Ref name="GprscsiServiceProfile"/>
                <NotExist/>
                </Condition>
                <Condition operator="eq">
                <Ref name="GprscsiServiceProfile"/>
                <Val>0</Val>
                </Condition>
            </OR>
            <OR>
                <Condition operator="eq">
                <Ref name="SmocsiServiceProfile"/>
                <NotExist/>
                </Condition>
                <Condition operator="eq">
                <Ref name="SmocsiServiceProfile"/>
                <Val>0</Val>
                </Condition>
            </OR>
            </AND>
            <Then>
            <TestAttribute type="notExist">
                <Val>camelMarkInhibitionRoamersPs</Val>
            </TestAttribute>
            </Then>
        </If-->
<!--end FR SDMA01FAG228628-->
<!--  Remove SDMA01FAG255161 end -->
<!--SDMA01FAG228582  begin-->
                                        <Foreach name="SNwithBearerService">
                                            <MultiValue>
                                                <Ref name="SNwithBearerServiceList" />
                                            </MultiValue>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                <Description />
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>SNwithBearerService</Val>
                                                    </Parameter>
                                                    <Parameter name="SNwithBearerService" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                    <Parameter name="BearerCapabilityName" />
                                                </Out>
                                            </CallBE>
<!--Begin add for feature 66935, wangying-->
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="neq">
                                                        <Ref name="countryCodeId" />
                                                        <Ref name="hostedCC" />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="31">
                                                            <Frame FrameId="12128" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!--End add for feature 66935, wangying-->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="nationalDestinationCodeId" />
                                                    <NotExist />
                                                </Condition>
                                                <Then>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Val />
                                                    </Set>
                                                </Then>
                                            </If>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>Build Msisdn</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>SubscriberNumber_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_TEMP_check">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <Set name="DN_MSISDNList_check">
                                                <MultiValue>
                                                    <Ref name="DN_MSISDNList_check" />
                                                    <Ref name="DN_TEMP_check" />
                                                </MultiValue>
                                            </Set>
                                        </Foreach>
<!--SDMA01FAG228582  end-->
<!-- 
        ***************************************************************************************
        *   1.4.1 build  MSubIdentificationNumber_DN from mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId 
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>build MSubIdentificationNumber_DN from mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="plmnFunctionId">
                                                    <Ref name="plmnFunctionId" />
                                                </Parameter>
                                                <Parameter name="managedElementId">
                                                    <Ref name="managedElementId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description>associatedIMSI valorized</Description>
                                                <Parameter name="associatedIMSI">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- 
        ***************************************************************************************
        *   1.4.2 create the IMSI_DN
        *************************************************************************************** -->
<!--create MSubIdentificationNumber entry -->
<!--Description>build AUC_DN to check if auc available </Description-->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>AucServiceProfile_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_AUC">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <Set name="DN_IMSI_check">
                                            <Ref name="DN_AUC" />
                                        </Set>
<!--SDMA01FAG228582   remove to BePreQuery.CheckEntryExistence-->
<!--CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
            <Description> Call BeExistEntry.create to know if auc exist</Description>
            <In>
            <Parameter name="__DISTINGUISH_NAME">
                <Ref name="DN_AUC"/>
            </Parameter>
            </In>
            <Out>
            <Parameter name="existEntry">
                <Ref name="__BOOL"/>
            </Parameter>
            </Out>
        </CallBE>
        <If>
            <Condition operator="neq">
            <Ref name="existEntry"/>
            <Val>true</Val>
            </Condition>
            <Then>
            <ThrowException>
                <Error ErrorId="1">
                <Frame FrameId="8">
                    <StringAttributeType>
                    <Ref name="DN_AUC"/>
                    </StringAttributeType>
                </Frame>
                </Error>
            </ThrowException>
            </Then>
        </If-->
<!--SDMA01FAG228582  begin-->
                                        <CallBE entityName="HSS.SUB.Subscription.BePreQuery" name="CheckEntryExistence">
                                            <Description>+ prequery entrys used later</Description>
                                            <In>
                                                <Parameter name="DN_MSISDNList_check" />
                                                <Parameter name="DN_GsmserviceProfile_check" />
                                                <Parameter name="DN_IMSI_check" />
                                            </In>
                                            <Out />
                                        </CallBE>
<!--SDMA01FAG228582  end-->
<!-- add for 68095 -->
                                        <CallBE entityName="HSS.SUB.Subscription.BePreQuery" name="preQuery">
                                            <Description>+ prequery entrys used later</Description>
                                            <In>
<!--Mandatory data for building of below DN-->
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
<!--PacketDataProtocolProfile-->
                                                <Parameter name="packetMsAddressList" />
<!--U_CSI parameters-->
                                                <Parameter name="ucsiCamelServiceList" />
<!--O_CSI parameters-->
                                                <Parameter name="ocsiCollectedInfoTdpScpIsdn" />
<!--T_CSI parameters-->
                                                <Parameter name="tcsiTermAttemptTdpScpIsdn" />
<!--SS_CSI parameters-->
                                                <Parameter name="sscsiScpIsdn" />
<!-- Begin for feature:67807
                            Comment: Add other CSI part 
                            Author: Shen Xin
            Date: 2009/4/27
               -->
<!--D_CSI parameters-->
                                                <Parameter name="dcsiCamelServiceList" />
<!--SMO_CSI parameters-->
                                                <Parameter name="smocsiCollectedInfoTdpScpIsdn" />
<!--M_CSI parameters-->
<!-- begin 70186guowei -->
<!--SMT_CSI parameters -->
                                                <Parameter name="smtcsiDeliveryReqTdpScpIsdn" />
<!-- end 70186guowei -->
                                                <Parameter name="mcsiScpIsdn" />
<!--VT_CSI parameters-->
                                                <Parameter name="vtcsiTermAttemptTdpScpIsdn" />
                                                <Parameter name="vtcsiTNoAnswTdpScpIsdn" />
                                                <Parameter name="vtcsiTBusyTdpScpIsdn" />
<!--GRPS_CSI parameters-->
                                                <Parameter name="gprscsiPdpConChgPosTdpScpIsdn" />
                                                <Parameter name="gprscsiAttachProcTdpScpIsdn" />
                                                <Parameter name="gprscsiChgPositionTdpScpIsdn" />
                                                <Parameter name="gprscsiPdpConEstabTdpScpIsdn" />
                                                <Parameter name="gprscsiPdpConEstAckTdpScpIsdn" />
<!--End for feature:67807-->
                                            </In>
                                            <Out />
                                        </CallBE>
<!--check if this subscriber already exist-->
<!--  removed by 68095 feature -->
<!--CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                <Description>Call BeExistEntry.create to know if the subscriber already exist</Description>
                <In>
                <Parameter name="__DISTINGUISH_NAME">
                    <Ref name="associatedIMSI" />
                </Parameter>
                </In>
                <Out>
                <Parameter name="existEntry">
                    <Ref name="__BOOL" />
                </Parameter>
                </Out>
            </CallBE>
            <If>
                <Condition operator="eq">
                <Ref name="existEntry" />
                <Val>true</Val>
                </Condition>
                <Then>
                <ThrowException>
                    <Error ErrorId="2">
                    <Frame FrameId="9">
                        <StringAttributeType>
                        <Ref name="associatedIMSI" />
                        </StringAttributeType>
                    </Frame>
                    </Error>
                </ThrowException>
                </Then>
            </If-->
<!--add begin by BPQ for 68045 multi app, 20081226-->
<!-- 
        ***************************************************************************************
        *   1.4.3 make sure IMSI is not shared by other subscriber 
        *************************************************************************************** -->
<!-- fix FR SDMA01FAG235895 begin by BPQ, 20090518:  no matter isMultiAppSupported is active or not, GSM part should check whether IMSI is used by IMPI -->
                                        <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                            <Description>join MCC, MNC, MSIN to be an integer type variable : imsi4EisId</Description>
                                            <In>
                                                <Parameter name="joinParameters">
                                                    <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                </Parameter>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>pridImsi</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mSubIdentificationNumberId" />
                                            </In>
                                            <Out>
                                                <Parameter name="pridImsi" />
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <Description>build Imsi4Eis_DN via pridImsi</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>Imsi4Eis_DN</Val>
                                                </Parameter>
                                                <Parameter name="imsi4EisId">
                                                    <Ref name="pridImsi" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_Imsi4Eis">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <Description>test the existence of Imsi4Eis_DN</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_Imsi4Eis" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- if the Imsi4Eis_DN entry exists-->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
<!-- check whether the IMPI has same suMSubscriberProfileId or not -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>query link attribute pridLink4Eis from Imsi4Eis_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_Imsi4Eis" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>pridLink4Eis</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="pridLink4Eis" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>query SuMSubscriberProfileId from pridLink4Eis</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="pridLink4Eis" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="IMS_SuMSubscriberProfileId">
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                    </Out>
                                                </CallBE>
<!-- IMSI can only be shared between one subscriber's GSM and IMS subscription-->
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="IMS_SuMSubscriberProfileId" />
                                                        <Ref name="suMSubscriberProfileId" />
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="21">
                                                                <Frame FrameId="12054">
                                                                    <StringAttributeType>
                                                                        <Ref name="IMS_SuMSubscriberProfileId" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- SDMA01FAG261379, Shi Qin, 2010-11-09 -->
                                                <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>PridIMSIAssoc_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="pridLink4Eis" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_PridIMSIAssoc">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="__EXIST_ENTRY" DN="DN_PridIMSIAssoc" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setLessOrEqual">
                                                            <Ref name="pridToIMSILink" entityName="gdmiContext" DN="DN_PridIMSIAssoc" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                            <Description>modify PridIMSIAssoc</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PridIMSIAssoc" />
                                                                </Parameter>
                                                                <Parameter name="pridToIMSILink">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!-- SDMA01FAG261379 End, Shi Qin, 2010-11-09 -->
                                            </Then>
                                        </If>
<!-- fix FR SDMA01FAG235895 end by BPQ, 20090518 -->
<!-- 
        ***************************************************************************************
        *   1.4.4 if SuMSubscriberProfile entry exists, compare its NRGKey with AUC NRGKey
        *              14.4.1 if the two NRGKey are different, rehoming AUC entry together with SuMSubscriberProfile
        *   1.4.5 if SuMSubscriberProfile entry doesn't exist, create it on AUC NRGKey via manual policy 
        *************************************************************************************** -->
<!-- get AUC_NRGKey -->
                                        <CallBE entityName="HSS.AUC.*.BeGDMI" name="getNRGKey">
                                            <Description>get the NRG key where the AUC located</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_AUC" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="AUC_NRGKey">
                                                    <Ref name="__NRG_KEY" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- SDMA01FAG261076: move this part to the top, begin, zeyangy-->
<!-- if DN_SuMSubscriberProfile exist, get its NrgKey -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry_SuMSubscriber" />
                                                    <Val>true</Val>
                                                </Condition>
<!-- 70719, zeyangy, 2010-08-23, begin -->
                                                <Condition operator="eq">
                                                    <Ref name="subFound" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </OR>
<!-- 70719, zeyangy, 2010-08-23, end -->
                                            <Then>
<!-- 70719, zeyangy, 2010-08-23, move get SuMSubscriberProfile_NRGKey before-->
<!-- If SuMSubscriberProfile_NRGKey not equal AUC_NRGKey, rehoming AUC should be done -->
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="SuMSubscriberProfile_NRGKey" />
                                                        <Ref name="AUC_NRGKey" />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                            <In>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>strImsi</Val>
                                                                </Parameter>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="strImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeRehoming" name="rehomingAUC">
                                                            <Description>Call Be rehoming</Description>
                                                            <In>
                                                                <Parameter name="IMSI">
                                                                    <Ref name="strImsi" />
                                                                </Parameter>
                                                                <Parameter name="Target_NRG">
                                                                    <Ref name="SuMSubscriberProfile_NRGKey" />
                                                                </Parameter>
                                                                <Parameter name="Source_NRG">
                                                                    <Ref name="AUC_NRGKey" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- add for PT, shshi begin,SDMA01FAG265148 is for R3.1.1-->
<!-- after rehoming, must query AUC through DB exchange to refresh Index server, then IMSI entry will not create on the original nrg of this auc -->
                                                        <CallBE entityName="HSS.AUC.*.BeGDMI" name="query">
                                                            <Description>fetch AUC</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_AUC" />
                                                                </Parameter>
                                                                <Parameter name="__NO_CACHE">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- add for PT, shshi end -->
                                                    </Then>
                                                </If>
                                            </Then>
                                            <Else>
<!-- if DN_SuMSubscriberProfile entry does not exist -->
                                                <CallBE entityName="HSS.SUB.*.BeMultiApp" name="setNrgKeyForManualDCP">
                                                    <Description>set nrg key cause SuMSubscriberProfile entry is manual policy</Description>
                                                    <In>
                                                        <Parameter name="NrgKey">
                                                            <Ref name="AUC_NRGKey" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- FFRD70719, zeyangy, begin-->
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="Upgradeflag2" />
                                                        <Val>Old</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                            <Description>Create the SuMSubscriberProfile entry on the NRG which the AUC located</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!-- FFRD70719, zeyangy, end -->
                                            </Else>
                                        </If>
<!-- remove for PT, shshi begin, SDMA01FAG265148 is for R3.1.1 -->
<!--
            <CallBE entityName="HSS.AUC.*.BeGDMI" name="query">
                <Description>fetch AUC</Description>
                <In>
                <Parameter name="__DISTINGUISH_NAME">
                    <Ref name="DN_AUC" />
                </Parameter>
                <Parameter name="__ATTRIBUTE_NAME_LIST">
                    <Val />
                </Parameter>
                </In>
                <Out />
            </CallBE>
            -->
<!-- remove for PT, shshi end -->
<!--add end by BPQ for 68045 multi app, 20081226-->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                            <Description>Create Entry MSubIdentificationNumber</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="associatedIMSI" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!-- 
        ***************************************************************************************
        *   1.5   associatedSubscriptionProfile build 
        *************************************************************************************** -->
                                        <Set name="__DISTINGUISH_NAME">
                                            <Ref name="DN_BasicSubscription" />
                                        </Set>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>associatedSubscriptionProfile built</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>GsmServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>associatedSubscriptionProfile built</Description>
                                                <Parameter name="associatedSubscriptionProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- 
        ***************************************************************************************
        *   1.6   treatment of MainSNwithBearerService parameter 
        *************************************************************************************** -->
<!-- 
        ***************************************************************************************
        *   MSISDN counter initialization
        *************************************************************************************** -->
                                        <Set name="countMSISDN">
                                            <Val>0</Val>
                                        </Set>
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                        <Set name="associatedBasicServicesCodeList">
                                            <Null />
                                        </Set>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                        <Foreach name="MainSNwithBearerServiceElement">
                                            <MultiValue>
                                                <Ref name="MainSNwithBearerService" />
                                            </MultiValue>
<!-- 
        ***************************************************************************************
        *   1.6.1  extract countryCodeId, nationalDestinationCodeId, subscriberNumberId and BearerCapabilityName 
        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                <Description />
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>MainSNwithBearerServiceElement</Val>
                                                    </Parameter>
                                                    <Parameter name="MainSNwithBearerServiceElement" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                    <Parameter name="BearerCapabilityName" />
                                                </Out>
                                            </CallBE>
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!--
            If fPs100=true and NAM=namPsKey and mainMSISDN can be optional
            CC=dummyCC,NDC=MNC,SN=MSIN
            -->
                                            <If>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="countryCodeId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="nationalDestinationCodeId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="subscriberNumberId" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setGreater">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                        <Null />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="countryCodeId">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                        <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                    </Set>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Ref name="mobileNetworkCodeId" />
                                                    </Set>
                                                    <Set name="subscriberNumberId">
                                                        <Ref name="mSubIdentificationNumberId" />
                                                    </Set>
                                                </Then>
                                            </If>
<!-- modify for feature 69004 end -->
<!-- 
            ***************************************************************************************
            *   1.6.2  BSN uniqueness control 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="BearerServiceNameList" />
                                                    <Ref name="BearerCapabilityName" />
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12004">
                                                                        <StringAttributeType>
                                                                            <Ref name="BearerCapabilityName" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                                <Else>
                                                    <Set name="BearerServiceNameList">
                                                        <MultiValue>
                                                            <Ref name="BearerServiceNameList" />
                                                            <Ref name="BearerCapabilityName" />
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!-- 
        ***************************************************************************************
        *   1.6.3  check if GPRS provided (GPRSprovidedOnMain and BSotherthanGPRSprovided local data)
        *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>GPRS</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="GPRSprovidedOnMain">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="BSotherthanGPRSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Else>
                                            </If>
<!-- 
        ***************************************************************************************
        *   1.6.5  SMSMTAL not allowed on Main
        *************************************************************************************** -->
<!--If>
                <AND>
                    <Condition operator="neq">
                    <Ref name="fGprs105" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGprs" />
                    <Val>true</Val>
                    </Condition>
                    <Condition operator="eq">
                    <Ref name="BearerCapabilityName" />
                    <Val>SMSMTAL</Val>
                    </Condition>
                </AND>
                <Then>
                    <ThrowException>
                    <Error ErrorId="20">
                        <Frame FrameId="12121">
                        <StringAttributeType>
                            <Val>SMSMTAL</Val>
                        </StringAttributeType>
                        </Frame>
                    </Error>
                    </ThrowException>
                </Then>
                </If-->
<!-- 
            ***************************************************************************************
            *   1.6.6  build associatedMainMsisdn 
            *************************************************************************************** -->
<!-- NGHLR1FAG186920 begin -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="nationalDestinationCodeId" />
                                                    <NotExist />
                                                </Condition>
                                                <Then>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Val />
                                                    </Set>
                                                </Then>
                                            </If>
<!-- NGHLR1FAG186920 end-->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>main build associatedMainMsisdn</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>SubscriberNumber_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out>
                                                    <Description>build associatedMainMsisdn</Description>
                                                    <Parameter name="associatedMainMsisdn">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!-- 
            ***************************************************************************************
            *   1.6.7  build associatedBasicServices
            *************************************************************************************** -->
<!-- add begin by yan.yang for 67405 -->
                                            <CallBE name="getPLMN" entityName="HSS.PMH.HPLMN.PlmnCommonFunc">
                                                <Description>get mcc mnc, Plmn data Accessing</Description>
                                                <In>
                                                    <Parameter name="mvnomobileCountryCodeId">
                                                        <Ref name="mobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mvnomobileNetworkCodeId">
                                                        <Ref name="mobileNetworkCodeId" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="mvnomobileCountryCodeId" />
                                                    <Parameter name="mvnomobileNetworkCodeId" />
                                                </Out>
                                            </CallBE>
<!-- add end by yan.yang for 67405 -->
                                            <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>ServiceCodeMnemonic_DN</Val>
                                                    </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                    <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileNetworkCodeId" />
                                                    </Parameter>
                                                    <Parameter name="serviceCodeMnemonicId">
                                                        <Ref name="BearerCapabilityName" />
                                                    </Parameter>
                                                    <Parameter name="plmnFunctionId">
                                                        <Ref name="plmnFunctionId" />
                                                    </Parameter>
                                                    <Parameter name="managedElementId">
                                                        <Ref name="managedElementId" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_BSC">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <Set name="associatedBasicServices">
                                                <MultiValue>
                                                    <Ref name="associatedBasicServices" />
                                                    <Ref name="DN_BSC" />
                                                </MultiValue>
                                            </Set>
                                            <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                <Description>Query Entry Main SubscriberNumber</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BSC" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                    <Parameter name="belongToBscLink" />
                                                    <Parameter name="basicServiceCategory" />
                                                    <Parameter name="restrictedApplicabillity" />
                                                </Out>
                                            </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>Query BSC from belongToBscLink</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="belongToBscLink" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="basicServiceCodeId" />
                                                </Out>
                                            </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                            <If>
<!-- SDMA01FAG250922 begin -->
                                                <AND>
                                                    <Condition operator="neq">
                                                        <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA112" />
                                                        <Val>true</Val>
                                                    </Condition>
<!--Condition operator="nullIntersection">
                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" name="contspare4"/>
                <Val>fSA112</Val>
                </Condition-->
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                        <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                    </Condition>
                                                </AND>
<!-- SDMA01FAG250922 end -->
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="14">
                                                            <Frame FrameId="12031" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                                <Else>
                                                    <Set name="associatedBasicServicesCodeList">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                            <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!--end SDMA01FAG233913  change 12016 to 12031 zhao haibing 2007/4/13-->
<!--NGHLR1FAG165519_1 Add check for the associatedBasicServices must be autorized WITH SN -->
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="basicServiceCategory" />
                                                    <Val>1</Val>
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="12012">
                                                                <StringAttributeType>
                                                                    <Ref name="BearerCapabilityName" />
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *       1.6.8  Subscription Type OC+TC mandatory except for SMSMT
            *************************************************************************************** -->
                                            <Set name="subbasicServiceTCOCSubscription">
                                                <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode" />
                                            </Set>
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>SMSMTPP</Val>
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <AND>
<!-- NGHLR1FAG205598 -->
                                                            <Condition operator="eq">
                                                                <Ref name="restrictedApplicabillity" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="subbasicServiceTCOCSubscription" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="211">
                                                                        <StringAttributeType>
                                                                            <Val>MainSNwithBearerService</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>basicServiceTCOCSubscription</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="restrictedApplicabillity" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="211">
                                                                        <StringAttributeType>
                                                                            <Val>MainSNwithBearerService</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>restrictedApplicabillity</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.6.9  Incrementation of 1 of MSISDN counter
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Val>BOTH</Val>
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="countMSIMSIflag" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="countMSIMSIflag">
                                                                <Val>false</Val>
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <Set name="countMSIMSIflag">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Else>
                                                    </If>
                                                </Then>
                                            </If>
                                        </Foreach>
<!-- 
        ***************************************************************************************
        *   1.6.10  if BOTH at least one BS other than GPRS on Main
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Val>BOTH</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="BSotherthanGPRSprovided" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12000" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        **************************************************************************************
        *   1.6.11  if GPRS subscription, GPRS BS must be provided.Otherwise automatically set to main 
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="GPRSprovidedOnMain" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="GPRSsub" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="BearerCapabilityName">
                                                    <Val>GPRS</Val>
                                                </Set>
                                                <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                    <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>ServiceCodeMnemonic_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
<!-- FR181381 -->
<!--modify by F. Le Bars for FR180159-->
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                            <Ref name="mvnomobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
<!-- FR181381 -->
<!--modify by F. Le Bars for FR180159-->
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                            <Ref name="mvnomobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="serviceCodeMnemonicId">
                                                            <Ref name="BearerCapabilityName" />
                                                        </Parameter>
                                                        <Parameter name="plmnFunctionId">
                                                            <Ref name="plmnFunctionId" />
                                                        </Parameter>
                                                        <Parameter name="managedElementId">
                                                            <Ref name="managedElementId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_BSC">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <Set name="associatedBasicServices">
                                                    <MultiValue>
                                                        <Ref name="associatedBasicServices" />
                                                        <Ref name="DN_BSC" />
                                                    </MultiValue>
                                                </Set>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.6.12 control on  associatedBasicServices
        *************************************************************************************** -->
<!-- + FR NGHLR1FAG164472-->
                                        <Set name="BSnumber">
                                            <Ref name="associatedBasicServices" defaultValue="occurs" />
                                        </Set>
                                        <If>
                                            <OR>
                                                <Condition operator="greater">
                                                    <Ref name="BSnumber" />
                                                    <Val>2</Val>
                                                </Condition>
                                                <AND>
                                                    <Condition operator="neq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="greater">
                                                        <Ref name="BSnumber" />
                                                        <Val>1</Val>
                                                    </Condition>
                                                </AND>
                                            </OR>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12011">
                                                            <StringAttributeType>
                                                                <Val>MainSNwithBearerService</Val>
<!--Ref name="controlSNListElement"/-->
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- - FR NGHLR1FAG164472-->
<!-- 
        ***************************************************************************************
        *   1.6.13 create Entry SubscriberNumber on associatedMainMsisdn 
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                            <Description>Create Entry SubscriberNumber on associatedMainMsisdn</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="associatedMainMsisdn" />
                                                </Parameter>
                                                <Parameter name="associatedSubscriptionProfile" />
                                                <Parameter name="associatedIMSI" />
                                                <Parameter name="associatedBasicServices" />
<!-- Add for Feature 67405 by Qi Start -->
                                                <Parameter name="isdnMvnoIndex">
                                                    <Ref name="subscriptionMvnoIndex" />
                                                </Parameter>
<!-- Add for Feature 67405 by Qi End-->
<!-- SDMA01CAG258860 begin -->
                                                <Parameter name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
                                            </In>
                                            <Out />
<!--Out>
            <Parameter name="mainAssociatedBasicServices">
                <Ref name="associatedBasicServices"/>
            </Parameter>
            </Out-->
                                        </CallBE>
<!-- add for r4.2 NPA Split feature to automatically create a new MSISDN -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="getTranslatedNPAMSISDN">
                                                    <Description>-check if match npa</Description>
                                                    <In>
                                                        <Parameter name="oldNDC">
                                                            <Ref name="nationalDestinationCodeId" />
                                                        </Parameter>
                                                        <Parameter name="oldSN">
                                                            <Ref name="subscriberNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="NPAFlag" />
                                                        <Parameter name="newSN" />
                                                        <Parameter name="newNDC" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="NPAFlag" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                            <In>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>newMainMSISDNwithNPA</Val>
                                                                </Parameter>
                                                                <Parameter name="countryCodeId" />
                                                                <Parameter name="nationalDestinationCodeId">
                                                                    <Ref name="newNDC" />
                                                                </Parameter>
                                                                <Parameter name="subscriberNumberId">
                                                                    <Ref name="newSN" />
                                                                </Parameter>
                                                                <Parameter name="BearerCapabilityName" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="newMainMSISDNwithNPA" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="SNwithBearerServiceList" />
                                                                <Ref name="newMainMSISDNwithNPA" />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="SNwithBearerServiceList">
                                                                    <MultiValue>
                                                                        <Ref name="SNwithBearerServiceList" />
                                                                        <Ref name="newMainMSISDNwithNPA" />
                                                                    </MultiValue>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- end of r4.2 NPA Split feature to automatically create a new MSISDN -->
<!-- 
        ***************************************************************************************
        *   1.6.14 create Entry suMSubscriptionProfile 
        *************************************************************************************** -->
<!-- <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
            <Description>        Create Entry suMSubscriptionProfile       </Description>
            <In>
            <Parameter name="__DISTINGUISH_NAME">
                <Ref name="associatedSubscriptionProfile"/>
            </Parameter>
            <Parameter name="associatedMainMsisdn"/>
            </In>
            <Out>
            <Description>         mainMSISDN is valorized        </Description>
            <Parameter name="mainMSISDN">
                <Ref name="associatedMainMsisdn"/>
            </Parameter>
            </Out>
        </CallBE> -->
                                        <Set name="mainMSISDN">
                                            <Ref name="associatedMainMsisdn" />
                                        </Set>
<!-- 
        ***************************************************************************************
        *   1.7   treatment of SNwithBearerServiceList parameter 
        *************************************************************************************** -->
<!-- begin FR SDMA01FAG233910 zhao haibing  2009/4/13-->
<!--As the number of mainMsisdn is always 1, so there is no need to calulate -->
                                        <Set name="countMSISDN">
                                            <Val>1</Val>
                                        </Set>
<!-- end FR SDMA01FAG233910 zhao haibing  2009/4/13-->
                                        <Foreach name="SNwithBearerService">
                                            <MultiValue>
                                                <Ref name="SNwithBearerServiceList" />
                                            </MultiValue>
<!-- 
            ***************************************************************************************
            *   1.7.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName 
            *************************************************************************************** -->
                                            <CallBE name="query" entityName="HSS.SUB.*.BeString">
                                                <Description>SNwithBearerService : Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName</Description>
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>SNwithBearerService</Val>
                                                    </Parameter>
                                                    <Parameter name="SNwithBearerService" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                    <Parameter name="BearerCapabilityName" />
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="nationalDestinationCodeId" />
                                                    <NotExist />
                                                </Condition>
                                                <Then>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Val />
                                                    </Set>
                                                </Then>
                                            </If>
<!--Begin SDMA01FAG222615 -->
                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkMSISDN">
                                                <Description />
                                                <In>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out />
                                            </CallBE>
<!-- End SDMA01FAG222615 -->
<!-- 
            ***************************************************************************************
            *   1.7.2  BSN uniqueness control 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="BearerServiceNameList" />
                                                    <Ref name="BearerCapabilityName" />
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12004">
                                                                        <StringAttributeType>
                                                                            <Ref name="BearerCapabilityName" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                                <Else>
                                                    <Set name="BearerServiceNameList">
                                                        <MultiValue>
                                                            <Ref name="BearerServiceNameList" />
                                                            <Ref name="BearerCapabilityName" />
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.7.3  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data) 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>GPRS</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="GPRSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="BSotherthanGPRSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Else>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.7.4  check if BS other than SMSMT or SMSMO provided (BSotherthanSMSprovided local data) 
            *************************************************************************************** -->
                                            <If>
                                                <AND>
                                                    <Condition operator="neq">
                                                        <Ref name="BearerCapabilityName" />
                                                        <Val>SMSMTPP</Val>
                                                    </Condition>
                                                    <Condition operator="neq">
                                                        <Ref name="BearerCapabilityName" />
                                                        <Val>SMSMOPP</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="BSotherthanSMSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.7.5  create DN BSC corresponding to BearerCapabilityName 
            *************************************************************************************** -->
                                            <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                <Description>Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>ServiceCodeMnemonic_DN</Val>
                                                    </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                    <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileNetworkCodeId" />
                                                    </Parameter>
                                                    <Parameter name="serviceCodeMnemonicId">
                                                        <Ref name="BearerCapabilityName" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_BSC">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                            <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                <Description>Query the bearerServiceCode</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BSC" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>belongToBscLink</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="belongToBscLink" />
                                                </Out>
                                            </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>Query BSC from belongToBscLink</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="belongToBscLink" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="basicServiceCodeId" />
                                                </Out>
                                            </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
                                            <If>
<!-- SDMA01FAG250922 begin -->
                                                <AND>
                                                    <Condition operator="neq">
                                                        <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA112" />
                                                        <Val>true</Val>
                                                    </Condition>
<!--Condition operator="nullIntersection">
                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" name="contspare4"/>
                <Val>fSA112</Val>
                </Condition-->
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                        <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                    </Condition>
                                                </AND>
<!-- SDMA01FAG250922 end -->
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="14">
                                                            <Frame FrameId="12031" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                                <Else>
                                                    <Set name="associatedBasicServicesCodeList">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                            <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!--end SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!-- 
            ***************************************************************************************
            *   1.7.6  create DN MSISDN
            *************************************************************************************** -->
<!-- NGHLR1FAG186920 begin -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="nationalDestinationCodeId" />
                                                    <NotExist />
                                                </Condition>
                                                <Then>
                                                    <Set name="nationalDestinationCodeId">
                                                        <Val />
                                                    </Set>
                                                </Then>
                                            </If>
                                            <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                <Description>Create DN MSISDN and to valorize associatedMSISDN[7]</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>SubscriberNumber_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="countryCodeId" />
                                                    <Parameter name="nationalDestinationCodeId" />
                                                    <Parameter name="subscriberNumberId" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="DN_MSISDN">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!-- 
            ***************************************************************************************
            *   1.7.7  if SMSMTAL fill alertMSISDN 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>SMSMTAL</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="alertMSISDN">
                                                        <Ref name="DN_MSISDN" />
                                                    </Set>
<!--begin SDMA01FAG220643-->
                                                    <Set name="IsSMSMTProvided">
                                                        <Val>true</Val>
                                                    </Set>
<!--end SDMA01FAG220643-->
                                                </Then>
<!--  + FR NGHLR1FAG147509-->
                                                <Else>
                                                    <Set name="MSISDNwithoutSMSMTAL">
                                                        <MultiValue>
                                                            <Ref name="MSISDNwithoutSMSMTAL" />
                                                            <Ref name="DN_MSISDN" />
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
<!--  - FR NGHLR1FAG147509-->
                                            </If>
                                            <If>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="associatedMSISDN" />
                                                    <Ref name="DN_MSISDN" />
                                                </Condition>
                                                <Then>
<!-- 
                ***************************************************************************************
                *   1.7.8  create Entry MobileStationInternalISDN with associatedBasicServices if new 
                *************************************************************************************** -->
                                                    <Set name="associatedMSISDN">
                                                        <MultiValue>
                                                            <Ref name="associatedMSISDN" />
                                                            <Ref name="DN_MSISDN" />
                                                        </MultiValue>
                                                    </Set>
                                                    <Set name="associatedBasicServices">
                                                        <MultiValue>
                                                            <Ref name="DN_BSC" />
                                                        </MultiValue>
                                                    </Set>
                                                    <CallBE name="create" entityName="HSS.SUB.*.BeGDMI">
                                                        <Description>Create Entry MobileStationInternalISDN on associatedMSISDN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MSISDN" />
                                                            </Parameter>
                                                            <Parameter name="associatedSubscriptionProfile" />
                                                            <Parameter name="associatedIMSI" />
                                                            <Parameter name="associatedBasicServices" />
<!-- Add for Feature 67405 Start, by Qi  -->
                                                            <Parameter name="isdnMvnoIndex">
                                                                <Ref name="subscriptionMvnoIndex" />
                                                            </Parameter>
<!-- Add for Feature 67405 End, by Qi  -->
                                                        </In>
                                                        <Out />
                                                    </CallBE>
<!-- add for r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="CreateNewAssociatedMSISDNwithNPA">
                                                                <In>
                                                                    <Parameter name="countryCodeId" />
                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                    <Parameter name="subscriberNumberId" />
                                                                    <Parameter name="associatedIMSI" />
                                                                    <Parameter name="associatedSubscriptionProfile" />
                                                                    <Parameter name="associatedBasicServices" />
                                                                    <Parameter name="subscriptionMvnoIndex" />
                                                                    <Parameter name="associatedMSISDN" />
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="CreateNPAAssociatedMSISDNFlag">
                                                                        <Ref name="NPAFlag" />
                                                                    </Parameter>
                                                                    <Parameter name="associatedMSISDN" />
                                                                </Out>
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!-- end of r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                </Then>
                                                <Else>
<!-- 
                ***************************************************************************************
                *   1.7.9  modify Entry MobileStationInternalISDN if already created (complete associatedBasicServices) 
                *************************************************************************************** -->
<!-- + FR NGHLR1FAG164472-->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="alertMSISDN" />
                                                            <Ref name="DN_MSISDN" />
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12011">
                                                                        <StringAttributeType>
                                                                            <Val>SNwithBearerService</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
<!-- - FR NGHLR1FAG164472-->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Query on Entry MsisdnCharacteristics on one associatedMSISDN attribute</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MSISDN" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedBasicServices</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <AllParameters />
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="associatedBasicServices">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServices" />
                                                            <Ref name="DN_BSC" />
                                                        </MultiValue>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                        <Description>Modify associatedBasicServices on Entry associatedMSISDN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MSISDN" />
                                                            </Parameter>
                                                            <Parameter name="associatedBasicServices" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Else>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.7.9  if SMSMTAL fill alertMSISDN 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>SMSMTAL</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="alertMSISDN">
                                                        <Ref name="DN_MSISDN" />
                                                    </Set>
                                                </Then>
<!--  + FR NGHLR1FAG147509-->
                                                <Else>
                                                    <Set name="MSISDNwithoutSMSMTAL">
                                                        <MultiValue>
                                                            <Ref name="MSISDNwithoutSMSMTAL" />
                                                            <Ref name="DN_MSISDN" />
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
<!--  - FR NGHLR1FAG147509-->
                                            </If>
<!-- 
            ***************************************************************************************
            *       1.7.10  Subscription Type OC+TC mandatory except for SMSMT
            *************************************************************************************** -->
                                            <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                <Description>Query Entry SubscriberNumber</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BSC" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                    <Parameter name="belongToBscLink" />
                                                    <Parameter name="basicServiceCategory" />
                                                    <Parameter name="restrictedApplicabillity" />
                                                </Out>
                                            </CallBE>
<!--NGHLR1FAG165519_2 Add check for the associatedBasicServices must be autorized WITH SN -->
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="basicServiceCategory" />
                                                    <Val>1</Val>
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="12012">
                                                                <StringAttributeType>
                                                                    <Ref name="BearerCapabilityName" />
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!--    NGHLR1FAG165519_2End-->
                                            <Set name="subbasicServiceTCOCSubscription">
                                                <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode" />
                                            </Set>
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="BearerCapabilityName" />
                                                    <Val>SMSMTPP</Val>
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <AND>
<!-- NGHLR1FAG205598 -->
                                                            <Condition operator="eq">
                                                                <Ref name="restrictedApplicabillity" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="subbasicServiceTCOCSubscription" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="211">
                                                                        <StringAttributeType>
                                                                            <Val>SNwithBearerService</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>basicServiceTCOCSubscription</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="restrictedApplicabillity" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="211">
                                                                        <StringAttributeType>
                                                                            <Val>SNwithBearerService</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>restrictedApplicabillity</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!--
            ***************************************************************************************
            *       1.7.11  Incrementation of 1 of MSISDN counter
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="CreateNPAAssociatedMSISDNFlag" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="MappingIncrement">
                                                        <Val>1</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="MappingIncrement">
                                                        <Val>2</Val>
                                                    </Set>
                                                </Else>
                                            </If>
                                            <Set name="MappingOperation">
                                                <Val>+</Val>
                                            </Set>
                                            <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                <Description>Incrementation of 1 of MSISDN counter</Description>
                                                <In>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>MappingIncrement</Val>
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>countMSISDN</Val>
                                                    </Parameter>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>MappingOperation</Val>
                                                    </Parameter>
                                                    <Parameter name="countMSISDN" />
                                                    <Parameter name="MappingIncrement" />
                                                    <Parameter name="MappingOperation" />
                                                </In>
                                                <Out>
                                                    <Parameter name="countMSISDN" />
                                                </Out>
                                            </CallBE>
                                        </Foreach>
<!--
        ***************************************************************************************
        *   1.8 Control: Maximun number of MSISDN per subscription is not reached
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="greater">
                                                <Ref name="countMSISDN" />
                                                <Ref name="maxNumberOfMsisdnPerMS" entityName="HSS.SystemData.SystemData.Sys_OAM_SysSubscription" />
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="10057">
                                                            <StringAttributeType>
                                                                <Val>MSISDN per subscription</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--
        ***************************************************************************************
        *   1.9 Control: Maximun number of MSISDN is not reached
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="countEntry">
                                            <Description>Count the number of MSISDN</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>SubscriberNumber_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="countResultMSISDN">
                                                    <Ref name="__ENTRY_COUNTER" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <Set name="MappingOperation">
                                            <Val>+</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                            <Description>MSISDN counter total</Description>
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>countMSISDN</Val>
                                                </Parameter>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>countResultMSISDN</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>MappingOperation</Val>
                                                </Parameter>
                                                <Parameter name="countResultMSISDN" />
                                                <Parameter name="countMSISDN" />
                                                <Parameter name="MappingOperation" />
                                            </In>
                                            <Out>
                                                <Parameter name="countResultMSISDN" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="greater">
                                                <Ref name="countResultMSISDN" />
<!--Begin modify for feature 66935, wangying, query global level data-->
                                                <Ref name="contMaxMSISDN" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" queryLevel="MVNE" />
<!--End modify for feature 66935, wangying-->
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="10057">
                                                            <StringAttributeType>
                                                                <Val>MSISDN</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--
        ***************************************************************************************
        *   1.9.1   Control: Maximun number of subscriptions is not reached
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="countEntry">
                                            <Description>Count the number of MSISDN</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>GsmServiceProfile_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="countResultSubscriptions">
                                                    <Ref name="__ENTRY_COUNTER" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <Set name="MappingIncrement">
                                            <Val>1</Val>
                                        </Set>
                                        <Set name="MappingOperation">
                                            <Val>+</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                            <Description>Incrementation of 1 of Subcriptions counter</Description>
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>MappingIncrement</Val>
                                                </Parameter>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>countResultSubscriptions</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>MappingOperation</Val>
                                                </Parameter>
                                                <Parameter name="countResultSubscriptions" />
                                                <Parameter name="MappingIncrement" />
                                                <Parameter name="MappingOperation" />
                                            </In>
                                            <Out>
                                                <Parameter name="countResultSubscriptions" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="greater">
                                                <Ref name="countResultSubscriptions" />
<!--Begin modify for feature 66935, wangying, query global level data-->
                                                <Ref name="contMaxSubscriptions" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" queryLevel="MVNE" />
<!--End modify for feature 66935, wangying-->
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="10057">
                                                            <StringAttributeType>
                                                                <Val>Subcriptions</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.10   control with SMSMTAL on SN (another BS is mandatory)
        *************************************************************************************** -->
<!-- + FR NGHLR1FAG147509-->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="alertMSISDN" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="MSISDNwithoutSMSMTAL" />
                                                    <Ref name="alertMSISDN" />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12002" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- - FR NGHLR1FAG147509-->
<!-- 
        ***************************************************************************************
        *   1.11   Modify Entry MSubIdentificationNumber 
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                            <Description>Modify Entry MSubIdentificationNumber</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="associatedIMSI" />
                                                </Parameter>
                                                <Parameter name="mainMSISDN">
                                                    <Ref name="mainMSISDN" />
                                                </Parameter>
                                                <Parameter name="associatedMSISDN">
                                                    <Ref name="associatedMSISDN" />
                                                </Parameter>
                                                <Parameter name="alertMSISDN">
                                                    <Ref name="alertMSISDN" />
                                                </Parameter>
<!-- Add for Feature 67405 Start -->
                                                <Parameter name="mvnoIndex">
                                                    <Ref name="subscriptionMvnoIndex" />
                                                </Parameter>
<!-- Add for Feature 67405 End-->
<!-- OC SMSServicesData -->
                                                <Parameter name="gsmNotReachableSMSFlag">
                                                    <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                </Parameter>
                                                <Parameter name="gsmNotReachableReason">
                                                    <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                </Parameter>
                                                <Parameter name="memoryCapacityExceededFlag">
                                                    <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                </Parameter>
                                                <Parameter name="supOfAutReqCount">
                                                    <Ref name="supOfAutReqCount" defaultValue="force" />
                                                </Parameter>
                                                <Parameter name="autReqSubsPeriod">
                                                    <Ref name="autReqSubsPeriod" defaultValue="force" />
                                                </Parameter>
                                                <Parameter name="autReqSponSent">
                                                    <Ref name="autReqSponSent" defaultValue="force" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!--Proc>
            <Description>+          Modify Entry SubscriberNumber</Description>
            <In>
            <Parameter name="associatedMainMsisdn"/>
            <Parameter name="associatedSubscriptionProfile"/>
            <Parameter name="associatedIMSI"/>
            <Parameter name="associatedBasicServices"/>             
            </In>
            <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
            <Description>+        Modify Entry SubscriberNumber       </Description>
            <In>
            <Parameter name="__DISTINGUISH_NAME">
                <Ref name="associatedMainMsisdn"/>
            </Parameter>
            <Parameter name="associatedSubscriptionProfile"/>
            <Parameter name="associatedIMSI"/>
            <Parameter name="mainAssociatedBasicServices">
                <Ref name="associatedBasicServices"/>
            </Parameter>
            </In>
            <Out/>
            </CallBE>
            <Out/>
        </Proc-->
<!--SDMA01FAG220643-->
<!--<Set name="IsSMSMTPPProvided">
            <Val>false</Val>
        </Set>-->
<!--SDMA01FAG220643-->
<!-- 
        ***************************************************************************************
        *   1.12  treatement of BearerServiceWithoutSNList parameter
        *************************************************************************************** -->
                                        <Foreach name="BearerServiceCodeWithoutSN">
                                            <MultiValue>
                                                <Ref name="BearerServiceWithoutSNList" />
                                            </MultiValue>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                    <Val>SMSMTPP</Val>
                                                </Condition>
                                                <Then>
<!--begin SDMA01FAG220643-->
                                                    <Set name="IsSMSMTProvided">
                                                        <Val>true</Val>
                                                    </Set>
<!--end SDMA01FAG220643-->
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.12.1  BSN uniqueness control
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="BearerServiceNameList" />
                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="14">
                                                            <Frame FrameId="12004">
                                                                <StringAttributeType>
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                                <Else>
                                                    <Set name="BearerServiceNameList">
                                                        <MultiValue>
                                                            <Ref name="BearerServiceNameList" />
                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.12.2  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data) 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                    <Val>GPRS</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="GPRSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="BSotherthanGPRSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Else>
                                            </If>
<!--check if BS other than SMSMT or SMSMO provided -->
                                            <If>
                                                <AND>
                                                    <Condition operator="neq">
                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                        <Val>SMSMTPP</Val>
                                                    </Condition>
                                                    <Condition operator="neq">
                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                        <Val>SMSMOPP</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="BSotherthanSMSprovided">
                                                        <Val>true</Val>
                                                    </Set>
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.12.3  SMSMTAL not allowed on BSwithoutSN 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                    <Val>SMSMTAL</Val>
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="203">
                                                                <StringAttributeType>
                                                                    <Val>BearerServiceWithoutSNList</Val>
                                                                </StringAttributeType>
                                                                <StringAttributeType>
                                                                    <Val>SMSMTAL</Val>
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.12.4  create DN BSC corresponding to BearerCapabilityName
            *************************************************************************************** -->
                                            <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                <Description>Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>ServiceCodeMnemonic_DN</Val>
                                                    </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                    <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                        <Ref name="mvnomobileNetworkCodeId" />
                                                    </Parameter>
                                                    <Parameter name="serviceCodeMnemonicId">
                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_BSC">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                            <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                <Description>Query bearerServiceCode</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BSC" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>belongToBscLink</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="belongToBscLink" />
                                                </Out>
                                            </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>Query BSC from belongToBscLink</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="belongToBscLink" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="basicServiceCodeId" />
                                                </Out>
                                            </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
                                            <If>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                    <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="14">
                                                            <Frame FrameId="12031" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                                <Else>
                                                    <Set name="associatedBasicServicesCodeList">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                            <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                        </MultiValue>
                                                    </Set>
                                                </Else>
                                            </If>
<!--end SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!-- 
            ***************************************************************************************
            *   1.12.5  set bscWithoutSN
            *************************************************************************************** -->
                                            <Set name="bscWithoutSN">
                                                <MultiValue>
                                                    <Ref name="bscWithoutSN" />
                                                    <Ref name="DN_BSC" />
                                                </MultiValue>
                                            </Set>
<!--
            ***************************************************************************************
            *   1.12.6  Subscription Type OC+TC mandatory except for SMSMT
            *************************************************************************************** -->
                                            <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                <Description>Query Entry SubscriberNumber</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BSC" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                    <Parameter name="belongToBscLink" />
                                                    <Parameter name="basicServiceCategory" />
                                                    <Parameter name="restrictedApplicabillity" />
                                                </Out>
                                            </CallBE>
<!--NGHLR1FAG165519_3 Add check for the BasicServices must be autorized WITHOUT SN -->
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="basicServiceCategory" />
                                                    <Val>0</Val>
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="12013">
                                                                <StringAttributeType>
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!--    NGHLR1FAG165519_3End-->
<!-- Remove for SDMA01FAG250911 begin -->
<!--Set name="subbasicServiceTCOCSubscription">
            <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode"/>
            </Set>
            <If>
            <Condition operator="neq">
                <Ref name="BearerServiceCodeWithoutSN"/>
                <Val>SMSMTPP</Val>
            </Condition>
            <Then>
                <If>
                <AND-->
<!-- NGHLR1FAG205598 -->
<!--Condition operator="eq">
                    <Ref name="subbasicServiceTCOCSubscription"/>
                    <Val>false</Val>
                    </Condition>
                    <Condition operator="eq">
                    <Ref name="restrictedApplicabillity"/>
                    <Val>false</Val>
                    </Condition>
                </AND>
                <Then>
                    <If>
                    <Condition operator="eq">
                        <Ref name="fTC001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractTC"/>
                        <Val>false</Val>
                    </Condition>
                    <Then>
                        <ThrowException>
                        <Error ErrorId="14">
                            <Frame FrameId="211">
                            <StringAttributeType>
                                <Val>BearerServiceWithoutSN</Val>
                            </StringAttributeType>
                            <StringAttributeType>
                                <Val>basicServiceTCOCSubscription And restrictedApplicabillity</Val>
                            </StringAttributeType>
                            </Frame>
                        </Error>
                        </ThrowException>
                    </Then>
                    </If>
                </Then>
                </If>
            </Then>
            </If-->
<!-- Remove for SDMA01FAG250911 end -->
                                        </Foreach>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                        <If>
<!--OR>
                <AND>
                    <Condition operator="notNullIntersection">
                    <Ref name="associatedBasicServicesCodeList" />
                    <Val>GBS20</Val>
                    </Condition>
                    <Condition operator="notNullIntersection">
                    <Ref name="associatedBasicServicesCodeList" />
                    <Ref name="BSCofBSG20" defaultValue="force" />
                    </Condition>
                </AND-->
                                            <AND>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="associatedBasicServicesCodeList" />
                                                    <Val>GBS30</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="associatedBasicServicesCodeList" />
                                                    <Ref name="BSCofBSG30" defaultValue="force" />
                                                </Condition>
                                            </AND>
<!--/OR-->
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12031" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--***************************************************************************************
        *   Add for SDMA01CAG271493 begin: treatement of : treatment of ExtendedBearerServiceWithoutSNList
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                    <Val>fSA115</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="32">
                                                        <Frame FrameId="10134">
                                                            <StringAttributeType>
                                                                <Val>ExtendedBearerServiceWithoutSNList</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>fSA115</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                            <Else>
<!--Add for SDMA01CAG272836 beign-->
<!-- 
                ***************************************************************************************
                *   if GPRSonly, only SMS BS allowed 
                *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12003" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
<!--Add for SDMA01CAG272836 end-->
                                                    <Else>
                                                        <Foreach name="ExtendedBearerServiceWithoutSN">
                                                            <MultiValue>
                                                                <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                            </MultiValue>
<!--***************************************************************************************
            *   ExtendedBearerServiceWithoutSNList validation check
            *************************************************************************************** -->
<!--Set name="AllowedExtendedBearerServiceWithoutSNList">
                <MultiValue>
                        <Val>BS21</Val>
                        <Val>BS22</Val>
                        <Val>BS23</Val>
                        <Val>BS24</Val>
                        <Val>BS25</Val>
                        <Val>BS26</Val>
                </MultiValue>
            </Set-->
                                                            <If>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
<!--Ref name="AllowedExtendedBearerServiceWithoutSNList"/-->
                                                                    <Ref name="BSCofBSG20" defaultValue="force" />
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="20">
                                                                            <Frame FrameId="203">
                                                                                <StringAttributeType>
                                                                                    <Val>ExtendedBearerServiceWithoutSNList</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
<!--***************************************************************************************
            *       ExtendedBearerServiceWithoutSNList uniqueness control
            *************************************************************************************** -->
                                                            <If>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceNameList" />
                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12004">
                                                                                <StringAttributeType>
                                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="BearerServiceNameList">
                                                                        <MultiValue>
                                                                            <Ref name="BearerServiceNameList" />
                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Else>
                                                            </If>
<!--***************************************************************************************
            * Map to basicServiceCodeId
            *************************************************************************************** -->
                                                            <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                                <Description>Create DN BasicServiceCode_DN</Description>
                                                                <In>
                                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                                        <Val>BasicServiceCode_DN</Val>
                                                                    </Parameter>
                                                                    <Parameter name="basicServiceGroupId">
                                                                        <Val>BSG20</Val>
                                                                    </Parameter>
                                                                    <Parameter name="mobileNetworkCodeId">
                                                                        <Ref name="mvnomobileNetworkCodeId" />
                                                                    </Parameter>
                                                                    <Parameter name="mobileCountryCodeId">
                                                                        <Ref name="mvnomobileCountryCodeId" />
                                                                    </Parameter>
                                                                    <Parameter name="basicServiceCodeId">
                                                                        <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="DN_EBSC">
                                                                        <Ref name="__DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                <Description>Query BSC</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_EBSC" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="basicServiceCodeId" />
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="associatedBasicServicesCodeList" />
                                                                    <Ref name="basicServiceCodeId" />
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12031" />
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="associatedBasicServicesCodeList">
                                                                        <MultiValue>
                                                                            <Ref name="associatedBasicServicesCodeList" />
                                                                            <Ref name="basicServiceCodeId" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Else>
                                                            </If>
                                                            <Set name="subscriberType">
                                                                <MultiValue>
                                                                    <Ref name="subscriberType" />
                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Foreach>
                                                    </Else>
                                                </If>
                                            </Else>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="associatedBasicServicesCodeList" />
                                                    <Val>GBS20</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="associatedBasicServicesCodeList" />
                                                    <Ref name="BSCofBSG20" defaultValue="force" />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12031" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.13    Controls on BS 
        *************************************************************************************** -->
<!-- 
        ***************************************************************************************
        *   1.13.1 if GPRSonly, only SMS BS allowed 
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="BSotherthanSMSprovided" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12003" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.13.2 if noGPRS, BS GPRS not allowed
        *************************************************************************************** -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="GPRSprovided" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="GPRSprovidedOnMain" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
                                            </OR>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="20">
                                                        <Frame FrameId="203">
                                                            <StringAttributeType>
                                                                <Val>Bearer Service</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>GPRS</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.14  treatement of ServiceNodeNotificationList parameter 
        *************************************************************************************** -->
<!-- 
        ***************************************************************************************
        *   1.14.1 control (conditioned by fLR017)
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="ServiceNodeNotificationList" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="ServiceNodeNotificationList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fLR017" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="oamBackwardCapability" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="214">
                                                                    <StringAttributeType>
                                                                        <Val>ServiceNodeNotificationList</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                                <Frame FrameId="10067">
                                                                    <StringAttributeType>
                                                                        <Val>fLR017</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                    <Else>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
<!-- ZTX | 2009/08/24 | 10077 is removed according to FrameId description, should use 213 instead. -->
<!--Frame FrameId="10077"-->
                                                                <Frame FrameId="10063">
                                                                    <StringAttributeType>
                                                                        <Val>ServiceNodeNotificationList</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                                <Frame FrameId="10067">
                                                                    <StringAttributeType>
                                                                        <Val>fLR017</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.14.2 foreach ServiceNodeNotification
        *************************************************************************************** -->
                                        <Foreach name="ServiceNodeNotification">
                                            <MultiValue>
                                                <Ref name="ServiceNodeNotificationList" />
                                            </MultiValue>
<!-- 
            ***************************************************************************************
            *   1.14.2.1 extract trigger and SNaddress
            *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                <Description />
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>trigger-SNaddress</Val>
                                                    </Parameter>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>ServiceNodeNotification</Val>
                                                    </Parameter>
                                                    <Parameter name="ServiceNodeNotification" />
                                                </In>
                                                <Out>
                                                    <Description />
                                                    <Parameter name="trigger" />
                                                    <Parameter name="SNaddress" />
                                                </Out>
                                            </CallBE>
<!-- 
            ***************************************************************************************
            *   1.14.2.2 control that the triggeringType is allowed 
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="triggeringType" entityName="HSS.SystemData.SystemData.Sys_OAM_SysSubscription" />
                                                    <Ref name="trigger" />
                                                </Condition>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="203">
                                                                <StringAttributeType>
                                                                    <Val>ServiceNodeNotificationList</Val>
                                                                </StringAttributeType>
                                                                <StringAttributeType>
                                                                    <Ref name="trigger" />
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                                <Else>
<!--AutoResource begin-->
<!-- 
            ***************************************************************************************
            *   1.14.2.3 set serverAddress
            *************************************************************************************** -->
<!-- 
            ***************************************************************************************
            *   1.14.2.4 search if corresponding entry ServiceNodeAddress already exists
            *************************************************************************************** -->
<!-- 
            ***************************************************************************************
            *   1.14.2.5 create ServiceNodeAddress entry if doest not exist
            *************************************************************************************** -->
                                                    <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                        <In>
<!--SECONDARY_KEY_DN_SYNTAX_NAME-->
<!--DN_SYNTAX_NAME primary-->
<!--SECONDARY_KEY_SYNTAX-->
<!--secondary key parameters-->
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceNodeAddress_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                <Val>ServiceNodeAddress_Secondary_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                <Val>serverAddress</Val>
                                                            </Parameter>
                                                            <Parameter name="serverAddress">
                                                                <Ref name="SNaddress" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="dn_existing">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                            <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                        </Out>
                                                    </CallBE>
<!--before create auto Res,Res status need change to Free-->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>snaStateOfResource_@@_serverAddress</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="snaStateOfResource" />
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="snaStateOfResource" />
                                                            <Val>Free</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                    <Parameter name="snaStateOfResource">
                                                                        <Val>Free</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!--AutoResource end-->
                                                </Else>
                                            </If>
<!-- 
            ***************************************************************************************
            *   1.14.2.6 valorize vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
            *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="trigger" />
                                                    <Val>VLRSGSN</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="vlrSgsnServiceNodeNotification">
                                                        <Ref name="dn_existing" />
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="trigger" />
                                                            <Val>PLMN</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="plmnServiceNodeNotification">
                                                                <Ref name="dn_existing" />
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="trigger" />
                                                                    <Val>COUNTRY</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="ccServiceNodeNotification">
                                                                        <Ref name="dn_existing" />
                                                                    </Set>
                                                                </Then>
                                                                <Else>
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="trigger" />
                                                                            <Val>ALL</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <Set name="vlrSgsnServiceNodeNotification">
                                                                                <Ref name="dn_existing" />
                                                                            </Set>
                                                                            <Set name="plmnServiceNodeNotification">
                                                                                <Ref name="dn_existing" />
                                                                            </Set>
                                                                            <Set name="ccServiceNodeNotification">
                                                                                <Ref name="dn_existing" />
                                                                            </Set>
                                                                        </Then>
                                                                    </If>
                                                                </Else>
                                                            </If>
                                                        </Else>
                                                    </If>
                                                </Else>
                                            </If>
                                        </Foreach>
<!-- timeStamp1:set deactivatedSubscription =default value -->
                                        <Set name="deactivatedSubscription">
                                            <Ref name="deactivatedSubscription" defaultValue="force" />
                                        </Set>
<!-- timeStamp2:query current time -->
                                        <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                            <Description>+ Query Current Time</Description>
                                            <In />
                                            <Out>
                                                <Parameter name="CurrentTime">
                                                    <Ref name="date" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- timeStamp3: subscriptionCreationTime = current time -->
                                        <Set name="subscriptionCreationTime">
                                            <Ref name="CurrentTime" />
                                        </Set>
<!-- NGHLR1FAG203304 -->
                                        <Set name="subscriptionPurchaseTime">
                                            <Val>0</Val>
                                        </Set>
<!-- NGHLR1FAG203304 end -->
<!-- timeStamp4: subscriptionPurchaseTime=current time if odbSpecificHPLMN NullIntersection ODBS1 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="OdbServiceProfile" />
                                                    <Val>1</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="odbSpecificHPLMN" />
                                                    <Val>ODBS1</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="subscriptionPurchaseTime">
                                                    <Ref name="CurrentTime" />
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="OdbServiceProfile" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="OdbServiceProfile" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <Set name="subscriptionPurchaseTime">
                                                    <Ref name="CurrentTime" />
                                                </Set>
                                            </Then>
                                        </If>
<!-- Add for feature (MapScreening) Start -->
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="mapScreeningCategory" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA023" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR046" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR045" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR049" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR050" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="31007">
                                                            <StringAttributeType>
                                                                <Val>F-SA-023,F_LR_046,F_LR_045,F_LR_049,F_LR_050 when mapScreeningCategory exist</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- Add for feature (MapScreening) End -->
<!-- timeStamp End -->
<!-- add begin by qzg for 67452 prepay, 20090227
        *****************************************************************************************
        * 1.14.4 check prepay subscriber data                
        *****************************************************************************************-->
<!--CR SDMA01CAG271571 begin, qiangfw
            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_PrepayControl" name="createPrepayParaCheck">
                <In>
                <Parameter name="prepay" />
                <Parameter name="prepayCommonGroupId" />
                <Parameter name="oickKey" />
                <Parameter name="roamTickKey" />
                </In>
                <Out />
            </CallBE>
    CR SDMA01CAG271571 end, qiangfw -->
<!-- add end by qzg for 67452 prepay, 20090227-->
<!-- timeStamp End -->
<!--***************************************************************************************
        *   1.14.2.7  Check smsRouteViaHNetwRoam
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="smsRouteViaHNetwRoam" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fSMS104" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="24001">
                                                        <Frame FrameId="10059">
                                                            <StringAttributeType>
                                                                <Val>smsRouteViaHNetwRoam</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>true</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>fSMS104</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="smsRouteViaHNetwRoam" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    <Val>SUBSCRIBER</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    <Val>SUBNWKENT</Val>
                                                </Condition>
<!--beginF71046guowei-->
                                                <Condition operator="neq">
                                                    <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                    <Val>SUBNWKENTRLY</Val>
                                                </Condition>
<!--endF71046guowei-->
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="24001">
                                                        <Frame FrameId="30426">
                                                            <StringAttributeType>
                                                                <Val>smsRouteViaHNetwRoam</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>dummyVlrForSmsApplicability</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>SUBSCRIBER</Val>
                                                            </StringAttributeType>
<!--beginF71046guowei-->
                                                            <StringAttributeType>
                                                                <Val>SUBNWKENT or SUBNWKENTRLY</Val>
                                                            </StringAttributeType>
                                                        </Frame>
<!--endF71046guowei-->
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--***************************************************************************************
        *   1.14.2.8  Check serviceProviderReference
        *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fSPS001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="serviceProviderReference" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="24001">
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fSPS001</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.15  create Entry GsmServiceProfile
        *************************************************************************************** -->
<!-- NGHLR1FAG198454 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="accessRestrictionData" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
<!-- ZTX | 2009/11/17 | Add for LTE extend accessRestrictionData to be multi-value attribute -->
<!--Set name="accessRestrictionData">
                <Ref name="accessRestrictionData" defaultValue="force"/>
            </Set-->
                                                <Set name="accessRestrictionData">
                                                    <MultiValue>
                                                        <Ref name="accessRestrictionData" defaultValue="force" />
                                                    </MultiValue>
                                                </Set>
<!-- ZTX | 2009/11/17 | End of Add for LTE extend accessRestrictionData to be multi-value attribute -->
                                            </Then>
                                        </If>
<!-- Feature 67386:If RTU fADD001 set,and addService not input,default will be used-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fADD001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="addService" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="addService">
                                                    <Ref name="addService" defaultValue="force" />
                                                </Set>
                                            </Then>
                                        </If>
<!-- NGHLR1FAG198454 end -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                            <Description>+ Create Entry BasicSubscription</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_BasicSubscription" />
                                                </Parameter>
                                                <Parameter name="networkAccessMode" />
<!--Add for 71037 qdiao begin-->
                                                <Parameter name="icsIndicator" />
<!--Add for 71037 qdiao end-->
                                                <Parameter name="bscWithoutSN" />
                                                <Parameter name="vlrSgsnServiceNodeNotification" />
                                                <Parameter name="plmnServiceNodeNotification" />
                                                <Parameter name="ccServiceNodeNotification" />
<!-- R2.3 -->
                                                <Parameter name="accessRestrictionData" />
<!-- add for feature 67393 Start-->
                                                <Parameter name="subscriberType" />
<!-- add for feature 67393 End-->
<!-- timeStamp -->
                                                <Parameter name="deactivatedSubscription" />
                                                <Parameter name="subscriptionCreationTime" />
                                                <Parameter name="subscriptionPurchaseTime" />
                                                <Parameter name="associatedMainMsisdn" />
<!-- Add for feature (67386) Start -->
                                                <Parameter name="addService" />
<!-- Add for feature (MapScreening) Start -->
                                                <Parameter name="mapScreeningCategory" />
<!-- Add for feature (MapScreening) End -->
<!--FR SDMA01FAG229084 begin -->
                                                <Parameter name="multiSimMember">
                                                    <Val>false</Val>
                                                </Parameter>
<!--Fr SDMA01FAG229084 end -->
<!--begin for 67452 by qzg ,20090227-->
                                                <Parameter name="prepay" />
                                                <Parameter name="prepayCommonGroupId" />
<!--end for 67452 by qzg ,20090227-->
<!-- Add for Feature 67398 Start-->
                                                <Parameter name="smsRouteViaHNetwRoam" />
<!-- Add for Feature 67398 End-->
<!-- Add for Feature 67435 Start -->
                                                <Parameter name="serviceProviderReference" />
<!-- Add for Feature 67435 End-->
<!-- Add for Feature 67405 Start, by Qi-->
                                                <Parameter name="subscriptionMvnoIndex" />
<!-- Add for Feature 67405 End, by Qi-->
                                            </In>
                                            <Out>
                                                <AllParameters />
                                            </Out>
                                        </CallBE>
<!--Add for SDMA01CAG271493 begin-->
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <In>
                                                <Parameter name="subscriberType" />
                                            </In>
                                            <Out />
                                        </CallBE>
<!--Add for SDMA01CAG271493 end-->
<!-- 
        ***************************************************************************************
        *   1.16  call create CsServiceProfile if NAM equals noGPRS or BOTH
        *************************************************************************************** -->
<!--create CsServiceProfile if NAM equals noGPRS or BOTH -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Val>BOTH</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CsServiceProfile available</Description>
                                                        <Parameter name="DN_CsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSServiceProfile" name="create">
                                                    <Description>Create Entry CsServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="msCategory" />
                                                        <Parameter name="opSpecificCategory" />
                                                        <Parameter name="singleNumbering" />
                                                        <Parameter name="IpreferedCarrier" />
                                                        <Parameter name="csAllocationRetentionPriority" />
                                                        <Parameter name="RoamingRestrictionType" />
                                                        <Parameter name="associatedMainMsisdn" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- Add for 72989 begin, nian, 2012-02-29-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" name="fEps105" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <OR>
                                                    <Condition operator="setGreater">
                                                        <Ref name="selfActivationStatus" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setGreater">
                                                        <Ref name="framedPoolSetList" />
                                                        <Null />
                                                    </Condition>
                                                </OR>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="16">
                                                        <Frame FrameId="10067">
<!-- Functional option: {0} is not active. -->
                                                            <StringAttributeType>
                                                                <Val>fEps105</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10063">
<!-- Attribute {0} is not allowed. -->
                                                            <StringAttributeType>
                                                                <Val>selfActivationStatus/framedPoolSetList</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- Add for 72989 End, nian, 2012-03-01 -->
<!-- Add for 72989 begin, nian, 2012-07-17-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" name="fSAApp" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="selfActivationStatus" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="16">
                                                        <Frame FrameId="10067">
<!-- Functional option: {0} is not active. -->
                                                            <StringAttributeType>
                                                                <Val>fSAApp</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10063">
<!-- Attribute {0} is not allowed. -->
                                                            <StringAttributeType>
                                                                <Val>selfActivationStatus</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- Add for 72989 End, nian, 2012-07-17 -->
<!-- 
        ***************************************************************************************
        *   1.17  call create PServiceProfile if NAM equals GPRSonly or BOTH
        *************************************************************************************** -->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Val>BOTH</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN PsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>PsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN PsServiceProfile available</Description>
                                                        <Parameter name="DN_PsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- Begin SDMA01FAG223010  and SDMA01FAG220643-->
                                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS_internal" name="CheckControlOnTransferOfSmOption">
                                                    <Description>Check the value of transferOfSmOption</Description>
                                                    <In>
                                                        <Parameter name="networkAccessMode" />
                                                        <Parameter name="IsSMSMTProvided" />
                                                        <Parameter name="transferOfSmOption" />
                                                        <Parameter name="voiceMailIndex" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="transferOfSmOption" />
                                                    </Out>
                                                </CallBE>
<!-- End SDMA01FAG223010  and SDMA01FAG220643-->
<!-- Add begin by qigangx for 4.2 f73801 on 20121210 -->
                                                <Set name="eps3gppRestrictionListNumAdded">
                                                    <MultiValue>
                                                        <Ref name="eps3gppRestrictionListNum" />
                                                    </MultiValue>
                                                </Set>
<!-- Add end by qigangx for 4.2 f73801 on 20121210 -->
                                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="create">
                                                    <Description>Create Entry CsServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_PsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="transferOfSmOption" />
                                                        <Parameter name="packetMsAddressList" />
                                                        <Parameter name="chargingCharacteristics" />
<!-- Add begin by Guangli for 69915 on 20100201-->
                                                        <Parameter name="authVisitedPlmnNIDId" />
<!-- Add end by Guangli for 69915 on 20100201-->
<!--Add begin by Guangli for 69596, 20090908-->
                                                        <Parameter name="epsServiceProfile" />
                                                        <Parameter name="epsApnContextSetList" />
                                                        <Parameter name="framedPoolSetList" />
                                                        <Parameter name="maxRequestedBandwidthDL" />
                                                        <Parameter name="maxRequestedBandwidthUL" />
<!-- Add begin by nian for 72989 on 20120229-->
                                                        <Parameter name="selfActivationStatus" />
<!-- Add end by nian for 72989 on 20120229-->
                                                        <Parameter name="sqn4AAAIPv6" />
                                                        <Parameter name="imsSubNum4AAAIPv6" />
                                                        <Parameter name="epsAccessSubscriptionType" />
                                                        <Parameter name="apnOiReplacement" />
                                                        <Parameter name="stnSrData" />
                                                        <Parameter name="ratFreqSelectPriorityId" />
<!-- Add begin by nian for 72989 on 20120614 -->
                                                        <Parameter name="S6aRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
<!--Begin added by F71037, Austin, 2012-11-27 -->
                                                        <Parameter name="s6aRegRestrictionList" />
                                                        <Parameter name="RauTauTimer" />
                                                        <Parameter name="authLipaVplmnId" />
                                                        <Parameter name="mdtUserConsent" />
                                                        <Parameter name="mpsPriority" />
                                                        <Parameter name="relayNodeIndicator" />
                                                        <Parameter name="roamRstrD2UFeat" />
<!--End added by F71037, Austin, 2012-11-27 -->
<!-- Add begin by qigangx for 4.2 f73801 on 20121210 -->
                                                        <Parameter name="eps3gppRestrictionListNum" />
                                                        <Parameter name="eps3gppRestrictionListNumAdded" />
<!-- Add end by qigangx for 4.2 f73801 on 20121210 -->
<!-- Add begin by Guangli for 69915 on 20100201-->
                                                        <Parameter name="non3gppApnOiReplacement" />
<!-- Add end by Guangli for 69915 on 20100201-->
                                                        <Parameter name="non3gppAccessRestrictionData" />
                                                        <Parameter name="non3gppAuthenSesTimeout" />
                                                        <Parameter name="non3gppIpAccess" />
                                                        <Parameter name="non3gppIpAccessApn" />
                                                        <Parameter name="chargingGatewayFuncHost" />
                                                        <Parameter name="chargingGroup" />
                                                        <Parameter name="non3gppGwMobileIpCapability" />
                                                        <Parameter name="authVisitedNIDIdx" />
<!--Add end by Guangli for 69596, 20090908-->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="pcscfServerName" />
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- Add begin by ranli for 73246 on 20130221 -->
                                                        <Parameter name="allowMmeTableId" />
                                                        <Parameter name="allowSgsnTableId" />
<!-- Add end by ranli for 73246 on 20130221 -->
<!-- Add begin by nian for 72989 on 20120614 -->
                                                        <Parameter name="SWxRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
<!-- Add for 71910 begin, Liu, Yang W 20121205 -->
                                                        <Parameter name="pprIpAddress" />
                                                        <Parameter name="gmlcIpAddress" />
<!-- Add for 71910 end, Liu, Yang W 20121205 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-07, add contract data for SDMA01CAG272598-->
<!--SDMA01CAG272598 begin Robin 20111125-->
<!--create CsServiceProfile if not exist-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                    <Val>psCsRestrictionListProvision</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CsServiceProfile available</Description>
                                                        <Parameter name="DN_CsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE name="create" entityName="HSS.SUB.*.BeGDMI">
                                                    <Description>create CsServiceProfile entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CsServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <Description>- create ROaming Restriction Characteristics for CS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="csRoamingRestrictionType">
                                                            <Val>ALLPLMN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!--create PsServiceProfile if not exist-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                    <Val>psCsRestrictionListProvision</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN PsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>PsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN PsServiceProfile available</Description>
                                                        <Parameter name="DN_PsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                    <Description>Create the Entry PSServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_PsServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <AllParameters />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <Description>- create ROaming Restriction Characteristics for PS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_PsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="psRoamingRestrictionType">
                                                            <Val>ALLPLMN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!--initial the RoamingRestrictionType-->
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="RoamingRestrictionType" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Or>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                            <Val>psCsRestrictionListProvision</Val>
                                                        </Condition>
                                                        <And>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            </Condition>
                                                        </And>
                                                    </Or>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_CsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="csRoamingRestrictionType">
                                                                    <Ref name="RoamingRestrictionType" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Or>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                            <Val>psCsRestrictionListProvision</Val>
                                                        </Condition>
                                                        <And>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            </Condition>
                                                        </And>
                                                    </Or>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="psRoamingRestrictionType">
                                                                    <Ref name="RoamingRestrictionType" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!--initial the RoamingRestrictionType end-->
<!--SDMA01CAG272598 end Robin -->
<!-- update end for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
<!-- 
        ***************************************************************************************
        *   1.18  call create RoamingRestriction
        *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>DN RoamingGsmServiceProfile_DN available</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>RoamingGsmServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>DN RoamingGsmServiceProfile available</Description>
                                                <Parameter name="DN_ServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.RoamingRestriction.MS_OAM_RoamingRestriction" name="create">
                                            <Description>Create Roaming</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                                <Parameter name="RoamingRestrictionType" />
                                                <Parameter name="csRestrictionListNum" />
                                                <Parameter name="psRestrictionListNum" />
                                                <Parameter name="regSubscriptionListId" />
                                            </In>
                                            <Out>
<!-- 73338 -->
                                                <Parameter name="__SPECIAL_LOGICNAME_MAPPING">
                                                    <Ref name="__SPECIAL_LOGICNAME_MAPPING" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- 
        ***************************************************************************************
        *   1.19  call create CAMEL if CamelServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="CamelServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CamelServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CamelServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CamelServiceProfile available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.CAMEL.GENERAL_CAMEL" name="create">
                                                    <Description>Create CAMEL entries</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="camelLocationRequestFlag" />
                                                        <Parameter name="camelStatusRequestFlag" />
                                                        <Parameter name="camelMarkActivationRoamers" />
                                                        <Parameter name="camelMarkInhibitionRoamersCs" />
<!--***O_CSI parameters***-->
                                                        <Parameter name="OcsiServiceProfile" />
                                                        <Parameter name="ocsiCamelSubState" />
                                                        <Parameter name="ocsiCamelCapabilityHandling" />
                                                        <Parameter name="ocsiCamelVlrNotSuppDfltHandl" />
                                                        <Parameter name="ocsiCamelGmscNotSuppDfltHdl" />
                                                        <Parameter name="tifcsiTransformationInformFlag" />
                                                        <Parameter name="ocsiCollectedInfoTdpServKey" />
                                                        <Parameter name="ocsiCollectedInfoTdpScpIsdn" />
                                                        <Parameter name="ocsiCollectedInfoTdpDfltCalH" />
                                                        <Parameter name="callTypeCriteria" />
                                                        <Parameter name="destinationNumberCritList" />
                                                        <Parameter name="matchType" />
                                                        <Parameter name="destNbLengthCriteriaList" />
                                                        <Parameter name="originBscCritList" />
                                                        <Parameter name="originBsgCritList" />
                                                        <Parameter name="ocsiRouteSelectFailTdpServKey" />
                                                        <Parameter name="ocsiRouteSelectFailTdpScpIsdn" />
                                                        <Parameter name="ocsiRouteSelectFailTdpDfltCalH" />
                                                        <Parameter name="routeSelectFailTdpCauVCritList" />
                                                        <Parameter name="oickKey" />
<!--***T_CSI parameters***-->
                                                        <Parameter name="TcsiServiceProfile" />
                                                        <Parameter name="tcsiCamelSubState" />
                                                        <Parameter name="tcsiCamelCapabilityHandling" />
                                                        <Parameter name="tcsiCamelGmscNotSuppDfltHandl" />
                                                        <Parameter name="tcsiTermAttemptTdpServKey" />
                                                        <Parameter name="tcsiTermAttemptTdpScpIsdn" />
                                                        <Parameter name="tcsiTermAttemptTdpDfltCalH" />
                                                        <Parameter name="terminBscCritList" />
                                                        <Parameter name="terminBsgCritList" />
                                                        <Parameter name="tcsiTBusyTdpServKey" />
                                                        <Parameter name="tcsiTBusyTdpScpIsdn" />
                                                        <Parameter name="tcsiTBusyTdpDfltCalH" />
                                                        <Parameter name="tbusyTdpCauseValueCritList" />
                                                        <Parameter name="tcsiTNoAnswTdpServKey" />
                                                        <Parameter name="tcsiTNoAnswTdpScpIsdn" />
                                                        <Parameter name="tcsiTNoAnswTdpDfltCalH" />
                                                        <Parameter name="tnoAnswTdpCauseValueCritList" />
                                                        <Parameter name="homeTickKey" />
                                                        <Parameter name="roamTickKey" />
<!--***M_CSI parameters***-->
                                                        <Parameter name="McsiServiceProfile" />
                                                        <Parameter name="mobilityTriggers" />
                                                        <Parameter name="mcsiServKey" />
                                                        <Parameter name="mcsiScpIsdn" />
                                                        <Parameter name="mcsiCamelSubState" />
                                                        <Parameter name="mcsiCamelVlrNotSuppDfltHdl" />
<!--***SS_CSI parameters***-->
                                                        <Parameter name="SscsiServiceProfile" />
                                                        <Parameter name="sscsiScpIsdn" />
                                                        <Parameter name="sscsiCheckSSindicator" />
                                                        <Parameter name="sscsiCamelSubState" />
                                                        <Parameter name="sscsiCamelVlrNotSuppDfltHdl" />
<!--***U_CSI parameters***-->
                                                        <Parameter name="UcsiServiceProfile" />
                                                        <Parameter name="ucsiCamelServiceList" />
<!--***SMO_CSI parameters***-->
                                                        <Parameter name="SmocsiServiceProfile" />
                                                        <Parameter name="smocsiCamelSubState" />
                                                        <Parameter name="smocsiCamelCapabilityHandling" />
                                                        <Parameter name="smocsiCamelNotSuppDfltHdl" />
                                                        <Parameter name="smocsiCollectedInfoTdpServKey" />
                                                        <Parameter name="smocsiCollectedInfoTdpScpIsdn" />
                                                        <Parameter name="smocsiCollectedInfoTdpDfltCalH" />
<!-- begin 70186guowei -->
<!--***SMT_CSI parameters*** -->
                                                        <Parameter name="SmtcsiServiceProfile" />
                                                        <Parameter name="smtcsiDeliveryReqTdpServKey" />
                                                        <Parameter name="smtcsiDeliveryReqTdpScpIsdn" />
                                                        <Parameter name="smtcsiDeliveryReqTdpDfltSmsHdl" />
                                                        <Parameter name="smtcsiTpduSmsDelivCrit" />
                                                        <Parameter name="smtcsiTpduSmsStatusRepCrit" />
                                                        <Parameter name="smtcsiCamelSubState" />
                                                        <Parameter name="smtcsiCamelCapabilityHandling" />
                                                        <Parameter name="smtcsiCamelNotSuppDfltHdl" />
<!-- end 70186guowei -->
<!--***GPRS_CSI parameters***-->
                                                        <Parameter name="GprscsiServiceProfile" />
                                                        <Parameter name="gprscsiCamelSubState" />
                                                        <Parameter name="gprscsiCamelCapabilityHandling" />
                                                        <Parameter name="gprscsiCamelSgsnNotSuppDfltHdl" />
                                                        <Parameter name="camelMarkInhibitionRoamersPs" />
                                                        <Parameter name="gprscsiPdpConChgPosTdpServKey" />
                                                        <Parameter name="gprscsiPdpConChgPosTdpScpIsdn" />
                                                        <Parameter name="gprscsiPdpConChgPosTdpDfltCalH" />
                                                        <Parameter name="gprscsiAttachProcTdpServKey" />
                                                        <Parameter name="gprscsiAttachProcTdpScpIsdn" />
                                                        <Parameter name="gprscsiAttachProcTdpDfltCalH" />
                                                        <Parameter name="gprscsiChgPositionTdpServKey" />
                                                        <Parameter name="gprscsiChgPositionTdpScpIsdn" />
                                                        <Parameter name="gprscsiChgPositionTdpDfltCalH" />
                                                        <Parameter name="gprscsiPdpConEstabTdpServKey" />
                                                        <Parameter name="gprscsiPdpConEstabTdpScpIsdn" />
                                                        <Parameter name="gprscsiPdpConEstabTdpDfltCalH" />
                                                        <Parameter name="gprscsiPdpConEstAckTdpServKey" />
                                                        <Parameter name="gprscsiPdpConEstAckTdpScpIsdn" />
                                                        <Parameter name="gprscsiPdpConEstAckTdpDfltCalH" />
<!--***D_CSI parameters***-->
                                                        <Parameter name="DcsiServiceProfile" />
                                                        <Parameter name="dcsiCamelSubState" />
                                                        <Parameter name="dcsiCamelCapabilityHandling" />
                                                        <Parameter name="dcsiCamelVlrNotSuppDfltHandl" />
                                                        <Parameter name="dcsiCamelGmscNotSuppDfltHdl" />
                                                        <Parameter name="dcsiCamelServiceList" />
<!--***VT_CSI parameters***-->
                                                        <Parameter name="VTcsiServiceProfile" />
                                                        <Parameter name="vtcsiCamelSubState" />
                                                        <Parameter name="vtcsiCamelCapabilityHandling" />
                                                        <Parameter name="vtcsiCamelVlrNotSuppDfltHandl" />
<!-- Parameters relative to vtcsiTermAttemptTdp  -->
                                                        <Parameter name="vtcsiTermAttemptTdpServKey" />
                                                        <Parameter name="vtcsiTermAttemptTdpScpIsdn" />
                                                        <Parameter name="vtcsiTermAttemptTdpDfltCalH" />
                                                        <Parameter name="vterminBscCritList" />
                                                        <Parameter name="vterminBsgCritList" />
<!--Parameters relative to vtcsiTBusyTdp   -->
                                                        <Parameter name="vtcsiTBusyTdpServKey" />
                                                        <Parameter name="vtcsiTBusyTdpScpIsdn" />
                                                        <Parameter name="vtcsiTBusyTdpDfltCalH" />
                                                        <Parameter name="vterminBsgCritList" />
                                                        <Parameter name="vtbusyTdpCauseValueCritList" />
<!--Parameters relative to vtcsiTNoAnswTdp    -->
                                                        <Parameter name="vtcsiTNoAnswTdpServKey" />
                                                        <Parameter name="vtcsiTNoAnswTdpScpIsdn" />
                                                        <Parameter name="vtcsiTNoAnswTdpDfltCalH" />
                                                        <Parameter name="vtnoAnswTdpCauseValueCritList" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.21  call create CallBarring if CallBarringServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="CallBarringServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CallBarringServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CallBarringServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CallBarringServiceProfile_DN available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_CallBarring" name="create">
                                                    <Description>Create Call Barring entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="barOutCallProv" />
                                                        <Parameter name="barOutInterCallProv" />
                                                        <Parameter name="barOutIntCallExceptToHplmnProv" />
                                                        <Parameter name="barIncCallProvisioned" />
                                                        <Parameter name="barIncCallRoamFCountryProv" />
                                                        <Parameter name="BSGofBAOClist" />
                                                        <Parameter name="BSGofBOIClist" />
                                                        <Parameter name="BSGofBOICEXHClist" />
                                                        <Parameter name="BSGofBAIClist" />
                                                        <Parameter name="BSGofBICROAMlist" />
                                                        <Parameter name="msCbAbility" />
                                                        <Parameter name="callBarringPassword" />
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.22  call create CallForwrding if CallForwrdingServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="CallForwardingServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CallForwardingServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CallForwardingServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CallForwardingServiceProfile_DN available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_CallForwarding" name="create">
                                                    <Description>Create Call Forwarding entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="typeOfCallForwardingList" />
                                                        <Parameter name="msCfNoAbility" />
                                                        <Parameter name="destinationProfile" />
                                                        <Parameter name="cfuCallForwardingNumberList" />
                                                        <Parameter name="cfbusyCallForwardingNumberList" />
                                                        <Parameter name="cfnreplyCallForwardingNumberList" />
                                                        <Parameter name="cfnreachCallForwardingNumberList" />
                                                        <Parameter name="cfdCallForwardingNumberList" />
                                                        <Parameter name="cfdcfbusyCallForwardingNumberList" />
                                                        <Parameter name="cfdcfnreplyCallForwardingNumberList" />
                                                        <Parameter name="cfdcfnreachCallForwardingNumberList" />
                                                        <Parameter name="allCallForwardingNumberList" />
                                                        <Parameter name="cfuNotifToFwdPartyFlag" />
                                                        <Parameter name="cfbusyNotifToFwdPartyFlag" />
                                                        <Parameter name="cfnreplyNotifToFwdPartyFlag" />
                                                        <Parameter name="cfnreachNotifToFwdPartyFlag" />
                                                        <Parameter name="allNotifToFwdPartyFlag" />
                                                        <Parameter name="cfuNotifToCallingPartyFlag" />
                                                        <Parameter name="cfbusyNotifToCallingPartyFlag" />
                                                        <Parameter name="cfnreplyNotifToCallingPartFlag" />
                                                        <Parameter name="cfnreachNotifToCallingPartFlag" />
                                                        <Parameter name="allNotifToCallingPartyFlag" />
<!-- For feature 67401 begin -->
                                                        <Parameter name="cfDestinationProfileList" />
                                                        <Parameter name="specificCfType" />
<!-- For feature 67401 end -->
<!-- For feature 67441 begin -->
                                                        <Parameter name="voiceMailIndex" />
                                                        <Parameter name="SetDivertWithVM" />
<!-- For feature 67441 end -->
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        *   1.23  call create GCS if GcsServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="GcsServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN GeneralCallServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>GeneralCallServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN GeneralCallServiceProfile_DN available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.MS_OAM_SUP_GCS" name="create">
                                                    <Description>Create Gcs entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="colpProvisionedFlag" />
                                                        <Parameter name="colpOverrideCategoryState" />
                                                        <Parameter name="clipProvisionedFlag" />
                                                        <Parameter name="clipOverrideCategoryState" />
                                                        <Parameter name="clirProvisionedFlag" />
                                                        <Parameter name="presentationMode" />
<!--  Begin SDMA01FAG222609 -->
<!-- parameters relative to CNAP ********** -->
                                                        <Parameter name="cnapProvisionedFlag" />
                                                        <Parameter name="cnapOverrideCategoryState" />
<!--  End SDMA01FAG222609 -->
                                                        <Parameter name="callHoldProvisionedFlag" />
                                                        <Parameter name="mptyProvisionedFlag" />
                                                        <Parameter name="aoccProvisionedFlag" />
                                                        <Parameter name="aociProvisionedFlag" />
                                                        <Parameter name="callTransferProvisionedFlag" />
                                                        <Parameter name="maliciousCallProvisionedFlag" />
                                                        <Parameter name="colrProvisionedFlag" />
                                                        <Parameter name="osss1ProvisionedFlag" />
                                                        <Parameter name="osss1ActivationFlag" />
                                                        <Parameter name="osss2ProvisionedFlag" />
                                                        <Parameter name="osss2ActivationFlag" />
                                                        <Parameter name="osss3ProvisionedFlag" />
                                                        <Parameter name="osss3ActivationFlag" />
                                                        <Parameter name="osss4ProvisionedFlag" />
                                                        <Parameter name="osss4ActivationFlag" />
                                                        <Parameter name="osss5ProvisionedFlag" />
                                                        <Parameter name="osss5ActivationFlag" />
                                                        <Parameter name="osss6ProvisionedFlag" />
                                                        <Parameter name="osss6ActivationFlag" />
                                                        <Parameter name="osss7ProvisionedFlag" />
                                                        <Parameter name="osss7ActivationFlag" />
                                                        <Parameter name="osss8ProvisionedFlag" />
                                                        <Parameter name="osss8ActivationFlag" />
                                                        <Parameter name="osss9ProvisionedFlag" />
                                                        <Parameter name="osss9ActivationFlag" />
                                                        <Parameter name="osss10ProvisionedFlag" />
                                                        <Parameter name="osss10ActivationFlag" />
                                                        <Parameter name="osss11ProvisionedFlag" />
                                                        <Parameter name="osss11ActivationFlag" />
                                                        <Parameter name="osss12ProvisionedFlag" />
                                                        <Parameter name="osss12ActivationFlag" />
                                                        <Parameter name="osss13ProvisionedFlag" />
                                                        <Parameter name="osss13ActivationFlag" />
                                                        <Parameter name="osss14ProvisionedFlag" />
                                                        <Parameter name="osss14ActivationFlag" />
                                                        <Parameter name="osss15ProvisionedFlag" />
                                                        <Parameter name="osss15ActivationFlag" />
                                                        <Parameter name="callWaitingProvisionedFlag" />
                                                        <Parameter name="cwTSSpeechActivationFlag" />
                                                        <Parameter name="cwTSFaxActivationFlag" />
                                                        <Parameter name="cwBSG20ActivationFlag" />
                                                        <Parameter name="cwBSG30ActivationFlag" />
<!-- Add for 67396 start -->
                                                        <Parameter name="acrProvisionedFlag" />
                                                        <Parameter name="acrActivationFlag" />
<!-- Add for 67396 end -->
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!--
        ***************************************************************************************
        *   1.24  call create CUG if ClosedUserGroupProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="ClosedUserGroupProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN ClosedUserGroupProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>ClosedUserGroupProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN ClosedUserGroupProfile_DN available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_Cug" name="create">
                                                    <Description>Create CUG entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="cugInterlockCodeInd1" />
                                                        <Parameter name="cugInterlockCodeInd2" />
                                                        <Parameter name="cugInterlockCodeInd3" />
                                                        <Parameter name="cugInterlockCodeInd4" />
                                                        <Parameter name="cugInterlockCodeInd5" />
                                                        <Parameter name="cugInterlockCodeInd6" />
                                                        <Parameter name="cugInterlockCodeInd7" />
                                                        <Parameter name="cugInterlockCodeInd8" />
                                                        <Parameter name="cugInterlockCodeInd9" />
                                                        <Parameter name="cugInterlockCodeInd10" />
                                                        <Parameter name="intraCugOptionInd1" />
                                                        <Parameter name="intraCugOptionInd2" />
                                                        <Parameter name="intraCugOptionInd3" />
                                                        <Parameter name="intraCugOptionInd4" />
                                                        <Parameter name="intraCugOptionInd5" />
                                                        <Parameter name="intraCugOptionInd6" />
                                                        <Parameter name="intraCugOptionInd7" />
                                                        <Parameter name="intraCugOptionInd8" />
                                                        <Parameter name="intraCugOptionInd9" />
                                                        <Parameter name="intraCugOptionInd10" />
<!--AllassociatedBsgStringx only used by hmi-->
                                                        <Parameter name="AllassociatedBsgString1" />
                                                        <Parameter name="AllassociatedBsgString2" />
                                                        <Parameter name="AllassociatedBsgString3" />
                                                        <Parameter name="AllassociatedBsgString4" />
                                                        <Parameter name="AllassociatedBsgString5" />
                                                        <Parameter name="AllassociatedBsgString6" />
                                                        <Parameter name="AllassociatedBsgString7" />
                                                        <Parameter name="AllassociatedBsgString8" />
                                                        <Parameter name="AllassociatedBsgString9" />
                                                        <Parameter name="AllassociatedBsgString10" />
<!--Object Class = ClosedUserGroup-->
                                                        <Parameter name="prefCugIndexForSpeech" />
                                                        <Parameter name="prefCugIndexForFax" />
                                                        <Parameter name="prefCugIndexForBsg20" />
                                                        <Parameter name="prefCugIndexForBsg30" />
                                                        <Parameter name="interCugRestForSpeech" />
                                                        <Parameter name="interCugRestForFax" />
                                                        <Parameter name="interCugRestForBsg20" />
                                                        <Parameter name="interCugRestForBsg30" />
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        * 1.25  call create LCS if LcsServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="LcsServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN LcsServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>LcsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN LcsServiceProfile available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.LCS.LCS_OAM_LCSSubscription" name="create">
                                                    <Description>Create LCS entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
<!-- Begin for feature:67403
                                         Comment: Add two parameters: pai and paiControl
                                         Author: Shen Xin
                                         Date: 2009/3/13
                                     -->
                                                        <Parameter name="pai" />
                                                        <Parameter name="paiControl" />
<!-- End for feature:67403-->
                                                        <Parameter name="originatingLcs" />
                                                        <Parameter name="terminatingLcs" />
                                                        <Parameter name="callRelatedNotification" />
                                                        <Parameter name="callUnrelatedNotification" />
                                                        <Parameter name="externalClientProfileId" />
                                                        <Parameter name="plmnClientList" />
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 
        ***************************************************************************************
        * 1.26  call create eMLPP if eMLPPServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="eMLPPServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN EMLPPServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>EMLPPServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>EMLPPServiceProfile_DN available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_eMLPP" name="create">
                                                    <Description>Create eMLPP entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="emlppMaxEntitledPriority" />
                                                        <Parameter name="emlppDefaultPriority" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- SDMA01FAG214141
        ***************************************************************************************
        *   1.20  call create ODB if OdbServiceProfile equals true
        *************************************************************************************** -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="OdbServiceProfile" />
                                                <Val>1</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN OdbServiceProfile_DN available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>OdbServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN OdbServiceProfile available</Description>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.ODB.MS_OAM_ODB" name="create">
                                                    <Description>Create ODB entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="odbOutgoingCalls" />
                                                        <Parameter name="odbIncomingCalls" />
                                                        <Parameter name="odbRoaming" />
                                                        <Parameter name="odbSpecificHPLMN" />
                                                        <Parameter name="barringForLockingReason" />
<!--WA for upgrading-->
                                                        <Parameter name="odbPremiumRateCalls" />
<!--
                <Parameter name="odbPremiumRateCallsOld">
                 <Ref name="odbPremiumRateCalls"/>
                </Parameter>                        
                -->
                                                        <Parameter name="odbSuplServiceMngt" />
                                                        <Parameter name="odbCfFTNRegistration" />
                                                        <Parameter name="odbECTInvocation" />
                                                        <Parameter name="odbECTDoublyChargeable" />
                                                        <Parameter name="odbMultipleECT" />
                                                        <Parameter name="odbSpecificToPs" />
<!--add begin for 67390 ODB by qzg,20090403-->
                                                        <Parameter name="odbCustoSmsCalls" />
                                                        <Parameter name="odbCustoPremRateCalls" />
                                                        <Parameter name="odbRouteToSPBar" />
<!--add end for 67390 ODB by qzg,20090403-->
<!--add for 67452 prepay odb by qzg,20090227-->
                                                        <Parameter name="odbPrepayIcBar" />
                                                        <Parameter name="callFromBasic">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!--end SDMA01FAG214141-->
<!-- timeStamp NGHLR1FAG197896-->
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.MS_OAM_GSM_update" name="update">
                                                    <In>
                                                        <Parameter name="Dn_update">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                        <Parameter name="csLastUpdateTime">
                                                            <Val>0</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.MS_OAM_Subscription_PS_update" name="update">
                                                    <In>
                                                        <Parameter name="Dn_update">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                        <Parameter name="psLastUpdateTime">
                                                            <Val>0</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- 67386 Feature-->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                        <Set name="DN_GsmServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Set>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="csgContextList" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="create">
                                                    <Description>Create the csg data</Description>
                                                    <In>
                                                        <Parameter name="DN_GsmServiceProfile" />
                                                        <Parameter name="csgContextList" />
                                                        <Parameter name="visitedMmePlmnId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="csgSubscriptionData" />
                                                        <Parameter name="csgSendIDRFlag" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- Add end by fucong for 70018 on 20100729-->
<!--Begin add with feature 66935, wangying-->
                                    </Else>
                                </If>
<!--End add with feature 66935, wangying-->
<!-- 
        ***************************************************************************************
        *   1.27  call create ADD if fADD001 equals true
        *************************************************************************************** -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fADD001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>AddServiceData_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_ServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.LOC.ADD.LOC_OAM_ADD" name="create">
                                            <Description>Create ADD entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- begin 69781,yunqingg -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSMS113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>ExtendedMWD_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_ExtendedMWD">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                            <Description>Create ExtendedMWD entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ExtendedMWD" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- end 69781,yunqingg -->
<!-- timeStamp NGHLR1FAG197896 end -->
<!--Add for F71040 SDMA01FAG269410 begin-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                        <Val>true</Val>
                                    </Condition>
<!--Add by Guan Xiao for SDMA01FAG277804 Begin -->
                                    <Then>
                                        <Set name="appListActivateTracingImsi">
                                            <MultiValue>
                                                <Ref name="appListActivateTracingImsi" />
                                                <Val>UNRI</Val>
                                            </MultiValue>
                                        </Set>
                                    </Then>
<!--Add by Guan Xiao for SDMA01FAG277804 End -->
                                </If>
                                <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MSubIdentificationNumber_DN</Val>
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mobileCountryCodeId" />
                                    </In>
                                    <Out>
                                        <Parameter name="IMSI_DN">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                    <Description>qdiao1::::insertion modify IMSI_DN</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="IMSI_DN" />
                                        </Parameter>
                                        <Parameter name="appListActivateTracingImsi" />
                                    </In>
                                    <Out />
                                </CallBE>
<!--Add for F71040 SDMA01FAG269410 end-->
<!--For feature 69834 begin -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSA109" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <OR>
                                                <Condition operator="neq">
                                                    <Ref name="localMobileStationIdentity" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="vlrIsdn" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mscIsdn" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="roamingRestrictionFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="vlrUpdateFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="roamingCharactsFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="flagCffPlmn" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="supOfLocRegCount" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="locRegSubsPeriod" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gsmCamelPhase" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gsmNegocCamelPhases" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="odbUnsuppFeaturesFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="vlrBasServUnsuppFeaturesFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="vlrGenUnsuppFeaturesFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedCbocBsg" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedCboiBsg" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedCboehBsg" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="vlrLastGlobalUpdateTime" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="currentMapScreeningProfile" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedCbicBsg" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedCbicroamBsg" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="roamingCapabilityFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsEnhancementIndicator" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnGenUnsuppFeaturesFlags" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnIsdn" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnIp" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsCamelPhase" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsNegocCamelPhases" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnRoamingRestriction" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsNotReachableFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsNotReachableReason" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnLastGlobalUpdateTime" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="smscIsdn" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gsmNotReachableSMSFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gsmNotReachableReason" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="memoryCapacityExceededFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="timeStampWaitingSms" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="voiceMailOrigin" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="smscIsdnForExtMWD" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="timeStampWaitingSmsForExtMWD" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="voiceMailOriginForExtMWD" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addSource" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addRecache" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addCsCurrent" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addPsCurrent" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addImeiSv" />
                                                    <NotExist />
                                                </Condition>
<!--69915 begin-->
                                                <Condition operator="neq">
                                                    <Ref name="add3gpp2Meid" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addEpsMMECurrent" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="addEpsAAACurrent" />
                                                    <NotExist />
                                                </Condition>
<!--69915 end-->
                                                <Condition operator="neq">
                                                    <Ref name="addTimeStamp" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="cbPwdSuccErroneousAttempts" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeIdentity" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeLastGlobalUpdateTime" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="aaaIdentity" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="non3gppIpAccRegStatus" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="aaaUpdateFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="aaaLastGlobalUpdateTime" />
                                                    <NotExist />
                                                </Condition>
<!-- begin feature 69582, zeyangy, 2010-03-17 -->
                                                <Condition operator="neq">
                                                    <Ref name="msStatusInCS" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="msStatusInPS" />
                                                    <NotExist />
                                                </Condition>
<!-- end feature 69582, zeyangy, 2010-03-17 -->
<!-- Add for 70018, Shi Qin, 2010-06-18-->
                                                <Condition operator="neq">
                                                    <Ref name="urrpMmeFlag" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="visitedMmePlmnId" />
                                                    <NotExist />
                                                </Condition>
<!-- Add for 70018 End, Shi Qin, 2010-06-18-->
<!-- begin 70186guowei -->
                                                <Condition operator="neq">
                                                    <Ref name="gsmOfferedCAMEL4CSIs" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsOfferedCAMEL4CSIs" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gsmNegocCamelPhasesExt" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="gprsNegocCamelPhasesExt" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="inducedGsmSMSBAR" />
                                                    <NotExist />
                                                </Condition>
<!-- begin 70186 weichao -->
                                                <Condition operator="neq">
                                                    <Ref name="inducedGprsSMSBAR" />
                                                    <NotExist />
                                                </Condition>
<!-- begin 70186 weichao -->
<!-- end 70186guowei -->
                                            </OR>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="21">
                                                        <Frame FrameId="16107">
                                                            <StringAttributeType>
                                                                <Val>Location Data</Val>
                                                            </StringAttributeType>
                                                            <StringAttributeType>
                                                                <Val>fSA109 is false</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                    </Then>
                                    <Else>
<!--FR SDMA01FAG264590, begin by wang chunmei-->
                                        <If>
<!--AND-->
                                            <OR>
                                                <Condition operator="setGreater">
                                                    <Ref name="addImeiSv" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="add3gpp2Meid" />
                                                    <Null />
                                                </Condition>
                                            </OR>
<!--Condition operator="eq">
                  <Ref name="addSource" />
                  <Val>NONE</Val>
                   </Condition>
                </AND-->
                                            <Then>
                                                <Set name="addSource">
                                                    <Val>ADMIN</Val>
                                                </Set>
<!-- 73282-76 begin -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="supportIMEIInSh" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sqn4IMEI">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- 73282-76 end -->
                                            </Then>
                                        </If>
<!--FR SDMA01FAG264590, end by wang chunmei-->
                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>Virtual_INSERTION_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_LocationInsert">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.LOC.Location.LOC_OAM_Location_Insertion" name="create">
                                            <Description>Create Entry location insert</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_LocationInsert" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity" />
                                                <Parameter name="vlrIsdn" />
                                                <Parameter name="mscIsdn" />
                                                <Parameter name="roamingRestrictionFlags" />
                                                <Parameter name="vlrUpdateFlag" />
                                                <Parameter name="roamingCharactsFlags" />
                                                <Parameter name="flagCffPlmn" />
                                                <Parameter name="supOfLocRegCount" />
                                                <Parameter name="locRegSubsPeriod" />
                                                <Parameter name="gsmCamelPhase" />
                                                <Parameter name="gsmNegocCamelPhases" />
                                                <Parameter name="odbUnsuppFeaturesFlags" />
                                                <Parameter name="vlrBasServUnsuppFeaturesFlags" />
                                                <Parameter name="vlrGenUnsuppFeaturesFlags" />
                                                <Parameter name="inducedCbocBsg" />
                                                <Parameter name="inducedCboiBsg" />
                                                <Parameter name="inducedCboehBsg" />
                                                <Parameter name="vlrLastGlobalUpdateTime" />
                                                <Parameter name="currentMapScreeningProfile" />
                                                <Parameter name="inducedCbicBsg" />
                                                <Parameter name="inducedCbicroamBsg" />
                                                <Parameter name="roamingCapabilityFlags" />
                                                <Parameter name="sgsnUpdateFlag" />
                                                <Parameter name="gprsEnhancementIndicator" />
                                                <Parameter name="sgsnGenUnsuppFeaturesFlags" />
                                                <Parameter name="sgsnIsdn" />
                                                <Parameter name="sgsnIp" />
                                                <Parameter name="gprsCamelPhase" />
                                                <Parameter name="gprsNegocCamelPhases" />
                                                <Parameter name="sgsnRoamingRestriction" />
                                                <Parameter name="gprsNotReachableFlag" />
                                                <Parameter name="gprsNotReachableReason" />
                                                <Parameter name="sgsnLastGlobalUpdateTime" />
                                                <Parameter name="smscIsdn" />
                                                <Parameter name="gsmNotReachableSMSFlag" />
                                                <Parameter name="gsmNotReachableReason" />
                                                <Parameter name="memoryCapacityExceededFlag" />
                                                <Parameter name="timeStampWaitingSms" />
                                                <Parameter name="voiceMailOrigin" />
                                                <Parameter name="smscIsdnForExtMWD" />
                                                <Parameter name="timeStampWaitingSmsForExtMWD" />
                                                <Parameter name="voiceMailOriginForExtMWD" />
                                                <Parameter name="addSource" />
                                                <Parameter name="addRecache" />
                                                <Parameter name="addCsCurrent" />
                                                <Parameter name="addPsCurrent" />
                                                <Parameter name="addImeiSv" />
<!--69915 begin-->
                                                <Parameter name="add3gpp2Meid" />
                                                <Parameter name="addEpsMMECurrent" />
                                                <Parameter name="addEpsAAACurrent" />
<!--69915 end-->
                                                <Parameter name="addTimeStamp" />
                                                <Parameter name="cbPwdSuccErroneousAttempts" />
                                                <Parameter name="mmeIdentity" />
                                                <Parameter name="uePurgedInMme" />
                                                <Parameter name="mmeUpdateFlag" />
                                                <Parameter name="mmeLastGlobalUpdateTime" />
                                                <Parameter name="aaaIdentity" />
                                                <Parameter name="non3gppIpAccRegStatus" />
                                                <Parameter name="aaaUpdateFlag" />
                                                <Parameter name="aaaLastGlobalUpdateTime" />
<!-- begin feature 69582, zeyangy, 2010-03-17 -->
                                                <Parameter name="msStatusInCS" />
                                                <Parameter name="msStatusInPS" />
<!-- end feature 69582, zeyangy, 2010-03-17 -->
<!-- Add for 70018, Shi Qin, 2010-06-18-->
                                                <Parameter name="urrpMmeFlag" />
                                                <Parameter name="visitedMmePlmnId" />
<!-- Add for 70018 End, Shi Qin, 2010-06-18-->
<!-- begin 70186guowei -->
                                                <Parameter name="gsmNegocCamelPhasesExt" />
                                                <Parameter name="gprsNegocCamelPhasesExt" />
                                                <Parameter name="gsmOfferedCAMEL4CSIs" />
                                                <Parameter name="gprsOfferedCAMEL4CSIs" />
                                                <Parameter name="inducedGsmSMSBAR" />
                                                <Parameter name="inducedGprsSMSBAR" />
<!-- end 70186guowei -->
<!-- 73282-76, begin -->
                                                <Parameter name="sqn4IMEI" />
<!-- 73282-76, end -->
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Else>
                                </If>
<!-- Add begin by xiaozhxu for 68733 on 20101207 -->
                                <If>
                                    <OR>
                                        <Condition operator="setGreater">
                                            <Ref name="notificationToCseFlag" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cfGsmSCF1" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cfGsmSCF2" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cfGsmSCF3" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cbGsmSCF1" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cbGsmSCF2" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="cbGsmSCF3" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="odbGsmSCF1" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="odbGsmSCF2" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="odbGsmSCF3" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="csiGsmSCF1" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="csiGsmSCF2" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="csiGsmSCF3" />
                                            <Null />
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="DN_GsmSuppServiceProfile">
                                                    <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="DN_GsmServiceProfile" />
                                                </Set>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cfGsmSCF1" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cfGsmSCF1</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cfGsmSCF1" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF1" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cfGsmSCF1" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF1">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cfGsmSCF2" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cfGsmSCF2</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cfGsmSCF2" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF2" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cfGsmSCF2" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF2">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cfGsmSCF3" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cfGsmSCF3</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cfGsmSCF3" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF3" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cfGsmSCF3" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cfGsmSCF3">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cbGsmSCF1" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cbGsmSCF1</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cbGsmSCF1" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF1" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cbGsmSCF1" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF1">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cbGsmSCF2" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cbGsmSCF2</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cbGsmSCF2" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF2" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cbGsmSCF2" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF2">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="cbGsmSCF3" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>cbGsmSCF3</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="cbGsmSCF3" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF3" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="cbGsmSCF3" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="cbGsmSCF3">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="odbGsmSCF1" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>odbGsmSCF1</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="odbGsmSCF1" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF1" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="odbGsmSCF1" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF1">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="odbGsmSCF2" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>odbGsmSCF2</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="odbGsmSCF2" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF2" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="odbGsmSCF2" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF2">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="odbGsmSCF3" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>odbGsmSCF3</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="odbGsmSCF3" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF3" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="odbGsmSCF3" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="odbGsmSCF3">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="csiGsmSCF1" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>csiGsmSCF1</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="csiGsmSCF1" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF1" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="csiGsmSCF1" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF1">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="csiGsmSCF2" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>csiGsmSCF2</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="csiGsmSCF2" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF2" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="csiGsmSCF2" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF2">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="csiGsmSCF3" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                            <In>
                                                                <Parameter name="__SOURCE_NAME">
                                                                    <Val>csiGsmSCF3</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>countryCodeId</Val>
                                                                </Parameter>
                                                                <Parameter name="csiGsmSCF3" />
                                                                <Parameter name="countryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF3" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                    <Val>scpAddress</Val>
                                                                </Parameter>
                                                                <Parameter name="scpAddress">
                                                                    <Ref name="csiGsmSCF3" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="csiGsmSCF3">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="scpStateOfResource" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="scpStateOfResource" />
                                                                <Val>Free</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="scpStateOfResource">
                                                                            <Val>Free</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--Auto Resource end-->
                                                    </Then>
                                                </If>
<!-- After getting all LINK, check this Entry exsits -->
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfile" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                            <Description>Create the GsmSuppServiceProfile entry</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_GsmSuppServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="notificationToCseFlag" />
                                                                <Parameter name="cfGsmSCF1" />
                                                                <Parameter name="cfGsmSCF2" />
                                                                <Parameter name="cfGsmSCF3" />
                                                                <Parameter name="cbGsmSCF1" />
                                                                <Parameter name="cbGsmSCF2" />
                                                                <Parameter name="cbGsmSCF3" />
                                                                <Parameter name="odbGsmSCF1" />
                                                                <Parameter name="odbGsmSCF2" />
                                                                <Parameter name="odbGsmSCF3" />
                                                                <Parameter name="csiGsmSCF1" />
                                                                <Parameter name="csiGsmSCF2" />
                                                                <Parameter name="csiGsmSCF3" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify the GsmSuppServiceProfile entry</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_GsmSuppServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="notificationToCseFlag" />
                                                                <Parameter name="cfGsmSCF1" />
                                                                <Parameter name="cfGsmSCF2" />
                                                                <Parameter name="cfGsmSCF3" />
                                                                <Parameter name="cbGsmSCF1" />
                                                                <Parameter name="cbGsmSCF2" />
                                                                <Parameter name="cbGsmSCF3" />
                                                                <Parameter name="odbGsmSCF1" />
                                                                <Parameter name="odbGsmSCF2" />
                                                                <Parameter name="odbGsmSCF3" />
                                                                <Parameter name="csiGsmSCF1" />
                                                                <Parameter name="csiGsmSCF2" />
                                                                <Parameter name="csiGsmSCF3" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Else>
                                                </If>
                                            </Then>
<!--FR SDMA01FAG265274 -->
                                            <Else>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10050">
                                                            <StringAttributeType>
                                                                <Val>notificationToCseFlag or GsmSCF not allowed</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fCA3010</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Else>
                                        </If>
                                    </Then>
                                </If>
<!-- Add end by xiaozhxu for 68733 on 20101207 -->
<!--For feature 69834 begin -->
<!-- Add begin for feature 68733, 2010/12/07-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="DN_GsmSuppServiceProfileData">
                                            <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                        </Set>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfileData" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_ProcessNSDM" name="SetCheckFlagForNREQ">
                                                    <In>
                                                        <Parameter name="DN_GsmSuppServiceProfileData" />
                                                    </In>
                                                    <Out>
                                                        <AllParameters />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <In>
                                                        <Parameter name="needCheckCF" />
                                                        <Parameter name="needCheckCB" />
                                                        <Parameter name="needCheckODB" />
                                                        <Parameter name="needCheckCSI" />
                                                        <Parameter name="notificationToCseFlag" />
                                                        <Parameter name="mobileCountryCodeId" />
                                                        <Parameter name="mobileNetworkCodeId" />
                                                        <Parameter name="mSubIdentificationNumberId" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- Add for 73118 Weichung -->
                            </Then>
                        </If>
<!-- 
           *******************************************************************************************
                *   1.28  call create MdtDomain if fEPS111 is turn on, add by zhao nannan for 71037 begin
           ********************************************************************************************* -->
<!--the check of fEPS111 is down in the Interface of MdtDomain create request-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="mdtDomainIdEps" />
                                <Val>EPS</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Ref name="mdtDomainIdEps" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="32">
                                                <Frame FrameId="9">
                                                    <StringAttributeType>
                                                        <Val>DN_MdtDomain</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                    <Else>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="create">
                                            <Description>Create MdtDomain entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="jobType">
                                                    <Ref name="jobTypeEps" />
                                                </Parameter>
                                                <Parameter name="areaScope">
                                                    <Ref name="areaScopeEps" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrList">
                                                    <Ref name="eutranCGIStrListEps" />
                                                </Parameter>
                                                <Parameter name="lteTAStrList">
                                                    <Ref name="lteTAStrListEps" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4Lte">
                                                    <Ref name="listMeasurement4LteEps" />
                                                </Parameter>
                                                <Parameter name="reportingTrigger">
                                                    <Ref name="reportingTriggerEps" />
                                                </Parameter>
                                                <Parameter name="reportInterval">
                                                    <Ref name="reportIntervalEps" />
                                                </Parameter>
                                                <Parameter name="reportAmount">
                                                    <Ref name="reportAmountEps" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRP">
                                                    <Ref name="eventThresholdRSRPEps" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQ">
                                                    <Ref name="eventThresholdRSRQEps" />
                                                </Parameter>
                                                <Parameter name="loggingInterval">
                                                    <Ref name="loggingIntervalEps" />
                                                </Parameter>
                                                <Parameter name="loggingDuration">
                                                    <Ref name="loggingDurationEps" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Else>
                                </If>
                            </Then>
                        </If>
                        <If>
                            <Condition operator="eq">
                                <Ref name="mdtDomainIdPs" />
                                <Val>PS</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Ref name="mdtDomainIdPs" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="32">
                                                <Frame FrameId="9">
                                                    <StringAttributeType>
                                                        <Val>DN_MdtDomain</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                    <Else>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="create">
                                            <Description>Create MdtDomain entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="jobType">
                                                    <Ref name="jobTypePs" />
                                                </Parameter>
                                                <Parameter name="areaScope">
                                                    <Ref name="areaScopePs" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrList">
                                                    <Ref name="eutranCGIStrListPs" />
                                                </Parameter>
                                                <Parameter name="lteTAStrList">
                                                    <Ref name="lteTAStrListPs" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4Lte">
                                                    <Ref name="listMeasurement4LtePs" />
                                                </Parameter>
                                                <Parameter name="reportingTrigger">
                                                    <Ref name="reportingTriggerPs" />
                                                </Parameter>
                                                <Parameter name="reportInterval">
                                                    <Ref name="reportIntervalPs" />
                                                </Parameter>
                                                <Parameter name="reportAmount">
                                                    <Ref name="reportAmountPs" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRP">
                                                    <Ref name="eventThresholdRSRPPs" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQ">
                                                    <Ref name="eventThresholdRSRQPs" />
                                                </Parameter>
                                                <Parameter name="loggingInterval">
                                                    <Ref name="loggingIntervalPs" />
                                                </Parameter>
                                                <Parameter name="loggingDuration">
                                                    <Ref name="loggingDurationPs" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Else>
                                </If>
                            </Then>
                        </If>
                        <If>
                            <Condition operator="eq">
                                <Ref name="mdtDomainIdCs" />
                                <Val>CS</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Ref name="mdtDomainIdCs" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="32">
                                                <Frame FrameId="9">
                                                    <StringAttributeType>
                                                        <Val>DN_MdtDomain</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                    <Else>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="create">
                                            <Description>Create MdtDomain entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="jobType">
                                                    <Ref name="jobTypeCs" />
                                                </Parameter>
                                                <Parameter name="areaScope">
                                                    <Ref name="areaScopeCs" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrList">
                                                    <Ref name="eutranCGIStrListCs" />
                                                </Parameter>
                                                <Parameter name="lteTAStrList">
                                                    <Ref name="lteTAStrListCs" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4Lte">
                                                    <Ref name="listMeasurement4LteCs" />
                                                </Parameter>
                                                <Parameter name="reportingTrigger">
                                                    <Ref name="reportingTriggerCs" />
                                                </Parameter>
                                                <Parameter name="reportInterval">
                                                    <Ref name="reportIntervalCs" />
                                                </Parameter>
                                                <Parameter name="reportAmount">
                                                    <Ref name="reportAmountCs" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRP">
                                                    <Ref name="eventThresholdRSRPCs" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQ">
                                                    <Ref name="eventThresholdRSRQCs" />
                                                </Parameter>
                                                <Parameter name="loggingInterval">
                                                    <Ref name="loggingIntervalCs" />
                                                </Parameter>
                                                <Parameter name="loggingDuration">
                                                    <Ref name="loggingDurationCs" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Else>
                                </If>
                            </Then>
                        </If>
<!--
            **********************************************************************************************************************
            *   If the subscriber create is for Twin-IMSI master member,
            *   call MultiSim create request to create a MultSim group with the Twin-Imsi master member.
            **********************************************************************************************************************-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="twin_Imsi" />
                                <Val>Master</Val>
                            </Condition>
                            <Then>
<!--  Prepare SuMSubscriberProfile_DN as DN before invoking MultiSim create request. -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                    <Description>build SuMSubscriberProfile DN via suMSubscriberProfileId of the input DN</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>SuMSubscriberProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_SuMSubscriberProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
<!--
                     **************************************************************************************************************
                     *  Obtain Country Code, National Destination Code and Subscriber Number from the main MSISDN.                    
                     ************************************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                    <Description>extract cc ndc and sn from associatedMainMsisdn</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="associatedMainMsisdn" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>extract cc ndc and sn from associatedMainMsisdn</Description>
                                        <Parameter name="CommonPublicMsisdnCC">
                                            <Ref name="countryCodeId" />
                                        </Parameter>
                                        <Parameter name="CommonPublicMsisdnNDC">
                                            <Ref name="nationalDestinationCodeId" />
                                        </Parameter>
                                        <Parameter name="CommonPublicMsisdnSN">
                                            <Ref name="subscriberNumberId" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="getNRGKey">
                                    <Description>get the NRG key where the DN_SuMSubscriberProfile located</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_SuMSubscriberProfile" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="SuMSubscriberProfile_NRGKey">
                                            <Ref name="__NRG_KEY" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
<!--
                        ***********************************************************************************************************
                        *    Call BeString to create  MultiSIMMember1 string then call MultiSim create request to 
                        *    create Twin-IMSI master member.
                        ***********************************************************************************************************  -->
                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                    <Description>build MultiSIMMember1</Description>
                                    <In>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>MultiSIMMember1</Val>
                                        </Parameter>
                                        <Parameter name="__SYNTAX">
                                            <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                        </Parameter>
                                        <Parameter name="mobileCountryCodeId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="twin_Imsi_Add">
                                            <Val>ADD</Val>
                                        </Parameter>
                                        <Parameter name="nullString">
                                            <Null />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="MultiSIMMember1" />
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="create">
                                    <Description>call MultiSim create request to create Twin-IMSI master member</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_SuMSubscriberProfile" />
                                        </Parameter>
                                        <Parameter name="MultiSIMType">
                                            <Val>H_MSIM</Val>
                                        </Parameter>
<!--     <Parameter name="NRG_Id">
                                           <Ref name="SuMSubscriberProfile_NRGKey" />
                                       </Parameter>   -->
                                        <Parameter name="MultiSIMMember1" />
                                        <Parameter name="MasterSIM">
                                            <Val>1</Val>
                                        </Parameter>
                                        <Parameter name="CommonPublicMsisdnCC" />
                                        <Parameter name="CommonPublicMsisdnNDC" />
                                        <Parameter name="CommonPublicMsisdnSN" />
                                        <Parameter name="ExternalMemberMsisdn">
                                            <Null />
                                        </Parameter>
                                        <Parameter name="multiSimCharacteristics">
                                            <Val>MULTI_IMSI_SUB</Val>
                                        </Parameter>
                                        <Parameter name="multiSimAllowShared">
                                            <Val>true</Val>
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- End for 73118 by Weichung -->
<!-- 73282-62 begin -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="supportIpSmGwEnh" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
                            <Then>
<!-- 73282-05 begin -->
<!-- Convert scAddress4IPSM to scAddress4IPSMLink -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="scAddress4IPSM" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BeServiceNodeAddress" name="createServiceNode">
                                            <In>
                                                <Parameter name="serverAddress">
                                                    <Ref name="scAddress4IPSM" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="scAddress4IPSMLink">
                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out>
                                                <Parameter name="IMSI_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="IMSI_DN" />
                                                </Parameter>
                                                <Parameter name="scAddress4IPSMLink" />
                                            </In>
                                            <Out>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 73282-05 end -->
                                <If>
                                    <Condition operator="setLessOrEqual">
                                        <Ref name="IPSMGWRegisterAddress" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="12163" />
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>ExtendedMWD_DN</Val>
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mobileCountryCodeId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_ExtendedMWD">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ExtendedMWD" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
<!-- the function setEntryArrayValue has to create the Entry using GDMI interface; Here this entry needs to be removed in advance. Otherwise the duplicated error could happen. -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ExtendedMWD" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.LOC.*.BeCommonHandler" name="setEntryArrayValue">
                                    <Description />
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ExtendedMWD" />
                                        </Parameter>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>smscIsdnForExtMWD[12]</Val>
                                        </Parameter>
                                        <Parameter name="__SOURCE_NAME">
                                            <Val>IPSMGWRegisterAddress</Val>
                                        </Parameter>
                                        <Parameter name="IPSMGWRegisterAddress">
                                            <Ref name="IPSMGWRegisterAddress" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                            <Else>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="IPSMGWRegisterAddress" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="16107">
                                                    <StringAttributeType>
                                                        <Val>IP-SM-GW number</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>supportIpSmGwEnh is not true</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- 73282-05 begin -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="scAddress4IPSM" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="16107">
                                                    <StringAttributeType>
                                                        <Val>scAddress4IPSM</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>supportIpSmGwEnh is not true</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- 73282-05 end -->
                            </Else>
                        </If>
<!-- 73282-62 end -->
                        <Result />
                    </Request>
                    <Request name="modify">
                        <Description>
                            <Summary>The modify Operation enables to modify the common characteristics of a subscription</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
<!--
                        ***************************************************************************************
                        * 2. Modify Request 
                        *   2.0 prepare for postCommit
                        *       2.1   save input DN in local data DN_BasicSubscription
                        *   2.2   changeIMSI
                        *     2.2.1   controls (parameter and fonctions)
                        *     2.2.2   build  newIMSI_DN and oldIMSI_DN and newAUC_DN and oldAUC_DN
                        *     2.2.3   Control: old  IMSI is associated to mainMSISDN
                        *     2.2.4   IMSI-change-mode = AUTOCRE or MANUAL
                        *       2.2.4.1   Control: new exist in AUC
                        *           2.2.4.2   Control: new IMSI not exist
                        *       2.2.4.3  Control:Check whether two AUC numbers exist in the different NRG
                        *       2.2.4.4   Control: New or old IMSI is not already linked,then create newIMSI_DN and newADD_DN (67386)
                        *       2.2.4.5   IMSI-change-mode = AUTOCRE
                        *               2.2.4.5.1 Control: percentImsiChange is reached
                        *               2.2.4.5.2 Creation of link on old IMSI
                        *               2.2.4.5.3 Creation of link on new IMSI
                        *       2.2.4.6   IMSI-change-mode = MANUAL
                        *               2.2.4.6.1 Copy of oldIMSI attributs to newIMSI attributs
                        *               2.2.4.6.2 Prepare CREQ message
                        *               2.2.4.6.3 Modification of associatedIMSI(mainMSISDN and associatedMainMsisdn)
                        *               2.2.4.6.4 Deletion oldIMSI_DN(FR159458) and oldADD_DN(67386)
                        *     2.2.5   IMSI-change-mode = AUTODEL
                        *       2.2.5.1 Control: old IMSI is linked with imsiStatus=LKOLD
                        *       2.2.5.2 Control: old IMSI is well linked with new IMSI 
                        *       2.2.5.3 Control: new IMSI is linked with imsiStatus=LKNEW
                        *           2.2.5.4   Deletion of link on old IMSI
                        *           2.2.5.5   Deletion of link on new IMSIand deletion new IMSI_DN and new ADD_DN (67386)
                        *   2.3   subscriberModification 
                        *     2.3.1   accessRestrictionData allowed if F_SA_018 is active 
                        *     2.3.2   networkAccessMode is allowed if F_GPRS_001 is active
                        *     2.3.3   If F_SA_025 is active, newSuMSubscriptionProfileId value is authorized.
                        *     2.3.4   If the subscriber is linked to a multi-SIM subscriber, changing subscriber RDN not allowed.
                        *     2.3.5   Get old value of NAM 
                        *     2.3.6   analyse NAM change (set local data deleteGSM, createGSM, deleteGPRS, createGPRS)
                        *     2.3.7   treatement of BearerServiceWithoutSNList parameter
                        *           2.3.7.1  get oldBearerServiceNameList
                        *           2.3.7.2  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data)
                        *           2.3.7.3  SMSMTAL not allowed on BSwithoutSN
                        *           2.3.7.4  Subscription Type OC+TC mandatory except for SMSMT
                        *        NGHLR1FAG165519_4 Add check that BearerServiceWithoutSN must be autorized WITHOUT SN                       
                        *               2.3.7.5  create DN BSC corresponding to BearerService
                        *               2.3.7.6  if NAM changed to GPRSonly BS other than SMSMO and SMSMTPP are removed before set bscWithoutSN
                        *               2.3.7.7  else set bscWithoutSN
                        *               2.3.7.8  if no BearerServiceWithoutSNList in input, remove the existing 
                        *    2.3.8   treatement of ServiceNodeNotificationList parameter
                        *       2.3.8.1 control (conditioned by fLR017)
                        *           2.3.8.2  raz vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
                        *           2.3.8.3 foreach ServiceNodeNotification
                        *               2.3.8.3.1 extract trigger and SNaddress
                        *               2.3.8.3.2 control that the triggeringType is allowed 
                        *               2.3.8.3.3 set serverAddress
                        *               2.3.8.3.4 search if corresponding entry ServiceNodeAddress already exists
                        *               2.3.8.3.5 create ServiceNodeAddress entry if doest not exist
                        *               2.3.8.3.6 valorize vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
                        *    2.3.9   Other parameter
                                2.3.9.1 Modify smsRouteViaHNetwRoam
                        *       2.3.9.2 Modify serviceProviderReference
                        *     2.3.10  updating Entry BasicSubscription 
                        *     2.3.12   get associatedMainMsisdn
                        *     2.3.13   treatment of mainSNwithBearerService parameter
                        *           2.3.13.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName
                        *           2.3.13.2    build associatedBasicServices
                        *       NGHLR1FAG165519_5 Add check that mainSNwithBearerService must be autorized WITH SN                      
                        *               2.3.13.3    Subscription Type OC+TC mandatory except for SMSMT
                        *               2.3.13.4  BSN uniqueness control
                        *               2.3.13.5  check if GPRS provided (GPRSprovidedOnMain and BSotherthanGPRSprovidedOnMain local data)
                        *               2.3.13.6  build  new associatedMainMsisdn
                        *               2.3.13.7  create DN BSC corresponding to BearerCapabilityName
                        *               2.3.13.8  if NAM change
                        *               2.3.13.8.1  if NAM changed to noGPRS, BS GPRS is removed before set associatedBasicServices
                        *               2.3.13.8.2  if NAM changed to GPRSonly, BS other than SMSMOPP and SMSMTPP are removed before set associatedBasicServices
                        *               2.3.13.8.3  other NAM change, set associatedBasicServices
                        *               2.3.13.9  if no NAM change set associatedBasicServices
                        *               2.3.13.10 Incrementation of 1 of MSISDN counter
                        *     2.3.14   associatedBasicServices for MainSNwithBearerService must not be null
                        *     2.3.15  if BOTH at least one BS other than GPRS on Main 
                        *     2.3.16  if GPRS subscription, GPRS BS must be provided.Otherwise automatically set to main
                        *       update mainMSISDN
                        *     2.3.18  treatment of SNwithBearerServiceList parameter
                        *               2.3.18.1  raz  associatedBasicServices
                        *               2.3.18.2  get associatedMSISDN and alertMSISDN of IMSI and force alertMSISDN to null
                        *               2.3.18.3  MEDIATION Prepare of CREQ message
                        *               2.3.18.4  if NAM changed to GPRSonly, remove SNwithBS
                        *               2.3.18.5  Control: SN modified is not forwarded to number
                        *               2.3.18.6  update SNwithBearerServiceList
                        *               2.3.18.7  loop on SNwithBearerServiceList
                        *               2.3.18.7.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName
                        *               2.3.18.7.2  BSN uniqueness control
                        *               2.3.18.7.3  check if GPRS provided  (GPRSprovided and BSotherthanGPRSprovided local data)
                        *               2.3.18.7.4  create DN BSC corresponding to BearerCapabilityName
                        *               2.3.18.7.5  create DN MSISDN
                        *               2.3.18.7.6  if SMSMTAL fill alertMSISDN
                        *               2.3.18.7.7  if new MSISDN create Entry
                        *               2.3.18.7.8  if existing linked MSISDN and first time, modify associatedBasicServices
                        *               2.3.18.7.9  if existing linked MSISDN and not first time,update MSISDN with new BS
                        *               2.3.18.7.10  Subscription Type OC+TC mandatory except for SMSMT
                        *       NGHLR1FAG165519_6 Add check that SNwithBearerService must be autorized WITH SN                      
                        *               2.3.18.7.11  Incrementation of 1 of MSISDN counter
                        *               2.3.18.7.12  find the existing  MSISDN
                        *               2.3.18.8  find associated MSISDN to delete
                        *               2.3.18.9  alert MSISDN must have another BS
                        *               2.3.18.10  update associatedMSISDN and alertMSISDN of IMSI
                        *     2.3.19    Control: Maximun number of MSISDN per subscription is not reached
                        *     2.3.20    Control: Maximun number of MSISDN is not reached
                        *       2.3.20.1    Control: Maximun number of subscriptions is not reached
                        *     2.3.21    NAM change with management of restriction lists 
                        *           2.3.21.1  build CsServiceProfile and PsServiceProfile
                        *           2.3.21.2  call create CsServiceProfile if createGSM true
                        *           2.3.21.3  call create PsServiceProfile if createGPRS true
                        *           2.3.21.4  call delete CsServiceProfile if deleteGSM true
                        *           2.3.21.5  call delete PsServiceProfile if deleteGPRS true
                        *       2.3.22 NGHLR1FAG169606:each time when BSCs of a subscriber modified
                        *           2.3.20.1    GetoldBSGlist from the oldBSCnamelist
                        *           2.3.20.2    GetnewBSGlist 
                        *           2.3.20.3    get the BSG deleted
                        *           2.3.20.4    if there is BSG deleted ,check SSs(OSSS,CB,CF,CW,CUG) if the BSGs are still apllicable,if not delete the SS
                        *           //NGHLR1FAG199372 and NGHLR1FAG199610, remove MSISDN to check the condition to operate the underTestImsi and testNewImsi
                        *       2.3.23 Change Key
                        *           2.3.22.3  Call BE HSS.SUB.*.BeChangeSubKey with newSuMSubscriberProfileId and  newSuMSubscriptionProfileId.
                        *************************************************************************************** -->
                        <ReqParameters>
                            <Optional name="MainSNwithBearerService" />
                            <Optional name="SNwithBearerServiceList" />
                            <Optional name="BearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 begin-->
                            <Optional name="ExtendedBearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 end-->
                            <Optional name="ServiceNodeNotificationList" />
                            <Optional name="networkAccessMode" />
                            <Optional name="accessRestrictionData" />
<!-- Change IMSI -->
<!--        <Optional name="newMobileCountryCodeId"/> -->
<!-- Feature 67386-->
                            <Optional name="addService" />
<!-- add for feature 67393 Start-->
                            <Optional name="subscriberType" />
<!-- add for feature 67393 End-->
<!--Add for 71037 qdiao begin-->
                            <Optional name="icsIndicator" />
<!--Add for 71037 qdiao end-->
<!-- add for feature 67398 Start-->
                            <Optional name="smsRouteViaHNetwRoam" />
<!-- add for feature 67398 End-->
<!-- add for feature 67435 Start-->
                            <Optional name="serviceProviderReference" />
<!-- add for feature 67435 End-->
<!-- Change IMSI -->
                            <Optional name="newMobileCountryCodeId" />
                            <Optional name="newMobileNetworkCodeId" />
                            <Optional name="newMSubIdentificationNumberId" />
                            <Optional name="IMSI_Change_Mode" />
                            <Optional name="typeOfModification" />
<!--add for feature 73024 start-->
                            <Optional name="tracingLevelEps" />
                            <Optional name="appListActivateTracingEps" />
                            <Optional name="tracingSubProfileIdEPS" />
                            <Optional name="tracingMSISDN" />
<!--add for feature 73024 end -->
<!-- timeStamp -->
                            <Optional name="deactivatedSubscription" />
<!-- Add for feature (MapScreening) Start -->
                            <Optional name="mapScreeningCategory" />
<!-- Add for feature (MapScreening) End -->
<!-- Change SuMSubscriberProfileId and SuMSubscriptionProfileId -->
                            <Optional name="newSuMSubscriberProfileId" />
                            <Optional name="newSuMSubscriptionProfileId" />
                            <Optional name="prepayCommonGroupId" />
                            <Optional name="prepay" />
<!-- Add for feature 69834 start -->
                            <Optional name="dateOfLinkExpiry" />
<!-- Add for feature 69834 end -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                            <Optional name="csgContextList" />
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- SDMA01CAG258860 begin -->
                            <Optional name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
<!-- Add begin by xiaozhxu for 68733 on 20101206 -->
                            <Optional name="notificationToCseFlag" />
                            <Optional name="cfGsmSCF1" />
                            <Optional name="cfGsmSCF2" />
                            <Optional name="cfGsmSCF3" />
                            <Optional name="cbGsmSCF1" />
                            <Optional name="cbGsmSCF2" />
                            <Optional name="cbGsmSCF3" />
                            <Optional name="odbGsmSCF1" />
                            <Optional name="odbGsmSCF2" />
                            <Optional name="odbGsmSCF3" />
                            <Optional name="csiGsmSCF1" />
                            <Optional name="csiGsmSCF2" />
                            <Optional name="csiGsmSCF3" />
<!-- Add end by xiaozhxu for 68733 on 20101206 -->
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
                            <Optional name="deactivatedDomains" />
<!-- add end by weimingm for F73419 on 2012-12-11 -->
<!-- 73282-05,62 begin -->
                            <Optional name="scAddress4IPSM" />
                            <Optional name="IPSMGWRegisterAddress" />
<!-- 73282-05,62 end -->
<!-- add begin by kuibing for F73248 on 2013-3-1 -->
                            <Optional name="removeAllAssociatedMSISDN" />
<!-- add end by kuibing for F73248 on 2013-3-1 -->
                        </ReqParameters>
<!--add for 70200-->
                        <CallBE name="getR30upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                            <Description>modify***build DN from SuMSubscriberProfile entry</Description>
                            <Out>
                                <Parameter name="Upgradeflag" />
                            </Out>
                        </CallBE>
<!--end for 70200-->
<!-- 70719, zeyangy, 2010-08-23, begin -->
                        <CallBE name="getR21upgradeflag" entityName="HSS.SUB.*.BeUpgradeFlag">
                            <Description>Get R21upgradeFlag</Description>
                            <Out>
                                <Parameter name="Upgradeflag2" />
                            </Out>
                        </CallBE>
<!-- 70719, zeyangy, 2010-08-23, end -->
<!--begin for dual logic by guowei in F70186-->
                        <CallBE name="getR31upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                            <Description>build DN from SuMSubscriberProfile entry</Description>
                            <Out>
                                <Parameter name="Upgradeflag31">
                                    <Ref name="Upgradeflag" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!--end for dual logic by guowei in F70186-->
<!--Add for 71037 qdiao begin-->
                        <Set name="DN_GsmSUB">
                            <Ref name="__DISTINGUISH_NAME" />
                        </Set>
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="icsIndicator" delta="changed" />
                                    <Null />
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="icsIndicator" />
                                    <Null />
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="isIcsIndicatorChanged">
                                    <Val>true</Val>
                                </Set>
                                <CallBE entityName="PostCommitBeContext" name="modify">
                                    <Description>put icsIndicator related data into post commit</Description>
                                    <In>
                                        <Parameter name="icsIndicator" />
                                        <Parameter name="isIcsIndicatorChanged" />
                                        <Parameter name="modifyOtherMemberFlag">
                                            <Val>true</Val>
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!--Add for 71037 qdiao end-->
<!--Add for 73118 qdiao begin 032012-->
                        <Set name="subscriberType_para">
                            <Ref name="subscriberType" />
                        </Set>
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>- Query on Entry SuMSubscriptionProfile</Description>
                            <In>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>subscriberType</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="subscriberType_old">
                                    <Ref name="subscriberType" />
                                </Parameter>
                            </Out>
                        </CallBE>
                        <Set name="subscriberType">
                            <Ref name="subscriberType_para" />
                        </Set>
<!-- Begin added by F72874, Austin, 2012-6-12, -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="subscriberType_old" />
                                    <Val>Shared_PROFILE</Val>
                                </Condition>
                                <Condition operator="neq">
                                    <Ref name="subscriberType" />
                                    <Val>Shared_PROFILE</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <ThrowException>
                                    <Error ErrorId="21">
                                        <Frame FrameId="12148">
                                            <StringAttributeType>
                                                <Val>subscriberType</Val>
                                            </StringAttributeType>
                                            <StringAttributeType>
                                                <Val>Shared_PROFILE</Val>
                                            </StringAttributeType>
                                        </Frame>
                                    </Error>
                                </ThrowException>
                            </Then>
                        </If>
                        <If>
                            <AND>
                                <Condition operator="neq">
                                    <Ref name="subscriberType_old" />
                                    <Val>Shared_PROFILE</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="subscriberType" />
                                    <Val>Shared_PROFILE</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <ThrowException>
                                    <Error ErrorId="21">
                                        <Frame FrameId="12149">
                                            <StringAttributeType>
                                                <Val>subscriberType</Val>
                                            </StringAttributeType>
                                            <StringAttributeType>
                                                <Val>Shared_PROFILE</Val>
                                            </StringAttributeType>
                                        </Frame>
                                    </Error>
                                </ThrowException>
                            </Then>
                        </If>
<!-- End added by F72874, Austin, 2012-6-12, -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="typeOfModification" />
                                <NotExist />
                            </Condition>
                            <Then>
                                <Set name="typeOfModification">
                                    <Val>subscriberModification</Val>
                                </Set>
                            </Then>
                        </If>
<!-- 73251 b -->
                        <Set name="isSlaveModify">
                            <Val>false</Val>
                        </Set>
<!-- 73251 e -->
                        <If>
                            <AND>
                                <Condition operator="notNullIntersection">
                                    <Ref name="subscriberType_old" />
                                    <Val>SHARED_SUBS_SLAVE</Val>
                                </Condition>
                                <Condition operator="neq">
                                    <Ref name="typeOfModification" />
                                    <Val>changeIMSI</Val>
                                </Condition>
<!-- 73251 b -->
                                <Condition operator="eq">
                                    <Ref name="fMSIMSubsBySlaveIMSI" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                    <Val>false</Val>
                                </Condition>
<!-- 73251 e -->
                            </AND>
                            <Then>
                                <ThrowException>
                                    <Error ErrorId="21">
                                        <Frame FrameId="12148">
                                            <StringAttributeType>
                                                <Val>GSM Data</Val>
                                            </StringAttributeType>
                                            <StringAttributeType>
                                                <Val>Slave Subscriber</Val>
                                            </StringAttributeType>
                                        </Frame>
                                    </Error>
                                </ThrowException>
                            </Then>
                            <Else>
<!-- 73251 b -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="MainSNwithBearerService" delta="changed" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="32">
                                                <Frame FrameId="12139">
                                                    <StringAttributeType>
                                                        <Val>MainSNwithBearerService</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkSlaveModify">
                                    <Description />
                                    <In>
                                        <Parameter name="subscriberType_old" />
                                        <Parameter name="MainSNwithBearerService" />
                                        <Parameter name="SNwithBearerServiceList" />
                                        <Parameter name="BearerServiceWithoutSNList" />
                                        <Parameter name="ExtendedBearerServiceWithoutSNList" />
                                        <Parameter name="ServiceNodeNotificationList" />
                                        <Parameter name="networkAccessMode" />
                                        <Parameter name="accessRestrictionData" />
                                        <Parameter name="addService" />
                                        <Parameter name="subscriberType" />
                                        <Parameter name="icsIndicator" />
                                        <Parameter name="smsRouteViaHNetwRoam" />
                                        <Parameter name="serviceProviderReference" />
                                        <Parameter name="newMobileCountryCodeId" />
                                        <Parameter name="newMobileNetworkCodeId" />
                                        <Parameter name="newMSubIdentificationNumberId" />
                                        <Parameter name="IMSI_Change_Mode" />
                                        <Parameter name="typeOfModification" />
                                        <Parameter name="tracingLevelEps" />
                                        <Parameter name="appListActivateTracingEps" />
                                        <Parameter name="tracingSubProfileIdEPS" />
                                        <Parameter name="tracingMSISDN" />
                                        <Parameter name="deactivatedSubscription" />
                                        <Parameter name="mapScreeningCategory" />
                                        <Parameter name="newSuMSubscriberProfileId" />
                                        <Parameter name="newSuMSubscriptionProfileId" />
                                        <Parameter name="prepayCommonGroupId" />
                                        <Parameter name="prepay" />
                                        <Parameter name="dateOfLinkExpiry" />
                                        <Parameter name="csgContextList" />
                                        <Parameter name="portoutFlag" />
                                        <Parameter name="notificationToCseFlag" />
                                        <Parameter name="cfGsmSCF1" />
                                        <Parameter name="cfGsmSCF2" />
                                        <Parameter name="cfGsmSCF3" />
                                        <Parameter name="cbGsmSCF1" />
                                        <Parameter name="cbGsmSCF2" />
                                        <Parameter name="cbGsmSCF3" />
                                        <Parameter name="odbGsmSCF1" />
                                        <Parameter name="odbGsmSCF2" />
                                        <Parameter name="odbGsmSCF3" />
                                        <Parameter name="csiGsmSCF1" />
                                        <Parameter name="csiGsmSCF2" />
                                        <Parameter name="csiGsmSCF3" />
                                        <Parameter name="deactivatedDomains" />
                                        <Parameter name="scAddress4IPSM" />
                                        <Parameter name="IPSMGWRegisterAddress" />
                                        <Parameter name="removeAllAssociatedMSISDN" />
                                    </In>
                                    <Out>
                                        <Parameter name="isSlaveModify" />
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="isSlaveModify" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="networkAccessMode">
                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        </Set>
                                    </Then>
                                </If>
<!-- 73251 e -->
                                <If>
                                    <AND>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType_old" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                        <Condition operator="nullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="21">
                                                <Frame FrameId="12148">
                                                    <StringAttributeType>
                                                        <Val>subscriberType</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>SHARED_SUBS</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="nullIntersection">
                                            <Ref name="subscriberType_old" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="21">
                                                <Frame FrameId="12149">
                                                    <StringAttributeType>
                                                        <Val>subscriberType</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>SHARED_SUBS</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="nullIntersection">
                                            <Ref name="subscriberType_old" />
                                            <Val>SHARED_SUBS_SLAVE</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS_SLAVE</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="21">
                                                <Frame FrameId="12149">
                                                    <StringAttributeType>
                                                        <Val>subscriberType</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>SHARED_SUBS_SLAVES</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!--Add for 73118 qdiao end 032012-->
<!-- 
                        ***************************************************************************************
                        *   2.0   prepare for postcommit
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.SupplementaryService.BeInitMediation" name="create" />
<!--CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubServicesList" name="create"/-->
<!-- Throughout this interface logic, when accessing IMSI roaming data, new logic is added to consider Twin-IMSI case..
     For Twin-IMSI (73118) case, if the active member is a Twin-IMSI slave member,
     set roaming_Imsi to actveTwinImsi, which is put into PostCommitBeContext when BeInitMediation is called,
     to access IMSI roaming data. 
     If the active IMSI is not a Twin-IMSI slave case, set roaming_Imsi to associatedIMSI to access IMSI data. -->
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                <If>
                                    <Condition operator="setLessOrEqual">
                                        <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="roaming_Imsi">
                                            <Ref name="associatedIMSI" />
                                        </Set>
                                    </Then>
                                    <Else>
                                        <Set name="roaming_Imsi">
                                            <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                        </Set>
                                    </Else>
                                </If>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
<!-- Add by wupingfan.Query the returnErrorForNoEpsSub for confEpsData.-->
<!-- Update by wupingfan.There is no need to check this data,So comment it.-->
<!-- Update by wupingfan.Extract the all 3gppApnCtxList and Non3gppApnCtxList from epsApnContextSetList,and Put it to PostCommitBeContext.-->
<!-- Add begin by Guangli for 69894 on 20100316 -->
<!-- Deleted begin by LIU Yang -->
<!--     <If>
                                    <AND>
                                        <Condition operator="neq">
                                            <Ref name="networkAccessMode" />
                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>PsServiceProfile_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_PsServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_PsServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>odbSpecificToPs</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="odbSpecificToPs" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="odbSpecificToPs" />
                                                    <Val>ODBPS</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="odbSpecificToPs" />
                                                    <Val>ODBPSHR</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="odbSpecificToPs" />
                                                    <Val>ODBPSVR</Val>
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <Set name="mmeSupportedServices">
                                                    <Null />
                                                </Set>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>EquipmentIdentity_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="equipmentIdentityId">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="equipmentTypeId">
                                                            <Val>MME</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_EquipmentIdentity">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>check existence of MME data</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_EquipmentIdentity" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query mmeSupportedServices</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_EquipmentIdentity" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>mmeSupportedServices</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="mmeSupportedServices" />
                                                            </Out>
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <In>
                                                <Parameter name="mmeSupportedServices" />
                                                <Parameter name="odbSpecificToPs" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>         -->
<!-- Deleted end by LIU Yang -->
<!-- Add end by Guangli for 69894 on 20100316 -->
                                <Set name="epsApnContextSetList">
                                    <Ref name="epsApnContextSetList" delta="old" />
                                </Set>
                                <Set name="framedPoolSetList">
                                    <Ref name="framedPoolSetList" delta="old" />
                                </Set>
                                <Set name="threegppEpsApnContextSetList">
                                    <Null />
                                </Set>
                                <Set name="Non3gppEpsApnContextSetList">
                                    <Null />
                                </Set>
<!-- Add for D55, SQ, 2009/11/20 -->
                                <Set name="specificApnContextList">
                                    <Ref name="specificApnContextList" delta="old" />
                                </Set>
<!-- Add for D55, SQ, 2009/11/20 -->
<!-- Begin for SDMA01FAG280431 by Guan Xiao -->
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" name="fEps105" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="epsApnContextSetList" />
                                            <Null />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fEps102" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="IdentityExistValue">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                            <Else>
                                                <Set name="IdentityExistValue">
                                                    <Val>false</Val>
                                                </Set>
                                            </Else>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fPs102" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="DeactivedExistValue">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                            <Else>
                                                <Set name="DeactivedExistValue">
                                                    <Val>false</Val>
                                                </Set>
                                            </Else>
                                        </If>
<!--If>
                                            <Condition operator="eq">
                                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" name="supportVzWAAAIPv6Data" />
                                                <Val>false</Val>
                                            </Condition>
                                            <Then-->
                                        <CallBE entityName="HSS.SUB.*.BeCombinList" name="combinListForCreate">
                                            <Description />
                                            <In>
                                                <Parameter name="epsApnContextSetList" />
                                                <Parameter name="framedPoolSetList" />
                                                <Parameter name="IdentityExistValue" />
                                                <Parameter name="DeactivedExistValue" />
                                            </In>
                                            <Out>
                                                <Parameter name="epsApnContextSetList" />
                                                <Parameter name="framedPoolSetList" />
                                            </Out>
                                        </CallBE>
<!--/Then>
                                        </If-->
                                    </Then>
                                </If>
<!-- End for SDMA01FAG280431 by Guan Xiao -->
                                <Foreach name="epsApnContextSetListElement">
                                    <MultiValue>
                                        <Ref name="epsApnContextSetList" />
                                    </MultiValue>
<!--********************************************-->
<!-- 7.2 Extract parameters of epsApnContextSet -->
<!--********************************************-->
                                    <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_EPS_internal" name="ExtractEpsApnContext">
                                        <Description>Extract parameters of epsApnContextSet</Description>
                                        <In>
                                            <Parameter name="epsApnContextSetStr">
                                                <Ref name="epsApnContextSetListElement" />
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="epsApnContextSetIdx" />
                                            <Parameter name="accessInd3gppNon3gpp" />
<!-- modify begin by Guangli for 69915 on 20100330-->
<!-- Parameter name="defaultApnContextInd"/-->
                                            <Parameter name="default3gppNon3gpp" />
<!-- modify end by Guangli for 69915 on 20100330-->
<!-- Add begin by fucong for 70018 on 20100906 -->
                                            <Parameter name="epsProfileIdx" />
                                            <Parameter name="epsApnContextDeactivated" />
                                            <Parameter name="servedPartyIpAddress1" />
                                            <Parameter name="servedPartyIpAddress2" />
                                            <Parameter name="pdnGwIpAddress1" />
                                            <Parameter name="pdnGwIpAddress2" />
                                            <Parameter name="pdnGwHost" />
                                            <Parameter name="pdnGwRealm" />
                                            <Parameter name="pdnGwPlmnIdentity" />
<!-- Add end by fucong for 70018 on 20100906 -->
<!-- Add begin by pomykala for 72989 on 20120416 -->
                                            <Parameter name="framedPoolNameIpv4" />
                                            <Parameter name="framedPoolNameIpv6" />
                                            <Parameter name="starentSubPermission" />
<!-- Add end, pomykala, 72989 on 20120416 -->
<!--Begin added by F71037, Austin, 2012-12-5 -->
                                            <Parameter name="epsSipto" />
                                            <Parameter name="lipaPermission" />
                                            <Parameter name="apnLevelAOR" />
<!--End added by F71037, Austin, 2012-12-5 -->
<!--Added for 73247 begin -->
                                            <Parameter name="epsFramedIPv6Prefix" />
                                            <Parameter name="epsFramedInterfaceId" />
                                            <Parameter name="timestampForIpv6" />
                                        </Out>
                                    </CallBE>
<!--Added for 73247 end -->
<!-- Add begin by fucong for 70018 on 20100906 -->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="fPs102" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                            <Val>false</Val>
                                        </Condition>
                                        <Then>
                                            <Set name="epsApnContextDeactivatedStr">
                                                <Null />
                                            </Set>
                                            <Set name="epsApnContextDeactivated">
                                                <Null />
                                            </Set>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                <In>
                                                    <Parameter name="__SYNTAX">
<!-- modify for 72989 begin, pomykala, 20120416 -->
<!--epsSipto/lipaPermission/apnLevelAOR are added by F71037, Austin, 2012-12-5 -->
                                                        <Val>epsApnContextSetIdx/epsProfileIdx/accessInd3gppNon3gpp/servedPartyIpAddress1/servedPartyIpAddress2/pdnGwIpAddress1/pdnGwIpAddress2/pdnGwHost/pdnGwRealm/pdnGwPlmnIdentity/default3gppNon3gpp/epsApnContextDeactivatedStr/epsSipto/lipaPermission/apnLevelAOR/framedPoolNameIpv4/framedPoolNameIpv6/starentSubPermission/epsFramedIPv6Prefix/epsFramedInterfaceId/timestampForIpv6</Val>
<!-- modify end for 72989 begin, pomykala, 20120416 -->
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>epsApnContextSetListElement</Val>
                                                    </Parameter>
                                                    <Parameter name="epsApnContextSetIdx" />
                                                    <Parameter name="epsProfileIdx" />
                                                    <Parameter name="accessInd3gppNon3gpp" />
                                                    <Parameter name="servedPartyIpAddress1" />
                                                    <Parameter name="servedPartyIpAddress2" />
                                                    <Parameter name="pdnGwIpAddress1" />
                                                    <Parameter name="pdnGwIpAddress2" />
                                                    <Parameter name="pdnGwHost" />
                                                    <Parameter name="pdnGwRealm" />
                                                    <Parameter name="default3gppNon3gpp" />
                                                    <Parameter name="pdnGwPlmnIdentity" />
<!-- Add begin by dorothy for 72989 on 20120416 -->
                                                    <Parameter name="framedPoolNameIpv4" />
                                                    <Parameter name="framedPoolNameIpv6" />
                                                    <Parameter name="starentSubPermission" />
                                                    <Parameter name="epsApnContextDeactivated" />
<!-- Add end,pomykala,72989,20120416, query only:epsFramedIPv6Prefix,epsFramedInterfaceId,timestampForIpv6 -->
<!--Begin added by F71037, Austin, 2012-12-5 -->
                                                    <Parameter name="epsSipto" />
                                                    <Parameter name="lipaPermission" />
                                                    <Parameter name="apnLevelAOR" />
<!--End added by F71037, Austin, 2012-12-5 -->
<!-- Added for 73247 -->
                                                    <Parameter name="epsFramedIPv6Prefix" />
                                                    <Parameter name="epsFramedInterfaceId" />
                                                    <Parameter name="timestampForIpv6" />
                                                </In>
                                                <Out>
                                                    <Parameter name="epsApnContextSetListElement" />
                                                </Out>
                                            </CallBE>
                                        </Then>
                                        <Else>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="epsApnContextDeactivated" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="epsApnContextDeactivatedStr">
                                                        <Val>1</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="epsApnContextDeactivatedStr">
                                                        <Val>0</Val>
                                                    </Set>
                                                </Else>
                                            </If>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                <In>
                                                    <Parameter name="__SYNTAX">
<!-- modify for 72989 begin, nian, 2012-03-02 -->
<!--epsSipto/lipaPermission/apnLevelAOR are added by F71037, Austin, 2012-12-5 -->
                                                        <Val>epsApnContextSetIdx/epsProfileIdx/accessInd3gppNon3gpp/servedPartyIpAddress1/servedPartyIpAddress2/pdnGwIpAddress1/pdnGwIpAddress2/pdnGwHost/pdnGwRealm/pdnGwPlmnIdentity/default3gppNon3gpp/epsApnContextDeactivatedStr/epsSipto/lipaPermission/apnLevelAOR/framedPoolNameIpv4/framedPoolNameIpv6/starentSubPermission/epsFramedIPv6Prefix/epsFramedInterfaceId/timestampForIpv6</Val>
<!-- modify end for 72989 begin, nian, 2012-03-02 -->
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>epsApnContextSetListElement</Val>
                                                    </Parameter>
                                                    <Parameter name="epsApnContextSetIdx" />
                                                    <Parameter name="epsProfileIdx" />
                                                    <Parameter name="accessInd3gppNon3gpp" />
                                                    <Parameter name="servedPartyIpAddress1" />
                                                    <Parameter name="servedPartyIpAddress2" />
                                                    <Parameter name="pdnGwIpAddress1" />
                                                    <Parameter name="pdnGwIpAddress2" />
                                                    <Parameter name="pdnGwHost" />
                                                    <Parameter name="pdnGwRealm" />
                                                    <Parameter name="default3gppNon3gpp" />
                                                    <Parameter name="pdnGwPlmnIdentity" />
<!-- Add begin by pomykala for 72989 on 20120416 -->
                                                    <Parameter name="framedPoolNameIpv4" />
                                                    <Parameter name="framedPoolNameIpv6" />
                                                    <Parameter name="starentSubPermission" />
<!-- Add end, pomykala for 72989 on 20120416  -->
                                                    <Parameter name="epsApnContextDeactivated" />
<!--Begin added by F71037, Austin, 2012-12-5 -->
                                                    <Parameter name="epsSipto" />
                                                    <Parameter name="lipaPermission" />
                                                    <Parameter name="apnLevelAOR" />
<!--End added by F71037, Austin, 2012-12-5 -->
<!-- Added for 73247 -->
                                                    <Parameter name="epsFramedIPv6Prefix" />
                                                    <Parameter name="epsFramedInterfaceId" />
                                                    <Parameter name="timestampForIpv6" />
                                                </In>
                                                <Out>
                                                    <Parameter name="epsApnContextSetListElement" />
                                                </Out>
                                            </CallBE>
                                        </Else>
                                    </If>
<!-- Add end by fucong for 70018 on 20100906 -->
<!-- Add begin by fucong for 70018 on 20100906 -->
                                    <If>
<!-- Modify begin by Guangli for 69915 on 20100201-->
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="accessInd3gppNon3gpp" />
                                                <Val>3GPP</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="accessInd3gppNon3gpp" />
                                                <Val>BOTH</Val>
                                            </Condition>
                                        </OR>
                                        <Then>
                                            <Set name="threegppEpsApnContextSetList">
                                                <MultiValue>
                                                    <Ref name="epsApnContextSetListElement" />
                                                    <Ref name="threegppEpsApnContextSetList" />
                                                </MultiValue>
                                            </Set>
                                            <If>
<!--Condition operator="eq">
                                            <Ref name="defaultApnContextInd"/>
                                            <Val>1</Val>
                                        </Condition-->
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="default3gppNon3gpp" />
                                                        <Val>3GPP</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="default3gppNon3gpp" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </OR>
<!-- Modify end by Guangli for 69915 on 20100201-->
                                                <Then>
                                                    <Set name="dflt3gppEpsApnContextSetIdx">
                                                        <Ref name="epsApnContextSetIdx" />
                                                    </Set>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
                                    <If>
<!-- Modify begin by Guangli for 69915 on 20100201-->
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="accessInd3gppNon3gpp" />
                                                <Val>Non3GPP</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="accessInd3gppNon3gpp" />
                                                <Val>BOTH</Val>
                                            </Condition>
                                        </OR>
                                        <Then>
                                            <Set name="Non3gppEpsApnContextSetList">
                                                <MultiValue>
                                                    <Ref name="epsApnContextSetListElement" />
                                                    <Ref name="Non3gppEpsApnContextSetList" />
                                                </MultiValue>
                                            </Set>
                                            <If>
<!--Condition operator="eq">
                                            <Ref name="defaultApnContextInd"/>
                                            <Val>1</Val>
                                        </Condition-->
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="default3gppNon3gpp" />
                                                        <Val>Non3GPP</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="default3gppNon3gpp" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </OR>
<!-- Modify end by Guangli for 69915 on 20100201-->
                                                <Then>
                                                    <Set name="dfltNon3gppEpsApnContextSetIdx">
                                                        <Ref name="epsApnContextSetIdx" />
                                                    </Set>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
                                </Foreach>
<!-- Add for D55, SQ, 2009/11/17-->
<!--********************************************-->
<!--    Prepare specific APN list for PostCommit -->
<!--********************************************-->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="specificApnContextList" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Foreach name="specificApnContextListElement">
                                            <MultiValue>
                                                <Ref name="specificApnContextList" />
                                            </MultiValue>
                                            <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_EPS_internal" name="ExtractSpecificApnContext">
                                                <Description>Extract parameters of specificAPNContext</Description>
                                                <In>
                                                    <Parameter name="specificApnStr">
                                                        <Ref name="specificApnContextListElement" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="specificApnDataId" />
                                                    <Parameter name="specificApn" />
                                                    <Parameter name="specificApn3gppAccessInd" />
                                                    <Parameter name="specificApnInforPdnGwIpAddr1" />
                                                    <Parameter name="specificApnInforPdnGwIpAddr2" />
                                                    <Parameter name="specificApnInforPdnGwHost" />
                                                    <Parameter name="specificApnInforPdnGwRealm" />
<!-- Add begin by fucong for 70018 on 20100906 -->
                                                    <Parameter name="specificApnInforPdnGwPlmnIdentity" />
<!-- Add end by fucong for 70018 on 20100906 -->
                                                </Out>
                                            </CallBE>
<!-- Add begin by fucong for 70018 on 20100906 -->
                                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                <In>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>specificApnDataId/specificApn/specificApn3gppAccessInd/specificApnInforPdnGwIpAddr1/specificApnInforPdnGwIpAddr2/specificApnInforPdnGwHost/specificApnInforPdnGwRealm/specificApnInforPdnGwPlmnIdentity</Val>
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>specificApnContextListElement</Val>
                                                    </Parameter>
                                                    <Parameter name="specificApnDataId" />
                                                    <Parameter name="specificApn" />
                                                    <Parameter name="specificApn3gppAccessInd" />
                                                    <Parameter name="specificApnInforPdnGwIpAddr1" />
                                                    <Parameter name="specificApnInforPdnGwIpAddr2" />
                                                    <Parameter name="specificApnInforPdnGwHost" />
                                                    <Parameter name="specificApnInforPdnGwRealm" />
                                                    <Parameter name="specificApnInforPdnGwPlmnIdentity" />
                                                </In>
                                                <Out>
                                                    <Parameter name="specificApnContextListElement" />
                                                </Out>
                                            </CallBE>
<!-- Add end by fucong for 70018 on 20100906 -->
                                            <If>
<!-- Modify begin by Guangli for 69915 on 20100201-->
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="specificApn3gppAccessInd" />
                                                        <Val>3GPP</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="specificApn3gppAccessInd" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </OR>
<!-- Modify end by Guangli for 69915 on 20100201-->
                                                <Then>
                                                    <Set name="specificApn3gppStrList">
                                                        <MultiValue>
                                                            <Ref name="specificApn3gppStrList" />
                                                            <Ref name="specificApnContextListElement" />
                                                        </MultiValue>
                                                    </Set>
                                                </Then>
                                            </If>
                                            <If>
<!-- Modify begin by Guangli for 69915 on 20100201-->
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="specificApn3gppAccessInd" />
                                                        <Val>Non3GPP</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="specificApn3gppAccessInd" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </OR>
<!-- Modify end by Guangli for 69915 on 20100201-->
                                                <Then>
                                                    <Set name="specificApnNon3gppStrList">
                                                        <MultiValue>
                                                            <Ref name="specificApnNon3gppStrList" />
                                                            <Ref name="specificApnContextListElement" />
                                                        </MultiValue>
                                                    </Set>
                                                </Then>
                                            </If>
                                        </Foreach>
                                    </Then>
                                </If>
<!-- Add for D55, SQ End, 2009/11/17-->
                                <CallBE entityName="PostCommitBeContext" name="modify">
                                    <In>
                                        <Parameter name="chargingCharacteristics">
                                            <Ref name="chargingCharacteristics" delta="old" />
                                        </Parameter>
                                        <Parameter name="chargingGatewayFuncHost">
                                            <Ref name="chargingGatewayFuncHost" delta="old" />
                                        </Parameter>
                                        <Parameter name="chargingGroup">
                                            <Ref name="chargingGroup" delta="old" />
                                        </Parameter>
<!--Add begin by Guangli for 69915 on 20100201-->
                                        <Parameter name="non3gppApnOiReplacement">
                                            <Ref name="non3gppApnOiReplacement" delta="old" />
                                        </Parameter>
<!--Add end by Guangli for 69915 on 20100201-->
                                        <Parameter name="non3gppAccessRestrictionData">
                                            <Ref name="non3gppAccessRestrictionData" delta="old" />
                                        </Parameter>
                                        <Parameter name="non3gppAuthenSesTimeout">
                                            <Ref name="non3gppAuthenSesTimeout" delta="old" />
                                        </Parameter>
                                        <Parameter name="non3gppGwMobileIpCapability">
                                            <Ref name="non3gppGwMobileIpCapability" delta="old" />
                                        </Parameter>
                                        <Parameter name="non3gppIpAccess">
                                            <Ref name="non3gppIpAccess" delta="old" />
                                        </Parameter>
                                        <Parameter name="non3gppIpAccessApn">
                                            <Ref name="non3gppIpAccessApn" delta="old" />
                                        </Parameter>
                                        <Parameter name="maxRequestedBandwidthDL">
                                            <Ref name="maxRequestedBandwidthDL" delta="old" />
                                        </Parameter>
                                        <Parameter name="maxRequestedBandwidthUL">
                                            <Ref name="maxRequestedBandwidthUL" delta="old" />
                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                        <Parameter name="selfActivationStatus">
                                            <Ref name="selfActivationStatus" delta="old" />
                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                        <Parameter name="apnOiReplacement">
                                            <Ref name="apnOiReplacement" delta="old" />
                                        </Parameter>
                                        <Parameter name="stnSrData">
                                            <Ref name="stnSrData" delta="old" />
                                        </Parameter>
                                        <Parameter name="ratFreqSelectPriorityId">
                                            <Ref name="ratFreqSelectPriorityId" delta="old" />
                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120614 -->
                                        <Parameter name="S6aRoamingRestrictionType">
                                            <Ref name="S6aRoamingRestrictionType" delta="old" />
                                        </Parameter>
<!-- Add end by nian for 72989 on 20120614 -->
<!--Begin added by F71037, Austin, 2012-11-27 -->
                                        <Parameter name="s6aRegRestrictionList">
                                            <Ref name="s6aRegRestrictionList" delta="old" />
                                        </Parameter>
                                        <Parameter name="mpsPriority">
                                            <Ref name="mpsPriority" delta="old" />
                                        </Parameter>
                                        <Parameter name="relayNodeIndicator">
                                            <Ref name="relayNodeIndicator" delta="old" />
                                        </Parameter>
                                        <Parameter name="roamRstrD2UFeat">
                                            <Ref name="roamRstrD2UFeat" delta="old" />
                                        </Parameter>
<!--End added by F71037, Austin, 2012-11-27 -->
                                        <Parameter name="epsAccessSubscriptionType">
                                            <Ref name="epsAccessSubscriptionType" delta="old" />
                                        </Parameter>
                                        <Parameter name="dflt3gppEpsApnContextSetIdx" />
                                        <Parameter name="dfltNon3gppEpsApnContextSetIdx" />
                                        <Parameter name="Non3gppEpsApnContextSetList" />
                                        <Parameter name="threegppEpsApnContextSetList" />
<!-- Add for D55, SQ, 2009/11/17 -->
                                        <Parameter name="specificApn3gppStrList" />
                                        <Parameter name="specificApnNon3gppStrList" />
<!-- Add for D55 End, SQ, 2009/11/17 -->
<!-- Add begin by fucong for 70018 on 20100729-->
                                        <Parameter name="pcscfServerName">
                                            <Ref name="pcscfServerName" delta="old" />
                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729-->
<!-- Add begin by nian for 72989 on 20120614 -->
                                        <Parameter name="SWxRoamingRestrictionType">
                                            <Ref name="SWxRoamingRestrictionType" delta="old" />
                                        </Parameter>
<!-- Add end by nian for 72989 on 20120614 -->
                                    </In>
                                    <Out />
                                </CallBE>
<!-- End by wupingfan.-->
<!-- 
                        ***************************************************************************************
                        *   2.1   save input DN in local data DN_BasicSubscription
                        *************************************************************************************** -->
                                <Set name="DN_BasicSubscription">
                                    <Ref name="__DISTINGUISH_NAME" />
                                </Set>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="typeOfModification" />
                                        <NotExist />
                                    </Condition>
                                    <Then>
                                        <Set name="typeOfModification">
                                            <Val>subscriberModification</Val>
                                        </Set>
                                    </Then>
                                </If>
<!-- add for feature 67405 Start -->
                                <If>
<!--Begin add for feature 66935, wangying-->
                                    <OR>
<!--End add for feature 66935, wangying-->
                                        <Condition operator="eq">
                                            <Ref name="fMVN001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
<!--Begin add for feature 66935, wangying-->
                                        <Condition operator="eq">
                                            <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
<!--End add for feature 66935, wangying-->
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <Description>- query subscriptionMvnoIndex of the GsmServiceProfile entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_BasicSubscription" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>subscriptionMvnoIndex</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="subscriptionMvnoIndex" />
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- add for feature 67405 End -->
<!-- Add for 72989 begin, nian, 2012-03-014 -->
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" name="fEps105" />
                                            <Val>false</Val>
                                        </Condition>
                                        <OR>
                                            <Condition operator="setGreater">
                                                <Ref name="selfActivationStatus" delta="changed" />
                                                <Null />
                                            </Condition>
                                            <Condition operator="setGreater">
                                                <Ref name="framedPoolSetList" delta="changed" />
                                                <Null />
                                            </Condition>
                                        </OR>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="16">
                                                <Frame FrameId="10067">
<!-- Functional option: {0} is not active. -->
                                                    <StringAttributeType>
                                                        <Val>fEps105</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                                <Frame FrameId="10063">
<!-- Attribute {0} is not allowed. -->
                                                    <StringAttributeType>
                                                        <Val>selfActivationStatus/framedPoolSetList</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- Add for 72989 End, nian, 2012-03-14 -->
<!-- Add for 72989 begin, nian, 2012-07-17-->
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" name="fSAApp" />
                                            <Val>false</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="selfActivationStatus" delta="changed" />
                                            <Null />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="16">
                                                <Frame FrameId="10067">
<!-- Functional option: {0} is not active. -->
                                                    <StringAttributeType>
                                                        <Val>fSAApp</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                                <Frame FrameId="10063">
<!-- Attribute {0} is not allowed. -->
                                                    <StringAttributeType>
                                                        <Val>selfActivationStatus</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- Add for 72989 End, nian, 2012-07-17 -->
<!-- add for feature 67393 Start -->
                                <If>
                                    <AND>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="fSS110" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractAuc" />
                                            <Val>false</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>FMC</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="33">
                                                <Frame FrameId="14006">
                                                    <StringAttributeType>
                                                        <Val>FMC</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>fSS110</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- add for feature 67393 End -->
<!--Begin add for feature 66935, wangying-->
<!--1.1. If subscriberType has Shared_M2M value and fSA113 is not true, throw exception.-->
                                <If>
                                    <AND>
                                        <Condition operator="neq">
                                            <Ref name="fSA113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>Shared_M2M</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="203">
                                                    <StringAttributeType>
                                                        <Val>subscriberType</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>Shared_M2M</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>when fSA113 is not active</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fSA113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
<!--If fSA113 is true, subscriberType has Shared_M2M value and subscriberType has other value, throw exception.-->
                                        <Set name="numberOfSet">
                                            <Ref name="subscriberType" defaultValue="occurs" />
                                        </Set>
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="subscriberType" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                                <Condition operator="greater">
                                                    <Ref name="numberOfSet" />
                                                    <Val>1</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="12129" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--If subscriberType = Shared_M2M and typeOfModification = changeIMSI, throw exception-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="subscriberType" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="typeOfModification" />
                                                    <Val>changeIMSI</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="12130" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--If old value of subscriberType is Shared_M2M, and subscriberType is changed, throw exception-->
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" delta="changed" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="subscriberType" delta="old" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="12131" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--linkToOtherIMSI has value, and subscriberType is changed to Shared_M2M value, throw exception.-->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="subscriberType" />
                                                <Val>Shared_M2M</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="associatedMainMsisdn">
                                                    <Ref name="associatedMainMsisdn" entityName="gdmiContext" DN="__DISTINGUISH_NAME" />
                                                </Set>
                                                <Set name="associatedIMSI">
                                                    <Ref name="associatedIMSI" entityName="gdmiContext" DN="associatedMainMsisdn" />
                                                </Set>
                                                <Set name="DN_AutoImsiChange">
                                                    <Ref name="__DN_HANDLER" dnSyntax="AutoImsiChange_DN" DN="associatedIMSI" />
                                                </Set>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="__EXIST_ENTRY" DN="DN_AutoImsiChange" fetch="__NO_FETCH" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="31">
                                                                <Frame FrameId="12133" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!--3.  If fSA113 is true, multiSimMember is true, and subscriberType is changed to Shared_M2M value, throw exception.-->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="subscriberType" />
                                                    <Val>Shared_M2M</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="multiSimMember" entityName="gdmiContext" DN="__DISTINGUISH_NAME" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="12132" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!--End add for feature 66935, wangying-->
<!-- timeStamp1: controls (parameter and functions) -->
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
<!-- begin if deactivatedDomains changed, other parameter can not change at the same time -->
                                <If>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="deactivatedDomains" delta="changed" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="typeOfModification" />
                                            <Val>subscriberModification</Val>
                                        </Condition>
                                        <OR>
<!-- add for feature 67393 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67393 End -->
<!-- add for feature 67398 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="smsRouteViaHNetwRoam" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="smsRouteViaHNetwRoam" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67398 End -->
<!-- add for feature 67435 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="serviceProviderReference" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="serviceProviderReference" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67435 End -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="MainSNwithBearerService" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="MainSNwithBearerService" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="SNwithBearerServiceList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="SNwithBearerServiceList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="BearerServiceWithoutSNList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="BearerServiceWithoutSNList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="ServiceNodeNotificationList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="ServiceNodeNotificationList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="networkAccessMode" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="networkAccessMode" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
<!-- NGHLR1FAG198454 modify-->
                                                <Condition operator="setGreater">
                                                    <Ref name="accessRestrictionData" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
<!-- NGHLR1FAG198454 end-->
                                                <Condition operator="setGreater">
                                                    <Ref name="accessRestrictionData" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Condition operator="setGreater">
                                                <Ref name="newSuMSubscriberProfileId" />
                                                <Null />
                                            </Condition>
                                            <Condition operator="setGreater">
                                                <Ref name="newSuMSubscriptionProfileId" />
                                                <Null />
                                            </Condition>
<!-- FR SDMA01FAG266214: Add for feature 68733 begin -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="notificationToCseFlag" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="notificationToCseFlag" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!--  FR SDMA01FAG266214: Add for feature 68733 end -->
<!-- SDMA01CAG258860 begin -->
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fNPO101" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="portoutFlag" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- SDMA01CAG258860 end -->
                                        </OR>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="12195" />
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- end if deactivatedDomains changed, other parameter can not;t change at the same time -->
<!-- begin if deactivatedSubscription is  true, deactivatedDomains can not be noCS, noPS or noEPS -->
                                <If>
                                    <And>
                                        <Condition operator="eq">
                                            <Ref name="deactivatedSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Or>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deactivatedDomains" />
                                                <Val>noCS</Val>
                                            </Condition>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deactivatedDomains" />
                                                <Val>noPS</Val>
                                            </Condition>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deactivatedDomains" />
                                                <Val>noEPS</Val>
                                            </Condition>
                                        </Or>
                                    </And>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="33">
                                                <Frame FrameId="12192">
                                                    <StringAttributeType>
                                                        <Val>deactivatedSubscription</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>deactivatedDomains</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- end if deactivatedSubscription is  true, deactivatedDomains can not be noCS, noPS or noEPS -->
<!-- begin if NetworkAccessMode is GPRSOnly, then deactivatedDomains can not be noCS -->
                                <If>
                                    <And>
                                        <Condition operator="setGreater">
                                            <Ref name="deactivatedDomains" delta="changed" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" />
                                            <Val>noCS</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        </Condition>
                                    </And>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="33">
                                                <Frame FrameId="12193">
                                                    <StringAttributeType>
                                                        <Val>noCS</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>GPRSonly</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- end if NetworkAccessMode is GPRSOnly, then deactivatedDomains can not be noCS -->
<!-- begin if NetworkAccessMode is noGPRS, then deactivatedDomains can not be noPS or noEPS -->
                                <If>
                                    <And>
                                        <Condition operator="setGreater">
                                            <Ref name="deactivatedDomains" delta="changed" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        </Condition>
                                        <Or>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deactivatedDomains" />
                                                <Val>noPS</Val>
                                            </Condition>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deactivatedDomains" />
                                                <Val>noEPS</Val>
                                            </Condition>
                                        </Or>
                                    </And>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="33">
                                                <Frame FrameId="12193">
                                                    <StringAttributeType>
                                                        <Val>noPS or noEPS</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>noGPRS</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- end if NetworkAccessMode is noGPRS, then deactivatedDomains can  not be noPS or noEPS -->
<!-- begin if epsServiceProfile not exist, then deactivatedDomains can not be noEPS -->
                                <Set name="DN_EpsServiceProfile">
                                    <Ref name="__DN_HANDLER" dnSyntax="EpsServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                </Set>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>exist epsServiceProfile</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_EpsServiceProfile" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <And>
                                        <Condition operator="eq">
                                            <Ref name="existEntry" />
                                            <Val>false</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" />
                                            <Val>noEPS</Val>
                                        </Condition>
                                    </And>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="33">
                                                <Frame FrameId="12194">
                                                    <StringAttributeType>
                                                        <Val>noEPS</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>epsServiceProfile</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- end if epsServiceProfile not exist, then deactivatedDomains can not be noEPS -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="deactivatedDomains" delta="changed" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>build oldIMSI_DN</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="plmnFunctionId">
                                                    <Ref name="plmnFunctionId" />
                                                </Parameter>
                                                <Parameter name="managedElementId">
                                                    <Ref name="managedElementId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description>associatedIMSI valorized</Description>
                                                <Parameter name="oldIMSI_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="roaming_Imsi">
                                                    <Ref name="oldIMSI_DN" />
                                                </Set>
                                            </Then>
                                            <Else>
                                                <Set name="roaming_Imsi">
                                                    <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Else>
                                        </If>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="roaming_Imsi" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="roam_mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="roam_mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="roam_mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <Description>Query on Entry MSubIdentificationNumber</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="roaming_Imsi" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>sgsnUpdateFlag_@@_msStatusInPS_@@_s6dULRFlags_@@_s6aULRFlags_@@_sgsnIdentity_@@_sgsnIsdn_@@_vlrIsdn_@@_aaaIdentity_@@_non3gppIpAccRegStatus_@@_mmeIdentity_@@_uePurgedInMme_@@_mmeUpdateFlag_@@_aaaUpdateFlag_@@_localMobileStationIdentity_@@_visitedSgsnPlmnId</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="sgsnUpdateFlag" />
                                                <Parameter name="msStatusInPS" />
                                                <Parameter name="s6dULRFlags" />
                                                <Parameter name="s6aULRFlags" />
                                                <Parameter name="sgsnIdentity" />
                                                <Parameter name="sgsnIsdn">
                                                    <Ref name="sgsnIsdn" />
                                                </Parameter>
                                                <Parameter name="vlrIsdn">
                                                    <Ref name="vlrIsdn" />
                                                </Parameter>
                                                <Parameter name="aaaIdentity">
                                                    <Ref name="aaaIdentity" />
                                                </Parameter>
                                                <Parameter name="non3gppIpAccRegStatus">
                                                    <Ref name="non3gppIpAccRegStatus" />
                                                </Parameter>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" />
                                                </Parameter>
                                                <Parameter name="uePurgedInMme">
                                                    <Ref name="uePurgedInMme" />
                                                </Parameter>
                                                <Parameter name="mmeUpdateFlag">
                                                    <Ref name="mmeUpdateFlag" />
                                                </Parameter>
                                                <Parameter name="aaaUpdateFlag">
                                                    <Ref name="aaaUpdateFlag" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" />
                                                </Parameter>
                                                <Parameter name="visitedSgsnPlmnId">
                                                    <Ref name="visitedSgsnPlmnId" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE name="getInterceptedPara" entityName="HSS.SUB.Subscription.BeSubInterception">
                                            <In>
                                                <Parameter name="queryIMSI">
                                                    <Ref name="oldIMSI_DN" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!-- update PostCommitBeContext -->
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <Description>Save postCommit Context</Description>
                                            <In>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="roam_mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="roam_mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="roam_mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="sgsnIdentity" />
                                                <Parameter name="sgsnUpdateFlag" />
                                                <Parameter name="msStatusInPS" />
                                                <Parameter name="vlrIsdn">
                                                    <Ref name="vlrIsdn" />
                                                </Parameter>
                                                <Parameter name="sgsnIsdn">
                                                    <Ref name="sgsnIsdn" />
                                                </Parameter>
                                                <Parameter name="aaaIdentity">
                                                    <Ref name="aaaIdentity" />
                                                </Parameter>
                                                <Parameter name="non3gppIpAccRegStatus">
                                                    <Ref name="non3gppIpAccRegStatus" />
                                                </Parameter>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" />
                                                </Parameter>
                                                <Parameter name="uePurgedInMme">
                                                    <Ref name="uePurgedInMme" />
                                                </Parameter>
                                                <Parameter name="mmeUpdateFlag">
                                                    <Ref name="mmeUpdateFlag" />
                                                </Parameter>
                                                <Parameter name="aaaUpdateFlag">
                                                    <Ref name="aaaUpdateFlag" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" />
                                                </Parameter>
                                                <Parameter name="visitedSgsnPlmnId">
                                                    <Ref name="visitedSgsnPlmnId" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- begin if deactivatedDomains noPS or noEPS value is added, psLastUpdateTime must be set to the currrent datetime -->
<!-- judge whether PsServiceProfile exist -->
                                <Set name="eps3gppApnContextSetLinkLst">
                                    <Null />
                                </Set>
                                <Set name="pdpContext">
                                    <Null />
                                </Set>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>- DN PsServiceProfile available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>PsServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN PsServiceProfile available</Description>
                                        <Parameter name="DN_PsServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_PsServiceProfile" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendComIdrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendComDsrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendComClrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendIdrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendDsrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendClrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendS4sgsnIdrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendS4sgsnDsrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="sendS4sgsnClrMsg">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="deleteComDataType">
                                            <Null />
                                        </Set>
                                        <Set name="insertComDataType">
                                            <Null />
                                        </Set>
                                        <Set name="deleteMMEDataType">
                                            <Null />
                                        </Set>
                                        <Set name="insertMMEDataType">
                                            <Null />
                                        </Set>
                                        <Set name="deleteS4sgsnDataType">
                                            <Null />
                                        </Set>
                                        <Set name="insertS4sgsnDataType">
                                            <Null />
                                        </Set>
                                        <Set name="DN_EpsServiceProfile">
                                            <Ref name="__DN_HANDLER" dnSyntax="EpsServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                        </Set>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_EpsServiceProfile" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>+ query eps3gppApnContextSetLinkLst from EpsServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_EpsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>eps3gppApnContextSetLinkLst</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="eps3gppApnContextSetLinkLst" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- PsServiceProfile exist, you can update psLastUpdateTime  -->
                                        <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                            <Description>+ query current time for Domain state change time</Description>
                                            <In />
                                            <Out>
                                                <Parameter name="psLastUpdateTimeTmp">
                                                    <Ref name="date" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <Description />
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_PsServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>pdpContext</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="pdpContext" />
                                            </Out>
                                        </CallBE>
<!-- noPS and noEPS provisioned -->
<!--
    ******************************************
    1. sgsnIsdn not Null
       update psLastUpdateTime
    2. aaaIdentity not Null
       update psLastUpdateTime
    3. mmeIdentity not Null
       update psLastUpdateTime
       if combined MME and SGSN
          send CLR to MME.
    4. sgsnIdentity not Null
          not combined MME and SGSN, send CLR to SGSN.
       update psLastUpdateTime
    ****************************************** 
-->
                                        <If>
                                            <And>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noPS</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noEPS</Val>
                                                </Condition>
                                            </And>
                                            <Then>
                                                <If>
                                                    <Or>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIsdn" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="aaaIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                    </Or>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="psLastUpdateTime">
                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <And>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="sgsnIdentity" />
                                                            <Ref name="mmeIdentity" />
                                                        </Condition>
                                                    </And>
                                                    <Then>
                                                        <Set name="sendComClrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                            <In>
                                                                <Parameter name="sendComClrMsg" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="sgsnIdentity" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="sendS4sgsnClrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="mmeIdentity" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="sendClrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                            <In>
                                                                <Parameter name="sendS4sgsnClrMsg" />
                                                                <Parameter name="sendClrMsg" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- noPS provisioned, no noEPS -->
<!--
    ******************************************
    1. sgsnIsdn not Null
       send Creq to sgsnIsdn
       update psLastUpdateTime
    2. combined MME and SGSN(mmeIdentiy equal with sgsnIdentity)
       1) if deactivatedDomains contains noEPS Or eps3gppApnContextSetLinkLst Null
           send CLR to MME and SGSN.
           update psLastUpdateTime
        1) else
           2) if s6aULRFlags or s6dULRFlags includes GPRS_SUB_DATA_IND
                3) if pdpContext not Null
                      send DSR to MME and SGSN to delete pdpContext.
    3. mmeIdentity not Null, not combined MME and SGSN.
        1) if deactivatedDomains contains noEPS
              send CLR to MME.
              update psLastUpdateTime
        1) else
            2) if s6aULRFlags includes GPRS_SUB_DATA_IND
                3) if eps3gppApnContextSetLinkLst not Null
                   4) if pdpContext not Null
                    send DSR to MME to delte pdpContext. 
                3) else
                      update psLastUpdateTime
                      send CLR to MME.
    4. sgsnIdentity not Null, not combined MME and SGSN.
        1) if deactivatedDomains contains noEPS Or eps3gppApnContextSetLinkLst Null
              send CLR to SGSN.
              update psLastUpdateTime
        1) else
            2) if s6dULRFlags includes GPRS_SUB_DATA_IND     
                3) if pdpContext not Null
                    send DSR to SGSN to delete pdpContext 
    ******************************************
-->
                                        <If>
                                            <And>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noPS</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noEPS</Val>
                                                </Condition>
                                            </And>
                                            <Then>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="sgsnIsdn" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="psLastUpdateTime">
                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <And>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="mmeIdentity" />
                                                            <Ref name="sgsnIdentity" />
                                                        </Condition>
                                                    </And>
                                                    <Then>
                                                        <If>
                                                            <Or>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="deactivatedDomains" />
                                                                    <Val>noEPS</Val>
                                                                </Condition>
                                                                <Condition operator="setLessOrEqual">
                                                                    <Ref name="eps3gppApnContextSetLinkLst" />
                                                                    <Null />
                                                                </Condition>
                                                            </Or>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <Description>+ modify deactivatedDomains to database</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_PsServiceProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="psLastUpdateTime">
                                                                            <Ref name="psLastUpdateTimeTmp" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <Set name="sendComClrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="sendComClrMsg" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Or>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="s6dULRFlags" />
                                                                            <Val>GPRS_SUB_DATA_IND</Val>
                                                                        </Condition>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="s6aULRFlags" />
                                                                            <Val>GPRS_SUB_DATA_IND</Val>
                                                                        </Condition>
                                                                    </Or>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="sendComDsrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <Set name="deleteComDataType">
                                                                                    <MultiValue>
                                                                                        <Ref name="deleteComDataType" />
                                                                                        <Val>GPRS</Val>
                                                                                    </MultiValue>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendComDsrMsg" />
                                                                                        <Parameter name="deleteComDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="deactivatedDomains" />
                                                                        <Val>noEPS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psLastUpdateTime">
                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <Set name="sendClrMsg">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="sendClrMsg" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6aULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="pdpContext" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteMMEDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteMMEDataType" />
                                                                                                        <Val>GPRS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendDsrMsg" />
                                                                                                        <Parameter name="deleteMMEDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                    <Else>
                                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                                            <In>
                                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                                </Parameter>
                                                                                                <Parameter name="psLastUpdateTime">
                                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                        <Set name="sendClrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendClrMsg" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Else>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                        <If>
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="sgsnIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Or>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="deactivatedDomains" />
                                                                            <Val>noEPS</Val>
                                                                        </Condition>
                                                                        <Condition operator="setLessOrEqual">
                                                                            <Ref name="eps3gppApnContextSetLinkLst" />
                                                                            <Null />
                                                                        </Condition>
                                                                    </Or>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psLastUpdateTime">
                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <Set name="sendS4sgsnClrMsg">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- set sendS4sgsnClrMsg into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="sendS4sgsnClrMsg" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6dULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="sendS4sgsnDsrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="deleteS4sgsnDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="deleteS4sgsnDataType" />
                                                                                                <Val>GPRS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendS4sgsnDsrMsg" />
                                                                                                <Parameter name="deleteS4sgsnDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- noEPS provisioned, no noPS -->
<!--
    ******************************************
    1. aaaIdentity not Null
       send CLR to aaa. 
       update psLastUpdateTime
    2. combined MME and SGSN(mmeIdentiy equal with sgsnIdentity)
       1) if deactivatedDomains contains noPS
              update psLastUpdateTime
              send CLR to MME and SGSN.
        1) else
            2) if pdpContext Null or SGSN purged and MME not purged and s6aULRFlags not contain IND. send CLR.
            2) if MME and SGSN not purged
              3) if s6dULRFlags includes GPRS_SUB_DATA_IND
                4) if pdpContext not Null
            5) if EPS Data not Null
                    send DSR to MME and SGSN to delete Eps Data.
              3) else
                4) if pdpContext not Null
                  send IDR with pdpContext no EPS Data to MME and SGSN.
            5) if EPS Data not Null
                  send DSR to MME and SGSN to delete Eps Data.
            2) else
                3) if only MME not purged.
                  4) if s6aULRFlags includes GPRS_SUB_DATA_IND
                    5) if pdpContext not Null
                6) if EPS Data not Null
                        send DSR to MME and SGSN to delete Eps Data.
                3) if only SGSN not purged
                  4) if s6dULRFlags includes GPRS_SUB_DATA_IND
                    5) if pdpContext not Null
                6) if EPS Data not Null
                        send DSR to MME and SGSN to delete Eps Data.
                  4) else
                    5) if pdpContext not Null
                      send IDR with pdpContext no EPS Data to MME and SGSN.
                6) if EPS Data not Null
                      send DSR to MME and SGSN to delete Eps Data.
    3. mmeIdentity not Null, not combined MME and SGSN.
        1)  if deactivatedDomains contains noPS
                update psLastUpdateTime
                send CLR to MME.
        1) else 
              2) if s6aULRFlags includes GPRS_SUB_DATA_IND
                3) if pdpContext not Null
           4) if EPS Data not Null
                      send DSR to MME to delete Eps Data.
                3) else
                      send CLR to MME.
                      update psLastUpdateTime
              2) else
                  send CLR to MEM.
                  update psLastUpdateTime
    4. sgsnIdentity not Null, not combined MME and SGSN.
       1) if deactivatedDomains contains noPS
              update psLastUpdateTime
              send CLR to SGSN.
        1) else
            2) if s6dULRFlags includes GPRS_SUB_DATA_IND
              3) if pdpContext not Null
          4) if EPS Data not Null
                  send DSR to SGSN to delete Eps Data.
              3) else 
                  send CLR to  SGSN.
            2) else
              3) if pdpContext not Null
                send IDR with pdpContext no EPS Data to SGSN.
        4) if EPS Data not Null
                send DSR to SGSN to delete Eps Data.
              3) else
                update psLastUpdateTime
                send CLR to SGSN.
    ******************************************
-->
                                        <If>
                                            <And>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noPS</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="added" />
                                                    <Val>noEPS</Val>
                                                </Condition>
                                            </And>
                                            <Then>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="aaaIdentity" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="psLastUpdateTime">
                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <And>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="mmeIdentity" />
                                                            <Ref name="sgsnIdentity" />
                                                        </Condition>
                                                    </And>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="deactivatedDomains" />
                                                                <Val>noPS</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <Description>+ modify deactivatedDomains to database</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_PsServiceProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="psLastUpdateTime">
                                                                            <Ref name="psLastUpdateTimeTmp" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <Set name="sendComClrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="sendComClrMsg" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Or>
                                                                        <Condition operator="setLessOrEqual">
                                                                            <Ref name="pdpContext" />
                                                                            <Null />
                                                                        </Condition>
                                                                        <And>
                                                                            <Condition operator="neq">
                                                                                <Ref name="uePurgedInMme" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="msStatusInPS" />
                                                                                <Val>Purged_in_S4_SGSN</Val>
                                                                            </Condition>
                                                                            <Condition operator="nullIntersection">
                                                                                <Ref name="s6aULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                        </And>
                                                                    </Or>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psLastUpdateTime">
                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <Set name="sendComClrMsg">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="sendComClrMsg" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <And>
                                                                        <Condition operator="neq">
                                                                            <Ref name="uePurgedInMme" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <Condition operator="nullIntersection">
                                                                            <Ref name="msStatusInPS" />
                                                                            <Val>Purged_in_S4_SGSN</Val>
                                                                        </Condition>
                                                                    </And>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6dULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendComDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteComDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendComDsrMsg" />
                                                                                                        <Parameter name="deleteComDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                            <Else>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendComDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteComDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                            </Then>
                                                                                        </If>
                                                                                        <Set name="sendComIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertComDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertComDataType" />
                                                                                                <Val>GPRS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendComDsrMsg" />
                                                                                                <Parameter name="sendComIdrMsg" />
                                                                                                <Parameter name="deleteComDataType" />
                                                                                                <Parameter name="insertComDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Else>
                                                                        </If>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="uePurgedInMme" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="notNullIntersection">
                                                                                        <Ref name="s6aULRFlags" />
                                                                                        <Val>GPRS_SUB_DATA_IND</Val>
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="pdpContext" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <If>
                                                                                                    <Condition operator="setGreater">
                                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                        <Null />
                                                                                                    </Condition>
                                                                                                    <Then>
                                                                                                        <Set name="sendComDsrMsg">
                                                                                                            <Val>true</Val>
                                                                                                        </Set>
                                                                                                        <Set name="deleteComDataType">
                                                                                                            <MultiValue>
                                                                                                                <Ref name="deleteComDataType" />
                                                                                                                <Val>EPS</Val>
                                                                                                            </MultiValue>
                                                                                                        </Set>
                                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                            <In>
                                                                                                                <Parameter name="sendComDsrMsg" />
                                                                                                                <Parameter name="deleteComDataType" />
                                                                                                            </In>
                                                                                                            <Out />
                                                                                                        </CallBE>
                                                                                                    </Then>
                                                                                                </If>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                        <If>
                                                                            <Condition operator="nullIntersection">
                                                                                <Ref name="msStatusInPS" />
                                                                                <Val>Purged_in_S4_SGSN</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="notNullIntersection">
                                                                                        <Ref name="s6dULRFlags" />
                                                                                        <Val>GPRS_SUB_DATA_IND</Val>
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="pdpContext" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <If>
                                                                                                    <Condition operator="setGreater">
                                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                        <Null />
                                                                                                    </Condition>
                                                                                                    <Then>
                                                                                                        <Set name="sendComDsrMsg">
                                                                                                            <Val>true</Val>
                                                                                                        </Set>
                                                                                                        <Set name="deleteComDataType">
                                                                                                            <MultiValue>
                                                                                                                <Ref name="deleteComDataType" />
                                                                                                                <Val>EPS</Val>
                                                                                                            </MultiValue>
                                                                                                        </Set>
                                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                            <In>
                                                                                                                <Parameter name="sendComDsrMsg" />
                                                                                                                <Parameter name="deleteComDataType" />
                                                                                                            </In>
                                                                                                            <Out />
                                                                                                        </CallBE>
                                                                                                    </Then>
                                                                                                </If>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                    <Else>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="pdpContext" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <If>
                                                                                                    <Condition operator="setGreater">
                                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                        <Null />
                                                                                                    </Condition>
                                                                                                    <Then>
                                                                                                        <Set name="sendComDsrMsg">
                                                                                                            <Val>true</Val>
                                                                                                        </Set>
                                                                                                        <Set name="deleteComDataType">
                                                                                                            <MultiValue>
                                                                                                                <Ref name="deleteComDataType" />
                                                                                                                <Val>EPS</Val>
                                                                                                            </MultiValue>
                                                                                                        </Set>
                                                                                                    </Then>
                                                                                                </If>
                                                                                                <Set name="sendComIdrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="insertComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="insertComDataType" />
                                                                                                        <Val>GPRS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendComDsrMsg" />
                                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                                        <Parameter name="deleteComDataType" />
                                                                                                        <Parameter name="insertComDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Else>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="deactivatedDomains" />
                                                                        <Val>noPS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psLastUpdateTime">
                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <Set name="sendClrMsg">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="sendClrMsg" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6aULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteMMEDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteMMEDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendDsrMsg" />
                                                                                                        <Parameter name="deleteMMEDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                    <Else>
                                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                                            <In>
                                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                                </Parameter>
                                                                                                <Parameter name="psLastUpdateTime">
                                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                        <Set name="sendClrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendClrMsg" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Else>
                                                                                </If>
                                                                            </Then>
                                                                            <Else>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <Description>+ modify deactivatedDomains to database</Description>
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="DN_PsServiceProfile" />
                                                                                        </Parameter>
                                                                                        <Parameter name="psLastUpdateTime">
                                                                                            <Ref name="psLastUpdateTimeTmp" />
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                                <Set name="sendClrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendClrMsg" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Else>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                        <If>
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="sgsnIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="deactivatedDomains" />
                                                                        <Val>noPS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psLastUpdateTime">
                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <Set name="sendS4sgsnClrMsg">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="sendS4sgsnClrMsg" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6dULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendS4sgsnDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteS4sgsnDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteS4sgsnDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendS4sgsnDsrMsg" />
                                                                                                        <Parameter name="deleteS4sgsnDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                    <Else>
                                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                                            <In>
                                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                                </Parameter>
                                                                                                <Parameter name="psLastUpdateTime">
                                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                        <Set name="sendS4sgsnClrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendS4sgsnClrMsg" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Else>
                                                                                </If>
                                                                            </Then>
                                                                            <Else>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendS4sgsnDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteS4sgsnDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteS4sgsnDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                            </Then>
                                                                                        </If>
                                                                                        <Set name="sendS4sgsnIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertS4sgsnDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertS4sgsnDataType" />
                                                                                                <Val>GPRS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendS4sgsnDsrMsg" />
                                                                                                <Parameter name="sendS4sgsnIdrMsg" />
                                                                                                <Parameter name="deleteS4sgsnDataType" />
                                                                                                <Parameter name="insertS4sgsnDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                    <Else>
                                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                            <Description>+ modify deactivatedDomains to database</Description>
                                                                                            <In>
                                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                                </Parameter>
                                                                                                <Parameter name="psLastUpdateTime">
                                                                                                    <Ref name="psLastUpdateTimeTmp" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                        <Set name="sendS4sgsnClrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendS4sgsnClrMsg" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Else>
                                                                                </If>
                                                                            </Else>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- end if deactivatedDomains noPS or noEPS value is added, psLastUpdateTime must be set to the currrent datetime -->
<!-- begin remove from deactivatedDomains -->
<!--
      remove noPS
      ******************************************
      1 combined MME and SGSN
        1) if s6aULRFlags or s6dULRFlags contain GPRS_SUB_DATA_IND
            2) if Eps Data not Null
                send IDR to MME and SGSN with pdpContext.
      2 standalone MME
        1) if s6aULRFlags contain GPRS_SUB_DATA_IND
            2) if Eps Data not Null
                send IDR to MME with pdpContext.
      3 standalone SGSN
        1) if s6dULRFlags contain GPRS_SUB_DATA_IND
            2) if Eps Data not Null
                send IDR to SGSN with pdpContext.
      ******************************************
-->
                                        <If>
                                            <And>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="removed" />
                                                    <Val>noPS</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="deactivatedDomains" delta="old" />
                                                    <Val>noEPS</Val>
                                                </Condition>
                                            </And>
                                            <Then>
                                                <If>
<!-- mmeIdentity and sgsnIdentity exist, and equal with each other -->
                                                    <And>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="mmeIdentity" />
                                                            <Ref name="sgsnIdentity" />
                                                        </Condition>
                                                    </And>
                                                    <Then>
                                                        <If>
                                                            <Or>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="s6dULRFlags" />
                                                                    <Val>GPRS_SUB_DATA_IND</Val>
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="s6aULRFlags" />
                                                                    <Val>GPRS_SUB_DATA_IND</Val>
                                                                </Condition>
                                                            </Or>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="sendComIdrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <Set name="insertComDataType">
                                                                                    <MultiValue>
                                                                                        <Ref name="insertComDataType" />
                                                                                        <Val>GPRS</Val>
                                                                                    </MultiValue>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                        <Parameter name="insertComDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <If>
<!-- mmeIdentity not equal with sgsnIdentity, mmeIdentity not Null -->
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="s6aULRFlags" />
                                                                    <Val>GPRS_SUB_DATA_IND</Val>
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="sendIdrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <Set name="insertMMEDataType">
                                                                                    <MultiValue>
                                                                                        <Ref name="insertMMEDataType" />
                                                                                        <Val>GPRS</Val>
                                                                                    </MultiValue>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendIdrMsg" />
                                                                                        <Parameter name="insertMMEDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                        <If>
<!-- mmeIdentity not equal with sgsnIdentity, sgsnIdentity not Null -->
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="sgsnIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="s6dULRFlags" />
                                                                    <Val>GPRS_SUB_DATA_IND</Val>
                                                                </Condition>
                                                            </And>
                                                            <Then>
<!-- sgsnIdentity not Null, s6dULRFlags contains GPRS_SUB_DATA_IND -->
<!-- pdpContext not Null, send to sgsn DSR, if Null, send to sgsn CLR, update psLastUpdateTime -->
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="sendS4sgsnIdrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <Set name="insertS4sgsnDataType">
                                                                                    <MultiValue>
                                                                                        <Ref name="insertS4sgsnDataType" />
                                                                                        <Val>GPRS</Val>
                                                                                    </MultiValue>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendS4sgsnIdrMsg" />
                                                                                        <Parameter name="insertS4sgsnDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!--
      remove noEPS
      ******************************************
      1 combined MME and SGSN
            1) if MME and SGSN not purged
              2) if s6dULRFlags includes GPRS_SUB_DATA_IND
                3) if pdpContext not Null
                    send IDR to MME and SGSN to delete Eps Data.
              2) else
                3) if pdpContext not Null and EPS Data not Null
                  send IDR to MME and SGSN with Eps Data.
                  send DSR to MME and SGSN to delete pdpContext.
            1) else
              2) if only MME not purged
                3) if s6aULRFlags includes GPRS_SUB_DATA_IND
                  4) if pdpContext not Null and EPS Data not Null
                    send IDR to MME and SGSN to insert Eps Data.                  
              2) if only SGSN not purged
                3) if s6dULRFlags includes GPRS_SUB_DATA_IND
                  4) if pdpContext not Null and EPS Data not Null
                      send IDR to MME and SGSN to insert Eps Data.
                3) else
                  4) if pdpContext not Null and EPS Data not null
                    send IDR to MME and SGSN with Eps Data.
                    send DSR to MME and SGSN to delete pdpContext.
      2 standalone MME
        1) if s6aULRFlags contain GPRS_SUB_DATA_IND
            2) if pdpContext not Null
                send IDR to MME with Eps Data.
      3 standalone SGSN
        1) if s6dULRFlags contain GPRS_SUB_DATA_IND
            2) if pdpContext not Null and  EPS Data not Null
                send IDR to SGSN with Eps Data.
        1) else 
            2) if pdpContext not Null and Eps Data not Null
                send IDR to SGSN with Eps Data.
                send DSR to SGSN to delete pdpContext.
      ******************************************
-->
                                        <If>
                                            <And>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="deactivatedDomains" delta="removed" />
                                                    <Val>noEPS</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="deactivatedDomains" delta="old" />
                                                    <Val>noPS</Val>
                                                </Condition>
                                            </And>
                                            <Then>
                                                <If>
<!-- mmeIdentity and sgsnIdentity exist, and equal with each other -->
                                                    <And>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="mmeIdentity" />
                                                            <Ref name="sgsnIdentity" />
                                                        </Condition>
                                                    </And>
                                                    <Then>
                                                        <If>
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="uePurgedInMme" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="msStatusInPS" />
                                                                    <Val>Purged_in_S4_SGSN</Val>
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="s6dULRFlags" />
                                                                        <Val>GPRS_SUB_DATA_IND</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="sendComIdrMsg">
                                                                                    <Val>true</Val>
                                                                                </Set>
                                                                                <Set name="insertComDataType">
                                                                                    <MultiValue>
                                                                                        <Ref name="insertComDataType" />
                                                                                        <Val>EPS</Val>
                                                                                    </MultiValue>
                                                                                </Set>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                        <Parameter name="insertComDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="sendComIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertComDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertComDataType" />
                                                                                                <Val>EPS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <Set name="sendComDsrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="deleteComDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="deleteComDataType" />
                                                                                                <Val>GPRS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                    </Then>
                                                                                </If>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                        <Parameter name="sendComDsrMsg" />
                                                                                        <Parameter name="deleteComDataType" />
                                                                                        <Parameter name="insertComDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="uePurgedInMme" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6aULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendComIdrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="insertComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="insertComDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                                        <Parameter name="insertComDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="nullIntersection">
                                                                        <Ref name="msStatusInPS" />
                                                                        <Val>Purged_in_S4_SGSN</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="s6dULRFlags" />
                                                                                <Val>GPRS_SUB_DATA_IND</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendComIdrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="insertComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="insertComDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                                    <In>
                                                                                                        <Parameter name="sendComIdrMsg" />
                                                                                                        <Parameter name="insertComDataType" />
                                                                                                    </In>
                                                                                                    <Out />
                                                                                                </CallBE>
                                                                                            </Then>
                                                                                        </If>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                            <Else>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="pdpContext" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <If>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Then>
                                                                                                <Set name="sendComIdrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="insertComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="insertComDataType" />
                                                                                                        <Val>EPS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                                <Set name="sendComDsrMsg">
                                                                                                    <Val>true</Val>
                                                                                                </Set>
                                                                                                <Set name="deleteComDataType">
                                                                                                    <MultiValue>
                                                                                                        <Ref name="deleteComDataType" />
                                                                                                        <Val>GPRS</Val>
                                                                                                    </MultiValue>
                                                                                                </Set>
                                                                                            </Then>
                                                                                        </If>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendComIdrMsg" />
                                                                                                <Parameter name="sendComDsrMsg" />
                                                                                                <Parameter name="deleteComDataType" />
                                                                                                <Parameter name="insertComDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Else>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <If>
<!-- mmeIdentity not equal with sgsnIdentity, mmeIdentity not Null -->
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="s6aULRFlags" />
                                                                        <Val>GPRS_SUB_DATA_IND</Val>
                                                                    </Condition>
                                                                    <Then>
<!-- pdpContext not Null, send to mme DSR, if Null, send to mme CLR, update  psLastUpdateTime -->
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="sendIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertMMEDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertMMEDataType" />
                                                                                                <Val>EPS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendIdrMsg" />
                                                                                                <Parameter name="insertMMEDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                        <If>
<!-- mmeIdentity not equal with sgsnIdentity, sgsnIdentity not Null -->
                                                            <And>
                                                                <Condition operator="neq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="sgsnIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                            </And>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="s6dULRFlags" />
                                                                        <Val>GPRS_SUB_DATA_IND</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="sendS4sgsnIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertS4sgsnDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertS4sgsnDataType" />
                                                                                                <Val>EPS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                            <In>
                                                                                                <Parameter name="sendS4sgsnIdrMsg" />
                                                                                                <Parameter name="insertS4sgsnDataType" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="pdpContext" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="eps3gppApnContextSetLinkLst" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="sendS4sgsnIdrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="insertS4sgsnDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="insertS4sgsnDataType" />
                                                                                                <Val>EPS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                        <Set name="sendS4sgsnDsrMsg">
                                                                                            <Val>true</Val>
                                                                                        </Set>
                                                                                        <Set name="deleteS4sgsnDataType">
                                                                                            <MultiValue>
                                                                                                <Ref name="deleteS4sgsnDataType" />
                                                                                                <Val>GPRS</Val>
                                                                                            </MultiValue>
                                                                                        </Set>
                                                                                    </Then>
                                                                                </If>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>- send sendmmeDSRFlag into postCommitContext</Description>
                                                                                    <In>
                                                                                        <Parameter name="sendS4sgsnIdrMsg" />
                                                                                        <Parameter name="sendS4sgsnDsrMsg" />
                                                                                        <Parameter name="deleteS4sgsnDataType" />
                                                                                        <Parameter name="insertS4sgsnDataType" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- end remove from deactivatedDomains -->
                                    </Then>
                                </If>
<!-- begin if deactivatedDomains noCS value is added, csLastUpdateTime must be set to the currrent datetime -->
                                <If>
                                    <And>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" delta="added" />
                                            <Val>noCS</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="vlrIsdn" />
                                            <Null />
                                        </Condition>
                                    </And>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>- DN CsServiceProfile available</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>CsServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>DN CsServiceProfile available</Description>
                                                <Parameter name="DN_CsServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_CsServiceProfile" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                                    <Description>+ query current time for Domain state change time</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="csLastUpdateTime">
                                                            <Ref name="date" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <Description>+ modify deactivatedDomains to database</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CsServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="csLastUpdateTime" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- end if deactivatedDomains noCS value is added, csLastUpdateTime must be set to the currrent datetime -->
<!-- update vlrIsdn to be Null -->
                                <If>
                                    <And>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" delta="added" />
                                            <Val>noCS</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="vlrIsdn" />
                                            <Null />
                                        </Condition>
                                    </And>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="roaming_Imsi" />
                                                </Parameter>
                                                <Parameter name="vlrIsdn">
                                                    <Null />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Null />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- begin delete Registered mmeIdentity and sgsnidentity -->
                                <If>
                                    <Or>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" delta="added" />
                                            <Val>noPS</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="deactivatedDomains" delta="added" />
                                            <Val>noEPS</Val>
                                        </Condition>
                                    </Or>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <Description>build DN_ServiceProfile</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="roaming_Imsi" />
                                                </Parameter>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>Virtual_EPS_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_ServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="sendComClrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_EPS" name="delete">
                                                    <Description>call internal BE of Location LOC_INTERAL_EPS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="removedEpsAccessSubscriptionType">
                                                            <MultiValue>
                                                                <Val>3GPP</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                        <Parameter name="networkElementItem">
                                                            <MultiValue>
                                                                <Val>MME</Val>
                                                                <Val>S4SGSN</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="sendClrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_EPS" name="delete">
                                                    <Description>call internal BE of Location LOC_INTERAL_EPS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="removedEpsAccessSubscriptionType">
                                                            <MultiValue>
                                                                <Val>3GPP</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                        <Parameter name="networkElementItem">
                                                            <MultiValue>
                                                                <Val>MME</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="sendS4sgsnClrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_EPS" name="delete">
                                                    <Description>call internal BE of Location LOC_INTERAL_EPS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="removedEpsAccessSubscriptionType">
                                                            <MultiValue>
                                                                <Val>3GPP</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                        <Parameter name="networkElementItem">
                                                            <MultiValue>
                                                                <Val>S4SGSN</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- end delete Registered mmeIdentity and sgsnidentity -->
<!-- begin delete Registered sgsnIsdn Msg when deactivatedDomains add noPS -->
                                <If>
                                    <Condition operator="notNullIntersection">
                                        <Ref name="deactivatedDomains" delta="added" />
                                        <Val>noPS</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="sgsnIsdn" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIsdn">
                                                            <Null />
                                                        </Parameter>
                                                        <Parameter name="localMobileStationIdentity">
                                                            <Null />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- end delete Registered sgsnIsdn Msg when deactivatedDomains add noPS -->
<!-- begin delete Registered aaaIdentity Msg when deactivatedDomains add noEPS -->
                                <If>
                                    <Condition operator="notNullIntersection">
                                        <Ref name="deactivatedDomains" delta="added" />
                                        <Val>noEPS</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="aaaIdentity" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_EPS" name="delete">
                                                    <Description>call internal BE of Location LOC_INTERAL_EPS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="removedEpsAccessSubscriptionType">
                                                            <MultiValue>
                                                                <Val>Non3GPP</Val>
                                                            </MultiValue>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- end delete Registered aaaIdentity Msg when deactivatedDomains add noEPS -->
<!-- begin update deactivatedDomains into DB -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="deactivatedDomains" delta="changed" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                            <Description>+ modify deactivatedsubscription to database</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME" />
                                                <Parameter name="deactivatedDomains" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- end update deactivatedDomains into DB -->
<!-- add end by weimingm for F73419 on 2012-12-11 -->
                                <If>
                                    <AND>
                                        <Condition operator="neq">
                                            <Ref name="fSA102" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="deactivatedSubscription" />
                                            <NotExist />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="14">
                                                <Frame FrameId="10063">
                                                    <StringAttributeType>
                                                        <Val>deactivatedSubscription</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="deactivatedSubscription" delta="changed" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="typeOfModification" />
                                            <Val>subscriberModification</Val>
                                        </Condition>
                                        <OR>
<!-- add for feature 67393 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="subscriberType" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67393 End -->
<!-- add for feature 67398 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="smsRouteViaHNetwRoam" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="smsRouteViaHNetwRoam" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67398 End -->
<!-- add for feature 67435 Start -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="serviceProviderReference" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="serviceProviderReference" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- add for feature 67435 End -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="MainSNwithBearerService" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="MainSNwithBearerService" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="SNwithBearerServiceList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="SNwithBearerServiceList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="BearerServiceWithoutSNList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="BearerServiceWithoutSNList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="ServiceNodeNotificationList" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="ServiceNodeNotificationList" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="networkAccessMode" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="networkAccessMode" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
<!-- NGHLR1FAG198454 modify-->
                                                <Condition operator="setGreater">
                                                    <Ref name="accessRestrictionData" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
<!-- NGHLR1FAG198454 end-->
                                                <Condition operator="setGreater">
                                                    <Ref name="accessRestrictionData" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Condition operator="setGreater">
                                                <Ref name="newSuMSubscriberProfileId" />
                                                <Null />
                                            </Condition>
                                            <Condition operator="setGreater">
                                                <Ref name="newSuMSubscriptionProfileId" />
                                                <Null />
                                            </Condition>
<!-- FR SDMA01FAG266214: Add for feature 68733 begin -->
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="notificationToCseFlag" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="notificationToCseFlag" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cfGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="cbGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF1" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF1" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF2" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF2" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF3" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="csiGsmSCF3" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!--  FR SDMA01FAG266214: Add for feature 68733 end -->
<!--    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="newMobileCountryCodeId"/>
                                            <NULL/>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="newMobileCountryCodeId" delta="changed"/>
                                            <NULL/>
                                        </Condition>
                                    </AND>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="newMobileNetworkCodeId"/>
                                            <NULL/>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="newMobileNetworkCodeId" delta="changed"/>
                                            <NULL/>
                                        </Condition>
                                    </AND>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="newMSubIdentificationNumberId"/>
                                            <NULL/>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="newMSubIdentificationNumberId" delta="changed"/>
                                            <NULL/>
                                        </Condition>
                                    </AND> 
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="IMSI_Change_Mode"/>
                                            <NULL/>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="IMSI_Change_Mode" delta="changed"/>
                                            <NULL/>
                                        </Condition>
                                    </AND> -->
<!--    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="typeOfModification"/>
                                            <NULL/>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="typeOfModification" delta="changed"/>
                                            <NULL/>
                                        </Condition>
                                    </AND>-->
<!-- SDMA01CAG258860 begin -->
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fNPO101" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="portoutFlag" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </AND>
<!-- SDMA01CAG258860 end -->
                                        </OR>
                                    </AND>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="12017" />
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="deactivatedSubscription" delta="changed" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                            <Description>+ query current time for subscription state change time</Description>
                                            <In />
                                            <Out>
                                                <Parameter name="CurrentTime">
                                                    <Ref name="date" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <Set name="subscriptionStateChangeTime">
                                            <Ref name="CurrentTime" />
                                        </Set>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="deactivatedSubscription" delta="removed" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="deactivatedSubscription" delta="added" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>build oldIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>MSubIdentificationNumber_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                        <Parameter name="plmnFunctionId">
                                                            <Ref name="plmnFunctionId" />
                                                        </Parameter>
                                                        <Parameter name="managedElementId">
                                                            <Ref name="managedElementId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>associatedIMSI valorized</Description>
                                                        <Parameter name="oldIMSI_DN">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="roaming_Imsi">
                                                            <Ref name="oldIMSI_DN" />
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="roaming_Imsi">
                                                            <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                        </Set>
                                                    </Else>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="roam_mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="roam_mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="roam_mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- Add by wupingfan for 67596.-->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query on Entry MSubIdentificationNumber</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>sgsnIsdn_@@_vlrIsdn_@@_aaaIdentity_@@_non3gppIpAccRegStatus_@@_mmeIdentity_@@_uePurgedInMme_@@_mmeUpdateFlag_@@_aaaUpdateFlag_@@_localMobileStationIdentity_@@_visitedSgsnPlmnId_@@_sgsnIdentity_@@_msStatusInPS_@@_s6aULRFlags_@@_s6dULRFlags</Val>
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
<!--Modify by pomykala for FFRD72989 on 20120404-->
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="sgsnIsdn">
                                                            <Ref name="sgsnIsdn" />
                                                        </Parameter>
                                                        <Parameter name="vlrIsdn">
                                                            <Ref name="vlrIsdn" />
                                                        </Parameter>
                                                        <Parameter name="aaaIdentity">
                                                            <Ref name="aaaIdentity" />
                                                        </Parameter>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="non3gppIpAccRegStatus">
                                                            <Ref name="non3gppIpAccRegStatus" />
                                                        </Parameter>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="aaaUpdateFlag">
                                                            <Ref name="aaaUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="localMobileStationIdentity">
                                                            <Ref name="localMobileStationIdentity" />
                                                        </Parameter>
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                        <Parameter name="visitedSgsnPlmnId">
                                                            <Ref name="visitedSgsnPlmnId" />
                                                        </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" />
                                                        </Parameter>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                    </Out>
                                                </CallBE>
<!-- NGHLR1CAG199081 added queryed parameter in PostCommitBeContext-->
                                                <CallBE name="getInterceptedPara" entityName="HSS.SUB.Subscription.BeSubInterception">
                                                    <In>
                                                        <Parameter name="queryIMSI">
                                                            <Ref name="oldIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- NGHLR1CAG199081 end -->
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <Description>Save DeactivateSubscriptionFlag</Description>
                                                    <In>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="roam_mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="roam_mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="roam_mSubIdentificationNumberId" />
                                                        </Parameter>
                                                        <Parameter name="vlrIsdn">
                                                            <Ref name="vlrIsdn" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIsdn">
                                                            <Ref name="sgsnIsdn" />
                                                        </Parameter>
                                                        <Parameter name="aaaIdentity">
                                                            <Ref name="aaaIdentity" />
                                                        </Parameter>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="non3gppIpAccRegStatus">
                                                            <Ref name="non3gppIpAccRegStatus" />
                                                        </Parameter>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="aaaUpdateFlag">
                                                            <Ref name="aaaUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="localMobileStationIdentity">
                                                            <Ref name="localMobileStationIdentity" />
                                                        </Parameter>
                                                        <Parameter name="DeactivateSubscriptionFlag">
                                                            <Val>true</Val>
                                                        </Parameter>
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                        <Parameter name="visitedSgsnPlmnId">
                                                            <Ref name="visitedSgsnPlmnId" />
                                                        </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" />
                                                        </Parameter>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- End by wupingfan.-->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                        <Parameter name="vlrIsdn">
                                                            <Null />
                                                        </Parameter>
                                                        <Parameter name="sgsnIsdn">
                                                            <Null />
                                                        </Parameter>
                                                        <Parameter name="localMobileStationIdentity">
                                                            <Null />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!--Add begin by Guangli for 69596 D53, 20091029-->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build DN_ServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>Virtual_EPS_DN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_ServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_EPS" name="delete">
                                                    <Description>call internal BE of Location LOC_INTERAL_EPS</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="removedEpsAccessSubscriptionType">
                                                            <MultiValue>
                                                                <Val>3GPP</Val>
                                                                <Val>Non3GPP</Val>
                                                            </MultiValue>
                                                        </Parameter>
<!-- add begin by weimingm for F73419 on 2012-12-17 -->
                                                        <Parameter name="networkElementItem">
                                                            <MultiValue>
                                                                <Val>S4SGSN</Val>
                                                                <Val>MME</Val>
                                                            </MultiValue>
                                                        </Parameter>
<!-- add end by weimingm for F73419 on 2012-12-17 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!--Add end by Guangli for 69596 D53, 20091029-->
                                            </Then>
                                        </If>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                            <Description>+ modify deactivatedsubscription to database</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                                <Parameter name="deactivatedSubscription">
                                                    <Ref name="deactivatedSubscription" />
                                                </Parameter>
                                                <Parameter name="subscriptionStateChangeTime">
                                                    <Ref name="subscriptionStateChangeTime" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- timeStamp end -->
<!-- modify for feature 68045 begin, BPQ, 20090205 -->
                                <Set name="isChangeSubKey">
                                    <Val>false</Val>
                                </Set>
<!-- modify for feature 68045 end, BPQ, 20090205 -->
<!-- add begin by yan.yang for 67405 -->
                                <CallBE name="getPLMN" entityName="HSS.PMH.HPLMN.PlmnCommonFunc">
                                    <Description>get mcc mnc, Plmn data Accessing</Description>
                                    <In>
                                        <Parameter name="mvnomobileCountryCodeId">
                                            <Ref name="submobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mvnomobileNetworkCodeId">
                                            <Ref name="submobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="mvnomobileCountryCodeId" />
                                        <Parameter name="mvnomobileNetworkCodeId" />
                                    </Out>
                                </CallBE>
<!-- add end by yan.yang for 67405 -->
<!-- 
                        ***************************************************************************************
                        *   2.2   changeIMSI
                        *************************************************************************************** -->
<!-- 
                        ***************************************************************************************
                        *   2.2.1   controls (parameter and fonctions)
                        *************************************************************************************** -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="typeOfModification" />
                                        <Val>changeIMSI</Val>
                                    </Condition>
                                    <Then>
<!-- Add for feature 69834 start -->
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="dateOfLinkExpiry" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fSA111" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>dateOfLinkExpiry</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fSA111</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="dateOfLinkExpiry" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Val>AUTOCRE</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="12123" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- Add for feature 69834 end -->
                                        <If>
<!--Begin add for feature 66935, wangying-->
                                            <OR>
<!--End add for feature 66935, wangying-->
                                                <Condition operator="eq">
                                                    <Ref name="fMVN001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
<!--Begin add for feature 66935, wangying-->
                                                <Condition operator="eq">
                                                    <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </OR>
<!--End add for feature 66935, wangying-->
                                            <Then>
<!--FRAME:33012 = Not allowed to change IMSI from MVNO PLMN to non-MVNO PLMN,
                                      from non-MVNO PLMN to MVNO PLMN, or from one MVNO PLMN to another MVNO PLMN. -->
                                                <If>
<!-- If PLMN is changed, veirfy it is not among the above cases -->
                                                    <OR>
                                                        <Condition operator="neq">
                                                            <Ref name="newMobileCountryCodeId" />
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="mobileNetworkCodeId" />
                                                            <Ref name="newMobileNetworkCodeId" />
                                                        </Condition>
                                                    </OR>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                            <In>
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>MobileNetworkCode_DN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_MobileNetworkCode">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>query plmnIdType of the PLMN of the old IMSI</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MobileNetworkCode" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>plmnIdType</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="plmnIdType" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="plmnIdType" />
                                                                <Val>MVNO</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="33012" />
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                            <In>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="newMobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="newMobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>MobileNetworkCode_DN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_MobileNetworkCode">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>query plmnIdType of the PLMN of the old IMSI</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MobileNetworkCode" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>plmnIdType</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="plmnIdType" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="plmnIdType" />
                                                                <Val>MVNO</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="33012" />
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- Start of F67405 MVNO update, by Qi 2009/04/15 -->
<!-- If the operator is not authorized to access the IMSI, throw an exception -->
                                        <If>
                                            <AND>
<!--Begin add for feature 66935, wangying-->
                                                <OR>
<!--End add for feature 66935, wangying-->
                                                    <Condition operator="eq">
                                                        <Ref name="fMVN001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                        <Val>true</Val>
                                                    </Condition>
<!--Begin add for feature 66935, wangying-->
                                                    <Condition operator="eq">
                                                        <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </OR>
<!--Beg SDMA01FAG278379 by Wayne-->
                                                <Condition operator="nullIntersection">
                                                    <Ref name="subscriberType_old" />
                                                    <Val>SHARED_SUBS</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="subscriberType_old" />
                                                    <Val>SHARED_SUBS_SLAVE</Val>
                                                </Condition>
<!--End SDMA01FAG278379 by Wayne-->
                                            </AND>
<!--End add for feature 66935, wangying-->
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_IMSI" name="verifyMVNOAuth">
                                                    <Description />
                                                    <In>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="newMobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="newMobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="newMSubIdentificationNumberId" />
                                                        </Parameter>
                                                        <Parameter name="isChangeIMSI">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- End of F67405 MVNO update, by Qi 2009/04/15 -->
                                        <Foreach name="inputParameter">
                                            <MultiValue>
                                                <Ref name="__RECEIVED_ATTRIBUTES" />
                                            </MultiValue>
                                            <If>
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>MainSNwithBearerService</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>SNwithBearerServiceList</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>BearerServiceWithoutSNList</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>ServiceNodeNotificationList</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>networkAccessMode</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>newSuMSubscriptionProfileId</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>newSuMSubscriberProfileId</Val>
                                                    </Condition>
<!-- begin to add for 68045 multi app, BPQ, 20090217 -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>accessRestrictionData</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>deactivatedSubscription</Val>
                                                    </Condition>
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>deactivatedDomains</Val>
                                                    </Condition>
<!-- add end by weimingm for F73419 on 2012-12-11 -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>mapScreeningCategory</Val>
                                                    </Condition>
<!-- end to add for 68045 multi app, BPQ, 20090217 -->
<!-- begin to add for 67452 prepay,qzg 20090227-->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>prepay</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>prepayCommonGroupId</Val>
                                                    </Condition>
<!-- end to add for 67452 prepay,qzg 20090227-->
<!-- SDMA01CAG258860 begin -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>portoutFlag</Val>
                                                    </Condition>
<!-- SDMA01CAG258860 end -->
<!-- Add begin by xiaozhxu for 68733 on 20101207 -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>notificationToCseFlag</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cfGsmSCF1</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cfGsmSCF2</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cfGsmSCF3</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cbGsmSCF1</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cbGsmSCF2</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>cbGsmSCF3</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>odbGsmSCF1</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>odbGsmSCF2</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>odbGsmSCF3</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>csiGsmSCF1</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>csiGsmSCF2</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameter" />
                                                        <Val>csiGsmSCF3</Val>
                                                    </Condition>
<!-- Add end by xiaozhxu for 68733 on 20101207 -->
                                                </OR>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="23">
                                                            <Frame FrameId="12005" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
                                        </Foreach>
                                        <If>
                                            <OR>
<!--fix FR SDMA01FAG233931, BPQ, 20090410 -->
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="newMobileCountryCodeId" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="newMobileNetworkCodeId" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="newMSubIdentificationNumberId" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Null />
                                                </Condition>
<!--fix FR SDMA01FAG233931, BPQ, 20090410 -->
                                            </OR>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="15">
                                                        <Frame FrameId="10079">
                                                            <StringAttributeType>
                                                                <Val>NewIMSI or IMSI_Change_Mode</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!-- add begin by BPQ for 68045 multi app, 20081226 
                                ***************************************************************************************
                                *   2.2.1   controls (if IMSI is shared by IMS subscription, change IMSI should be rejected)
                                *************************************************************************************** -->
<!-- If control flag is open -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isMultiAppSupported" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
<!-- Start building Imsi4Eis_DN via GSM -->
                                                <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                                    <Description>join MCC, MNC, MSIN to an integer type</Description>
                                                    <In>
                                                        <Parameter name="joinParameters">
                                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>pridImsi</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId" />
                                                        <Parameter name="mobileNetworkCodeId" />
                                                        <Parameter name="mSubIdentificationNumberId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="pridImsi" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>create a Imsi4Eis_DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>Imsi4Eis_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="imsi4EisId">
                                                            <Ref name="pridImsi" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_Imsi4Eis">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- End building Imsi4Eis_DN via GSM-->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>exist Imsi4Eis_DN test</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_Imsi4Eis" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!--modify by sull 20120614 for changeIMSI begin
                                        <If>
                                            begin add by junjy for imsi chg 
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="allowChgImsiBypassIms" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfOAM" />
                                                    <Val>true</Val>
                                                </Condition>
                                            end add by junjy for imsi chg
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                            begin add by junjy for imsi chg 
                                            </AND>
                                            end add by junjy for imsi chg
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="21">
                                                        <Frame FrameId="12053">
                                                            <StringAttributeType>
                                                                <Ref name="DN_Imsi4Eis" />
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
modify by sull 20120614 for changeIMSI end-->
                                            </Then>
                                        </If>
<!-- fix FR SDMA01FAG235895 begin by BPQ, 20090518 -->
<!-- new IMSI should not be used by other suMSubscriberProfileId -->
                                        <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                            <Description>join MCC, MNC, MSIN to be an integer type variable : imsi4EisId</Description>
                                            <In>
                                                <Parameter name="joinParameters">
                                                    <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                </Parameter>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>pridImsi</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="newMobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="newMobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="newMSubIdentificationNumberId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="pridImsi" />
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <Description>build Imsi4Eis_DN via pridImsi</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>Imsi4Eis_DN</Val>
                                                </Parameter>
                                                <Parameter name="imsi4EisId">
                                                    <Ref name="pridImsi" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_Imsi4Eis">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <Description>test the existence of Imsi4Eis_DN</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_Imsi4Eis" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- if the Imsi4Eis_DN entry exists-->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
<!-- check whether the IMPI has same suMSubscriberProfileId or not -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>query link attribute pridLink4Eis from Imsi4Eis_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_Imsi4Eis" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>pridLink4Eis</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="pridLink4Eis" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>query SuMSubscriberProfileId from pridLink4Eis</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="pridLink4Eis" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="IMS_SuMSubscriberProfileId">
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                    </Out>
                                                </CallBE>
<!-- IMSI can only be shared between one subscriber's GSM and IMS subscription-->
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="IMS_SuMSubscriberProfileId" />
                                                        <Ref name="suMSubscriberProfileId" />
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="21">
                                                                <Frame FrameId="12057">
                                                                    <StringAttributeType>
                                                                        <Ref name="IMS_SuMSubscriberProfileId" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- fix FR SDMA01FAG235895 end by BPQ, 20090518 -->
<!-- add end by BPQ for 68045 multi app, 20081226 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fIC001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                    <Val>false</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Val>MANUAL</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="14">
                                                        <Frame FrameId="10063">
                                                            <StringAttributeType>
                                                                <Val>IMSI_Change_Mode = AUTOCRE or AUTODEL</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                        <Frame FrameId="10067">
                                                            <StringAttributeType>
                                                                <Val>fIC001</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--
                                ***************************************************************************************
                                *   2.2.2 build  newIMSI_DN and oldIMSI_DN/newAUC_DN and oldAUC_DN
                                *************************************************************************************** -->
<!--
                                ***************************************************************************************
                                *   prepare for post commit
                                *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubServicesList" name="create" />
<!--Begin SDMA01FAG233295, merge from 1.1, 20090610, BPQ -->
                                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkNumberString">
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>mobileNetworkCodeId</Val>
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="newMobileNetworkCodeId" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkNumberString">
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>mobileCountryCodeId</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="newMobileCountryCodeId" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkNumberString">
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>mSubIdentificationNumberId</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="newMSubIdentificationNumberId" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!--End SDMA01FAG233295 -->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>build newIMSI_DN</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="newMobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="newMobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="newMSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="plmnFunctionId">
                                                    <Ref name="plmnFunctionId" />
                                                </Parameter>
                                                <Parameter name="managedElementId">
                                                    <Ref name="managedElementId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description>associatedIMSI valorized</Description>
                                                <Parameter name="newIMSI_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>build oldIMSI_DN</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="plmnFunctionId">
                                                    <Ref name="plmnFunctionId" />
                                                </Parameter>
                                                <Parameter name="managedElementId">
                                                    <Ref name="managedElementId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description>associatedIMSI valorized</Description>
                                                <Parameter name="oldIMSI_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="newIMSI_DN" />
                                                </Parameter>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>AucServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="newMSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="newMobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="newMobileCountryCodeId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="newAUC_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="oldIMSI_DN" />
                                                </Parameter>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>AucServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="oldAUC_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- start to modify for feature 67488 tracing, zhao jun, 20090831 -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query old IMSI entry to get tracing parameters</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="oldIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="underTracing_oldIMSI">
                                                            <Ref name="underTracingImsi" />
                                                        </Parameter>
                                                        <Parameter name="tracingLevel_oldIMSI">
                                                            <Ref name="tracingLevelImsi" />
                                                        </Parameter>
                                                        <Parameter name="appListActivateTracing_oldIMSI">
                                                            <Ref name="appListActivateTracingImsi" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!--for NSTracing DB roundtrip optimization -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query old IMSI entry to get tracing parameters</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="mainMSISDN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedSubscriptionProfile">
                                                            <Ref name="associatedSubscriptionProfile" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build the DN of new SuMSubscriberProfile entry</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>SuMSubscriberProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedSubscriptionProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_SuMSubscriberProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="mainMSISDN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="underTracingMsisdn" />
                                                        <Parameter name="appListActivateTracingMsisdn" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_SuMSubscriberProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="underTracing" />
                                                        <Parameter name="appListActivateTracing" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
<!--for NSTracing DB roundtrip optimization -->
<!-- end to modify for feature 67488 tracing, zhao jun, 20090831 -->
<!-- NGHLR1CAG199081 added queryed parameter in PostCommitBeContext-->
                                        <CallBE name="getInterceptedPara" entityName="HSS.SUB.Subscription.BeSubInterception">
                                            <In>
                                                <Parameter name="queryIMSI">
                                                    <Ref name="oldIMSI_DN" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
<!-- NGHLR1CAG199081 end -->
<!--
                                ***************************************************************************************
                                *   2.2.3 Control: old  IMSI is associated to mainMSISDN
                                *************************************************************************************** -->
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <Description>Query Entry MSubIdentificationNumber</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="oldIMSI_DN" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>mainMSISDN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="mainMSISDN">
                                                    <Ref name="mainMSISDN" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="mainMSISDN" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="23">
                                                        <Frame FrameId="12007" />
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If>
<!--
                                ***************************************************************************************
                                *   2.2.4     IMSI-change-mode = AUTOCRE or MANUAL
                                *************************************************************************************** -->
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="IMSI_Change_Mode" />
                                                <Val>AUTODEL</Val>
                                            </Condition>
                                            <Then>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.1     Control: new IMSI exist in AUC
                                        *************************************************************************************** -->
<!-- Removed by 68095 feature -->
                                                <LockPolicy name="Auc" type="noLock">
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <Description>Call BeExistEntry.create to know if newIMSI_DN exist</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="newAUC_DN" />
                                                            </Parameter>
                                                            <Parameter name="__NO_FETCH">
                                                                <Val>1</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                </LockPolicy>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>false</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="1">
                                                                <Frame FrameId="8">
                                                                    <StringAttributeType>
                                                                        <Val>newAUC_DN</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.2 Control: new IMSI is not already exist 
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Call BeExistEntry.create to know if newIMSI_DN exist</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="23">
                                                                <Frame FrameId="12008" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.3  Control:Check whether two AUC numbers exist in the different NRG, 
                                                     if yes, call BE HSS.SUB.RE-HOMING.BeReHoming:: rehomingAUC
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="getNRGKey">
                                                    <Description>get the NRG key where the new imsi located</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newAUC_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="sourceNRGKey">
                                                            <Ref name="__NRG_KEY" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="getNRGKey">
                                                    <Description>get the NRG key where the old imsi located</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="oldAUC_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="targetNRGKey">
                                                            <Ref name="__NRG_KEY" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="targetNRGKey" />
                                                        <Ref name="sourceNRGKey" />
                                                    </Condition>
                                                    <Then>
<!--  build strNewImsi = MCC-MNC-MSIN -->
                                                        <CallBE name="create" entityName="HSS.SUB.*.BeString">
                                                            <In>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>strNewImsi</Val>
                                                                </Parameter>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>newMobileCountryCodeId-newMobileNetworkCodeId-newMSubIdentificationNumberId</Val>
                                                                </Parameter>
                                                                <Parameter name="newMobileCountryCodeId" />
                                                                <Parameter name="newMobileNetworkCodeId" />
                                                                <Parameter name="newMSubIdentificationNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="strNewImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeRehoming" name="rehomingAUC">
                                                            <Description>Call Be rehoming</Description>
                                                            <In>
                                                                <Parameter name="IMSI">
                                                                    <Ref name="strNewImsi" />
                                                                </Parameter>
                                                                <Parameter name="Target_NRG">
                                                                    <Ref name="targetNRGKey" />
                                                                </Parameter>
                                                                <Parameter name="Source_NRG">
                                                                    <Ref name="sourceNRGKey" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--Need to query this new AUC entry again to let update indexserver -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>Call BeExistEntry.create to know if newIMSI_DN exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="newAUC_DN" />
                                                                </Parameter>
<!-- add NRG key for F67114 start  01/04/2009 zhao jun -->
                                                                <Parameter name="__NRG_KEY">
                                                                    <Ref name="targetNRGKey" />
                                                                </Parameter>
<!-- add NRG key for F67114 end  01/04/2009 zhao jun -->
                                                            </In>
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.4 Control: New or old IMSI is not already linked
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>build linkOldIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>AutoImsiChange_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>associatedIMSI valorized</Description>
                                                        <Parameter name="linkOldIMSI_DN">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>build linkNewIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>AutoImsiChange_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="newMobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="newMobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="newMSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>associatedIMSI valorized</Description>
                                                        <Parameter name="linkNewIMSI_DN">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Call BeExistEntry.create to know if linkOldIMSI_DN exist</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkOldIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="2">
                                                                <Frame FrameId="9">
                                                                    <StringAttributeType>
                                                                        <Ref name="linkOldIMSI_DN" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Call BeExistEntry.create to know if linkNewIMSI_DN exist</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkNewIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="2">
                                                                <Frame FrameId="9">
                                                                    <StringAttributeType>
                                                                        <Ref name="linkNewIMSI_DN" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                    <Description>create newIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- 67386 Feature-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="IMSI_Change_Mode" />
                                                        <Val>MANUAL</Val>
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="fADD001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <In>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>AddServiceData_DN</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_ServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.LOC.ADD.LOC_OAM_ADD" name="create">
                                                                    <Description>Create ADD entry</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_ServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.5 IMSI-change-mode = AUTOCRE
                                        *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="IMSI_Change_Mode" />
                                                        <Val>AUTOCRE</Val>
                                                    </Condition>
                                                    <Then>
<!--
                                                ***************************************************************************************
                                                *   2.2.4.5.1 Control: percentImsiChange is reached
                                                *************************************************************************************** -->
                                                        <Set name="percentImsiChange">
<!--Begin modify for feature 66935, wangying, query global level data-->
                                                            <Ref name="percentImsiChange" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" queryLevel="MVNE" />
<!--End modify for feature 66935, wangying-->
                                                        </Set>
                                                        <Set name="contMaxSubscriptions">
<!--Begin modify for feature 66935, wangying, query global level data-->
                                                            <Ref name="contMaxSubscriptions" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" queryLevel="MVNE" />
<!--End modify for feature 66935, wangying-->
                                                        </Set>
                                                        <Set name="maxImsiChange">
                                                            <Val>0</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="calculate">
                                                            <In>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>percentImsiChange#contMaxSubscriptions</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>maxImsiChange</Val>
                                                                </Parameter>
                                                                <Parameter name="percentImsiChange" />
                                                                <Parameter name="contMaxSubscriptions" />
                                                                <Parameter name="maxImsiChange" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="maxImsiChange" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="countEntry">
                                                            <Description>Count the number of entry</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>AutoImsiChange_DN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="numberOfImsiChange">
                                                                    <Ref name="__ENTRY_COUNTER" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="numberOfNewImsiChange">
                                                            <Val>0</Val>
                                                        </Set>
                                                        <Set name="value">
                                                            <Val>2</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="calculate">
                                                            <In>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>numberOfImsiChange+value</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>numberOfImsiChange</Val>
                                                                </Parameter>
                                                                <Parameter name="numberOfImsiChange" />
                                                                <Parameter name="value" />
                                                                <Parameter name="numberOfNewImsiChange" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="numberOfImsiChange" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="calculate">
                                                            <In>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>numberOfImsiChange/value</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>numberOfNewImsiChange</Val>
                                                                </Parameter>
                                                                <Parameter name="numberOfImsiChange" />
                                                                <Parameter name="value" />
                                                                <Parameter name="numberOfNewImsiChange" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="numberOfNewImsiChange" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="greater">
                                                                <Ref name="numberOfNewImsiChange" />
                                                                <Ref name="maxImsiChange" />
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="10057">
                                                                            <StringAttributeType>
                                                                                <Val>IMSI_Change</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
<!--
                                                ***************************************************************************************
                                                *   2.2.4.5.2 Creation of link on old IMSI
                                                *************************************************************************************** -->
                                                        <Set name="imsiStatus">
                                                            <Val>LKOLD</Val>
                                                        </Set>
                                                        <Set name="linkToOtherIMSI">
                                                            <Ref name="newIMSI_DN" />
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                                            <Description>get date</Description>
                                                            <In />
                                                            <Out>
                                                                <Parameter name="dateOfLinkCreation">
                                                                    <Ref name="date" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!-- Add for feature 69834 start -->
<!-- if dateOfLinkExpiry is not later than current time, throw exception -->
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="dateOfLinkExpiry" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="lessOrEqual">
                                                                        <Ref name="dateOfLinkExpiry" />
                                                                        <Ref name="dateOfLinkCreation" />
                                                                    </Condition>
                                                                    <Then>
                                                                        <ThrowException>
                                                                            <Error ErrorId="14">
                                                                                <Frame FrameId="12122" />
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
<!-- Add for feature 69834 end -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                            <Description>Create Entry linkOldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="linkOldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="imsiStatus" />
                                                                <Parameter name="linkToOtherIMSI" />
                                                                <Parameter name="dateOfLinkCreation" />
<!-- Add for feature 69834 start -->
                                                                <Parameter name="dateOfLinkExpiry" />
<!-- Add for feature 69834 end -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--
                                                ***************************************************************************************
                                                *   2.2.4.5.3 Creation of link on new IMSI
                                                *************************************************************************************** -->
                                                        <Set name="imsiStatus">
                                                            <Val>LKNEW</Val>
                                                        </Set>
                                                        <Set name="linkToOtherIMSI">
                                                            <Ref name="oldIMSI_DN" />
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                            <Description>Create Entry SubscriberNumber on associatedMainMsisdn</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="linkNewIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="imsiStatus" />
                                                                <Parameter name="linkToOtherIMSI" />
                                                                <Parameter name="dateOfLinkCreation" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- for FR SDMA01FAG266618 by qiaoh begin add a new link from new imsi to msisdn-->
<!--CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                    <Description>Query Entry MSubIdentificationNumber</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="oldIMSI_DN" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>mainMSISDN</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="mainMSISDN">
                                            <Ref name="mainMSISDN" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                 <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                    <Description>modify the msisdn from the new imsi</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="newIMSI_DN" />
                                        </Parameter>
                                        <Parameter name="mainMSISDN">
                                            <Ref name="mainMSISDN" />
                                        </Parameter>
                                        <Parameter name="roamingRestrictionFlags">
                                                <Val>None</Val>
                                        </Parameter>
                                        <Parameter name="vlrUpdateFlag">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="roamingCharactsFlags">
                                                <Val>None</Val>
                                        </Parameter>
                                        <Parameter name="flagCffPlmn">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="supOfAutReqCount">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="supOfLocRegCount">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="autReqSubsPeriod">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="supOfFtnRegCount">
                                                <Val>0</Val>
                    </Parameter>
                                        <Parameter name="locRegSubsPeriod">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="gsmCamelPhase">
                                                <Val>1</Val>
                                        </Parameter>
                                        <Parameter name="gsmNegocCamelPhases">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="inducedCbocBsg">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="inducedCboiBsg">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="inducedCboehBsg">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="roamingCapabilityFlags">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="sgsnGenUnsuppFeaturesFlags">
                                                <Val>None</Val>
                                        </Parameter>
                                        <Parameter name="gprsEnhancementIndicator">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="sgsnUpdateFlag">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="gprsNegocCamelPhases">
                                                <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="sgsnRoamingRestriction">
                                                <Val>None</Val>
                                        </Parameter>
                                        <Parameter name="gprsNotReachableFlag">
                                                <Val>1</Val>
                                        </Parameter>
                                        <Parameter name="gprsNotReachableReason">
                                                <Val>0</Val>
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE-->
<!-- for FR SDMA01FAG266618 by qiaoh end-->
<!-- ***SubInterception*** for AUTO Create Mode Imsi change-->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>- query underTestImsi under oldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTestImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="underTestImsi" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- Put old IMSI, new IMSI, IMSI change mode,and underInterception into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="oldIMSI_DN" />
                                                                        <Parameter name="newIMSI_DN" />
                                                                        <Parameter name="IMSI_Change_Mode" />
                                                                        <Parameter name="underInterception">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                                    <Description>-get all interception identities of the subscriber specified</Description>
                                                                    <In />
                                                                    <Out>
                                                                        <Parameter name="interceptedIdentityList" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getNumberofInterception">
                                                                    <Description>- get number of all interception identities</Description>
                                                                    <In />
                                                                    <Out>
                                                                        <Parameter name="numberOfInterceptedIdentities" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="eq">
                                                                            <Ref name="tagNewImsiOnImsiChange" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfInterception" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <AND>
                                                                            <Condition operator="greater">
                                                                                <Ref name="numberOfInterceptedIdentities" />
                                                                                <Val>1</Val>
                                                                            </Condition>
                                                                            <Condition operator="eq">
                                                                                <Ref name="imsiTargetTypeNotUsed" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Condition operator="eq">
                                                                                <Ref name="tagImsiOnMsisdnInterception" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfInterception" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                        </AND>
                                                                    </OR>
                                                                    <Then>
<!--
                                                                        <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                            <Description>- update the IMSI under newIMSI_DN</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="newIMSI_DN"/>
                                                                                </Parameter>
                                                                                <Parameter name="underTestImsi">
                                                                                    <Val>true</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out/>
                                                                        </CallBE>
                                                                        -->
<!--Set the testNewImsi is True-->
                                                                        <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                            <Description>- update the testNewImsi of new IMSI by linkNewIMSI_DN</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="linkNewIMSI_DN" />
                                                                                </Parameter>
                                                                                <Parameter name="testNewImsi">
                                                                                    <Val>true</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
<!--
                                                                        <Set name="__JUST_AFTER_COMMIT">
                                                                            <Val>justAfterCommit</Val>
                                                                        </Set>-->
                                                                    </Then>
                                                                </If>
<!--NGHLR1FAG200377 Begin-->
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                                        <Val>SUBS_INFO_CHANGE</Val>
                                                                    </Condition>
                                                                    <Then>
<!--NGHLR1FAG199200 Begin-->
                                                                        <Set name="__JUST_AFTER_COMMIT">
                                                                            <Val>justAfterCommit</Val>
                                                                        </Set>
<!--NGHLR1FAG199200 End-->
<!-- SDMA01CAG246501 begin -->
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- Put interceptionCommit into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="interceptionCommit">
                                                                                    <Val>true</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
<!-- SDMA01CAG246501 end -->
                                                                    </Then>
                                                                </If>
<!--NGHLR1FAG200377 End-->
                                                            </Then>
                                                        </If>
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!-- If fPs100 is true and main MSISDN is dummy, then change it, else not change it -->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="changeMSISDNEntry">
                                                            <In>
<!-- add for SDMA01FAG254126 Begin BY shshi -->
                                                                <Parameter name="newIMSI_DN" />
                                                                <Parameter name="IMSI_Change_Mode" />
<!-- add for SDMA01FAG254126 End BY shshi -->
                                                                <Parameter name="oldIMSI_DN" />
                                                                <Parameter name="DN_BasicSubscription">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="newMobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="newMSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- modify for feature 69004 end -->
<!-- ***SubInterception*** end for AUTO Create Mode Imsi change-->
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.4.6 IMSI-change-mode = MANUAL
                                        *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="IMSI_Change_Mode" />
                                                        <Val>MANUAL</Val>
                                                    </Condition>
                                                    <Then>
<!--
                                                ***************************************************************************************
                                                *   2.2.4.6.1 Copy of oldIMSI attributs to newIMSI attributs
                                                *************************************************************************************** -->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_IMSI" name="query">
                                                            <In>
                                                                <Parameter name="oldIMSI_DN" />
                                                                <Parameter name="newIMSI_DN" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--
                                                ***************************************************************************************
                                                *   2.2.4.6.2 Prepare CREQ message
                                                *************************************************************************************** -->
<!-- Add by wupingfan.-->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query on Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>sgsnIsdn_@@_vlrIsdn_@@_aaaIdentity_@@_non3gppIpAccRegStatus_@@_mmeIdentity_@@_uePurgedInMme_@@_mmeUpdateFlag_@@_aaaUpdateFlag_@@_localMobileStationIdentity_@@_visitedSgsnPlmnId_@@_sgsnIdentity_@@_msStatusInPS_@@_s6aULRFlags_@@_s6dULRFlags</Val>
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
<!--Modify by pomykala for FFRD72989 on 20120405-->
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="sgsnIsdn">
                                                                    <Ref name="sgsnIsdn" />
                                                                </Parameter>
                                                                <Parameter name="vlrIsdn">
                                                                    <Ref name="vlrIsdn" />
                                                                </Parameter>
                                                                <Parameter name="aaaIdentity">
                                                                    <Ref name="aaaIdentity" />
                                                                </Parameter>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                                                <Parameter name="non3gppIpAccRegStatus">
                                                                    <Ref name="non3gppIpAccRegStatus" />
                                                                </Parameter>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                                                <Parameter name="mmeIdentity">
                                                                    <Ref name="mmeIdentity" />
                                                                </Parameter>
                                                                <Parameter name="uePurgedInMme">
                                                                    <Ref name="uePurgedInMme" />
                                                                </Parameter>
                                                                <Parameter name="mmeUpdateFlag">
                                                                    <Ref name="mmeUpdateFlag" />
                                                                </Parameter>
                                                                <Parameter name="aaaUpdateFlag">
                                                                    <Ref name="aaaUpdateFlag" />
                                                                </Parameter>
                                                                <Parameter name="localMobileStationIdentity">
                                                                    <Ref name="localMobileStationIdentity" />
                                                                </Parameter>
<!--Add begin by pomykala for FFRD72989 on 20120405-->
                                                                <Parameter name="visitedSgsnPlmnId">
                                                                    <Ref name="visitedSgsnPlmnId" />
                                                                </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120405-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                                <Parameter name="sgsnIdentity">
                                                                    <Ref name="sgsnIdentity" />
                                                                </Parameter>
                                                                <Parameter name="s6aULRFlags">
                                                                    <Ref name="s6aULRFlags" />
                                                                </Parameter>
                                                                <Parameter name="s6dULRFlags">
                                                                    <Ref name="s6dULRFlags" />
                                                                </Parameter>
                                                                <Parameter name="msStatusInPS">
                                                                    <Ref name="msStatusInPS" />
                                                                </Parameter>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <Description>Save IMSI</Description>
                                                            <In>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                                <Parameter name="vlrIsdn" />
                                                                <Parameter name="sgsnIsdn" />
                                                                <Parameter name="aaaIdentity" />
                                                                <Parameter name="non3gppIpAccRegStatus" />
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
                                                                <Parameter name="mmeIdentity" />
                                                                <Parameter name="uePurgedInMme" />
                                                                <Parameter name="mmeUpdateFlag" />
                                                                <Parameter name="aaaUpdateFlag" />
                                                                <Parameter name="localMobileStationIdentity" />
                                                                <Parameter name="IMSI_Change_Mode" />
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                                <Parameter name="visitedSgsnPlmnId" />
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                                <Parameter name="sgsnIdentity" />
                                                                <Parameter name="s6aULRFlags" />
                                                                <Parameter name="s6dULRFlags" />
                                                                <Parameter name="msStatusInPS" />
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- End by wupingfan.-->
<!--
                                                ***************************************************************************************
                                                *   2.2.4.6.3 Modification of associatedIMSI(mainMSISDN and associatedMainMsisdn)
                                                *   add by sull begin
                                                *   and modification of PridIMSIAssoc.associatedIMSIAuth,PridIMSIAssoc.pridToIMSILink,
                        *   PridIMSIAssoc.associatedIMSIOCKey,Imsi4Eis
                                                *   add by sull end
                                                *************************************************************************************** -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query on Entry oldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- NGHLR1FAG191199 -->
                                                                    <Val>mainMSISDN_@@_associatedMSISDN_@@_waitingGgsn</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="mainMSISDN" />
                                                                <Parameter name="associatedMSISDN" />
<!-- NGHLR1FAG191199 begin -->
                                                                <Parameter name="waitingGgsn">
                                                                    <Ref name="waitingGgsn" />
                                                                </Parameter>
<!-- NGHLR1FAG191199 end -->
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="associatedIMSI">
                                                            <Ref name="newIMSI_DN" />
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>modify on mainMSISDN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="mainMSISDN" />
                                                                </Parameter>
                                                                <Parameter name="associatedIMSI" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BasicSubscription" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                                <Parameter name="suMSubscriberProfileId" />
                                                                <Parameter name="suMSubscriptionProfileId" />
                                                                <Parameter name="gsmServiceProfileId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>DN suMSubscriptionProfile available</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>GsmServiceProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId" />
                                                                <Parameter name="suMSubscriptionProfileId" />
                                                                <Parameter name="gsmServiceProfileId" />
                                                            </In>
                                                            <Out>
                                                                <Description>DN suMSubscriptionProfile available</Description>
                                                                <Parameter name="DN_SuMSubscriptionProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query on Entry SuMSubscriptionProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriptionProfile" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>associatedMainMsisdn</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="associatedMainMsisdn" />
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="associatedIMSI">
                                                            <Ref name="newIMSI_DN" />
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Query on Entry SubscriberNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedMainMsisdn" />
                                                                </Parameter>
                                                                <Parameter name="associatedIMSI" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <Foreach name="DN_MSISDN">
                                                            <MultiValue>
                                                                <Ref name="associatedMSISDN" />
                                                            </MultiValue>
                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MSISDN" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                                                    <Parameter name="countryCodeId" />
                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                    <Parameter name="subscriberNumberId" />
                                                                </Out>
                                                            </CallBE>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                <Description>Query on Entry MsisdnCharacteristics on one associatedMSISDN attribute</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MSISDN" />
                                                                    </Parameter>
                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                        <Val>associatedIMSI</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="associatedIMSI" />
                                                                </Out>
                                                            </CallBE>
                                                            <Set name="associatedIMSI">
                                                                <Ref name="newIMSI_DN" />
                                                            </Set>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                <Description>Query on Entry SubscriberNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MSISDN" />
                                                                    </Parameter>
                                                                    <Parameter name="associatedIMSI" />
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Foreach>
<!-- ***SubInterception*** for Manually Imsi change-->
<!--NGHLR1FAG199330 Begin-->
                                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                            <Description>-get all interception identities of the subscriber specified</Description>
                                                            <In />
                                                            <Out>
                                                                <Parameter name="interceptedIdentityList" />
                                                            </Out>
                                                        </CallBE>
<!--
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>-  query underTestImsi under oldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN"/>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTestImsi"/>
                                                            </Out>
                                                        </CallBE>
                                                        -->
                                                        <If>
<!--
                                                            <Condition operator="eq">
                                                                <Ref name="underTestImsi"/>
                                                                <Val>true</Val>
                                                            </Condition>
                                                            -->
                                                            <Condition operator="setGreater">
                                                                <Ref name="interceptedIdentityList" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- Put old IMSI, new IMSI, IMSI change mode,and underInterception into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="oldIMSI_DN" />
                                                                        <Parameter name="newIMSI_DN" />
                                                                        <Parameter name="IMSI_Change_Mode" />
                                                                        <Parameter name="underInterception">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
<!--
                                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                                    <Description>-get all interception identities of the subscriber specified</Description>
                                                                    <In/>
                                                                    <Out>
                                                                        <Parameter name="interceptedIdentityList"/>
                                                                    </Out>
                                                                </CallBE>
                                                                -->
                                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getNumberofInterception">
                                                                    <Description>- get number of all interception identities</Description>
                                                                    <In />
                                                                    <Out>
                                                                        <Parameter name="numberOfInterceptedIdentities" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>- query underTestImsi under oldIMSI_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="oldIMSI_DN" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="underTestImsi" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="underTestImsi" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <If>
                                                                            <OR>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="tagNewImsiOnImsiChange" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfInterception" />
                                                                                    <Val>true</Val>
                                                                                </Condition>
                                                                                <AND>
                                                                                    <Condition operator="greater">
                                                                                        <Ref name="numberOfInterceptedIdentities" />
                                                                                        <Val>1</Val>
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="imsiTargetTypeNotUsed" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                                                        <Val>true</Val>
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="tagImsiOnMsisdnInterception" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfInterception" />
                                                                                        <Val>true</Val>
                                                                                    </Condition>
                                                                                </AND>
                                                                            </OR>
                                                                            <Then>
                                                                                <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                                    <Description>- update the IMSI under newIMSI_DN</Description>
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="newIMSI_DN" />
                                                                                        </Parameter>
                                                                                        <Parameter name="underTestImsi">
                                                                                            <Val>true</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
<!--
                                                                        <Set name="__JUST_AFTER_COMMIT">
                                                                            <Val>justAfterCommit</Val>
                                                                        </Set>-->
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
<!--NGHLR1FAG199330 End-->
<!--***Begin SDMA01FAG225095***-->
<!-- Comment for 67807, it is a historical issue, the ContractInterception and ConfigurationInterception is always exist, no need to do such check -->
<!--
                                                        <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                                            <Description> Be Exist Entry</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Val>contractInterceptionId=1,contractDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL"/>
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry"/>
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then> 
                                                            -->
<!-- END of comment 67807-->
                                                                <If>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                                        <Val>SUBS_INFO_CHANGE</Val>
                                                                    </Condition>
                                                                    <Then>
<!--NGHLR1FAG199200 Begin-->
                                                                        <Set name="__JUST_AFTER_COMMIT">
                                                                            <Val>justAfterCommit</Val>
                                                                        </Set>
<!--NGHLR1FAG199200 End-->
<!-- SDMA01CAG246501 Begin -->
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>- Put interceptionCommit into postCommitContext</Description>
                                                                            <In>
                                                                                <Parameter name="interceptionCommit">
                                                                                    <Val>true</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
<!-- SDMA01CAG246501 End -->
                                                                    </Then>
                                                                </If>
<!-- Comment for 67807 -->
<!--
                                                        </Then>
                                                        </If>-->
                                                            </Then>
                                                        </If>
<!-- add by sull begin :
*   modification of PridIMSIAssoc.associatedIMSIAuth,PridIMSIAssoc.pridToIMSILink,PridIMSIAssoc.associatedIMSIOCKey,Imsi4Eis  -->
<!--begin query RDN about imsServiceProfile -->
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BasicSubscription" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                                <Parameter name="suMSubscriberProfileId" />
                                                                <Parameter name="suMSubscriptionProfileId" />
                                                            </Out>
                                                        </CallBE>
<!--end query RDN about imsServiceProfile -->
<!--begin create DN of imsServiceProfile -->
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>build imsServiceProfile_DN</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ImsServiceProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="imsServiceProfileId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriptionProfileId">
                                                                    <Ref name="suMSubscriptionProfileId" />
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId">
                                                                    <Ref name="suMSubscriberProfileId" />
                                                                </Parameter>
                                                                <Parameter name="subscriptionFunctionId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                                <Parameter name="managedElementId">
                                                                    <Val>HSS1</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_ImsServiceProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!--end create DN of imsServiceProfile -->
<!--begin existEntry of imsServiceProfile -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>Call BeExistEntry.create to know if imsServiceProfile_DN exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_ImsServiceProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
<!--begin query pridLinkList of imsServiceProfile -->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>query link attribute pridLinkList from imsServiceProfile_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_ImsServiceProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>pridLinkList</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="pridLinkList" />
                                                                    </Out>
                                                                </CallBE>
<!--end query pridLinkList of imsServiceProfile -->
<!-- begin build AucServiceProfile DN according new IMSI-->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>build AucServiceProfile_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>AucServiceProfile_DN</Val>
                                                                        </Parameter>
<!--Parameter name="aucServiceProfileId">
                                             <Val>1</Val>
                                          </Parameter-->
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="plmnFunctionId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                        <Parameter name="managedElementId">
                                                                            <Val>HSS1</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_AUC">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
<!-- end build AucServiceProfile DN according new IMSI-->
<!-- begin build AucOperatorCipherKey DN according new IMSI-->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>build AucOperatorCipherKey_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>AucOperatorCipherKey_DN</Val>
                                                                        </Parameter>
<!--Parameter name="aucOperatorCipherKeyId">
                                               <Val>1</Val>
                                           </Parameter-->
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="plmnFunctionId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                        <Parameter name="managedElementId">
                                                                            <Val>HSS1</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_AucOperatorCipherKey">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
<!-- end build AucOperatorCipherKey DN according new IMSI-->
<!-- begin build MSubIdentificationNumber DN according new IMSI-->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>build MSubIdentificationNumber_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>MSubIdentificationNumber_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="plmnFunctionId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                        <Parameter name="managedElementId">
                                                                            <Val>HSS1</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="newIMSI_DN">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
<!-- end build MSubIdentificationNumber DN according new IMSI-->
<!--begin according the pridid stored in the pridLinkList,search PridIMSIAssoc and modify -->
                                                                <Foreach name="DN_Prid_New">
                                                                    <MultiValue>
                                                                        <Ref name="pridLinkList" />
                                                                    </MultiValue>
<!-- begin build  PridIMSIAssoc DN according to pridId-->
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                        <Description>build PridIMSIAssoc_DN</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_Prid_New" />
                                                                            </Parameter>
                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                <Val>PridIMSIAssoc_DN</Val>
                                                                            </Parameter>
<!--Parameter name="pridIMSIAssocId">
                                                          <Val>1</Val>
                                                      </Parameter-->
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="DN_PridIMSIAssoc">
                                                                                <Ref name="__DISTINGUISH_NAME" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
<!-- end build  PridIMSIAssoc DN according to pridId-->
<!-- add by sull for fr SDMA01FAG277523 judge the PridIMSIAssoc whether exist and associated the old IMSI begin  -->
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                        <Description>Call BeExistEntry.create to know if imsServiceProfile_DN exist</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_PridIMSIAssoc" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="existEntry">
                                                                                <Ref name="__BOOL" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <If>
                                                                        <AND>
                                                                            <Condition operator="eq">
                                                                                <Ref name="existEntry" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                        </AND>
                                                                        <Then>
<!-- add by sull for fr SDMA01FAG277523 judge the PridIMSIAssoc whether exist and associated the old IMSI end  -->
<!-- begin query  attribute of PridIMSIAssoc: associatedIMSIAuth,pridToIMSILink,associatedIMSIOCKey-->
                                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                                <In>
                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                        <Ref name="DN_PridIMSIAssoc" />
                                                                                    </Parameter>
                                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- add by sull for fr SDMA01FAG277523 begin -->
                                                                                        <Val>pridImsiMcc_@@_pridImsiMnc_@@_pridImsiMsin_@@_associatedIMSIAuth_@@_pridToIMSILink_@@_associatedIMSIOCKey</Val>
<!-- add by sull for fr SDMA01FAG277523 end -->
                                                                                    </Parameter>
                                                                                </In>
                                                                                <Out>
<!-- add by sull for fr SDMA01FAG277523 begin -->
                                                                                    <Parameter name="pridImsiMcc" />
                                                                                    <Parameter name="pridImsiMnc" />
                                                                                    <Parameter name="pridImsiMsin" />
<!-- add by sull for fr SDMA01FAG277523 end -->
                                                                                    <Parameter name="associatedIMSIAuth" />
                                                                                    <Parameter name="pridToIMSILink" />
                                                                                    <Parameter name="associatedIMSIOCKey" />
                                                                                </Out>
                                                                            </CallBE>
<!-- end query  attribute of PridIMSIAssoc: associatedIMSIAuth,pridToIMSILink,associatedIMSIOCKey-->
<!-- begin modify  PridIMSIAssoc-->
<!-- add by sull for fr SDMA01FAG277523 begin -->
                                                                            <If>
                                                                                <AND>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                        <Ref name="pridImsiMsin" />
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                        <Ref name="pridImsiMnc" />
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                        <Ref name="pridImsiMcc" />
                                                                                    </Condition>
                                                                                </AND>
                                                                                <Then>
                                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                        <Description>modify Entry PridIMSIAssoc</Description>
                                                                                        <In>
                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                <Ref name="DN_PridIMSIAssoc" />
                                                                                            </Parameter>
                                                                                            <Parameter name="pridImsiMcc">
                                                                                                <Ref name="newMobileCountryCodeId" />
                                                                                            </Parameter>
                                                                                            <Parameter name="pridImsiMnc">
                                                                                                <Ref name="newMobileNetworkCodeId" />
                                                                                            </Parameter>
                                                                                            <Parameter name="pridImsiMsin">
                                                                                                <Ref name="newMSubIdentificationNumberId" />
                                                                                            </Parameter>
                                                                                        </In>
                                                                                        <Out />
                                                                                    </CallBE>
<!-- add by sull for fr SDMA01FAG277523 end -->
                                                                                    <If>
                                                                                        <Condition operator="neq">
                                                                                            <Ref name="associatedIMSIAuth" />
                                                                                            <NotExist />
                                                                                        </Condition>
                                                                                        <Then>
                                                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                                                <Description>query the RDN mSubIdentificationNumberId</Description>
                                                                                                <In>
                                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                                        <Ref name="associatedIMSIAuth" />
                                                                                                    </Parameter>
                                                                                                </In>
                                                                                                <Out>
                                                                                                    <Parameter name="submSubIdentificationNumberId_auth">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileNetworkCodeId_auth">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileCountryCodeId_auth">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                    </Parameter>
                                                                                                </Out>
                                                                                            </CallBE>
                                                                                            <If>
                                                                                                <AND>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                        <Ref name="submSubIdentificationNumberId_auth" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                        <Ref name="submobileNetworkCodeId_auth" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                        <Ref name="submobileCountryCodeId_auth" />
                                                                                                    </Condition>
                                                                                                </AND>
                                                                                                <Then>
                                                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                                        <Description>modify Entry PridIMSIAssoc</Description>
                                                                                                        <In>
                                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                                <Ref name="DN_PridIMSIAssoc" />
                                                                                                            </Parameter>
                                                                                                            <Parameter name="associatedIMSIAuth">
                                                                                                                <Ref name="DN_AUC" />
                                                                                                            </Parameter>
                                                                                                        </In>
                                                                                                        <Out />
                                                                                                    </CallBE>
                                                                                                </Then>
                                                                                            </If>
                                                                                        </Then>
                                                                                    </If>
                                                                                    <If>
                                                                                        <Condition operator="neq">
                                                                                            <Ref name="associatedIMSIOCKey" />
                                                                                            <NotExist />
                                                                                        </Condition>
                                                                                        <Then>
                                                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                                                <Description>query the RDN mSubIdentificationNumberId</Description>
                                                                                                <In>
                                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                                        <Ref name="associatedIMSIOCKey" />
                                                                                                    </Parameter>
                                                                                                </In>
                                                                                                <Out>
                                                                                                    <Parameter name="submSubIdentificationNumberId_ckey">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileNetworkCodeId_ckey">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileCountryCodeId_ckey">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                    </Parameter>
                                                                                                </Out>
                                                                                            </CallBE>
                                                                                            <If>
                                                                                                <AND>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                        <Ref name="submSubIdentificationNumberId_ckey" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                        <Ref name="submobileNetworkCodeId_ckey" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                        <Ref name="submobileCountryCodeId_ckey" />
                                                                                                    </Condition>
                                                                                                </AND>
                                                                                                <Then>
                                                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                                        <Description>modify Entry PridIMSIAssoc</Description>
                                                                                                        <In>
                                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                                <Ref name="DN_PridIMSIAssoc" />
                                                                                                            </Parameter>
                                                                                                            <Parameter name="associatedIMSIOCKey">
                                                                                                                <Ref name="DN_AucOperatorCipherKey" />
                                                                                                            </Parameter>
                                                                                                        </In>
                                                                                                        <Out />
                                                                                                    </CallBE>
                                                                                                </Then>
                                                                                            </If>
                                                                                        </Then>
                                                                                    </If>
                                                                                    <If>
                                                                                        <Condition operator="neq">
                                                                                            <Ref name="pridToIMSILink" />
                                                                                            <NotExist />
                                                                                        </Condition>
                                                                                        <Then>
                                                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                                                <Description>query the RDN mSubIdentificationNumberId</Description>
                                                                                                <In>
                                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                                        <Ref name="pridToIMSILink" />
                                                                                                    </Parameter>
                                                                                                </In>
                                                                                                <Out>
                                                                                                    <Parameter name="submSubIdentificationNumberId_link">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileNetworkCodeId_link">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="submobileCountryCodeId_link">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                    </Parameter>
                                                                                                </Out>
                                                                                            </CallBE>
                                                                                            <If>
                                                                                                <AND>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mSubIdentificationNumberId" />
                                                                                                        <Ref name="submSubIdentificationNumberId_link" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileNetworkCodeId" />
                                                                                                        <Ref name="submobileNetworkCodeId_link" />
                                                                                                    </Condition>
                                                                                                    <Condition operator="eq">
                                                                                                        <Ref name="mobileCountryCodeId" />
                                                                                                        <Ref name="submobileCountryCodeId_link" />
                                                                                                    </Condition>
                                                                                                </AND>
                                                                                                <Then>
                                                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                                        <Description>modify Entry PridIMSIAssoc</Description>
                                                                                                        <In>
                                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                                <Ref name="DN_PridIMSIAssoc" />
                                                                                                            </Parameter>
                                                                                                            <Parameter name="pridToIMSILink">
                                                                                                                <Ref name="newIMSI_DN" />
                                                                                                            </Parameter>
                                                                                                        </In>
                                                                                                        <Out />
                                                                                                    </CallBE>
                                                                                                </Then>
                                                                                            </If>
                                                                                        </Then>
                                                                                    </If>
<!-- end modify  PridIMSIAssoc-->
                                                                                </Then>
                                                                            </If>
                                                                        </Then>
                                                                    </If>
                                                                </Foreach>
<!--end according the pridid stored in the pridLinkList,search PridIMSIAssoc and modify -->
                                                            </Then>
                                                        </If>
<!--end existEntry of imsServiceProfile -->
<!-- begin find old Imsi4Eis  according oldIMSI -->
                                                        <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                                            <Description>join MCC, MNC, MSIN to be an integer type variable : imsi4EisId</Description>
                                                            <In>
                                                                <Parameter name="joinParameters">
                                                                    <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                                </Parameter>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>pridImsi</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="mSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="pridImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>build Imsi4Eis_DN via pridImsi</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>Imsi4Eis_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="imsi4EisId">
                                                                    <Ref name="pridImsi" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_Imsi4Eis">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!-- end find old Imsi4Eis  according old IMSI -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>test the existence of Imsi4Eis_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_Imsi4Eis" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
<!-- begin query attribute of the old Imsi4Eis -->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_Imsi4Eis" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>pridLink4Eis</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="pridLink4Eis" />
                                                                    </Out>
                                                                </CallBE>
<!-- end query attribute of the old Imsi4Eis -->
<!-- begin build new imsi4EisId according newIMSI -->
                                                                <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                                                    <Description>join MCC, MNC, MSIN to be an integer type variable : imsi4EisId</Description>
                                                                    <In>
                                                                        <Parameter name="joinParameters">
                                                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>pridImsi</Val>
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="pridImsi" />
                                                                    </Out>
                                                                </CallBE>
<!-- end build new imsi4EisId according newIMSI -->
<!-- begin create new Imsi4Eis -->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>build new Imsi4Eis_DN via pridImsi</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>Imsi4Eis_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="imsi4EisId">
                                                                            <Ref name="pridImsi" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_Imsi4Eis_New">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
<!-- end create new Imsi4Eis -->
<!-- add by sull for fr 279381 begin -->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                    <Description>test the existence of Imsi4Eis_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_Imsi4Eis_New" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="existEntry">
                                                                            <Ref name="__BOOL" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
<!-- add by sull for fr 279381 end -->
<!-- begin modify new Imsi4Eis attrubute -->
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                                            <Description>modify Entry Imsi4Eis</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_Imsi4Eis_New" />
                                                                                </Parameter>
                                                                                <Parameter name="pridLink4Eis">
                                                                                    <Ref name="pridLink4Eis" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
<!-- end modify new Imsi4Eis attrubute -->
<!-- begin delete old Imsi4Eis -->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                    <Description>Delete OldIMSI_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_Imsi4Eis" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
<!-- end delete old Imsi4Eis -->
                                                            </Then>
                                                        </If>
<!--add by sull end :
*   modification of PridIMSIAssoc.associatedIMSIAuth,PridIMSIAssoc.pridToIMSILink,PridIMSIAssoc.associatedIMSIOCKey,Imsi4Eis  -->
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!-- If fPs100 is true and main MSISDN is dummy, then change it, else not change it -->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="changeMSISDNEntry">
                                                            <In>
<!-- add for SDMA01FAG254126 Begin BY shshi -->
                                                                <Parameter name="newIMSI_DN" />
                                                                <Parameter name="IMSI_Change_Mode" />
<!-- add for SDMA01FAG254126 End BY shshi -->
                                                                <Parameter name="oldIMSI_DN" />
                                                                <Parameter name="DN_BasicSubscription">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="newMobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="newMSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- modify for feature 69004 end -->
<!-- ***SubInterception*** end for Manually Imsi change-->
<!--
                                                ****************************************************************************************
                                                *2.2.4.6.4 Deletion old IMSI suMSubIdentification
                                                ***************************************************************************************-->
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingImsi of oldIMSI_DN -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Get underTracingImsi of oldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>underTracingImsi</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTracingImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="underTracingImsi" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                    <In>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>tracingTargetId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__SYNTAX">
                                                                            <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId" />
                                                                        <Parameter name="mobileNetworkCodeId" />
                                                                        <Parameter name="mSubIdentificationNumberId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="tracingTargetId" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>TracingTarget_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="tracingTargetId" />
                                                                        <Parameter name="targetTypeId">
                                                                            <Val>IMSI</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="removeTracing_DN">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <Set name="removeTracing">
                                                                    <MultiValue>
                                                                        <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                        <Ref name="removeTracing_DN" />
                                                                    </MultiValue>
                                                                </Set>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <In>
                                                                        <Parameter name="removeTracing" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <Set name="__JUST_AFTER_COMMIT">
                                                                    <Val>justAfterCommit</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
<!-- SDMA01CAG246501 end -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                            <Description>Delete OldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- Feature 67386-->
                                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                                            <Description>- build addServiceData DN</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>AddServiceData_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="mSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_ServiceProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.LOC.*.BeGDMI" name="existEntry">
                                                            <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_ServiceProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.LOC.ADD.LOC_OAM_ADD" name="delete">
                                                                    <Description>Delete Entry Add Service Data</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_ServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!-- begin 69781,yunqingg -->
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>- build Old ExtendedMWD DN</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ExtendedMWD_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="mSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="oldExtendedMWD_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldExtendedMWD_DN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <OR>
                                                                <Condition operator="eq">
                                                                    <Ref name="fSMS113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                                    <Val>true</Val>
                                                                </Condition>
<!-- 73282-62 modify begin -->
                                                                <Condition operator="eq">
                                                                    <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                                    <Val>true</Val>
                                                                </Condition>
<!-- 73282-62 modify end -->
                                                            </OR>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <In>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>ExtendedMWD_DN</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="newExtendedMWD_DN">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                                    <Description>Create new imsi ExtendedMWD entry</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="newExtendedMWD_DN" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>Query on Entry oldExtendedMWD_DN</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="oldExtendedMWD_DN" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <AllParameters />
                                                                            </Out>
                                                                        </CallBE>
<!-- 73282-62 begin-->
                                                                        <If>
                                                                            <Condition operator="eq">
                                                                                <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE name="getValuefromMultivalue" entityName="HSS.LOC.*.BeCommonHandler">
                                                                                    <Description>?qdiao: 100 "getDatafromMultivalue"</Description>
                                                                                    <In>
                                                                                        <Parameter name="source_Multivalue_Name">
                                                                                            <Val>smscIsdnForExtMWD</Val>
                                                                                        </Parameter>
                                                                                        <Parameter name="source_EntryDn">
                                                                                            <Ref name="oldExtendedMWD_DN" />
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out>
                                                                                        <Parameter name="IPSMGWRegisterAddress">
                                                                                            <Ref name="resultData" />
                                                                                        </Parameter>
                                                                                    </Out>
                                                                                </CallBE>
                                                                                <If>
                                                                                    <Condition operator="setGreater">
                                                                                        <Ref name="IPSMGWRegisterAddress" />
                                                                                        <Null />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Remove name="smscIsdnForExtMWD">
                                                                                            <Ref name="IPSMGWRegisterAddress" />
                                                                                        </Remove>
                                                                                        <CallBE entityName="HSS.LOC.*.BeCommonHandler" name="setArrayValue">
                                                                                            <Description />
                                                                                            <In>
                                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                                    <Val>smscIsdnForExtMWD[12]</Val>
                                                                                                </Parameter>
                                                                                                <Parameter name="__SOURCE_NAME">
                                                                                                    <Val>IPSMGWRegisterAddress</Val>
                                                                                                </Parameter>
                                                                                                <Parameter name="smscIsdnForExtMWD">
                                                                                                    <Ref name="smscIsdnForExtMWD" />
                                                                                                </Parameter>
                                                                                                <Parameter name="IPSMGWRegisterAddress">
                                                                                                    <Ref name="IPSMGWRegisterAddress" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out>
                                                                                                <Parameter name="smscIsdnForExtMWD">
                                                                                                    <Ref name="smscIsdnForExtMWD" />
                                                                                                </Parameter>
                                                                                            </Out>
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
<!-- 73282-62 end -->
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>Modify Entry newExtendMWD_DN</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="newExtendedMWD_DN" />
                                                                                </Parameter>
                                                                                <Parameter name="smscIsdnForExtMWD">
                                                                                    <Ref name="smscIsdnForExtMWD" />
                                                                                </Parameter>
                                                                                <Parameter name="timeStampWaitingSmsForExtMWD">
                                                                                    <Ref name="timeStampWaitingSmsForExtMWD" />
                                                                                </Parameter>
                                                                                <Parameter name="voiceMailOriginForExtMWD">
                                                                                    <Ref name="voiceMailOriginForExtMWD" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                    <Description>Delete Old ExtendedMWD</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="oldExtendedMWD_DN" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!-- end 69781,yunqingg -->
<!--NGHLR1FAG191199,begin -->
                                                        <Foreach name="waitingGgsn_DN">
                                                            <MultiValue>
                                                                <Ref name="waitingGgsn" />
                                                            </MultiValue>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete waitingGgsn</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="waitingGgsn_DN" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Foreach>
<!--NGHLR1FAG191199,end -->
<!-- For feature 67401 begin -->
<!-- 
                         ***************************************************************************************
                         *  Delete on  Entry UnsuccessfulLocation
                         *************************************************************************************** -->
<!-- get & check UnsuccessfulLocation_DN -->
                                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>UnsuccessfulLocation_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="Unsuccessful_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.LOC.*.BeGDMI" name="existEntry">
                                                            <Description>Call BeExistEntry.create to know if Unsuccessful_DN exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="Unsuccessful_DN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!-- Delete UnsuccessfulLocation_DN -->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.LOC.*.BeGDMI" name="delete">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="Unsuccessful_DN" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!-- For feature 67401 end -->
                                                    </Then>
                                                </If>
                                            </Then>
<!--
                                    ***************************************************************************************
                                    *   2.2.5     IMSI-change-mode = AUTODEL
                                    *************************************************************************************** -->
                                            <Else>
<!--
                                        ***************************************************************************************
                                        *   2.2.5.1 Control: old IMSI is linked with imsiStatus=LKOLD
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>build autoImsiChange-DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>AutoImsiChange_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>associatedIMSI valorized</Description>
                                                        <Parameter name="linkOldIMSI_DN">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Call BeExistEntry.create to know if linkOldIMSI_DN exist</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkOldIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query Entry linkOldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="linkOldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>imsiStatus_@@_linkToOtherIMSI_@@_dateOfLinkCreation</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="imsiStatus">
                                                                    <Ref name="imsiStatus" />
                                                                </Parameter>
                                                                <Parameter name="linkToOtherIMSI">
                                                                    <Ref name="linkToOtherIMSI" />
                                                                </Parameter>
                                                                <Parameter name="dateOfLinkCreation">
                                                                    <Ref name="dateOfLinkCreation" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="imsiStatus" />
                                                                <Val>LKOLD</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="12009">
                                                                            <StringAttributeType>
                                                                                <Val>Old IMSI</Val>
                                                                            </StringAttributeType>
                                                                            <StringAttributeType>
                                                                                <Val>LKOLD</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
<!--
                                                ***************************************************************************************
                                                *   2.2.5.2 Control: old IMSI is well linked with new IMSI 
                                                *************************************************************************************** -->
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="linkToOtherIMSI" />
                                                                <Ref name="newIMSI_DN" />
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="12009">
                                                                            <StringAttributeType>
                                                                                <Val>Old IMSI</Val>
                                                                            </StringAttributeType>
                                                                            <StringAttributeType>
                                                                                <Val>New IMSI</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <ThrowException>
                                                            <Error ErrorId="31">
                                                                <Frame FrameId="12009">
                                                                    <StringAttributeType>
                                                                        <Val>Old IMSI</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>any IMSI</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Else>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.5.3 Control: new IMSI is linked with imsiStatus=LKNEW
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>build autoImsiChange-DN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>AutoImsiChange_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="newMobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="newMobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="newMSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>associatedIMSI valorized</Description>
                                                        <Parameter name="linkNewIMSI_DN">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Call BeExistEntry.create to know if linkNewIMSI_DN exist</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkNewIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Create Entry SubscriberNumber on associatedMainMsisdn</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="linkNewIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>imsiStatus_@@_linkToOtherIMSI_@@_dateOfLinkCreation</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="imsiStatus">
                                                                    <Ref name="imsiStatus" />
                                                                </Parameter>
                                                                <Parameter name="linkToOtherIMSI">
                                                                    <Ref name="linkToOtherIMSI" />
                                                                </Parameter>
                                                                <Parameter name="dateOfLinkCreation">
                                                                    <Ref name="dateOfLinkCreation" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="imsiStatus" />
                                                                <Val>LKNEW</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="12009">
                                                                            <StringAttributeType>
                                                                                <Val>New IMSI</Val>
                                                                            </StringAttributeType>
                                                                            <StringAttributeType>
                                                                                <Val>LKNEW</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--
                                        ***************************************************************************************
                                        *   2.2.5.4   Deletion of link on old IMSI
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                    <Description>Delete linkOldIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkOldIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!--
                                        ***************************************************************************************
                                        *   2.2.5.5   Deletion of link on new IMSI
                                        *************************************************************************************** -->
<!-- ***SubInterception*** for AUTO delete Mode Imsi change-->
<!--***Begin SDMA01FAG225095***-->
<!-- Comment for 67807 -->
<!--
                                        <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                            <Description> Be Exist Entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Val>contractInterceptionId=1,contractDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL"/>
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry"/>
                                                <Val>true</Val>
                                            </Condition>
                                            <Then> -->
                                                <If>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                        <Val>SUBS_INFO_CHANGE</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>- query underTestImsi under oldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTestImsi" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="underTestImsi" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- Put new IMSI, IMSI change mode,and underInterception into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="newIMSI_DN" />
                                                                        <Parameter name="IMSI_Change_Mode" />
                                                                        <Parameter name="underInterception">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                                    <Description>-get all interception identities of the subscriber specified</Description>
                                                                    <In />
                                                                    <Out>
                                                                        <Parameter name="interceptedIdentityList" />
                                                                    </Out>
                                                                </CallBE>
                                                                <Set name="__JUST_AFTER_COMMIT">
                                                                    <Val>justAfterCommit</Val>
                                                                </Set>
<!-- SDMA01CAG246501 begin -->
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- Put interceptionCommit into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="interceptionCommit">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
<!-- SDMA01CAG246501 end -->
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--
                                            </Then>
                                        </If> End of comment 67807-->
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!-- If fPs100 is true and main MSISDN is dummy, then change it, else not change it -->
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="changeMSISDNEntry">
                                                    <In>
<!-- add for SDMA01FAG254126 Begin BY shshi -->
                                                        <Parameter name="newIMSI_DN" />
                                                        <Parameter name="IMSI_Change_Mode" />
<!-- add for SDMA01FAG254126 End BY shshi -->
                                                        <Parameter name="oldIMSI_DN" />
                                                        <Parameter name="DN_BasicSubscription">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- modify for feature 69004 end -->
<!-- ***SubInterception*** end for AUTO delete Mode Imsi change-->
<!-- SDMA01CAG246501 begin -->
<!-- check the new IMSI DN is under tracing -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Get underTracingImsi of newIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newIMSI_DN" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>underTracingImsi</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="underTracingImsi" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracingImsi" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                            <In>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>tracingTargetId</Val>
                                                                </Parameter>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>newMobileCountryCodeId-newMobileNetworkCodeId-newMSubIdentificationNumberId</Val>
                                                                </Parameter>
                                                                <Parameter name="newMobileCountryCodeId" />
                                                                <Parameter name="newMobileNetworkCodeId" />
                                                                <Parameter name="newMSubIdentificationNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="tracingTargetId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>TracingTarget_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="tracingTargetId" />
                                                                <Parameter name="targetTypeId">
                                                                    <Val>IMSI</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="removeTracing_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="removeTracing">
                                                            <MultiValue>
                                                                <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                <Ref name="removeTracing_DN" />
                                                            </MultiValue>
                                                        </Set>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <In>
                                                                <Parameter name="removeTracing" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <Set name="__JUST_AFTER_COMMIT">
                                                            <Val>justAfterCommit</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- SDMA01CAG246501 end -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                    <Description>Delete linkNewIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="linkNewIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                    <Description>Delete newIMSI_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newIMSI_DN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Else>
                                        </If>
<!--add start for feature 73024,zhao nannan,change IMSI for LTE -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Val>AUTODEL</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="LTE_flag">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracing" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Foreach name="iter_appList">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracing" />
                                                            </MultiValue>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>OAM-LTEHSS</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
                                                                    <Set name="LTE_flag">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Break />
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracingMsisdn" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Foreach name="iter_appList">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracingMsisdn" />
                                                            </MultiValue>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>OAM-LTEHSS</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
                                                                    <Set name="LTE_flag">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Break />
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracing_oldIMSI" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Foreach name="iter_appList">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracing_oldIMSI" />
                                                            </MultiValue>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>OAM-LTEHSS</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
                                                                    <Set name="LTE_flag">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Break />
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="LTE_flag" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!--DB roundtrip end -->
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>- query oldIMSI_DN get the old IMSI</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="oldIMSI_DN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeNSTracing" name="BuildEpsTracingTargetDN">
                                                            <In>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="mSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="EpsTracingTargetDN" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.ConfigurationData.*.BeGDMI" name="existEntry">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="EpsTracingTargetDN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE name="query" entityName="HSS.ConfigurationData.*.BeGDMI">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="EpsTracingTargetDN" />
                                                                        </Parameter>
                                                                        <Parameter name="tracingLevelEps" />
                                                                        <Parameter name="appListActivateTracingEps" />
                                                                        <Parameter name="tracingSubProfileIdEPS" />
                                                                        <Parameter name="tracingMSISDN" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="tracingLevelEps" />
                                                                        <Parameter name="appListActivateTracingEps" />
                                                                        <Parameter name="tracingSubProfileIdEPS" />
                                                                        <Parameter name="tracingMSISDN" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE name="delete" entityName="HSS.SUB.*.BeGDMI">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="EpsTracingTargetDN" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
<!--build the new IMSI then build the new EpsTracingTarget -->
                                                                <CallBE entityName="HSS.SUB.*.BeNSTracing" name="BuildEpsTracingTargetDN">
                                                                    <In>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="EpsTracingTargetDN" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE name="create" entityName="HSS.ConfigurationData.*.BeGDMI">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="EpsTracingTargetDN" />
                                                                        </Parameter>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>EpsTracingTarget_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="tracingLevelEps">
                                                                            <Ref name="tracingLevelEps" />
                                                                        </Parameter>
                                                                        <Parameter name="appListActivateTracingEps">
                                                                            <Ref name="appListActivateTracingEps" />
                                                                        </Parameter>
                                                                        <Parameter name="tracingSubProfileIdEPS">
                                                                            <Ref name="tracingSubProfileIdEPS" />
                                                                        </Parameter>
                                                                        <Parameter name="tracingMSISDN">
                                                                            <Ref name="tracingMSISDN" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!--add end for feature 73024 -->
<!-- start to modify for feature 67488 tracing, zhao jun, 20090831 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="underTracing_oldIMSI" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Val>AUTODEL</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
<!-- The old IMSI is under tracing. So the new IMSI should be set under tracing too. -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modifyForce">
                                                    <Description>Modify tracing parameters of new IMSI entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="newIMSI_DN" />
                                                        </Parameter>
                                                        <Parameter name="underTracingImsi">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="tracingLevelImsi">
                                                            <Ref name="tracingLevel_oldIMSI" />
                                                        </Parameter>
                                                        <Parameter name="appListActivateTracingImsi">
                                                            <Ref name="appListActivateTracing_oldIMSI" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- fix 67488 FR SDMA01FAG249193 begin, BPQ, 2010-01-12 -->
<!-- if the new IMSI related tracingTarget already exists in DB, modify it according to old IMSI tracing info, else create its tracingTarget in DB -->
<!-- remark for FR SDMA01FAG249193
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="newIMSI_DN"/>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="mobileCountryCodeId"/>
                                                <Parameter name="mobileNetworkCodeId"/>
                                                <Parameter name="mSubIdentificationNumberId"/>
                                            </Out>
                                        </CallBE-->
<!-- create old IMSI corresponding strImsi -->
                                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                    <In>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>strImsi</Val>
                                                        </Parameter>
                                                        <Parameter name="__SYNTAX">
                                                            <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId" />
                                                        <Parameter name="mobileNetworkCodeId" />
                                                        <Parameter name="mSubIdentificationNumberId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="strImsi" />
                                                    </Out>
                                                </CallBE>
<!-- Build the tracing target DN for the old IMSI -->
                                                <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>TracingTarget_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="tracingTargetId">
                                                            <Ref name="strImsi" />
                                                        </Parameter>
                                                        <Parameter name="targetTypeId">
                                                            <Val>IMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_TracingTarget_oldIMSI">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- create new IMSI corresponding strImsi -->
                                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                    <In>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>strImsi</Val>
                                                        </Parameter>
                                                        <Parameter name="__SYNTAX">
                                                            <Val>newMobileCountryCodeId-newMobileNetworkCodeId-newMSubIdentificationNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="newMobileCountryCodeId" />
                                                        <Parameter name="newMobileNetworkCodeId" />
                                                        <Parameter name="newMSubIdentificationNumberId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="strImsi" />
                                                    </Out>
                                                </CallBE>
<!-- Build the tracing target DN for the new IMSI -->
                                                <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>TracingTarget_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="tracingTargetId">
                                                            <Ref name="strImsi" />
                                                        </Parameter>
                                                        <Parameter name="targetTypeId">
                                                            <Val>IMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_TracingTarget_newIMSI">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                                    <Description>+ Query Current Time</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="CurrentTime">
                                                            <Ref name="date" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- open new internal transaction to creat/modify new IMSI corresponding tracingTarget entry -->
                                                <CallBE entityName="HSS.SUB.*.BeNSTracing" name="setTracingTarget4changeIMSI">
                                                    <Description>create/modify tracing target for the new IMSI</Description>
                                                    <In>
                                                        <Parameter name="DN_TracingTarget_oldIMSI" />
                                                        <Parameter name="DN_TracingTarget_newIMSI" />
                                                        <Parameter name="CurrentTime" />
                                                        <Parameter name="NrgKey">
                                                            <Ref name="nrgNumberForTracingDB" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- end to modify for feature 67488 tracing, zhao jun, 20090831 -->
                                    </Then>
<!-- 
                            ***************************************************************************************
                            *   2.3   subscriberModification
                            *************************************************************************************** -->
<!-- Controls parameters -->
                                    <Else>
<!-- modify for feature 68045 multi app begin, BPQ, 20090204 -->
<!--
                                *******************************************
                                *    2.3.0.1  changeIMSI related parameter is not allowed
                                *******************************************-->
                                        <Foreach name="inputParameteri">
                                            <MultiValue>
                                                <Ref name="__RECEIVED_ATTRIBUTES" />
                                            </MultiValue>
                                            <If>
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameteri" />
                                                        <Val>newMobileCountryCodeId</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameteri" />
                                                        <Val>newMobileNetworkCodeId</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameteri" />
                                                        <Val>newMSubIdentificationNumberId</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameteri" />
                                                        <Val>IMSI_Change_Mode</Val>
                                                    </Condition>
<!-- Add for feature 69834 start -->
                                                    <Condition operator="eq">
                                                        <Ref name="inputParameteri" />
                                                        <Val>dateOfLinkExpiry</Val>
                                                    </Condition>
<!-- Add for feature 69834 end -->
                                                </OR>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="23">
                                                            <Frame FrameId="12006">
<!--Add for FR268594-->
<!--StringAttributeType-->
                                                                <IntegerAttributeType>
                                                                    <Ref name="inputParameteri" />
                                                                </IntegerAttributeType>
<!--/StringAttributeType-->
<!--Add for FR268594-->
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
                                        </Foreach>
<!--
                                *********************************************************************
                                *    2.3.0.2  distinguish changeSubKey request from other parameter modification
                                *********************************************************************-->
                                        <If>
                                            <OR>
                                                <Condition operator="setGreater">
                                                    <Ref name="newSuMSubscriberProfileId" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="newSuMSubscriptionProfileId" />
                                                    <Null />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <Foreach name="inputParameteri">
                                                    <MultiValue>
                                                        <Ref name="__RECEIVED_ATTRIBUTES" />
                                                    </MultiValue>
                                                    <If>
                                                        <OR>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>MainSNwithBearerService</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>SNwithBearerServiceList</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>BearerServiceWithoutSNList</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>ServiceNodeNotificationList</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>networkAccessMode</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>accessRestrictionData</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>deactivatedSubscription</Val>
                                                            </Condition>
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>deactivatedDomains</Val>
                                                            </Condition>
<!-- add end by weimingm for F73419 on 2012-12-11 -->
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>mapScreeningCategory</Val>
                                                            </Condition>
<!-- begin to add for 67452 prepay,qzg 20090227-->
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>prepay</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>prepayCommonGroupId</Val>
                                                            </Condition>
<!--end to add for 67452 prepay,qzg 20090227-->
<!-- SDMA01CAG258860 begin -->
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>portoutFlag</Val>
                                                            </Condition>
<!-- SDMA01CAG258860 end -->
<!-- Add begin by xiaozhxu for 68733 on 20101207 -->
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>notificationToCseFlag</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cfGsmSCF1</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cfGsmSCF2</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cfGsmSCF3</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cbGsmSCF1</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cbGsmSCF2</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>cbGsmSCF3</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>odbGsmSCF1</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>odbGsmSCF2</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>odbGsmSCF3</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>csiGsmSCF1</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>csiGsmSCF2</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="inputParameteri" />
                                                                <Val>csiGsmSCF3</Val>
                                                            </Condition>
<!-- Add end by xiaozhxu for 68733 on 20101207 -->
                                                        </OR>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="23">
                                                                    <Frame FrameId="12055" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Foreach>
                                                <Set name="isChangeSubKey">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isChangeSubKey" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
<!-- 
                                        *************************
                                        process of changeSubKey 
                                        *************************-->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.3   If F_SA_025 is active, newSuMSubscriptionProfileId value is authorized.
                                        *************************************************************************************** -->
<!-- Begin added by F72874, Austin, 2012-11-15, -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="subscriberType" />
                                                            <Val>Shared_PROFILE</Val>
                                                        </Condition>
                                                        <OR>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Null />
                                                            </Condition>
                                                        </OR>
                                                    </AND>
                                                    <Then>
                                                        <CallBE name="checkSaSubLinkforBasicSubscription" entityName="HSS.SUB.*.BeSaGpConstr">
                                                            <Description>call checkSaSubLinkforBasicSubscription to check if there is SA Sub links to BasicSubscription</Description>
                                                            <In>
                                                                <Parameter name="suMSubscriberProfileId" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!-- End added by F72874, Austin, 2012-11-15, -->
<!-- Begin Feature 66999 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="newSuMSubscriptionProfileId" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="fSA025" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="22">
                                                                <Frame FrameId="12024" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.3   If the subscriber is linked to a multi-SIM subscriber, changing subscriber RDN not allowed.
                                        *************************************************************************************** -->
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Null />
                                                            </Condition>
                                                        </AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="newSuMSubscriptionProfileId" />
                                                            <Null />
                                                        </Condition>
                                                    </OR>
                                                    <Then>
                                                        <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BasicSubscription" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="multiSimMember" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="multiSimMember" />
                                                                    <Val>1</Val>
                                                                </Condition>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="subscriberType" />
                                                                    <Val>SHARED_SUBS</Val>
                                                                </Condition>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="subscriberType" />
                                                                    <Val>SHARED_SUBS_SLAVE</Val>
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="22">
                                                                        <Frame FrameId="12023">
                                                                            <StringAttributeType>
                                                                                <Ref name="DN_BasicSubscription" />
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- End Feature 66999 -->
<!-- several control for changeSubKey, moved here from changeSubKey specific BE function in order to check it before rehoming -->
<!-- newSuMSubscriberProfileId cannot be set as "default"-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Val>default</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="23">
                                                                <Frame FrameId="12022" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- get old suMSubscriberProfileId and suMSubscriptionProfileId -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>extract suMSubscriberProfileId from input DN BasicSubscription</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                    </Out>
                                                </CallBE>
<!-- at least one of new RDNs should be different from current one -->
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Ref name="suMSubscriberProfileId" />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Ref name="suMSubscriptionProfileId" />
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Ref name="suMSubscriberProfileId" />
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="newSuMSubscriberProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setGreater">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="newSuMSubscriptionProfileId" />
                                                                <Ref name="suMSubscriptionProfileId" />
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="21">
                                                                <Frame FrameId="12020" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" name="isMultiAppSupported" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
<!--begin SDMA01FAG239325 BPQ, 20090626-->
<!--isMultiAppSupported inactive, subscriber cannot have both GSM and IMS profile -->
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <Description>build IMS DN by suMSubscriberProfileId</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>ImsServiceProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId">
                                                                            <Ref name="newSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriptionProfileId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                        <Parameter name="imsServiceProfileId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_ImsServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_ImsServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="existEntry">
                                                                            <Ref name="__BOOL" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <ThrowException>
                                                                            <Error ErrorId="33">
                                                                                <Frame FrameId="12056" />
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Then>
                                                                </If>
<!--end SDMA01FAG239325 BPQ, 20090626-->
                                                            </Then>
<!--begin deleted by junjy for R4.1 support HLR/IMS sub changesubkey>
                                                    <Else>
< only GSM subscriber can change suMSubscriberProfileId>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>create IMS DN of the same suMSubscriberProfileId</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ImsServiceProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId" />
                                                                <Parameter name="suMSubscriptionProfileId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                                <Parameter name="imsServiceProfileId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_ImsServiceProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>test the existence of DN_ImsServiceProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_ImsServiceProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="21">
                                                                        <Frame FrameId="12051">
                                                                            <StringAttributeType>
                                                                                <Ref name="DN_ImsServiceProfile" />
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Else>
<end delete by junjy for R4.1 support HLR/IMS sub changesubkey-->
                                                        </If>
                                                    </Then>
                                                </If>
<!-- make sure the new GsmServiceProfile DN not exist yet, otherwise, throw exception -->
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="newSuMSubscriberProfileId" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="newSuMSubscriberProfileId">
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="newSuMSubscriptionProfileId" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="newSuMSubscriptionProfileId">
                                                            <Ref name="suMSubscriptionProfileId" />
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="modify">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                        </Parameter>
                                                        <Parameter name="suMSubscriptionProfileId">
                                                            <Ref name="newSuMSubscriptionProfileId" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_newGsmServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>test the existence of DN_newGsmServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_newGsmServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="21">
                                                                <Frame FrameId="12021">
                                                                    <StringAttributeType>
                                                                        <Ref name="DN_newGsmServiceProfile" />
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--begin add by junjy for R4.1 changeSubkey include HLR/IMS sub together-->
<!--check the existence of oldImsServiceProfile and newImsServiceProfile-->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build IMS DN by suMSubscriberProfileId</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>ImsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                        <Parameter name="imsServiceProfileId">
                                                            <Val>1</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_ImsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ImsServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                            <Description>build IMS DN by newSuMSubscriberProfileId</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ImsServiceProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId">
                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                </Parameter>
                                                                <Parameter name="suMSubscriptionProfileId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                                <Parameter name="imsServiceProfileId">
                                                                    <Val>1</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_ImsServiceProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_ImsServiceProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="21">
                                                                        <Frame FrameId="12060">
                                                                            <StringAttributeType>
                                                                                <Ref name="DN_ImsServiceProfile" />
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--end add by junjy for R4.1 changeSubkey include HLR/IMS sub together-->
<!-- check rehoming is necessary or not-->
                                                <Set name="needRehoming">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
<!-- test the existence of newSuMSuscriberProfile -->
                                                        <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                            <Description>build the DN of new SuMSubscriberProfile entry</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>SuMSubscriberProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId">
                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_newSuMSubscriberProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE name="existEntry" entityName="HSS.SUB.*.BeGDMI">
                                                            <Description>test the existence of newSuMSubscriberProfileDn located</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_newSuMSubscriberProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!--  70719, zeyangy, 2010-08-23, begin-->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
<!-- getNRGKey of DN_newSuMSubscriberProfile-->
                                                                <CallBE name="getNRGKey" entityName="HSS.SUB.*.BeGDMI">
                                                                    <Description>get the NRG key where DN_newSuMSubscriberProfile located</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_newSuMSubscriberProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="newSuMSubscriberProfile_NRGKey">
                                                                            <Ref name="__NRG_KEY" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="eq">
                                                                            <Ref name="Upgradeflag2" />
                                                                            <Val>Old</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="Upgradeflag2" />
                                                                            <Val>Converting</Val>
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <CallBE name="getSubscriptionNrg" entityName="HSS.SUB.Subscription.BasicUpgrade_R31">
                                                                            <In>
                                                                                <Parameter name="DN_SuMSubscriberProfile">
                                                                                    <Ref name="DN_newSuMSubscriberProfile" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="targetNrg" />
                                                                                <Parameter name="subFound" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="eq">
                                                                                <Ref name="subFound" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="newSuMSubscriberProfile_NRGKey">
                                                                                    <Ref name="targetNrg" />
                                                                                </Set>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
<!-- 70719, zeyangy, 2010-08-23, end -->
<!-- if DN_newSuMSubscriberProfile already exist, get its NRGKey and compare it with -->
                                                        <If>
<!-- 70719, zeyangy, 2010-08-23, begin -->
                                                            <OR>
<!-- 70719, zeyangy, 2010-08-23, end -->
                                                                <Condition operator="eq">
                                                                    <Ref name="existEntry" />
                                                                    <Val>true</Val>
                                                                </Condition>
<!-- 70719, zeyangy, 2010-08-23, begin -->
                                                                <Condition operator="eq">
                                                                    <Ref name="subFound" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                            </OR>
<!-- 70719, zeyangy, 2010-08-23, end -->
                                                            <Then>
<!-- 70719, zeyangy, 2010-08-23, move newSuMSubscriberProfile_NRGKey before-->
<!-- getNRGKey of oldGsmServiceProfileDn-->
                                                                <CallBE name="getNRGKey" entityName="HSS.SUB.*.BeGDMI">
                                                                    <Description>get the NRG key where oldGsmServiceProfileDN located</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_BasicSubscription" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="oldGsmServiceProfile_NRGKey">
                                                                            <Ref name="__NRG_KEY" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldGsmServiceProfile_NRGKey" />
                                                                        <Ref name="newSuMSubscriberProfile_NRGKey" />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="needRehoming">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- SDMA01CAG246501 begin -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>build the DN of new SuMSubscriberProfile entry</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>SuMSubscriberProfile_DN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_SuMSubscriberProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- 70719, zeyangy, 2010-08-23, begin -->
                                                <Set name="existEntry">
                                                    <Val>true</Val>
                                                </Set>
                                                <If>
                                                    <OR>
                                                        <Condition operator="eq">
                                                            <Ref name="Upgradeflag2" />
                                                            <Val>Old</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="Upgradeflag2" />
                                                            <Val>Converting</Val>
                                                        </Condition>
                                                    </OR>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!-- 70719, zeyangy, 2010-08-23, end -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Get underTracing of DN_SuMSubscriberProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>underTracing_@@_tracingLevel_@@_appListActivateTracing</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTracing" />
                                                                <Parameter name="tracingLevel" />
                                                                <Parameter name="appListActivateTracing" />
                                                            </Out>
                                                        </CallBE>
<!-- 70719, zeyangy, 2010-08-23, begin -->
                                                    </Then>
                                                </If>
<!-- 70719, zeyangy, 2010-08-23, end -->
<!-- SDMA01CAG246501 begin -->
<!--rollback current transaction before changeSubKey to avoid dead lock during rehoming-->
<!--CallBE name="commit" entityName="HSS.SUB.*.BeGDMI">
                                            <Description>commit current transaction before changeSubKey to avoid dead lock</Description>
                                            <In />
                                            <Out />
                                        </CallBE-->
<!-- if rehoming is necessary, do it before changeSubKey -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="needRehoming" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!-- call rehoming one subscriber -->
<!--CallBE name="rehomingOneSubscriber" entityName="HSS.SUB.*.BeRehoming">
                                                    <Description>rehoming this subscriber to target NRG</Description>
                                                    <In>
                                                        <Parameter name="subscriberProfileId">
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Parameter>
                                                        <Parameter name="Target_NRG">
                                                            <Ref name="newSuMSubscriberProfile_NRGKey" />
                                                        </Parameter>
                                                        <Parameter name="LOG_Disabled">
                                                            <Val>false</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE-->
                                                        <ThrowException>
                                                            <Error ErrorId="23">
                                                                <Frame FrameId="0">
                                                                    <StringAttributeType>
                                                                        <Val>the sub need do rehoming first</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracing of DN_SuMSubscriberProfile -->
                                                <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                    <Description>build the DN of new SuMSubscriberProfile entry</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>SuMSubscriberProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_SuMSubscriberProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracing" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>TracingTarget_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="tracingTargetId">
                                                                    <Ref name="suMSubscriberProfileId" />
                                                                </Parameter>
                                                                <Parameter name="targetTypeId">
                                                                    <Val>SuMSubscriberProfileId</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="removeTracing_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="removeTracing">
                                                            <MultiValue>
                                                                <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                <Ref name="removeTracing_DN" />
                                                            </MultiValue>
                                                        </Set>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <In>
                                                                <Parameter name="removeTracing" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <Set name="__JUST_AFTER_COMMIT">
                                                            <Val>justAfterCommit</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- SDMA01CAG246501 end -->
<!-- do changeSubKey -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>Extract old SuMSubsciberProfileId, SuMSubscriptionProfileId from DN_BasicSubscription</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="oldSuMSubscriberProfileId">
                                                            <Ref name="suMSubscriberProfileId" />
                                                        </Parameter>
                                                        <Parameter name="oldSuMSubscriptionProfileId">
                                                            <Ref name="suMSubscriptionProfileId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!--add start feature 73024,changeSubKey for LTE -->
<!--if the applist have LTE,then build the EpsTracingTarget -->
<!--get old suMSubscriberProfileId and suMSubscriptionProfileId -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                            <Description>build the DN of old SuMSubscriberProfile entry</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>SuMSubscriberProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId">
                                                                    <Ref name="oldSuMSubscriberProfileId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_SuMSubscriberProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="LTE_flag">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Foreach name="iter_appList">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracing" />
                                                            </MultiValue>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>OAM-LTEHSS</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
                                                                    <Set name="LTE_flag">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Break />
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="underTracing" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="LTE_flag" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>GsmServiceProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId">
                                                                            <Ref name="oldSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriptionProfileId">
                                                                            <Ref name="oldSuMSubscriptionProfileId" />
                                                                        </Parameter>
                                                                        <Parameter name="gsmServiceProfileId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_GsmServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>- Query on Entry SuMSubscriptionProfile</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_GsmServiceProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>associatedMainMsisdn</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="associatedMainMsisdn" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>Query on Entry MobileStationInternalISDN on associatedMainMsisdn attribute</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedMainMsisdn" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>associatedIMSI</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="associatedIMSI" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedIMSI" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="mobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="mobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="mSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeNSTracing" name="BuildEpsTracingTargetDN">
                                                                    <In>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="mobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="mobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="mSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="EpsTracingTargetDN" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE name="modify" entityName="HSS.ConfigurationData.*.BeGDMI">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="EpsTracingTargetDN" />
                                                                        </Parameter>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>EpsTracingTarget_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="tracingSubProfileIdEPS">
                                                                            <Ref name="newSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--feature 73024 add for HSS shared data modify -->
                                                        <Set name="HSS_flag">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Foreach name="iter_appList">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracing" />
                                                            </MultiValue>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-HSS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>OAM-HSS</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
                                                                    <Set name="HSS_flag">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Break />
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="underTracing" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="HSS_flag" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>ImsServiceProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="imsServiceProfileId">
                                                                            <Val>1</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriptionProfileId">
                                                                            <Ref name="oldSuMSubscriptionProfileId" />
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId">
                                                                            <Ref name="oldSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_ImsServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_ImsServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="existEntry">
                                                                            <Ref name="__BOOL" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                                                            <In>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>pridLinkList_@@_puidLinkList</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_ImsServiceProfile" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="pridLinkList" />
                                                                                <Parameter name="puidLinkList" />
                                                                            </Out>
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                                <Foreach name="puidLink">
                                                                    <MultiValue>
                                                                        <Ref name="puidLinkList" />
                                                                    </MultiValue>
                                                                    <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="buildPridAndPuidHSSTracTarUserNDN">
                                                                        <In>
                                                                            <Parameter name="hssSubDN">
                                                                                <Ref name="puidLink" />
                                                                            </Parameter>
                                                                            <Parameter name="targetTypeId">
                                                                                <Val>IMPU</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="HSSTracTarUserNDN" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.BeGDMI" name="existEntry">
                                                                        <Description>- Tracing:check if subscriber entry exists</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="HSSTracTarUserNDN" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="existEntry">
                                                                                <Ref name="__BOOL" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="existEntry" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <CallBE name="modify" entityName="HSS.Tracing.*.BeGDMI">
                                                                                <In>
                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                        <Ref name="HSSTracTarUserNDN" />
                                                                                    </Parameter>
                                                                                    <Parameter name="tracingSubProfileIdHSS">
                                                                                        <Ref name="newSuMSubscriberProfileId" />
                                                                                    </Parameter>
                                                                                </In>
                                                                                <Out />
                                                                            </CallBE>
                                                                        </Then>
                                                                    </If>
                                                                </Foreach>
                                                                <Foreach name="pridLink">
                                                                    <MultiValue>
                                                                        <Ref name="pridLinkList" />
                                                                    </MultiValue>
                                                                    <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="buildPridAndPuidHSSTracTarUserNDN">
                                                                        <In>
                                                                            <Parameter name="hssSubDN">
                                                                                <Ref name="pridLink" />
                                                                            </Parameter>
                                                                            <Parameter name="targetTypeId">
                                                                                <Val>IMPI</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="HSSTracTarUserNDN" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.BeGDMI" name="existEntry">
                                                                        <Description>- Tracing:check if subscriber entry exists</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="HSSTracTarUserNDN" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="existEntry">
                                                                                <Ref name="__BOOL" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="existEntry" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <CallBE name="modify" entityName="HSS.Tracing.*.BeGDMI">
                                                                                <In>
                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                        <Ref name="HSSTracTarUserNDN" />
                                                                                    </Parameter>
                                                                                    <Parameter name="tracingSubProfileIdHSS">
                                                                                        <Ref name="newSuMSubscriberProfileId" />
                                                                                    </Parameter>
                                                                                </In>
                                                                                <Out />
                                                                            </CallBE>
                                                                        </Then>
                                                                    </If>
                                                                </Foreach>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--add end for feature 73024 -->
<!-- beg SDMA01FAG279107 by Wayne -->
<!-- to update the suMSubscriberProfileLink of ExtendedSubscriber Entry that links to this suMSubscriber about to perform ChangeSubKey -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Obtain associatedMainMsisdn via GsmServiceProfile_DN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedMainMsisdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedMainMsisdn" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query master member's Main SubscriberNumber entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedMainMsisdn" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedIMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedIMSI" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query master's Entry MSubIdentificationNumber to get master member's associatedMSISDN mainMSISDN and alertMSISDN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>extSubscriberIdLink</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="extSubscriberIdLink">
                                                            <Ref name="extSubscriberIdLink" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="extSubscriberIdLink" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query master's Entry MSubIdentificationNumber to get master member's associatedMSISDN mainMSISDN and alertMSISDN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="extSubscriberIdLink" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>suMSubscriberProfileLink</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="suMSubscriberProfileLink">
                                                                    <Ref name="suMSubscriberProfileLink" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="suMSubscriberProfileLink" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                    <Description>build SuMSubscriberProfile DN via suMSubscriberProfileId</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>SuMSubscriberProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId">
                                                                            <Ref name="newSuMSubscriberProfileId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="DN_SuMSubscriberProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                    <Description>Modify Entry ExtendedSubscriber</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>ExtendedSubscriber_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="extSubscriberIdLink" />
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileLink">
                                                                            <Ref name="DN_SuMSubscriberProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- end SDMA01FAG279107 by Wayne -->
                                                <CallBE name="changeSubKey" entityName="HSS.SUB.*.BeChangeSubKey">
                                                    <Description>call a specific BE changeSubID, where a new transaction is opened and changeSubKey is called</Description>
                                                    <In>
                                                        <Parameter name="oldSuMSubscriberProfileId">
                                                            <Ref name="oldSuMSubscriberProfileId" />
                                                        </Parameter>
                                                        <Parameter name="oldSuMSubscriptionProfileId">
                                                            <Ref name="oldSuMSubscriptionProfileId" />
                                                        </Parameter>
                                                        <Parameter name="newSuMSubscriberProfileId">
                                                            <Ref name="newSuMSubscriberProfileId" />
                                                        </Parameter>
                                                        <Parameter name="newSuMSubscriptionProfileId">
                                                            <Ref name="newSuMSubscriptionProfileId" />
                                                        </Parameter>
                                                        <Parameter name="isBasicRequest">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="__DISTINGUISH_NAME" />
                                                    </Out>
                                                </CallBE>
<!-- add by znn for feature,the new sub should underTracing too -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="underTracing" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                            <Description>build the DN of old SuMSubscriberProfile entry</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>SuMSubscriberProfile_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="suMSubscriberProfileId">
                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_SuMSubscriberProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modifyForce">
                                                            <Description>Modify tracing parameters of new IMSI entry</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                                </Parameter>
                                                                <Parameter name="underTracing">
                                                                    <Val>true</Val>
                                                                </Parameter>
                                                                <Parameter name="tracingLevel">
                                                                    <Ref name="tracingLevel" />
                                                                </Parameter>
                                                                <Parameter name="appListActivateTracing">
                                                                    <Ref name="appListActivateTracing" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>TracingTarget_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="tracingTargetId">
                                                                    <Ref name="newSuMSubscriberProfileId" />
                                                                </Parameter>
                                                                <Parameter name="targetTypeId">
                                                                    <Val>SuMSubscriberProfileId</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_TracingTarget_newSub">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                                            <Description>+ Query Current Time</Description>
                                                            <In />
                                                            <Out>
                                                                <Parameter name="CurrentTime">
                                                                    <Ref name="date" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeNSTracing" name="setTracingTarget4changeSubKey">
                                                            <Description>create/modify tracing target for the new IMSI</Description>
                                                            <In>
                                                                <Parameter name="removeTracing_DN" />
                                                                <Parameter name="DN_TracingTarget_newSub" />
                                                                <Parameter name="CurrentTime" />
                                                                <Parameter name="NrgKey">
                                                                    <Ref name="nrgNumberForTracingDB" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!-- add by znn for feature,the new sub should underTracing too -->
                                            </Then>
<!-- modify for feature 68045 multi app end, BPQ, 20090204 -->
                                            <Else>
<!-- 
                                        **************************************
                                        process of modification of other parameters 
                                        **************************************-->
<!-- moved here from above when modify for 68045 multi app begin, BPQ, 20090204 -->
<!-- the following part is located just before "2.2 changeIMSI" part, in condition typeOfModification != changeIMSI -->
<!--***Begin SDMA01FAG225095***-->
<!-- Comment for 67807 -->
<!--
                                        <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                            <Description> Be Exist Entry</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Val>contractInterceptionId=1,contractDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL"/>
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry"/>
                                                <Val>true</Val>
                                            </Condition>
                                            <Then> -->
                                                <If>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                        <Val>SUBS_INFO_CHANGE</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                            <Description>-get all interception identities of the subscriber specified</Description>
                                                            <In />
                                                            <Out>
                                                                <Parameter name="interceptedIdentityList" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="interceptedIdentityList" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>- Put underInterception into postCommitContext</Description>
                                                                    <In>
                                                                        <Parameter name="underInterception">
                                                                            <Val>true</Val>
                                                                        </Parameter>
<!-- SDMA01CAG246501 begin -->
                                                                        <Parameter name="interceptionCommit">
                                                                            <Val>true</Val>
                                                                        </Parameter>
<!-- SDMA01CAG246501 end -->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <Set name="__JUST_AFTER_COMMIT">
                                                                    <Val>justAfterCommit</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Comment for 67807 -->
<!--
                                            </Then>
                                        </If>
                                                                                End of comment 67807 -->
<!-- ***SubInterception*** end for subscriber modification-->
<!-- moved here from above when modify for 68045 multi app end, BPQ, 20090204 -->
<!--***NGHLR1FAG199372 and NGHLR1FAG199610 begin-->
                                                <CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubIMSI" name="create">
                                                    <Description>- get associatedIMSI</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="associatedIMSI" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>- NGHLR1FAG199372 and NGHLR1FAG199610 get mainMSIDN and associatedMSISDN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="mainMSISDN" />
                                                        <Parameter name="associatedMSISDN" />
                                                    </Out>
                                                </CallBE>
<!-- SDMA01CAG258860 begin -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="fNPO101" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="portoutFlag" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="portoutFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="33">
                                                                        <Frame FrameId="10134">
                                                                            <StringAttributeType>
                                                                                <Val>portoutFlag</Val>
                                                                            </StringAttributeType>
                                                                            <StringAttributeType>
                                                                                <Val>fNPO101</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                            <Else>
                                                                <Remove name="portoutFlag" />
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
<!--
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="portoutFlag" delta="changed" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>-</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="mainMSISDN" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>appListActivateTracingMsisdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="appListActivateTracingMsisdn" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="subPortOut" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="appListActivateTracingMsisdn">
                                                            <MultiValue>
                                                                <Ref name="appListActivateTracingMsisdn" />
                                                                <Val>subPortOut</Val>
                                                            </MultiValue>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="subPortOut" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="appListActivateTracingMsisdn">
                                                                    <MultiValue>
                                                                        <Ref name="appListActivateTracingMsisdn" />
                                                                        <Val>NONE</Val>
                                                                    </MultiValue>
                                                                </Set>
                                                                <Remove name="appListActivateTracingMsisdn">
                                                                    <MultiValue>
                                                                        <Val>subPortOut</Val>
                                                                    </MultiValue>
                                                                </Remove>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
                                        -->
<!-- SDMA01CAG258860 end -->
<!--get the old MSISDN list-->
                                                <Set name="oldMSISDNList">
                                                    <MultiValue>
                                                        <Ref name="mainMSISDN" />
                                                        <Ref name="associatedMSISDN" />
                                                    </MultiValue>
                                                </Set>
<!--***NGHLR1FAG199372 and NGHLR1FAG199610 then continue to 2.3.18-->
<!-- control on accessRestrictionData(allowed if F_SA_018 true) for R2.3 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="fSA018" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="accessRestrictionData" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="10063">
                                                                    <StringAttributeType>
                                                                        <Val>accessRestrictionData</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                                <Frame FrameId="10067">
                                                                    <StringAttributeType>
                                                                        <Val>fSA018</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--feature 67386 begin:If RTU fADD001 not set,addService can not be true-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="fADD001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="addService" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="10063">
                                                                    <StringAttributeType>
                                                                        <Val>addService</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                                <Frame FrameId="10067">
                                                                    <StringAttributeType>
                                                                        <Val>fADD001</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--feature 67386 end-->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.1   networkAccessMode is allowed if F_GPRS_001 is active
                                        *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="fGprs001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGprs" />
                                                            <Val>1</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
<!-- NGHLR1FAG189593 begin -->
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
<!-- NGHLR1FAG189593 end -->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="10063">
                                                                    <StringAttributeType>
                                                                        <Val>NetworkAccessMode</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
<!-- NGHLR1FAG189593 begin -->
                                                                <Frame FrameId="10067">
<!-- NGHLR1FAG189593 end -->
                                                                    <StringAttributeType>
                                                                        <Val>fGprs001</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.5   Get old value of NAM 
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query on Entry BasicSubscription with DN_BasicSubscription (input DN)</Description>
                                                    <In>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
                                                            <Val>networkAccessMode_@@_deactivatedDomains</Val>
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="oldNetworkAccessMode">
                                                            <Ref name="networkAccessMode" />
                                                        </Parameter>
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
                                                        <Parameter name="deactivatedDomains" />
<!-- add end by weimingm for F73419 on 2012-12-11 -->
                                                    </Out>
                                                </CallBE>
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
                                                <If>
                                                    <AND>
                                                        <Or>
                                                            <Condition operator="eq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Val>BOTH</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            </Condition>
                                                        </Or>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Remove name="deactivatedDomains">
                                                            <MultiValue>
                                                                <Val>noCS</Val>
                                                            </MultiValue>
                                                        </Remove>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Or>
                                                            <Condition operator="eq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Val>BOTH</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            </Condition>
                                                        </Or>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Remove name="deactivatedDomains">
                                                            <MultiValue>
                                                                <Val>noPS</Val>
                                                                <Val>noEPS</Val>
                                                            </MultiValue>
                                                        </Remove>
                                                    </Then>
                                                </If>
<!-- add end by weimingm for F73419 on 2012-12-11 -->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.6   analyse NAM change (set local data deleteGSM, createGSM, deleteGPRS, createGPRS)
                                        *************************************************************************************** -->
                                                <Set name="GPRSprovidedOnMain">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="deleteGSM">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="createGPRS">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="deleteGPRS">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="createGSM">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="createGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="createGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="createGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="createGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.7   treatement of BearerServiceWithoutSNList parameter
                                        *************************************************************************************** -->
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                                <Set name="associatedBasicServicesCodeList">
                                                    <Null />
                                                </Set>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.7.1  get oldBearerServiceNameList
                                        *************************************************************************************** -->
                                                <Proc>
                                                    <Description>read mainMSISDN on IMSI to check if available</Description>
                                                    <In>
                                                        <Parameter name="DN_BasicSubscription" />
                                                    </In>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Query on Entry BasicSubscription with DN_BasicSubscription (input DN)</Description>
                                                        <In>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>bscWithoutSN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="bscWithoutSN">
                                                                <Ref name="bscWithoutSN" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <Foreach name="DN_BSC">
                                                        <MultiValue>
                                                            <Ref name="bscWithoutSN" />
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                                            <Description>1 BearerServiceWithoutSN : Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId,serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BSC" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId,serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="basicServiceGroupId" />
                                                                <Parameter name="basicServiceCodeId" />
                                                                <Parameter name="BearerCapabilityName">
                                                                    <Ref name="serviceCodeMnemonicId" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="oldBearerServiceNameList">
                                                            <MultiValue>
                                                                <Ref name="oldBearerServiceNameList" />
                                                                <Ref name="BearerCapabilityName" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Foreach>
<!--Add for SDMA01CAG271493 begin-->
                                                    <Foreach name="ExtendedBearerServiceWithoutSN">
                                                        <MultiValue>
                                                            <Ref name="BSCofBSG20" defaultValue="force" />
                                                        </MultiValue>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                    <Ref name="subscriberType" />
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                    <Ref name="oldBearerServiceNameList" />
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <Set name="oldBearerServiceNameList">
                                                                    <MultiValue>
                                                                        <Ref name="oldBearerServiceNameList" />
                                                                        <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                    </MultiValue>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Foreach>
<!--Add for SDMA01CAG271493 end-->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                        <In />
                                                        <Out>
                                                            <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                            <Parameter name="suMSubscriptionProfileId" />
                                                            <Parameter name="gsmServiceProfileId" />
                                                            <Parameter name="DN_BasicSubscription">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>DN suMSubscriptionProfile available</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>GsmServiceProfile_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                            <Parameter name="suMSubscriptionProfileId" />
                                                            <Parameter name="gsmServiceProfileId" />
                                                        </In>
                                                        <Out>
                                                            <Description>DN suMSubscriptionProfile available</Description>
                                                            <Parameter name="DN_SuMSubscriptionProfile">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Query on Entry SuMSubscriptionProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriptionProfile" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedMainMsisdn</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <AllParameters />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Query on Entry MobileStationInternalISDN on associatedMainMsisdn attribute</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedMainMsisdn" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedBasicServices_@@_associatedIMSI</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <AllParameters />
                                                        </Out>
                                                    </CallBE>
                                                    <Foreach name="DN_BSC">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServices" />
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                                            <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BSC" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId</Description>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="basicServiceGroupId">
                                                                    <Val>SPEECH</Val>
                                                                </Parameter>
                                                                <Parameter name="basicServiceCodeId">
                                                                    <Ref name="basicServiceCodeId" />
                                                                </Parameter>
                                                                <Parameter name="BearerCapabilityName">
                                                                    <Ref name="serviceCodeMnemonicId" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="oldBearerServiceNameList">
                                                            <MultiValue>
                                                                <Ref name="oldBearerServiceNameList" />
                                                                <Ref name="BearerCapabilityName" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Foreach>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Query on Entry MSubIdentificationNumber on associatedIMSI attribute</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedIMSI" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedMSISDN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="associatedMSISDN">
                                                                <Ref name="associatedMSISDN" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <Foreach name="DN_MSISDN">
                                                        <MultiValue>
                                                            <Ref name="associatedMSISDN" />
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MSISDN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                                                <Parameter name="countryCodeId" />
                                                                <Parameter name="nationalDestinationCodeId" />
                                                                <Parameter name="subscriberNumberId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query on Entry MsisdnCharacteristics on one associatedMSISDN attribute</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MSISDN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>associatedIMSI_@@_associatedBasicServices</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <AllParameters />
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="intBearerServiceNameList">
                                                            <Ref name="oldBearerServiceNameList" />
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="modify">
                                                            <In>
                                                                <Parameter name="associatedBasicServices" />
                                                                <Parameter name="intBearerServiceNameList" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="intBearerServiceNameList" />
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="oldBearerServiceNameList">
                                                            <Ref name="intBearerServiceNameList" />
                                                        </Set>
                                                    </Foreach>
                                                    <Out>
                                                        <Parameter name="oldBearerServiceNameList" />
                                                    </Out>
                                                </Proc>
<!-- SDMA01FAG250922 begin -->
<!-- 
                                ***************************************************************************************
                                *   2.3.12   get associatedMainMsisdn
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN suMSubscriptionProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>GsmServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN suMSubscriptionProfile available</Description>
                                                        <Parameter name="DN_SuMSubscriptionProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query on Entry SuMSubscriptionProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_SuMSubscriptionProfile" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedMainMsisdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedMainMsisdn" />
                                                    </Out>
                                                </CallBE>
<!--Feature 723320 begin, added by qiangfw, 20110529-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!--FR SDMA01FAG270252 begin, qiangfw-->
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Ref name="networkAccessMode" />
                                                            </Condition>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="oldNetworkAccessMode" />
                                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Foreach name="SNwithBearerService">
                                                                            <MultiValue>
                                                                                <Ref name="SNwithBearerServiceList" />
                                                                            </MultiValue>
                                                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                                                <Description>query the attributes</Description>
                                                                                <In>
                                                                                    <Parameter name="__SYNTAX">
                                                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                                    </Parameter>
                                                                                    <Parameter name="__SOURCE_NAME">
                                                                                        <Val>SNwithBearerService</Val>
                                                                                    </Parameter>
                                                                                    <Parameter name="SNwithBearerService" />
                                                                                </In>
                                                                                <Out>
                                                                                    <Parameter name="countryCodeId" />
                                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                                    <Parameter name="subscriberNumberId" />
                                                                                    <Parameter name="BearerCapabilityName" />
                                                                                </Out>
                                                                            </CallBE>
                                                                            <If>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="BearerCapabilityName" />
                                                                                    <Val>GPRS</Val>
                                                                                </Condition>
                                                                                <Then>
                                                                                    <Remove name="SNwithBearerServiceList">
                                                                                        <Ref name="SNwithBearerService" />
                                                                                    </Remove>
                                                                                    <Break />
                                                                                </Then>
                                                                            </If>
                                                                        </Foreach>
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="oldNetworkAccessMode" />
                                                                            <Val>BOTH</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="networkAccessMode" />
                                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                                        </Condition>
                                                                    </AND>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                            <Description>Get MSISDN from associatedMainMsisdn</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="associatedMainMsisdn" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="countryCodeId" />
                                                                                <Parameter name="nationalDestinationCodeId" />
                                                                                <Parameter name="subscriberNumberId" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <Set name="BearerCapabilityName">
                                                                            <Val>GPRS</Val>
                                                                        </Set>
                                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                            <Description />
                                                                            <In>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>MainSNwithBearerServiceElement</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__SYNTAX">
                                                                                    <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                                </Parameter>
                                                                                <Parameter name="countryCodeId" />
                                                                                <Parameter name="nationalDestinationCodeId" />
                                                                                <Parameter name="subscriberNumberId" />
                                                                                <Parameter name="BearerCapabilityName" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="MainSNwithBearerServiceElement" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <Set name="SNwithBearerServiceList">
                                                                            <MultiValue>
                                                                                <Ref name="SNwithBearerServiceList" />
                                                                                <Ref name="MainSNwithBearerServiceElement" />
                                                                            </MultiValue>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
<!--FR SDMA01FAG270252 end, qiangfw-->
<!--Add for SDMA01FAG275705 begin-->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                            </Condition>
                                                            <Then>
                                                                <Set name="IsGPRSonly">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
<!--Add for SDMA01FAG275705 end-->
                                                        <Set name="IsFirstSNwithBearerService">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Set name="IsFindMainSNwithBearerService">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Foreach name="SNwithBearerService">
                                                            <MultiValue>
                                                                <Ref name="SNwithBearerServiceList" />
                                                            </MultiValue>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="IsFirstSNwithBearerService" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="IsFirstSNwithBearerService">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                    <Remove name="newSNwithBearerServiceList" />
                                                                    <Set name="newSNwithBearerServiceList">
                                                                        <MultiValue>
                                                                            <Ref name="newSNwithBearerServiceList" />
                                                                            <Ref name="SNwithBearerService" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Then>
                                                            </If>
                                                            <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                                <Description>lishaoxing-----1</Description>
                                                                <In>
                                                                    <Parameter name="__SYNTAX">
                                                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                    </Parameter>
                                                                    <Parameter name="__SOURCE_NAME">
                                                                        <Val>SNwithBearerService</Val>
                                                                    </Parameter>
                                                                    <Parameter name="SNwithBearerService" />
                                                                </In>
                                                                <Out>
                                                                    <Description />
                                                                    <Parameter name="countryCodeId" />
                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                    <Parameter name="subscriberNumberId" />
                                                                    <Parameter name="BearerCapabilityName" />
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="BearerCapabilityName" />
                                                                        <Val>GPRS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="networkAccessMode" />
                                                                        <Val>BOTH</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="21">
                                                                            <Frame FrameId="18250">
                                                                                <StringAttributeType>
                                                                                    <Val>GPRS</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>Bearer Service</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="networkAccessMode" />
                                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="IsGPRSonly">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="BearerCapabilityName" />
                                                                        <Val>GPRS</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="networkAccessMode" />
                                                                        <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="21">
                                                                            <Frame FrameId="18250">
                                                                                <StringAttributeType>
                                                                                    <Val>Bearer Service</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>GPRS</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
<!--FR SDMA01FAG270252 begin, qiangfw
                        <If>
                        <AND>
                        <Condition operator="neq">
                                <Ref name="BearerCapabilityName"/>
                                <Val>GPRS</Val>
                        </Condition>
                        <Condition operator="eq">
                                <Ref name="IsGPRSonly"/>
                                <Val>true</Val>
                        </Condition>
                        </AND>
            <Then>
                                <ThrowException>
                                    <Error ErrorId="14">
                                        <Frame FrameId="12138"/>
                                    </Error>
                                </ThrowException>
                        </Then>
                        </If>
            FR SDMA01FAG270252 end, qiangfw-->
                                                            <If>
                                                                <OR>
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="BearerCapabilityName" />
                                                                            <Val>GPRS</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="IsGPRSonly" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                    </AND>
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="BearerCapabilityName" />
                                                                            <Val>TELEPHON</Val>
                                                                        </Condition>
                                                                        <OR>
                                                                            <Condition operator="eq">
                                                                                <Ref name="networkAccessMode" />
                                                                                <Val>noGPRS</Val>
                                                                            </Condition>
                                                                            <Condition operator="eq">
                                                                                <Ref name="networkAccessMode" />
                                                                                <Val>BOTH</Val>
                                                                            </Condition>
                                                                        </OR>
                                                                    </AND>
                                                                </OR>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                        <Description />
                                                                        <In>
                                                                            <Parameter name="__DESTINATION_NAME">
                                                                                <Val>MainSNwithBearerServiceElement</Val>
                                                                            </Parameter>
                                                                            <Parameter name="__SYNTAX">
                                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                            </Parameter>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                            <Parameter name="BearerCapabilityName" />
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="MainSNwithBearerServiceElement" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <Set name="MainSNwithBearerService">
                                                                        <MultiValue>
                                                                            <Ref name="MainSNwithBearerService" />
                                                                            <Ref name="MainSNwithBearerServiceElement" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <Remove name="SNwithBearerServiceList">
                                                                        <Ref name="SNwithBearerService" />
                                                                    </Remove>
                                                                    <Set name="IsFindMainSNwithBearerService">
                                                                        <Val>true</Val>
                                                                    </Set>
                                                                </Then>
                                                            </If>
                                                        </Foreach>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="IsGPRSonly" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="IsFindMainSNwithBearerService" />
                                                                    <Val>false</Val>
                                                                </Condition>
<!--FR SDMA01FAG270252 begin, qiangfw-->
                                                                <Condition operator="neq">
                                                                    <Ref name="oldNetworkAccessMode" />
                                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                                </Condition>
<!--FR SDMA01FAG270252 end, qiangfw-->
                                                            </AND>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="21">
                                                                        <Frame FrameId="12138" />
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
<!--FR SDMA01FAG270252 begin, qiangfw-->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="IsFirstSNwithBearerService" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                                    <Description>lishaoxing-----1</Description>
                                                                    <In>
                                                                        <Parameter name="__SYNTAX">
                                                                            <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__SOURCE_NAME">
                                                                            <Val>newSNwithBearerServiceList</Val>
                                                                        </Parameter>
                                                                        <Parameter name="newSNwithBearerServiceList" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="countryCodeId" />
                                                                        <Parameter name="nationalDestinationCodeId" />
                                                                        <Parameter name="subscriberNumberId" />
                                                                        <Parameter name="BearerCapabilityName" />
                                                                    </Out>
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!--FR SDMA01FAG270252 end-->
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="IsFirstSNwithBearerService" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="IsFindMainSNwithBearerService" />
                                                                    <Val>false</Val>
                                                                </Condition>
<!--FR SDMA01FAG270252 begin-->
                                                                <Condition operator="neq">
                                                                    <Ref name="BearerCapabilityName" />
                                                                    <Val>GPRS</Val>
                                                                </Condition>
<!--FR SDMA01FAG270252 end-->
                                                            </AND>
                                                            <Then>
                                                                <Set name="MainSNwithBearerService">
                                                                    <MultiValue>
                                                                        <Ref name="MainSNwithBearerService" />
                                                                        <Ref name="newSNwithBearerServiceList" />
                                                                    </MultiValue>
                                                                </Set>
                                                                <Remove name="SNwithBearerServiceList">
                                                                    <Ref name="newSNwithBearerServiceList" />
                                                                </Remove>
                                                                <Remove name="newSNwithBearerServiceList" />
                                                                <Set name="IsFirstSNwithBearerService">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!--Feature 723320 end, added by qiangfw, 20110529-->
<!-- 
                                ***************************************************************************************
                                *   2.3.13   treatment of mainSNwithBearerService parameter
                                *************************************************************************************** -->
<!-- 
                                ***************************************************************************************
                                *   MSISDN counter initialization
                                *************************************************************************************** -->
<!--begin add for 66935, wangying-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>Query RDN MCC</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="mobileCountryCodeId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeMultiCountry" name="getHostedCCByMCC">
                                                            <Description>get host CC by MCC</Description>
                                                            <In>
                                                                <Parameter name="mobileCountryCodeId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="hostedCC" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeMultiCountry" name="getDummyCCByMCC">
                                                                    <Description>get per country dummyCC by MCC</Description>
                                                                    <In>
                                                                        <Parameter name="mobileCountryCodeId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="countryDummyCC" />
                                                                    </Out>
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BeMultiCountry" name="getRightDummyCC">
                                                    <In>
                                                        <Parameter name="countryDummyCC" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="realDummyCC" />
                                                    </Out>
                                                </CallBE>
<!--end add for 66935, wangying-->
                                                <Set name="countMSISDN">
                                                    <Val>0</Val>
                                                </Set>
                                                <Foreach name="MainSNwithBearerServiceElement">
                                                    <MultiValue>
                                                        <Ref name="MainSNwithBearerService" />
                                                    </MultiValue>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                        <Description>extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                            </Parameter>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>MainSNwithBearerServiceElement</Val>
                                                            </Parameter>
                                                            <Parameter name="MainSNwithBearerServiceElement" />
                                                        </In>
                                                        <Out>
                                                            <Description />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                            <Parameter name="BearerCapabilityName" />
                                                        </Out>
                                                    </CallBE>
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!--
                                                If fPs100=true and NAM=namPsKey and mainMSISDN can be optional
                                                CC=dummyCC,NDC=MNC,SN=MSIN
                                            -->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            </Condition>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="countryCodeId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="nationalDestinationCodeId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="subscriberNumberId" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setGreater">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                                <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                                <Null />
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <Set name="countryCodeId">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                                <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                            </Set>
                                                            <Set name="nationalDestinationCodeId">
                                                                <Ref name="mobileNetworkCodeId" />
                                                            </Set>
                                                            <Set name="subscriberNumberId">
                                                                <Ref name="mSubIdentificationNumberId" />
                                                            </Set>
                                                        </Then>
                                                    </If>
<!--
                                                If fPs100=true and NAM=BOTH or namCsKey, mainMSISDN cann't be dummy MSISDN
                                                countryCodeId cann't be equal to dummyCC
                                            -->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <OR>
                                                                <Condition operator="eq">
                                                                    <Ref name="networkAccessMode" />
                                                                    <Val>BOTH</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="networkAccessMode" />
                                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                                </Condition>
                                                            </OR>
                                                        </AND>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="countryCodeId" />
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                                    <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="33">
                                                                            <Frame FrameId="12127">
                                                                                <StringAttributeType>
                                                                                    <Val>countryCodeId</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Ref name="countryCodeId" />
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>networkAccessMode</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Ref name="networkAccessMode" />
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>fPs100</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                    </If>
<!-- modify for feature 69004 end -->
<!-- NGHLR1FAG186920 begin -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="nationalDestinationCodeId" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Then>
                                                            <Set name="nationalDestinationCodeId">
                                                                <Val />
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- NGHLR1FAG186920 end-->
<!-- modify for feature 69004, author: shshi, time: 2009/11/12 -->
<!--
                                                If fPs100 is true and countryCodeId is equal to dummyCC, check whether the entry already exist.
                                                If exist, throw a new exception: dummy MSISDN already exist 
                                            -->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="fPs100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="countryCodeId" />
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                                <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                            </Condition>
                                                            <Condition operator="setGreater">
<!--Begin modify for feature 66935, wangying-->
<!--Ref name="dummyCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractPs"/-->
                                                                <Ref name="realDummyCC" />
<!--End modify for feature 66935, wangying-->
                                                                <Null />
                                                            </Condition>
                                                        </AND>
                                                        <Then>
<!-- build newMainMSISDN by countryCodeId, nationalDestinationCodeId, subscriberNumberId -->
                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                <In>
                                                                    <Parameter name="subscriberNumberId" />
                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                    <Parameter name="countryCodeId" />
                                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                                        <Val>SubscriberNumber_DN</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="nowMainMsisdn">
                                                                        <Ref name="__DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
<!-- check whether this newMainMSISDN already exist -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="nowMainMsisdn" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="existEntry">
                                                                        <Ref name="__BOOL" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="existEntry" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="33">
                                                                            <Frame FrameId="12126">
                                                                                <StringAttributeType>
                                                                                    <Ref name="nowMainMsisdn" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                    </If>
<!-- modify for feature 69004 end -->
<!--Begin add for feature 66935, wangying-->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                                <Val>true</Val>
                                                            </Condition>
<!-- 73251 b -->
                                                            <Condition operator="eq">
                                                                <Ref name="isSlaveModify" />
                                                                <Val>false</Val>
                                                            </Condition>
<!-- 73251 e -->
                                                        </AND>
                                                        <Then>
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="countryCodeId" />
                                                                        <Ref name="hostedCC" />
                                                                    </Condition>
                                                                    <AND>
                                                                        <Condition operator="setGreater">
                                                                            <Ref name="realDummyCC" />
                                                                            <Null />
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="countryCodeId" />
                                                                            <Ref name="realDummyCC" />
                                                                        </Condition>
                                                                    </AND>
                                                                </OR>
                                                                <Then />
                                                                <Else>
                                                                    <ThrowException>
                                                                        <Error ErrorId="31">
                                                                            <Frame FrameId="12128" />
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Else>
                                                            </If>
                                                        </Then>
                                                    </If>
<!--End add for feature 66935, wangying-->
<!--Begin SDMA01FAG222615 -->
                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkMSISDN">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
<!-- End SDMA01FAG222615 -->
<!--  + FR NGHLR1FAG156669-->
                                                    <Set name="internationalCode">
                                                        <Val>91</Val>
                                                    </Set>
                                                    <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                        <Description>create controlSNList</Description>
                                                        <In>
                                                            <Parameter name="joinParameters">
                                                                <Val>internationalCode,countryCodeId,nationalDestinationCodeId,subscriberNumberId</Val>
                                                            </Parameter>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>controlSNListElement</Val>
                                                            </Parameter>
                                                            <Parameter name="internationalCode" />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="controlSNListElement" />
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="controlSNList">
                                                        <MultiValue>
                                                            <Ref name="controlSNList" />
                                                            <Ref name="controlSNListElement" />
                                                        </MultiValue>
                                                    </Set>
<!--  - FR NGHLR1FAG156669-->
<!-- Begin SDMA01FAG267415: backout SDMA01FAG248753 and orignal FR SDMA01FAG241382 -->
<!-- Begin SDMA01FAG241382  -->
<!--                                           <If>   -->
<!-- Begin SDMA01FAG248753  -->
<!--                                               <AND>
                                                    <Condition operator="neq">
                                                        <Ref name="fGprs105" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGprs" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="BearerCapabilityName" />
                                                        <Val>SMSMTAL</Val>
                                                    </Condition>
                                                </AND>  -->
<!-- End SDMA01FAG248753  -->
<!--                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="20">
                                                            <Frame FrameId="12121">
                                                                <StringAttributeType>
                                                                    <Val>SMSMTAL</Val>
                                                                </StringAttributeType>
                                                            </Frame>
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>  -->
<!-- End SDMA01FAG241382 -->
<!--End SDMA01FAG267415 -->
<!--                                   ***************************************************************************************
                                    *   2.3.13.2    build associatedBasicServices
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                            <Parameter name="plmnFunctionId">
                                                                <Ref name="plmnFunctionId" />
                                                            </Parameter>
                                                            <Parameter name="managedElementId">
                                                                <Ref name="managedElementId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC1">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!--
                                            <Set name="associatedBasicServices">
                                                <MultiValue>
                                                    <Ref name="associatedBasicServices"/>
                                                    <Ref name="DN_BSC1"/>
                                                </MultiValue>
                                            </Set>
                                            -->
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query Entry Main SubscriberNumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC1" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                            <Parameter name="belongToBscLink" />
                                                            <Parameter name="basicServiceCategory" />
                                                            <Parameter name="restrictedApplicabillity" />
                                                        </Out>
                                                    </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>Query BSC from belongToBscLink</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="belongToBscLink" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="basicServiceCodeId" />
                                                        </Out>
                                                    </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                                    <If>
<!-- SDMA01FAG250922 begin -->
                                                        <AND>
                                                            <Condition operator="neq">
                                                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA112" />
                                                                <Val>true</Val>
                                                            </Condition>
<!--Condition operator="nullIntersection">
                                                        <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" name="contspare4"/>
                                                        <Val>fSA112</Val>
                                                    </Condition-->
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                                <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                            </Condition>
                                                        </AND>
<!-- SDMA01FAG250922 end -->
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12031" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                        <Else>
                                                            <Set name="associatedBasicServicesCodeList">
                                                                <MultiValue>
                                                                    <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                                    <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!--end SDMA01FAG233913 change 12016 to 12031  zhao haibing 2007/4/13-->
<!--NGHLR1FAG165519_5-->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCategory" />
                                                            <Val>1</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="20">
                                                                    <Frame FrameId="12012">
                                                                        <StringAttributeType>
                                                                            <Ref name="BearerCapabilityName" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
<!-- 
                                            
                                    ***************************************************************************************
                                    *     2.3.13.3  Subscription Type OC+TC mandatory except for SMSMT
                                    *************************************************************************************** -->
                                                    <Set name="subbasicServiceTCOCSubscription">
                                                        <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode" />
                                                    </Set>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>SMSMTPP</Val>
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <AND>
<!-- NGHLR1FAG205598 -->
                                                                    <Condition operator="eq">
                                                                        <Ref name="restrictedApplicabillity" />
                                                                        <Val>false</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="subbasicServiceTCOCSubscription" />
                                                                        <Val>false</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="211">
                                                                                <StringAttributeType>
                                                                                    <Val>MainSNwithBearerService</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>basicServiceTCOCSubscription</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="restrictedApplicabillity" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="211">
                                                                                <StringAttributeType>
                                                                                    <Val>MainSNwithBearerService</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>restrictedApplicabillity</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.4  BSN uniqueness control
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="BearerServiceNameList" />
                                                            <Ref name="BearerCapabilityName" />
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12004">
                                                                                <StringAttributeType>
                                                                                    <Ref name="BearerCapabilityName" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                        <Else>
                                                            <Set name="BearerServiceNameList">
                                                                <MultiValue>
                                                                    <Ref name="BearerServiceNameList" />
                                                                    <Ref name="BearerCapabilityName" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.5  check if GPRS provided (GPRSprovidedOnMain and BSotherthanGPRSprovidedOnMain local data)
                                    *************************************************************************************** -->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="BearerCapabilityName" />
                                                                <Val>GPRS</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="deleteGPRS" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <Set name="GPRSprovidedOnMain">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="BSotherthanGPRSprovidedOnMain">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.6  build  new associatedMainMsisdn
                                    *************************************************************************************** -->
<!-- NGHLR1FAG186920 begin -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="nationalDestinationCodeId" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Then>
                                                            <Set name="nationalDestinationCodeId">
                                                                <Val />
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- NGHLR1FAG186920 end-->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>build associatedMainMsisdn</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>SubscriberNumber_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out>
                                                            <Description>build associatedMainMsisdn</Description>
                                                            <Parameter name="newAssociatedMainMsisdn">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.7  create DN BSC corresponding to BearerCapabilityName
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.8  if NAM change
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="oldNetworkAccessMode" />
                                                        </Condition>
                                                        <Then>
<!-- 
                                            ***************************************************************************************
                                            *   2.3.13.8.1  if NAM changed to noGPRS, BS GPRS is removed before set associatedBasicServices
                                            *************************************************************************************** -->
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                                </Condition>
                                                                <Then>
                                                                    <If>
                                                                        <Condition operator="neq">
                                                                            <Ref name="BearerCapabilityName" />
                                                                            <Val>GPRS</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <Set name="associatedBasicServices">
                                                                                <MultiValue>
                                                                                    <Ref name="associatedBasicServices" />
                                                                                    <Ref name="DN_BSC" />
                                                                                </MultiValue>
                                                                            </Set>
                                                                        </Then>
                                                                    </If>
                                                                </Then>
                                                                <Else>
<!-- 
                                                    ***************************************************************************************
                                                    *   2.3.13.8.2  if NAM changed to GPRSonly, BS other than SMSMOPP and SMSMTPP are removed before set associatedBasicServices
                                                    *************************************************************************************** -->
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                                        </Condition>
                                                                        <Then>
                                                                            <If>
                                                                                <OR>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="BearerCapabilityName" />
                                                                                        <Val>GPRS</Val>
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="BearerCapabilityName" />
                                                                                        <Val>SMSMTPP</Val>
                                                                                    </Condition>
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="BearerCapabilityName" />
                                                                                        <Val>SMSMOPP</Val>
                                                                                    </Condition>
                                                                                </OR>
                                                                                <Then>
                                                                                    <Set name="associatedBasicServices">
                                                                                        <MultiValue>
                                                                                            <Ref name="associatedBasicServices" />
                                                                                            <Ref name="DN_BSC" />
                                                                                        </MultiValue>
                                                                                    </Set>
                                                                                </Then>
                                                                            </If>
                                                                        </Then>
                                                                        <Else>
<!-- 
                                                            ***************************************************************************************
                                                            *   2.3.13.8.3  other NAM change, set associatedBasicServices
                                                            *************************************************************************************** -->
                                                                            <Set name="associatedBasicServices">
                                                                                <MultiValue>
                                                                                    <Ref name="associatedBasicServices" />
                                                                                    <Ref name="DN_BSC" />
                                                                                </MultiValue>
                                                                            </Set>
                                                                        </Else>
                                                                    </If>
                                                                </Else>
                                                            </If>
                                                        </Then>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.13.9  if no NAM change set associatedBasicServices
                                        *************************************************************************************** -->
                                                        <Else>
                                                            <If>
                                                                <OR>
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="BearerCapabilityName" />
                                                                            <Val>GPRS</Val>
                                                                        </Condition>
                                                                    </AND>
<!-- SDMA01FAG228272 -->
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                                        </Condition>
                                                                        <Condition operator="neq">
                                                                            <Ref name="BearerCapabilityName" />
                                                                            <Val>GPRS</Val>
                                                                        </Condition>
                                                                    </AND>
                                                                </OR>
<!-- SDMA01FAG228272 -->
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="214">
                                                                                <StringAttributeType>
                                                                                    <Ref name="BearerCapabilityName" />
<!-- SDMA01FAG228272 -->
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="associatedBasicServices">
                                                                        <MultiValue>
                                                                            <Ref name="associatedBasicServices" />
                                                                            <Ref name="DN_BSC" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Else>
                                                            </If>
                                                        </Else>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.13.10  Incrementation of 1 of MSISDN counter
                                    *************************************************************************************** -->
<!--<Set name="MappingIncrement">
                                                <Val>1</Val>
                                            </Set>
                                            <Set name="MappingOperation">
                                                <Val>+</Val>
                                            </Set>
                                            <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                <Description> Incrementation of 1 of MSISDN counter</Description>
                                                <In>
                                                    <Parameter name="__SOURCE_NAME">
                                                        <Val>MappingIncrement</Val>
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>countMSISDN</Val>
                                                    </Parameter>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>MappingOperation</Val>
                                                    </Parameter>
                                                    <Parameter name="countMSISDN"/>
                                                    <Parameter name="MappingIncrement"/>
                                                    <Parameter name="MappingOperation"/>
                                                </In>
                                                <Out>
                                                    <Parameter name="countMSISDN"/>
                                                </Out>
                                            </CallBE>-->
                                                </Foreach>
<!--As the number of mainMsisdn is always 1, so there is no need to calulate <DuPeijuan modified> -->
                                                <Set name="countMSISDN">
                                                    <Val>1</Val>
                                                </Set>
<!-- 
                                ***************************************************************************************
                                *   2.3.14   associatedBasicServices for MainSNwithBearerService must not be null
                                *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="setLessOrEqual">
                                                            <Ref name="associatedBasicServices" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="15">
                                                                <Frame FrameId="213">
                                                                    <StringAttributeType>
                                                                        <Val>MainSNwithBearerService</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.15   if BOTH at least one BS other than GPRS on Main
                                *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="BSotherthanGPRSprovidedOnMain" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12000" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.16  if GPRS subscription, GPRS BS must be provided.Otherwise automatically set to main
                                *************************************************************************************** -->
<!--begin NGHLR1FAG189032
                                                    Description:If networkAccessMode is not equal to noGPRS,BCN GPRS should not be suppressed   
                                                -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="BearerCapabilityName">
                                                            <Val>GPRS</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                            <Description>build associatedBasicServices of GPRS</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ServiceCodeMnemonic_DN</Val>
                                                                </Parameter>
<!-- multiPLMN link, link to master HPLMN -->
                                                                <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                    <Ref name="mvnomobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                    <Ref name="mvnomobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="serviceCodeMnemonicId">
                                                                    <Ref name="BearerCapabilityName" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_BSC">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="associatedBasicServices">
                                                            <MultiValue>
                                                                <Ref name="associatedBasicServices" />
                                                                <Ref name="DN_BSC" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Then>
                                                </If>
<!--end NGHLR1FAG189032 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="GPRSprovidedOnMain" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="createGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="BearerCapabilityName">
                                                            <Val>GPRS</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                            <Description>build associatedBasicServices of GPRS</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>ServiceCodeMnemonic_DN</Val>
                                                                </Parameter>
<!-- multiPLMN link, link to master HPLMN -->
                                                                <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                    <Ref name="mvnomobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                    <Ref name="mvnomobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="serviceCodeMnemonicId">
                                                                    <Ref name="BearerCapabilityName" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_BSC">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="associatedBasicServices">
                                                            <MultiValue>
                                                                <Ref name="associatedBasicServices" />
                                                                <Ref name="DN_BSC" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- + FR NGHLR1FAG164472-->
                                                <Set name="BSnumber">
                                                    <Ref name="associatedBasicServices" defaultValue="occurs" />
                                                </Set>
                                                <If>
                                                    <OR>
                                                        <Condition operator="greater">
                                                            <Ref name="BSnumber" />
                                                            <Val>2</Val>
                                                        </Condition>
                                                        <AND>
                                                            <Condition operator="neq">
                                                                <Ref name="networkAccessMode" />
                                                                <Val>BOTH</Val>
                                                            </Condition>
                                                            <Condition operator="setGreater">
                                                                <Ref name="BSnumber" />
                                                                <Val>1</Val>
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12011">
                                                                    <StringAttributeType>
                                                                        <Val>MainSNwithBearerService</Val>
<!--Ref name="controlSNListElement"/-->
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- - FR NGHLR1FAG164472-->
<!-- 
                                ***************************************************************************************
                                *   2.3.17  update mainMSISDN
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query Entry Main SubscriberNumber</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedMainMsisdn" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedSubscriptionProfile_@@_associatedIMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedSubscriptionProfile" />
                                                        <Parameter name="associatedIMSI" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="associatedMainMsisdn" />
                                                        <Ref name="newAssociatedMainMsisdn" />
                                                    </Condition>
                                                    <Then>
<!--update associatedBasicServices on MainMSISDN -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify Entry MobileStationInternalISDN on associatedMainMsisdn</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedMainMsisdn" />
                                                                </Parameter>
                                                                <Parameter name="associatedBasicServices" />
<!-- SDMA01CAG258860 begin -->
                                                                <Parameter name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                    <Else>
<!--Begin add for feature 66935, wangying-->
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="fSA113" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="subscriberType" />
                                                                    <Val>Shared_M2M</Val>
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="31">
                                                                        <Frame FrameId="12134" />
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                        </If>
<!--end add for feature 66935, wangying-->
<!-- SDMA01FAG244954 begin by Tan Lihe -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>check the newAssociatedMainMsisdn used by another subscription</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="newAssociatedMainMsisdn" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
<!--Feature 723320 begin, qiangfw, 20110627-->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>query link attribute associatedSubscriptionProfile from newAssociatedMainMsisdn</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="newAssociatedMainMsisdn" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>associatedSubscriptionProfile</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="tmp_associatedSubscriptionProfile">
                                                                            <Ref name="associatedSubscriptionProfile" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeString" name="getSubStr">
                                                                    <Description>-- extract suMSubscriberProfileId from associatedSubscriptionProfile</Description>
                                                                    <In>
                                                                        <Parameter name="__SOURCE_NAME">
                                                                            <Ref name="tmp_associatedSubscriptionProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="__SYNTAX">
                                                                            <Val>suMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>associated_suMSubscriberProfileId</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="associated_suMSubscriberProfileId" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="associated_suMSubscriberProfileId" />
                                                                        <Ref name="suMSubscriberProfileId" />
                                                                    </Condition>
                                                                    <Then>
                                                                        <ThrowException>
                                                                            <Error ErrorId="12002">
                                                                                <Frame FrameId="12033" />
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Then>
                                                                    <Else>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>lsx4---Create Entry MobileStationInternalISDN on associatedMainMsisdn</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="newAssociatedMainMsisdn" />
                                                                                </Parameter>
                                                                                <Parameter name="associatedSubscriptionProfile" />
                                                                                <Parameter name="associatedIMSI" />
                                                                                <Parameter name="associatedBasicServices" />
<!-- Add for Feature 67405 Start, by Qi-->
                                                                                <Parameter name="isdnMvnoIndex">
                                                                                    <Ref name="subscriptionMvnoIndex" />
                                                                                </Parameter>
<!-- Add for Feature 67405 End, by Qi-->
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                            <Else>
<!--Feature 723320 end, qiangfw, 20110627-->
<!--Feature 723320 end, qiangfw, 20110627-->
<!--        <ThrowException>
                                                            <Error ErrorId="12002">
                                                                <Frame FrameId="12033">
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>   -->
<!--Feature 723320 end, qiangfw, 20110627-->
<!-- SDMA01FAG244954 end by Tan Lihe -->
<!--create associatedMainMsisdn-->
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                                    <Description>Create Entry MobileStationInternalISDN on associatedMainMsisdn</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="newAssociatedMainMsisdn" />
                                                                        </Parameter>
                                                                        <Parameter name="associatedSubscriptionProfile" />
                                                                        <Parameter name="associatedIMSI" />
                                                                        <Parameter name="associatedBasicServices" />
<!-- Add for Feature 67405 Start, by Qi-->
                                                                        <Parameter name="isdnMvnoIndex">
                                                                            <Ref name="subscriptionMvnoIndex" />
                                                                        </Parameter>
<!-- Add for Feature 67405 End, by Qi-->
<!-- SDMA01CAG258860 begin -->
                                                                        <Parameter name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
<!--Feature 723320 begin, qiangfw, 20110627-->
<!-- add for r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="getTranslatedNPAMSISDN">
                                                                            <Description>-check if match npa</Description>
                                                                            <In>
                                                                                <Parameter name="oldNDC">
                                                                                    <Ref name="nationalDestinationCodeId" />
                                                                                </Parameter>
                                                                                <Parameter name="oldSN">
                                                                                    <Ref name="subscriberNumberId" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="NPAFlag" />
                                                                                <Parameter name="newSN" />
                                                                                <Parameter name="newNDC" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="eq">
                                                                                <Ref name="NPAFlag" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                                    <In>
                                                                                        <Parameter name="__SYNTAX">
                                                                                            <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                                        </Parameter>
                                                                                        <Parameter name="__DESTINATION_NAME">
                                                                                            <Val>newMainMSISDNwithNPAnew</Val>
                                                                                        </Parameter>
                                                                                        <Parameter name="countryCodeId" />
                                                                                        <Parameter name="nationalDestinationCodeId">
                                                                                            <Ref name="newNDC" />
                                                                                        </Parameter>
                                                                                        <Parameter name="subscriberNumberId">
                                                                                            <Ref name="newSN" />
                                                                                        </Parameter>
                                                                                        <Parameter name="BearerCapabilityName" />
                                                                                    </In>
                                                                                    <Out>
                                                                                        <Parameter name="newMainMSISDNwithNPAnew" />
                                                                                    </Out>
                                                                                </CallBE>
                                                                                <If>
                                                                                    <Condition operator="nullIntersection">
                                                                                        <Ref name="SNwithBearerServiceList" />
                                                                                        <Ref name="newMainMSISDNwithNPAnew" />
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <Set name="mainMSISDNImpactFlag">
                                                                                            <Val>true</Val>
                                                                                        </Set>
<!--Set name="SNwithBearerServiceList">
                                                                                            <MultiValue>
                                                                                                <Ref name="SNwithBearerServiceList" />
                                                                                                <Ref name="newMainMSISDNwithNPA" />
                                                                                            </MultiValue>
                                                                                        </Set-->
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
<!-- end of r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                            </Else>
                                                        </If>
<!--Feature 723320 end, qiangfw, 20110627-->
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingMsisdn of associatedMainMsisdn -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedMainMsisdn" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>underTracingMsisdn</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="underTracingMsisdn" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="underTracingMsisdn" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>Get MSISDN from associatedMainMsisdn</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedMainMsisdn" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="countryCodeId" />
                                                                        <Parameter name="nationalDestinationCodeId" />
                                                                        <Parameter name="subscriberNumberId" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                    <Description>build MSISDN tracingTargetId</Description>
                                                                    <In>
                                                                        <Parameter name="__DESTINATION_NAME">
                                                                            <Val>tracingTargetId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="__SYNTAX">
                                                                            <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId</Val>
                                                                        </Parameter>
                                                                        <Parameter name="countryCodeId" />
                                                                        <Parameter name="nationalDestinationCodeId" />
                                                                        <Parameter name="subscriberNumberId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="tracingTargetId" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="convertTracingTargetId">
                                                                    <Description>convertTracingTargetId</Description>
                                                                    <In>
                                                                        <Parameter name="tracingTargetId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="tracingTargetId">
                                                                            <Ref name="msdnTracingTargetId" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>TracingTarget_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="tracingTargetId" />
                                                                        <Parameter name="targetTypeId">
                                                                            <Val>MSISDN</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="removeTracing_DN">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <Set name="removeTracing">
                                                                    <MultiValue>
                                                                        <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                        <Ref name="removeTracing_DN" />
                                                                    </MultiValue>
                                                                </Set>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <In>
                                                                        <Parameter name="removeTracing" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                                <Set name="__JUST_AFTER_COMMIT">
                                                                    <Val>justAfterCommit</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
<!-- SDMA01CAG246501 end -->
<!--Delete previous Main -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                            <Description>Delete previous Entry MobileStationInternalISDN on associatedMainMsisdn</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedMainMsisdn" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- add for r4.2 NPA Split feature to automatically delete a new MSISDN -->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>Get MSISDN from associatedMainMsisdn</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedMainMsisdn" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="nationalDestinationCodeId" />
                                                                        <Parameter name="subscriberNumberId" />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="getTranslatedNPAMSISDN">
                                                                    <Description>-check if match npa</Description>
                                                                    <In>
                                                                        <Parameter name="oldNDC">
                                                                            <Ref name="nationalDestinationCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="oldSN">
                                                                            <Ref name="subscriberNumberId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="NPAFlag" />
                                                                        <Parameter name="newNDC" />
                                                                        <Parameter name="newSN" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="NPAFlag" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                            <Description>Get MSISDN from associatedMainMsisdn</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="newAssociatedMainMsisdn" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="nationalDestinationCodeId" />
                                                                                <Parameter name="subscriberNumberId" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                            <In>
                                                                                <Parameter name="__SYNTAX">
                                                                                    <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>newMainMSISDNwithNPA</Val>
                                                                                </Parameter>
                                                                                <Parameter name="countryCodeId" />
                                                                                <Parameter name="nationalDestinationCodeId">
                                                                                    <Ref name="newNDC" />
                                                                                </Parameter>
                                                                                <Parameter name="subscriberNumberId">
                                                                                    <Ref name="newSN" />
                                                                                </Parameter>
                                                                                <Parameter name="BearerCapabilityName" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="newMainMSISDNwithNPA" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="notNullIntersection">
                                                                                <Ref name="SNwithBearerServiceList" />
                                                                                <Ref name="newMainMSISDNwithNPA" />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Remove name="SNwithBearerServiceList">
                                                                                    <MultiValue>
                                                                                        <Ref name="newMainMSISDNwithNPA" />
                                                                                    </MultiValue>
                                                                                </Remove>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
<!-- end of r4.2 NPA Split feature to automatically delete a new MSISDN -->
                                                        <Set name="oldMsisdn_DN">
                                                            <Ref name="associatedMainMsisdn" />
                                                        </Set>
<!--Set new associatedMainMSISDN  -->
                                                        <Set name="associatedMainMsisdn">
                                                            <Ref name="newAssociatedMainMsisdn" />
                                                        </Set>
<!--Set new mainMSISDN  -->
                                                        <Set name="mainMSISDN">
                                                            <Ref name="newAssociatedMainMsisdn" />
                                                        </Set>
<!-- update mainMSISDN of IMSI -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify mainMSISDN on Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                                <Parameter name="mainMSISDN">
                                                                    <Ref name="mainMSISDN" />
                                                                </Parameter>
                                                                <Parameter name="associatedMSISDN">
                                                                    <Ref name="associatedMSISDN" />
                                                                </Parameter>
                                                                <Parameter name="alertMSISDN">
                                                                    <Ref name="alertMSISDN" />
                                                                </Parameter>
<!-- Add for Feature  67405  by Qi Start -->
                                                                <Parameter name="mvnoIndex">
                                                                    <Ref name="subscriptionMvnoIndex" />
                                                                </Parameter>
<!-- Add for Feature 67405   by Qi SEnd-->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- update associatedMainMsisdn of Subscription -->
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify associatedMainMsisdn on Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_SuMSubscriptionProfile" />
                                                                </Parameter>
                                                                <Parameter name="associatedMainMsisdn" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--When fSA025 is true and the old mainMSISDN acts as public msisdn of other members 
                                                    need to modify other member
                                                 -->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="fSA025" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>Query Entry GsmServiceProfile</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_SuMSubscriptionProfile" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>multiSimMember_@@_roleInMultiSim_@@_msimPublicMsisdn</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="multiSimMember" />
                                                                        <Parameter name="roleInMultiSim" />
                                                                        <Parameter name="msimPublicMsisdn" />
                                                                    </Out>
                                                                </CallBE>
<!--check the subscirber is defined as one member of multi-SIM subscriber-->
                                                                <If>
                                                                    <AND>
                                                                        <Condition operator="eq">
                                                                            <Ref name="multiSimMember" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <OR>
                                                                            <Condition operator="eq">
                                                                                <Ref name="roleInMultiSim" />
                                                                                <Val>MASTER</Val>
                                                                            </Condition>
                                                                            <Condition operator="eq">
                                                                                <Ref name="roleInMultiSim" />
                                                                                <Val>NO_H</Val>
                                                                            </Condition>
                                                                        </OR>
                                                                    </AND>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                            <Description>Query Entry GsmServiceProfile</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_SuMSubscriptionProfile" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="suMSubscriberProfileId" />
                                                                                <Parameter name="suMSubscriptionProfileId" />
                                                                            </Out>
                                                                        </CallBE>
<!--build multi-sim Subscirber -->
<!-- modify for feature 68045 multi app begin, BPQ, 20090205-->
<!-- replace SuMSubscriberProfile_DN with new DN MultiSimServiceProfile_DN, output into DN_MultiSimServiceProfile -->
                                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                            <Description>build Entry DN MultiSimServiceProfile</Description>
                                                                            <In>
                                                                                <Parameter name="suMSubscriberProfileId" />
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>MultiSimServiceProfile_DN</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="DN_MultiSimServiceProfile">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>Query Entry MultiSimServiceProfile</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_MultiSimServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>eachMemberList</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="eachMemberList" />
                                                                            </Out>
                                                                        </CallBE>
<!-- modify for feature 68045 multi app end, BPQ, 20090205-->
<!--Loop to read other members -->
                                                                        <Foreach name="tmpIndex">
                                                                            <MultiValue>
                                                                                <Ref name="eachMemberList" />
                                                                            </MultiValue>
                                                                            <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="StringtoInt">
                                                                                <Description>convert string to int</Description>
                                                                                <In>
                                                                                    <Parameter name="__SOURCE_NAME">
                                                                                        <Val>tmpIndex</Val>
                                                                                    </Parameter>
                                                                                    <Parameter name="__DESTINATION_NAME">
                                                                                        <Val>Index</Val>
                                                                                    </Parameter>
                                                                                    <Parameter name="tmpIndex" />
                                                                                    <Parameter name="Index" />
                                                                                </In>
                                                                                <Out>
                                                                                    <Parameter name="Index" />
                                                                                </Out>
                                                                            </CallBE>
                                                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                                                <Description>build DN_By_Profile</Description>
                                                                                <In>
                                                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                                                        <Val>GsmServiceProfile_DN</Val>
                                                                                    </Parameter>
                                                                                    <Parameter name="suMSubscriptionProfileId">
                                                                                        <Ref name="Index" />
                                                                                    </Parameter>
                                                                                    <Parameter name="suMSubscriberProfileId" />
                                                                                    <Parameter name="gsmServiceProfileId">
                                                                                        <Val>1</Val>
                                                                                    </Parameter>
                                                                                </In>
                                                                                <Out>
                                                                                    <Parameter name="DN_By_Profile">
                                                                                        <Ref name="__DISTINGUISH_NAME" />
                                                                                    </Parameter>
                                                                                </Out>
                                                                            </CallBE>
<!--only other member need to update public msisdn -->
<!-- 2008-8-11 14:45 add the check of fSA025-->
                                                                            <If>
                                                                                <OR>
                                                                                    <Condition operator="neq">
                                                                                        <Ref name="suMSubscriptionProfileId" />
                                                                                        <Ref name="Index" />
                                                                                    </Condition>
<!-- 73118begin Wayne -->
<!-- For Twin-IMSI members, not only update the slave ones, but also the Master's msimPublicMsisdn -->
                                                                                    <Condition operator="eq">
                                                                                        <Ref name="subscriberType_old" />
                                                                                        <Val>SHARED_SUBS</Val>
                                                                                    </Condition>
                                                                                </OR>
<!-- 73118end Wayne -->
                                                                                <Then>
<!--query the public msisdn of the member -->
                                                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM_internal" name="multiquery">
                                                                                        <Description>Query Entry GsmServiceProfile</Description>
                                                                                        <In>
                                                                                            <Parameter name="DN_By_Profile" />
                                                                                        </In>
                                                                                        <Out>
                                                                                            <Parameter name="msimPublicMsisdn" />
                                                                                        </Out>
                                                                                    </CallBE>
                                                                                    <If>
                                                                                        <AND>
                                                                                            <Condition operator="setGreater">
                                                                                                <Ref name="msimPublicMsisdn" />
                                                                                                <Null />
                                                                                            </Condition>
                                                                                            <Condition operator="eq">
                                                                                                <Ref name="msimPublicMsisdn" />
                                                                                                <Ref name="oldMsisdn_DN" />
                                                                                            </Condition>
                                                                                        </AND>
                                                                                        <Then>
                                                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                                <Description>Query Entry GsmServiceProfile</Description>
                                                                                                <In>
                                                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                                                        <Ref name="DN_By_Profile" />
                                                                                                    </Parameter>
                                                                                                    <Parameter name="msimPublicMsisdn">
                                                                                                        <Ref name="newAssociatedMainMsisdn" />
                                                                                                    </Parameter>
                                                                                                </In>
                                                                                            </CallBE>
                                                                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                                <Description>-</Description>
                                                                                                <In>
                                                                                                    <Parameter name="modifyOtherMemberFlag">
                                                                                                        <Val>true</Val>
                                                                                                    </Parameter>
                                                                                                </In>
                                                                                                <Out />
                                                                                            </CallBE>
                                                                                        </Then>
                                                                                    </If>
                                                                                </Then>
                                                                            </If>
                                                                        </Foreach>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.18 treatment of SNwithBearerServiceList parameter
                                *************************************************************************************** -->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.1  raz  associatedBasicServices
                                *************************************************************************************** -->
                                                <Remove name="associatedBasicServices" />
<!-- begin NGHLR1FAG191641 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="singleNumbering" />
                                                            <Val>true</Val>
                                                        </Condition>
<!-- NGHLR01FAG208173 start -->
                                                        <Condition operator="setGreater">
                                                            <Ref name="SNwithBearerServiceList" />
                                                            <Null />
                                                        </Condition>
<!-- NGHLR01FAG208173 end -->
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="31">
                                                                <Frame FrameId="25000" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--NGHLR1FAG191641 end-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.2  get associatedMSISDN and alertMSISDN of IMSI and force alertMSISDN to null
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query Entry MSubIdentificationNumber to get associatedMSISDN and alertMSISDN</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedMSISDN_@@_alertMSISDN_@@_mainMSISDN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedMSISDN">
                                                            <Ref name="associatedMSISDN" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" />
                                                        </Parameter>
<!--Parameter name="oldalertMSISDN">
                                            <Ref name="alertMSISDN"/>
                                        </Parameter-->
                                                    </Out>
                                                </CallBE>
                                                <Set name="alertMSISDN">
                                                    <Null />
                                                </Set>
<!-- 
                                ***************************************************************************************
                                *   2.3.18.3  MEDIATION Prepare of CREQ message
                                *************************************************************************************** -->
<!-- Add by wupingfan.-->
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="roaming_Imsi">
                                                            <Ref name="associatedIMSI" />
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="roaming_Imsi">
                                                            <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                        </Set>
                                                    </Else>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="roam_mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="roam_mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="roam_mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query on Entry MSubIdentificationNumber</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="roaming_Imsi" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>sgsnIsdn_@@_vlrIsdn_@@_aaaIdentity_@@_non3gppIpAccRegStatus_@@_mmeIdentity_@@_uePurgedInMme_@@_mmeUpdateFlag_@@_aaaUpdateFlag_@@_localMobileStationIdentity_@@_visitedMmePlmnId_@@_visitedSgsnPlmnId_@@_sgsnIdentity_@@_msStatusInPS_@@_s6aULRFlags_@@_s6dULRFlags_@@_visitedS4SgsnPlmnId</Val>
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
<!--Modify by pomykala for FFRD72989 on 20120404-->
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="oldSgsnIsdn">
                                                            <Ref name="sgsnIsdn" />
                                                        </Parameter>
                                                        <Parameter name="oldVlrIsdn">
                                                            <Ref name="vlrIsdn" />
                                                        </Parameter>
                                                        <Parameter name="aaaIdentity">
                                                            <Ref name="aaaIdentity" />
                                                        </Parameter>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="non3gppIpAccRegStatus">
                                                            <Ref name="non3gppIpAccRegStatus" />
                                                        </Parameter>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="aaaUpdateFlag">
                                                            <Ref name="aaaUpdateFlag" />
                                                        </Parameter>
                                                        <Parameter name="oldLocalMobileStationIdentity">
                                                            <Ref name="localMobileStationIdentity" />
                                                        </Parameter>
<!-- Add begin by fucong for 70018 on 20100729-->
                                                        <Parameter name="visitedMmePlmnId">
                                                            <Ref name="visitedMmePlmnId" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729-->
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                        <Parameter name="visitedSgsnPlmnId">
                                                            <Ref name="visitedSgsnPlmnId" />
                                                        </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" />
                                                        </Parameter>
                                                        <Parameter name="visitedS4SgsnPlmnId">
                                                            <Ref name="visitedS4SgsnPlmnId" />
                                                        </Parameter>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                    </Out>
                                                </CallBE>
<!-- NGHLR1CAG199081 added queryed parameter in PostCommitBeContext-->
                                                <CallBE name="getInterceptedPara" entityName="HSS.SUB.Subscription.BeSubInterception">
                                                    <In>
                                                        <Parameter name="queryIMSI">
                                                            <Ref name="associatedIMSI" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- NGHLR1CAG199081 end -->
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <Description>Save IMSI</Description>
                                                    <In>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="roam_mobileCountryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="roam_mobileNetworkCodeId" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="roam_mSubIdentificationNumberId" />
                                                        </Parameter>
                                                        <Parameter name="oldVlrIsdn" />
                                                        <Parameter name="oldSgsnIsdn" />
                                                        <Parameter name="aaaIdentity" />
                                                        <Parameter name="non3gppIpAccRegStatus" />
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
                                                        <Parameter name="mmeIdentity" />
                                                        <Parameter name="mmeUpdateFlag" />
                                                        <Parameter name="aaaUpdateFlag" />
                                                        <Parameter name="uePurgedInMme" />
                                                        <Parameter name="oldLocalMobileStationIdentity" />
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                        <Parameter name="visitedSgsnPlmnId" />
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                        <Parameter name="sgsnIdentity" />
                                                        <Parameter name="s6aULRFlags" />
                                                        <Parameter name="s6dULRFlags" />
                                                        <Parameter name="msStatusInPS" />
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
<!-- End by wupingfan.-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGSM" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldVlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>noGPRS</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldSgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>GPRSonly</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.18.4  if NAM changed to GPRSonly, remove SNwithBS 
                                *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="oldNetworkAccessMode" />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="newSNwithBearerServiceList">
                                                            <Null />
                                                        </Set>
                                                        <Set name="newSNwithBearerService">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- FR SDMA01FAG270252 begin, qiangfw-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="oldNetworkAccessMode" />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                        </Condition>
<!--FR SDMA01FAG271163 begin, qiangfw -->
                                                        <Condition operator="setGreater">
<!--FR SDMA01FAG271163 end, qiangfw -->
                                                            <Ref name="SNwithBearerServiceList" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12003" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- FR SDMA01FAG270252 end, qiangfw-->
                                                <Foreach name="SNwithBearerService">
                                                    <MultiValue>
                                                        <Ref name="SNwithBearerServiceList" />
                                                    </MultiValue>
                                                    <CallBE name="query" entityName="HSS.SUB.*.BeString">
                                                        <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                            </Parameter>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>SNwithBearerService</Val>
                                                            </Parameter>
                                                            <Parameter name="SNwithBearerService" />
                                                        </In>
                                                        <Out>
                                                            <Description />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                            <Parameter name="BearerCapabilityName" />
                                                        </Out>
                                                    </CallBE>
<!--Begin add for feature 66935, wangying-->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="countryCodeId" />
                                                                <Ref name="hostedCC" />
                                                            </Condition>
<!-- 73251 b -->
                                                            <Condition operator="eq">
                                                                <Ref name="isSlaveModify" />
                                                                <Val>false</Val>
                                                            </Condition>
<!-- 73251 e -->
                                                        </AND>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="31">
                                                                    <Frame FrameId="12128" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
<!--End add for feature 66935, wangying-->
<!-- NGHLR1FAG186920 begin -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="nationalDestinationCodeId" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Then>
                                                            <Set name="nationalDestinationCodeId">
                                                                <Val />
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- NGHLR1FAG186920 end-->
<!--Begin SDMA01FAG222615 -->
                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="checkMSISDN">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
<!-- End SDMA01FAG222615 -->
<!--  + FR NGHLR1FAG156669-->
                                                    <Set name="internationalCode">
                                                        <Val>91</Val>
                                                    </Set>
                                                    <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                        <Description>create controlSNList</Description>
                                                        <In>
                                                            <Parameter name="joinParameters">
                                                                <Val>internationalCode,countryCodeId,nationalDestinationCodeId,subscriberNumberId</Val>
                                                            </Parameter>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>controlSNListElement</Val>
                                                            </Parameter>
                                                            <Parameter name="internationalCode" />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="controlSNListElement" />
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="controlSNList">
                                                        <MultiValue>
                                                            <Ref name="controlSNList" />
                                                            <Ref name="controlSNListElement" />
                                                        </MultiValue>
                                                    </Set>
<!--  - FR NGHLR1FAG156669-->
                                                </Foreach>
<!--  + FR NGHLR1FAG156669-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.5  Control: SN modified is not forwarded to number
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>- build DN_CallForwardingType</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CallForwardingServiceProfile_DN</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="DN_CallForwardingServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>Be Exist Entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CallForwardingServiceProfile" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_CallForwardingServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>linkedFTN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="linkedFTN">
                                                                    <Ref name="linkedFTN" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Foreach name="DN_FTN">
                                                            <MultiValue>
                                                                <Ref name="linkedFTN" />
                                                            </MultiValue>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                <Description>extract forwardedToNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_FTN" />
                                                                    </Parameter>
                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                        <Val>forwardedToNumber</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="forwardedToNumber" />
                                                                </Out>
                                                            </CallBE>
                                                            <Set name="controlFTNList">
                                                                <MultiValue>
                                                                    <Ref name="controlFTNList" />
                                                                    <Ref name="forwardedToNumber" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Foreach>
                                                    </Then>
                                                </If>
                                                <Foreach name="controlSNListElement">
                                                    <MultiValue>
                                                        <Ref name="controlSNList" />
                                                    </MultiValue>
                                                    <If>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="controlFTNList" />
                                                            <Ref name="controlSNListElement" />
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12010">
                                                                        <StringAttributeType>
                                                                            <Ref name="controlSNListElement" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                </Foreach>
<!--  - FR NGHLR1FAG156669-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.6  update SNwithBearerServiceList
                                *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="newSNwithBearerService" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="SNwithBearerServiceList">
                                                            <MultiValue>
                                                                <Ref name="newSNwithBearerServiceList" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="mainMSISDNImpactFlag" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="SNwithBearerServiceList">
                                                            <MultiValue>
                                                                <Ref name="SNwithBearerServiceList" />
                                                                <Ref name="newMainMSISDNwithNPAnew" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.18.7  loop on SNwithBearerServiceList
                                *************************************************************************************** -->
                                                <Foreach name="SNwithBearerService">
                                                    <MultiValue>
                                                        <Ref name="SNwithBearerServiceList" />
                                                    </MultiValue>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.1  extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName
                                    *************************************************************************************** -->
                                                    <CallBE name="query" entityName="HSS.SUB.*.BeString">
                                                        <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId and BearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                                            </Parameter>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>SNwithBearerService</Val>
                                                            </Parameter>
                                                            <Parameter name="SNwithBearerService" />
                                                        </In>
                                                        <Out>
                                                            <Description />
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                            <Parameter name="BearerCapabilityName" />
                                                        </Out>
                                                    </CallBE>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.2  BSN uniqueness control
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="BearerServiceNameList" />
                                                            <Ref name="BearerCapabilityName" />
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12004">
                                                                                <StringAttributeType>
                                                                                    <Ref name="BearerCapabilityName" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                        <Else>
                                                            <Set name="BearerServiceNameList">
                                                                <MultiValue>
                                                                    <Ref name="BearerServiceNameList" />
                                                                    <Ref name="BearerCapabilityName" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.3  check if GPRS provided  (GPRSprovided and BSotherthanGPRSprovided local data)
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="GPRSprovided">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <Set name="BSotherthanGPRSprovided">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.4  create DN BSC corresponding to BearerCapabilityName
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query bearerServiceCode</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="belongToBscLink" />
                                                        </Out>
                                                    </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>Query BSC from belongToBscLink</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="belongToBscLink" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="basicServiceCodeId" />
                                                        </Out>
                                                    </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
                                                    <If>
<!-- SDMA01FAG250922 begin -->
                                                        <AND>
                                                            <Condition operator="neq">
                                                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA112" />
                                                                <Val>true</Val>
                                                            </Condition>
<!--Condition operator="nullIntersection">
                                                        <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" name="contspare4"/>
                                                        <Val>fSA112</Val>
                                                    </Condition-->
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                                <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                            </Condition>
                                                        </AND>
<!-- SDMA01FAG250922 end -->
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12031" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                        <Else>
                                                            <Set name="associatedBasicServicesCodeList">
                                                                <MultiValue>
                                                                    <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                                    <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!--end SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.5  create DN MSISDN
                                    *************************************************************************************** -->
<!-- NGHLR1FAG186920 begin -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="nationalDestinationCodeId" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Then>
                                                            <Set name="nationalDestinationCodeId">
                                                                <Val />
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- NGHLR1FAG186920 end-->
                                                    <CallBE name="create" entityName="HSS.SUB.*.DnHandler">
                                                        <Description>Create DN MSISDN and to valorize associatedMSISDN[7]</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>SubscriberNumber_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out>
                                                            <Description />
                                                            <Parameter name="DN_MSISDN">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!-- 
                                            ***************************************************************************************
                                            *   2.3.18.7.6  if SMSMTAL fill alertMSISDN
                                            *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>SMSMTAL</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="alertMSISDN">
                                                                <Ref name="DN_MSISDN" />
                                                            </Set>
                                                        </Then>
<!--  + FR NGHLR1FAG147509-->
                                                        <Else>
                                                            <Set name="MSISDNwithoutSMSMTAL">
                                                                <MultiValue>
                                                                    <Ref name="MSISDNwithoutSMSMTAL" />
                                                                    <Ref name="DN_MSISDN" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
<!--  - FR NGHLR1FAG147509-->
                                                    </If>
                                                    <If>
                                                        <AND>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="associatedMSISDN" />
                                                                <Ref name="DN_MSISDN" />
                                                            </Condition>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="DN_MSISDN" />
                                                                <Ref name="newAssociatedMSISDN" />
                                                            </Condition>
                                                        </AND>
                                                        <Then>
<!-- 
                                            ***************************************************************************************
                                            *   2.3.18.7.7  if new MSISDN create Entry
                                            *************************************************************************************** -->
<!-- SDMA01FAG244954 begin by Tan Lihe -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                <Description>check the newAssociatedMainMsisdn used by another subscription</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MSISDN" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="existEntry">
                                                                        <Ref name="__BOOL" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="existEntry" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="12002">
                                                                            <Frame FrameId="12033" />
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
<!-- SDMA01FAG244954 end by Tan Lihe -->
<!-- new SN  -->
                                                            <Set name="newAssociatedMSISDN">
                                                                <MultiValue>
                                                                    <Ref name="newAssociatedMSISDN" />
                                                                    <Ref name="DN_MSISDN" />
                                                                </MultiValue>
                                                            </Set>
                                                            <Set name="associatedBasicServices">
                                                                <MultiValue>
                                                                    <Ref name="DN_BSC" />
                                                                </MultiValue>
                                                            </Set>
                                                            <CallBE name="create" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>Create Entry MobileStationInternalISDN on associatedMSISDN</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MSISDN" />
                                                                    </Parameter>
                                                                    <Parameter name="associatedSubscriptionProfile" />
                                                                    <Parameter name="associatedIMSI" />
                                                                    <Parameter name="associatedBasicServices" />
<!-- Add for Feature 67405 Start -->
                                                                    <Parameter name="isdnMvnoIndex">
                                                                        <Ref name="subscriptionMvnoIndex" />
                                                                    </Parameter>
<!-- Add for Feature 67405 End-->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
<!-- add for r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="CreateNPAAssociatedMSISDNFlag">
                                                                        <Val>false</Val>
                                                                    </Set>
                                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="CreateNewAssociatedMSISDNwithNPA">
                                                                        <In>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                            <Parameter name="associatedIMSI" />
                                                                            <Parameter name="associatedSubscriptionProfile" />
                                                                            <Parameter name="associatedBasicServices" />
                                                                            <Parameter name="subscriptionMvnoIndex" />
                                                                            <Parameter name="associatedMSISDN">
                                                                                <Ref name="newAssociatedMSISDN" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="CreateNPAAssociatedMSISDNFlag">
                                                                                <Ref name="NPAFlag" />
                                                                            </Parameter>
                                                                            <Parameter name="newAssociatedMSISDN">
                                                                                <Ref name="associatedMSISDN" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
<!-- end of r4.2 NPA Split feature to automatically create a new MSISDN -->
                                                        </Then>
                                                        <Else>
                                                            <If>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="DN_MSISDN" />
                                                                    <Ref name="newAssociatedMSISDN" />
                                                                </Condition>
                                                                <Then>
<!-- 
                                                    ***************************************************************************************
                                                    *   2.3.18.7.8  if existing linked MSISDN and first time, modify associatedBasicServices
                                                    *************************************************************************************** -->
                                                                    <Set name="newAssociatedMSISDN">
                                                                        <MultiValue>
                                                                            <Ref name="newAssociatedMSISDN" />
                                                                            <Ref name="DN_MSISDN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <Set name="associatedBasicServices">
                                                                        <MultiValue>
                                                                            <Ref name="DN_BSC" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                        <Description>then Modify associatedBasicServices on Entry associatedMSISDN</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_MSISDN" />
                                                                            </Parameter>
                                                                            <Parameter name="associatedBasicServices" />
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                                <Else>
<!-- 
                                                    ***************************************************************************************
                                                    *   2.3.18.7.9  if existing linked MSISDN and not first time,update MSISDN with new BS
                                                    *************************************************************************************** -->
<!-- + FR NGHLR1FAG164472-->
                                                                    <If>
                                                                        <Condition operator="neq">
                                                                            <Ref name="alertMSISDN" />
                                                                            <Ref name="DN_MSISDN" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <ThrowException>
                                                                                <Error ErrorId="14">
                                                                                    <Frame FrameId="12011">
                                                                                        <StringAttributeType>
                                                                                            <Val>SNwithBearerService</Val>
                                                                                        </StringAttributeType>
                                                                                    </Frame>
                                                                                </Error>
                                                                            </ThrowException>
                                                                        </Then>
                                                                    </If>
<!-- - FR NGHLR1FAG164472-->
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                        <Description>Query on Entry MsisdnCharacteristics on one associatedMSISDN attribute</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_MSISDN" />
                                                                            </Parameter>
                                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                <Val>associatedBasicServices</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <AllParameters />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <Set name="associatedBasicServices">
                                                                        <MultiValue>
                                                                            <Ref name="associatedBasicServices" />
                                                                            <Ref name="DN_BSC" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                        <Description>else Modify associatedBasicServices on Entry associatedMSISDN</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_MSISDN" />
                                                                            </Parameter>
                                                                            <Parameter name="associatedBasicServices" />
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Else>
                                                            </If>
                                                        </Else>
                                                    </If>
<!--
                                    ***************************************************************************************
                                    *       2.3.18.7.10  Subscription Type OC+TC mandatory except for SMSMT
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>1 Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC1">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query Entry Main SubscriberNumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC1" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                            <Parameter name="belongToBscLink" />
                                                            <Parameter name="basicServiceCategory" />
                                                            <Parameter name="restrictedApplicabillity" />
                                                        </Out>
                                                    </CallBE>
<!--NGHLR1FAG165519_6-->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCategory" />
                                                            <Val>1</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="20">
                                                                    <Frame FrameId="12012">
                                                                        <StringAttributeType>
                                                                            <Ref name="BearerCapabilityName" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
                                                    <Set name="subbasicServiceTCOCSubscription">
                                                        <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode" />
                                                    </Set>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="BearerCapabilityName" />
                                                            <Val>SMSMTPP</Val>
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <AND>
<!-- NGHLR1FAG205598 -->
                                                                    <Condition operator="eq">
                                                                        <Ref name="restrictedApplicabillity" />
                                                                        <Val>false</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="subbasicServiceTCOCSubscription" />
                                                                        <Val>false</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="211">
                                                                                <StringAttributeType>
                                                                                    <Val>SNwithBearerService</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>basicServiceTCOCSubscription</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="restrictedApplicabillity" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="211">
                                                                                <StringAttributeType>
                                                                                    <Val>SNwithBearerService</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>restrictedApplicabillity</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.18.7.11  Incrementation of 1 of MSISDN counter
                                    *************************************************************************************** -->
                                                    <Set name="MappingIncrement">
                                                        <Val>1</Val>
                                                    </Set>
                                                    <Set name="MappingOperation">
                                                        <Val>+</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                        <Description>Incrementation of 1 of MSISDN counter</Description>
                                                        <In>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>MappingIncrement</Val>
                                                            </Parameter>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>countMSISDN</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>MappingOperation</Val>
                                                            </Parameter>
                                                            <Parameter name="countMSISDN" />
                                                            <Parameter name="MappingIncrement" />
                                                            <Parameter name="MappingOperation" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="countMSISDN" />
                                                        </Out>
                                                    </CallBE>
                                                </Foreach>
<!-- begin FR SDMA01FAG233910 zhao haibing  2009/4/13-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.7.12  find the existing  MSISDN 
                                *************************************************************************************** -->
<!--FR SDMA01FAG268407 begin, qiangfw-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="oldcountMSISDN">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="oldcountMSISDN">
                                                            <Val>1</Val>
                                                        </Set>
                                                    </Else>
                                                </If>
<!--FR SDMA01FAG268407 end, qiangfw-->
                                                <Foreach name="SNwithBearerService">
                                                    <MultiValue>
                                                        <Ref name="SNwithBearerServiceList" delta="old" />
                                                    </MultiValue>
                                                    <Set name="MappingIncrement">
                                                        <Val>1</Val>
                                                    </Set>
                                                    <Set name="MappingOperation">
                                                        <Val>+</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                        <Description>Incrementation of 1 of MSISDN counter</Description>
                                                        <In>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>MappingIncrement</Val>
                                                            </Parameter>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>oldcountMSISDN</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>MappingOperation</Val>
                                                            </Parameter>
                                                            <Parameter name="oldcountMSISDN" />
                                                            <Parameter name="MappingIncrement" />
                                                            <Parameter name="MappingOperation" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="oldcountMSISDN" />
                                                        </Out>
                                                    </CallBE>
                                                </Foreach>
<!--end FR SDMA01FAG233910 zhao haibing  2009/4/10-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.8  find associated MSISDN to delete
                                *************************************************************************************** -->
                                                <Foreach name="associatedMSISDNelement">
                                                    <MultiValue>
                                                        <Ref name="associatedMSISDN" />
                                                    </MultiValue>
                                                    <If>
<!-- FR SDMA01FAG270252 begein, qiangfw-->
                                                        <AND>
                                                            <OR>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="associatedMSISDNelement" />
                                                                    <Ref name="newAssociatedMSISDN" />
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="SNwithBearerServiceList" />
                                                                    <NotExist />
                                                                </Condition>
                                                            </OR>
                                                            <Condition operator="nullIntersection">
                                                                <Ref name="associatedMSISDNelement" />
                                                                <Ref name="newAssociatedMainMsisdn" />
                                                            </Condition>
                                                        </AND>
<!-- FR SDMA01FAG270252 end, qiangfw -->
                                                        <Then>
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingMsisdn of associatedMSISDNelement -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedMSISDNelement" />
                                                                    </Parameter>
                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                        <Val>underTracingMsisdn</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="underTracingMsisdn" />
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="underTracingMsisdn" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="associatedMSISDNelement" />
                                                                            </Parameter>
                                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                <Val>countryCodeId_@@_nationalDestinationCodeId_@@_subscriberNumberId</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                        <In>
                                                                            <Parameter name="__DESTINATION_NAME">
                                                                                <Val>tracingTargetId</Val>
                                                                            </Parameter>
                                                                            <Parameter name="__SYNTAX">
                                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId</Val>
                                                                            </Parameter>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="tracingTargetId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="convertTracingTargetId">
                                                                        <In>
                                                                            <Parameter name="tracingTargetId" />
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="tracingTargetId">
                                                                                <Ref name="msdnTracingTargetId" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                        <In>
                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                <Val>TracingTarget_DN</Val>
                                                                            </Parameter>
                                                                            <Parameter name="tracingTargetId" />
                                                                            <Parameter name="targetTypeId">
                                                                                <Val>MSISDN</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="removeTracing_DN">
                                                                                <Ref name="__DISTINGUISH_NAME" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <Set name="removeTracing">
                                                                        <MultiValue>
                                                                            <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                            <Ref name="removeTracing_DN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                                        <In>
                                                                            <Parameter name="removeTracing" />
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                    <Set name="__JUST_AFTER_COMMIT">
                                                                        <Val>justAfterCommit</Val>
                                                                    </Set>
                                                                </Then>
                                                            </If>
<!-- SDMA01CAG246501 end -->
<!--delete MSISDN -->
<!--F723320,qiangfw,20110627 -->
<!-- FR SDMA01FAG270252 begin, qiangfw -->
<!-- add for r4.2 NPA Split feature to automatically delete a new MSISDN -->
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="DeleteNewAssociatedMSISDNwithNPA">
                                                                        <In>
                                                                            <Parameter name="associatedMainMsisdnDelete">
                                                                                <Ref name="associatedMSISDNelement" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="associatedMSISDNNPADelete">
                                                                                <Ref name="associatedMSISDNNPADelete" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
<!-- end of r4.2 NPA Split feature to automatically delete a new MSISDN -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete on Entry SubscriberNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedMSISDNelement" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Foreach>
<!-- add for NPA Split automatically remove NPA impacted associated MSISDN,2013-3-21, KuiBing -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="enableNPASplit" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfNPASplitCapability" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Foreach name="associatedMSISDNelement">
                                                            <MultiValue>
                                                                <Ref name="associatedMSISDNNPADelete" />
                                                            </MultiValue>
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingMsisdn of associatedMSISDNelement -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedMSISDNelement" />
                                                                    </Parameter>
                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                        <Val>underTracingMsisdn</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="underTracingMsisdn" />
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="underTracingMsisdn" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="associatedMSISDNelement" />
                                                                            </Parameter>
                                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                <Val>countryCodeId_@@_nationalDestinationCodeId_@@_subscriberNumberId</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                        <In>
                                                                            <Parameter name="__DESTINATION_NAME">
                                                                                <Val>tracingTargetId</Val>
                                                                            </Parameter>
                                                                            <Parameter name="__SYNTAX">
                                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId</Val>
                                                                            </Parameter>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="tracingTargetId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="convertTracingTargetId">
                                                                        <In>
                                                                            <Parameter name="tracingTargetId" />
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="tracingTargetId">
                                                                                <Ref name="msdnTracingTargetId" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                        <In>
                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                <Val>TracingTarget_DN</Val>
                                                                            </Parameter>
                                                                            <Parameter name="tracingTargetId" />
                                                                            <Parameter name="targetTypeId">
                                                                                <Val>MSISDN</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="removeTracing_DN">
                                                                                <Ref name="__DISTINGUISH_NAME" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <Set name="removeTracing">
                                                                        <MultiValue>
                                                                            <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                            <Ref name="removeTracing_DN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                                        <In>
                                                                            <Parameter name="removeTracing" />
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                    <Set name="__JUST_AFTER_COMMIT">
                                                                        <Val>justAfterCommit</Val>
                                                                    </Set>
                                                                </Then>
                                                            </If>
<!-- SDMA01CAG246501 end -->
<!--delete MSISDN -->
<!--F723320,qiangfw,20110627 -->
<!-- FR SDMA01FAG270252 begin, qiangfw -->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete on Entry SubscriberNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedMSISDNelement" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                            <Remove name="newAssociatedMSISDN">
                                                                <MultiValue>
                                                                    <Ref name="associatedMSISDNelement" />
                                                                </MultiValue>
                                                            </Remove>
                                                        </Foreach>
                                                    </Then>
                                                </If>
<!-- End of adding for NPA Split automatically remove NPA impacted associated MSISDN,2013-3-21, KuiBing -->
<!-- add it for bulk R4.2 73248 by daniel -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="removeAllAssociatedMSISDN" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Foreach name="associatedMSISDNelement">
                                                            <MultiValue>
                                                                <Ref name="associatedMSISDN" />
                                                            </MultiValue>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete on Entry SubscriberNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedMSISDNelement" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Foreach>
                                                        <Set name="newAssociatedMSISDN">
                                                            <Null />
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- End of REMOVE_ALL_AssociatedMSISDN add it for bulk R4.2 73248 by daniel -->
<!-- FR SDMA01FAG270252 end, qiangfw -->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.9  alert MSISDN must have another BS
                                *************************************************************************************** -->
<!--  + FR NGHLR1FAG147509-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="alertMSISDN" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="nullIntersection">
                                                            <Ref name="MSISDNwithoutSMSMTAL" />
                                                            <Ref name="alertMSISDN" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12002" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--  - FR NGHLR1FAG147509-->
<!-- 
                                ***************************************************************************************
                                *   2.3.18.10  update associatedMSISDN and alertMSISDN of IMSI
                                *************************************************************************************** -->
                                                <Set name="associatedMSISDN">
                                                    <MultiValue>
                                                        <Ref name="newAssociatedMSISDN" />
                                                    </MultiValue>
                                                </Set>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="SNwithBearerServiceList" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify Entry MSubIdentificationNumber with associatedMSISDN to NULL</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
<!--Parameter name="mainMSISDN"/-->
                                                                <Parameter name="associatedMSISDN">
                                                                    <Null />
                                                                </Parameter>
<!-- check alert != from main  -->
                                                                <Parameter name="alertMSISDN">
                                                                    <Ref name="alertMSISDN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
<!--Parameter name="mainMSISDN"/-->
                                                                <Parameter name="associatedMSISDN">
                                                                    <Ref name="associatedMSISDN" />
                                                                </Parameter>
                                                                <Parameter name="alertMSISDN">
                                                                    <Ref name="alertMSISDN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Else>
                                                </If>
<!--
                                ***************************************************************************************
                                *   2.3.19  Control: Maximun number of MSISDN per subscription is not reached
                                *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="greater">
                                                        <Ref name="countMSISDN" />
                                                        <Ref name="maxNumberOfMsisdnPerMS" entityName="HSS.SystemData.SystemData.Sys_OAM_SysSubscription" />
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="31">
                                                                <Frame FrameId="10057">
                                                                    <StringAttributeType>
                                                                        <Val>MSISDN per subscription</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--
                                ***************************************************************************************
                                *   2.3.20  Control: Maximun number of MSISDN is not reached
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="countEntry">
                                                    <Description>Count the number of MSISDN</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>SubscriberNumber_DN</Val>
                                                        </Parameter>
<!--FR SDMA01FAG268407 begin, qiangfw-->
                                                        <Parameter name="__NO_CACHE">
                                                            <Val>1</Val>
                                                        </Parameter>
<!--FR SDMA01FAG268407 end, qiangfw-->
                                                    </In>
                                                    <Out>
                                                        <Parameter name="countResultMSISDN">
                                                            <Ref name="__ENTRY_COUNTER" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <Set name="MappingOperation">
                                                    <Val>+</Val>
                                                </Set>
                                                <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                    <Description>MSISDN counter total</Description>
                                                    <In>
                                                        <Parameter name="__SOURCE_NAME">
                                                            <Val>countMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>countResultMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="__SYNTAX">
                                                            <Val>MappingOperation</Val>
                                                        </Parameter>
                                                        <Parameter name="countResultMSISDN" />
                                                        <Parameter name="countMSISDN" />
                                                        <Parameter name="MappingOperation" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="countResultMSISDN" />
                                                    </Out>
                                                </CallBE>
<!-- begin FR SDMA01FAG233910 zhao haibing  2009/4/13-->
                                                <Set name="MappingOperation">
                                                    <Val>-</Val>
                                                </Set>
                                                <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                    <Description>MSISDN counter total</Description>
                                                    <In>
                                                        <Parameter name="__SOURCE_NAME">
                                                            <Val>oldcountMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>countResultMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="__SYNTAX">
                                                            <Val>MappingOperation</Val>
                                                        </Parameter>
                                                        <Parameter name="countResultMSISDN" />
                                                        <Parameter name="oldcountMSISDN" />
                                                        <Parameter name="MappingOperation" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="countResultMSISDN" />
                                                    </Out>
                                                </CallBE>
<!-- end FR SDMA01FAG233910 zhao haibing  2009/4/13-->
                                                <If>
                                                    <Condition operator="greater">
                                                        <Ref name="countResultMSISDN" />
<!--Begin modify for feature 66935, wangying, query global level data-->
                                                        <Ref name="contMaxMSISDN" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" queryLevel="MVNE" />
<!--End modify for feature 66935, wangying-->
                                                    </Condition>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="31">
                                                                <Frame FrameId="10057">
                                                                    <StringAttributeType>
                                                                        <Val>MSISDN</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!--
                                ***************************************************************************************
                                *   2.3.20.1    Control: Maximun number of subscriptions is not reached
                                *************************************************************************************** -->
<!-- ZTX | 2009/08/24 | This control can be removed since modify will not the subscriber number -->
<!-- CallBE entityName="HSS.SUB.*.BeGDMI" name="countEntry">
                                            <Description> Count the number of MSISDN       </Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>GsmServiceProfile_DN</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="countResultSubscriptions">
                                                    <Ref name="__ENTRY_COUNTER"/>
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <Set name="MappingIncrement">
                                            <Val>1</Val>
                                        </Set>
                                        <Set name="MappingOperation">
                                            <Val>+</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                            <Description> Incrementation of 1 of Subcriptions counter</Description>
                                            <In>
                                                <Parameter name="__SOURCE_NAME">
                                                    <Val>MappingIncrement</Val>
                                                </Parameter>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>countResultSubscriptions</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>MappingOperation</Val>
                                                </Parameter>
                                                <Parameter name="countResultSubscriptions"/>
                                                <Parameter name="MappingIncrement"/>
                                                <Parameter name="MappingOperation"/>
                                            </In>
                                            <Out>
                                                <Parameter name="countResultSubscriptions"/>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="greater">
                                                <Ref name="countResultSubscriptions"/>
                                                <Ref name="contMaxSubscriptions" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription"/>
                                            </Condition>
                                            <Then>
                                                <ThrowException>
                                                    <Error ErrorId="31">
                                                        <Frame FrameId="10057">
                                                            <StringAttributeType>
                                                                <Val>Subcriptions</Val>
                                                            </StringAttributeType>
                                                        </Frame>
                                                    </Error>
                                                </ThrowException>
                                            </Then>
                                        </If-->
<!-- SDMA01FAG250922 end -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
                                                            <Ref name="oldNetworkAccessMode" />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="bscWithoutSN">
                                                            <Null />
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <Foreach name="BearerServiceCodeWithoutSN">
                                                    <MultiValue>
                                                        <Ref name="BearerServiceWithoutSNList" />
                                                    </MultiValue>
<!-- 
                                            ***************************************************************************************
                                            *   2.3.7.2  check if GPRS provided (GPRSprovided and BSotherthanGPRSprovided local data)
                                            *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="GPRSprovided">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <Set name="BSotherthanGPRSprovided">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!-- 
                                            ***************************************************************************************
                                            *   2.3.7.3  SMSMTAL not allowed on BSwithoutSN
                                            *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                            <Val>SMSMTAL</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="20">
                                                                    <Frame FrameId="203">
                                                                        <StringAttributeType>
                                                                            <Val>BearerServiceWithoutSNList</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Val>SMSMTAL</Val>
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
<!-- 
                                            ***************************************************************************************
                                            *       2.3.7.4  Subscription Type OC+TC mandatory except for SMSMT
                                            *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerServiceCodeWithoutSN" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC1">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query Entry Main SubscriberNumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC1" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink_@@_basicServiceCategory_@@_restrictedApplicabillity</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
<!-- NGHLR1FAG205598 add restrictedApplicabillity -->
                                                            <Parameter name="belongToBscLink" />
                                                            <Parameter name="basicServiceCategory" />
                                                            <Parameter name="restrictedApplicabillity" />
                                                        </Out>
                                                    </CallBE>
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>Query BSC from belongToBscLink</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="belongToBscLink" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="basicServiceCodeId" />
                                                        </Out>
                                                    </CallBE>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!--begin SDMA01FAG233913 change 12016 to 12031  zhao haibing 2007/4/13-->
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                                    <If>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                            <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="14">
                                                                    <Frame FrameId="12031" />
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                        <Else>
                                                            <Set name="associatedBasicServicesCodeList">
                                                                <MultiValue>
                                                                    <Ref name="associatedBasicServicesCodeList" />
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
<!--Ref name="belongToBscLink"/-->
                                                                    <Ref name="basicServiceCodeId" />
<!-- End SDMA01FAG250911 by Tan Lihe -->
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
<!--end SDMA01FAG233913 change 12016 to 12031 zhao haibing 2007/4/13-->
<!--NGHLR1FAG165519_4 Add check for the BasicServices must be autorized WITHOUT SN -->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCategory" />
                                                            <Val>0</Val>
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="20">
                                                                    <Frame FrameId="12013">
                                                                        <StringAttributeType>
                                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                    </If>
<!--    NGHLR1FAG165519_4End-->
                                                    <Set name="subbasicServiceTCOCSubscription">
                                                        <Ref name="basicServiceTCOCSubscription" DN="belongToBscLink" entityName="HSS.ContractData.ContractData.Cont_OAM_BasicServiceCode" />
                                                    </Set>
<!-- NGHLR1FAG205598 -->
                                                    <Set name="BearerCapabilityName">
                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                    </Set>
<!-- Remove begin SDMA01FAG250911 by Tan Lihe -->
<!--If>
                                                <Condition operator="neq">
                                                    <Ref name="BearerCapabilityName"/>
                                                    <Val>SMSMTPP</Val>
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <AND>
                                                            -->
<!-- NGHLR1FAG205598 -->
<!--
                                                            <Condition operator="eq">
                                                                <Ref name="subbasicServiceTCOCSubscription"/>
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="restrictedApplicabillity"/>
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="fTC001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractTC"/>
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="211">
                                                                                <StringAttributeType>
                                                                                    <Val>BearerServiceWithoutSN</Val>
                                                                                </StringAttributeType>
                                                                                <StringAttributeType>
                                                                                    <Val>basicServiceTCOCSubscription And restrictedApplicabillity</Val>
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If-->
<!-- Remove end SDMA01FAG250911 by Tan Lihe -->
<!-- 
                                            ***************************************************************************************
                                            *   2.3.7.5  create DN BSC corresponding to BearerService
                                            *************************************************************************************** -->
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>Create DN ServiceCodeMnemonic_DN to valorize the associatedBasicServices attribute, basicServiceGroupId fixed to 1 by defaultValue</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerServiceCodeWithoutSN" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <AND>
                                                            <Condition operator="neq">
                                                                <Ref name="networkAccessMode" />
                                                                <Ref name="oldNetworkAccessMode" />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                            </Condition>
                                                        </AND>
                                                        <Then>
<!-- 
                                                    ***************************************************************************************
                                                    *   2.3.7.6  if NAM changed to GPRSonly BS other than SMSMO and SMSMTPP are removed before set bscWithoutSN
                                                    *************************************************************************************** -->
                                                            <If>
                                                                <OR>
                                                                    <Condition operator="eq">
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                        <Val>SMSMTPP</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                        <Val>SMSMOPP</Val>
                                                                    </Condition>
                                                                </OR>
                                                                <Then>
<!-- BSN uniqueness control -->
                                                                    <If>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="BearerServiceNameList" />
                                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <ThrowException>
                                                                                <Error ErrorId="14">
                                                                                    <Frame FrameId="12004">
                                                                                        <StringAttributeType>
                                                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                                                        </StringAttributeType>
                                                                                    </Frame>
                                                                                </Error>
                                                                            </ThrowException>
                                                                        </Then>
                                                                        <Else>
                                                                            <Set name="BearerServiceNameList">
                                                                                <MultiValue>
                                                                                    <Ref name="BearerServiceNameList" />
                                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                                </MultiValue>
                                                                            </Set>
                                                                        </Else>
                                                                    </If>
                                                                    <Set name="bscWithoutSN">
                                                                        <MultiValue>
                                                                            <Ref name="bscWithoutSN" />
                                                                            <Ref name="DN_BSC" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Then>
                                                            </If>
                                                        </Then>
                                                        <Else>
<!-- FR SDMA01FAG270252 begin, qiangfw -->
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="networkAccessMode" />
                                                                        <Ref name="oldNetworkAccessMode" />
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="networkAccessMode" />
                                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                        <Val>SMSMTPP</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                        <Val>SMSMOPP</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12003" />
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                            </If>
<!-- FR SDMA01FAG270252 end, qiangfw -->
<!-- 
                                                    ***************************************************************************************
                                                    *   2.3.7.7  else set bscWithoutSN
                                                    *************************************************************************************** -->
<!-- BSN uniqueness control -->
                                                            <If>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceNameList" />
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                </Condition>
                                                                <Then>
                                                                    <ThrowException>
                                                                        <Error ErrorId="14">
                                                                            <Frame FrameId="12004">
                                                                                <StringAttributeType>
                                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                                </StringAttributeType>
                                                                            </Frame>
                                                                        </Error>
                                                                    </ThrowException>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="BearerServiceNameList">
                                                                        <MultiValue>
                                                                            <Ref name="BearerServiceNameList" />
                                                                            <Ref name="BearerServiceCodeWithoutSN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Else>
                                                            </If>
                                                            <Set name="bscWithoutSN">
                                                                <MultiValue>
                                                                    <Ref name="bscWithoutSN" />
                                                                    <Ref name="DN_BSC" />
                                                                </MultiValue>
                                                            </Set>
                                                        </Else>
                                                    </If>
                                                </Foreach>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.7.8  if no BearerServiceWithoutSNList in input, remove the existing 
                                        *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="BearerServiceWithoutSNList" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="bscWithoutSN">
                                                            <Null />
                                                        </Set>
                                                    </Then>
                                                </If>
<!--********************************************************************************
                                * Add for SDMA01CAG271493 begin treatment of ExtendedBearerServiceWithoutSNList                                              **********************************************************************************-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="nullIntersection">
                                                            <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                            <Val>fSA115</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="32">
                                                                <Frame FrameId="10134">
                                                                    <StringAttributeType>
                                                                        <Val>ExtendedBearerServiceWithoutSNList</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>fSA115</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
<!--porting from R3.1 to R4.1 by zhao nannan,begin -->
                                                    <Else>
<!--Add for SDMA01CAG272836 beign-->
<!-- 
                ***************************************************************************************
                *   if GPRSonly, only SMS BS allowed 
                *************************************************************************************** -->
                                                        <Set name="networkAccessMode_old">
                                                            <Ref name="networkAccessMode" delta="old" />
                                                        </Set>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                                    <Null />
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="networkAccessMode_old" />
                                                                        <Val>BOTH</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="ExtendedBearerServiceWithoutSNList">
                                                                            <Null />
                                                                        </Set>
                                                                    </Then>
                                                                    <Else>
                                                                        <ThrowException>
                                                                            <Error ErrorId="14">
                                                                                <Frame FrameId="12003" />
                                                                            </Error>
                                                                        </ThrowException>
                                                                    </Else>
                                                                </If>
                                                            </Then>
<!--Add for SDMA01CAG272836 end-->
                                                            <Else>
                                                                <Foreach name="ExtendedBearerServiceWithoutSN">
                                                                    <MultiValue>
                                                                        <Ref name="BSCofBSG20" defaultValue="force" />
                                                                    </MultiValue>
                                                                    <If>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                            <Ref name="subscriberType" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <Remove name="subscriberType">
                                                                                <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                            </Remove>
                                                                        </Then>
                                                                    </If>
                                                                </Foreach>
<!--***************************************************************************************
                                *       ExtendedBearerServiceWithoutSNList validation check
                                *************************************************************************************** -->
                                                                <Foreach name="ExtendedBearerServiceWithoutSN">
                                                                    <MultiValue>
                                                                        <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                                    </MultiValue>
                                                                    <If>
                                                                        <Condition operator="nullIntersection">
                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
<!--Ref name="AllowedExtendedBearerServiceWithoutSNList"/-->
                                                                            <Ref name="BSCofBSG20" defaultValue="force" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <ThrowException>
                                                                                <Error ErrorId="20">
                                                                                    <Frame FrameId="203">
                                                                                        <StringAttributeType>
                                                                                            <Val>ExtendedBearerServiceWithoutSNList</Val>
                                                                                        </StringAttributeType>
                                                                                        <StringAttributeType>
                                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                                        </StringAttributeType>
                                                                                    </Frame>
                                                                                </Error>
                                                                            </ThrowException>
                                                                        </Then>
                                                                    </If>
<!--***************************************************************************************
                                *       ExtendedBearerServiceWithoutSNList uniqueness control
                                *************************************************************************************** -->
                                                                    <If>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="BearerServiceNameList" />
                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <ThrowException>
                                                                                <Error ErrorId="14">
                                                                                    <Frame FrameId="12004">
                                                                                        <StringAttributeType>
                                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                                        </StringAttributeType>
                                                                                    </Frame>
                                                                                </Error>
                                                                            </ThrowException>
                                                                        </Then>
                                                                        <Else>
                                                                            <Set name="BearerServiceNameList">
                                                                                <MultiValue>
                                                                                    <Ref name="BearerServiceNameList" />
                                                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                                </MultiValue>
                                                                            </Set>
                                                                        </Else>
                                                                    </If>
<!--***************************************************************************************
                                * Map to basicServiceCodeId
                                *************************************************************************************** -->
                                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                                        <Description>Create DN BasicServiceCode_DN</Description>
                                                                        <In>
                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                <Val>BasicServiceCode_DN</Val>
                                                                            </Parameter>
                                                                            <Parameter name="basicServiceGroupId">
                                                                                <Val>BSG20</Val>
                                                                            </Parameter>
                                                                            <Parameter name="mobileNetworkCodeId">
                                                                                <Ref name="mvnomobileNetworkCodeId" />
                                                                            </Parameter>
                                                                            <Parameter name="mobileCountryCodeId">
                                                                                <Ref name="mvnomobileCountryCodeId" />
                                                                            </Parameter>
                                                                            <Parameter name="basicServiceCodeId">
                                                                                <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="DN_EBSC">
                                                                                <Ref name="__DISTINGUISH_NAME" />
                                                                            </Parameter>
                                                                        </Out>
                                                                    </CallBE>
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                        <Description>Query BSC</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_EBSC" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="basicServiceCodeId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <If>
                                                                        <Condition operator="notNullIntersection">
                                                                            <Ref name="associatedBasicServicesCodeList" />
                                                                            <Ref name="basicServiceCodeId" />
                                                                        </Condition>
                                                                        <Then>
                                                                            <ThrowException>
                                                                                <Error ErrorId="14">
                                                                                    <Frame FrameId="12031" />
                                                                                </Error>
                                                                            </ThrowException>
                                                                        </Then>
                                                                        <Else>
                                                                            <Set name="associatedBasicServicesCodeList">
                                                                                <MultiValue>
                                                                                    <Ref name="associatedBasicServicesCodeList" />
                                                                                    <Ref name="basicServiceCodeId" />
                                                                                </MultiValue>
                                                                            </Set>
                                                                        </Else>
                                                                    </If>
                                                                    <Set name="subscriberType">
                                                                        <MultiValue>
                                                                            <Ref name="subscriberType" />
                                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                                        </MultiValue>
                                                                    </Set>
                                                                </Foreach>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <In>
                                                        <Parameter name="BSCofBSG20">
                                                            <Ref name="BSCofBSG20" defaultValue="force" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!--Add for SDMA01CAG271493 end-->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.8   treatement of ServiceNodeNotificationList parameter
                                        *************************************************************************************** -->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.8.1 control (conditioned by fLR017)
                                        *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="ServiceNodeNotificationList" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="ServiceNodeNotificationList" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="fLR017" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="oamBackwardCapability" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <ThrowException>
                                                                    <Error ErrorId="14">
                                                                        <Frame FrameId="214">
                                                                            <StringAttributeType>
                                                                                <Val>ServiceNodeNotificationList</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                        <Frame FrameId="10067">
                                                                            <StringAttributeType>
                                                                                <Val>fLR017</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Then>
                                                            <Else>
                                                                <ThrowException>
                                                                    <Error ErrorId="14">
<!-- ZTX | 2009/08/24 | 10077 is useless and replaced with 213.-->
                                                                        <Frame FrameId="213">
<!--Frame FrameId="10077"-->
                                                                            <StringAttributeType>
                                                                                <Val>ServiceNodeNotificationList</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                        <Frame FrameId="10066">
                                                                            <StringAttributeType>
                                                                                <Val>fLR017</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.8.2  raz vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
                                *************************************************************************************** -->
                                                <Set name="vlrSgsnServiceNodeNotification">
                                                    <Null />
                                                </Set>
                                                <Set name="plmnServiceNodeNotification">
                                                    <Null />
                                                </Set>
                                                <Set name="ccServiceNodeNotification">
                                                    <Null />
                                                </Set>
<!-- 
                                ***************************************************************************************
                                *   2.3.8.3 foreach ServiceNodeNotification
                                *************************************************************************************** -->
                                                <Foreach name="ServiceNodeNotification">
                                                    <MultiValue>
                                                        <Ref name="ServiceNodeNotificationList" />
                                                    </MultiValue>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.8.3.1 extract trigger and SNaddress
                                    *************************************************************************************** -->
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="query">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>trigger-SNaddress</Val>
                                                            </Parameter>
                                                            <Parameter name="__SOURCE_NAME">
                                                                <Val>ServiceNodeNotification</Val>
                                                            </Parameter>
                                                            <Parameter name="ServiceNodeNotification" />
                                                        </In>
                                                        <Out>
                                                            <Description />
                                                            <Parameter name="trigger" />
                                                            <Parameter name="SNaddress" />
                                                        </Out>
                                                    </CallBE>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.8.3.2 control that the triggeringType is allowed 
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="nullIntersection">
                                                            <Ref name="triggeringType" entityName="HSS.SystemData.SystemData.Sys_OAM_SysSubscription" />
                                                            <Ref name="trigger" />
                                                        </Condition>
                                                        <Then>
                                                            <ThrowException>
                                                                <Error ErrorId="20">
                                                                    <Frame FrameId="203">
                                                                        <StringAttributeType>
                                                                            <Val>ServiceNodeNotificationList</Val>
                                                                        </StringAttributeType>
                                                                        <StringAttributeType>
                                                                            <Ref name="trigger" />
                                                                        </StringAttributeType>
                                                                    </Frame>
                                                                </Error>
                                                            </ThrowException>
                                                        </Then>
                                                        <Else>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.8.3.3 set serverAddress
                                        *************************************************************************************** -->
<!--AutoResource begin-->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.8.3.4 search if corresponding entry ServiceNodeAddress already exists
                                        *************************************************************************************** -->
<!-- 
                                        ***************************************************************************************
                                        *   2.3.8.3.5 create ServiceNodeAddress entry if doest not exist
                                        *************************************************************************************** -->
                                                            <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                <In>
<!--SECONDARY_KEY_DN_SYNTAX_NAME-->
<!--DN_SYNTAX_NAME primary-->
<!--SECONDARY_KEY_SYNTAX-->
<!--secondary key parameters-->
                                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                                        <Val>ServiceNodeAddress_DN</Val>
                                                                    </Parameter>
                                                                    <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                        <Val>ServiceNodeAddress_Secondary_DN</Val>
                                                                    </Parameter>
                                                                    <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                        <Val>serverAddress</Val>
                                                                    </Parameter>
                                                                    <Parameter name="serverAddress">
                                                                        <Ref name="SNaddress" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="dn_existing">
                                                                        <Ref name="__DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                    <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                </Out>
                                                            </CallBE>
<!--before create auto Res,Res status need change to Free-->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                        <Val>snaStateOfResource_@@_serverAddress</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="snaStateOfResource" />
                                                                </Out>
                                                            </CallBE>
                                                            <If>
                                                                <Condition operator="neq">
                                                                    <Ref name="snaStateOfResource" />
                                                                    <Val>Free</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Parameter>
                                                                            <Parameter name="snaStateOfResource">
                                                                                <Val>Free</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
<!--AutoResource end-->
                                                        </Else>
                                                    </If>
<!-- 
                                    ***************************************************************************************
                                    *   2.3.8.3.6 valorize vlrSgsnServiceNodeNotification,plmnServiceNodeNotification and ccServiceNodeNotification
                                    *************************************************************************************** -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="trigger" />
                                                            <Val>VLRSGSN</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="vlrSgsnServiceNodeNotification">
                                                                <Ref name="dn_existing" />
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="trigger" />
                                                                    <Val>PLMN</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="plmnServiceNodeNotification">
                                                                        <Ref name="dn_existing" />
                                                                    </Set>
                                                                </Then>
                                                                <Else>
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="trigger" />
                                                                            <Val>COUNTRY</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <Set name="ccServiceNodeNotification">
                                                                                <Ref name="dn_existing" />
                                                                            </Set>
                                                                        </Then>
                                                                        <Else>
                                                                            <If>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="trigger" />
                                                                                    <Val>ALL</Val>
                                                                                </Condition>
                                                                                <Then>
                                                                                    <Set name="vlrSgsnServiceNodeNotification">
                                                                                        <Ref name="dn_existing" />
                                                                                    </Set>
                                                                                    <Set name="plmnServiceNodeNotification">
                                                                                        <Ref name="dn_existing" />
                                                                                    </Set>
                                                                                    <Set name="ccServiceNodeNotification">
                                                                                        <Ref name="dn_existing" />
                                                                                    </Set>
                                                                                </Then>
                                                                            </If>
                                                                        </Else>
                                                                    </If>
                                                                </Else>
                                                            </If>
                                                        </Else>
                                                    </If>
                                                </Foreach>
<!-- Add for feature (MapScreening) Start -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mapScreeningCategory" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA023" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR046" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR045" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR049" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR050" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="31007">
                                                                    <StringAttributeType>
                                                                        <Val>F-SA-023,F_LR_046,F_LR_045,F_LR_049,F_LR_050 when mapScreeningCategory exist</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- Add for feature (MapScreening) End -->
<!-- add begin by qzg for 67452 prepay, 20090227
                        *****************************************************************************************
                        * 1.14.4 check prepay subscriber data                
                        *****************************************************************************************-->
<!--CR SDMA01CAG271571 begin, qiangfw   
                                        <Set name="oldprepay">
                                            <Ref name="prepay" delta="old" />
                                        </Set>
                                        <Set name="oldprepayCommonGroupId">
                                            <Ref name="prepayCommonGroupId" delta="old" />
                                        </Set>
                                        <If>
                                            <OR>
                                                <Condition operator="setGreater">
                                                    <Ref name="prepay" delta="changed" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="prepayCommonGroupId" delta="changed" />
                                                    <Null />
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_PrepayControl" name="modifyPrepayParaCheck">
                                                    <In>
                                                        <Parameter name="oldprepay" />
                                                        <Parameter name="oldprepayCommonGroupId" />
                                                        <Parameter name="newprepay">
                                                            <Ref name="prepay" delta="" />
                                                        </Parameter>
                                                        <Parameter name="newprepayCommonGroupId">
                                                            <Ref name="prepayCommonGroupId" delta="" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="prepayCommonGroupId">
                                                            <Ref name="newprepayCommonGroupId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
        CR SDMA01CAG271571 end, qiangfw-->
<!-- add end by qzg for 67452 prepay, 20090227-->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="csgContextList" delta="changed" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="DN_GsmServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Set>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="sgsnIdentity" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="mmeIdentity" />
                                                                    <Ref name="sgsnIdentity" />
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <If>
                                                                    <AND>
                                                                        <Condition operator="setGreater">
                                                                            <Ref name="visitedMmePlmnId" />
                                                                            <Null />
                                                                        </Condition>
                                                                        <Condition operator="setGreater">
                                                                            <Ref name="visitedS4SgsnPlmnId" />
                                                                            <Null />
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="visitedMmePlmnId" />
                                                                            <Ref name="visitedS4SgsnPlmnId" />
                                                                        </Condition>
                                                                    </AND>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="modify">
                                                                            <Description>Create the csg data</Description>
                                                                            <In>
                                                                                <Parameter name="DN_GsmServiceProfile" />
                                                                                <Parameter name="csgContextList" />
                                                                                <Parameter name="visitedMmePlmnId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csgSubscriptionData" />
                                                                                <Parameter name="csgSendDSRFlag" />
                                                                                <Parameter name="csgSendIDRFlag" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="csgDataQuery">
                                                                            <Description>Query the csg data</Description>
                                                                            <In>
                                                                                <Parameter name="DN_GsmServiceProfile">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="visitedMmePlmnId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csgSubscriptionData" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <Set name="csgSubscriptionDataNum">
                                                                            <Ref name="csgSubscriptionData" defaultValue="occurs" />
                                                                        </Set>
                                                                        <If>
                                                                            <Condition operator="greater">
                                                                                <Ref name="csgSubscriptionDataNum" />
                                                                                <Val>0</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                    <Description>Save the related data into postcommit</Description>
                                                                                    <In>
                                                                                        <Parameter name="csgSubscriptionDataNum" />
                                                                                        <Parameter name="csgSubscriptionData" />
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>Save csg related data into post commit</Description>
                                                                    <In>
                                                                        <Parameter name="csgSendDSRFlag" />
                                                                        <Parameter name="csgSendIDRFlag" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="sgsnIdentity" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="modify">
                                                                            <Description>Create the csg data</Description>
                                                                            <In>
                                                                                <Parameter name="DN_GsmServiceProfile" />
                                                                                <Parameter name="csgContextList" />
                                                                                <Parameter name="visitedMmePlmnId">
                                                                                    <Ref name="visitedS4SgsnPlmnId" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csgSubscriptionData" />
                                                                                <Parameter name="sgsnCsgSendDSRFlag">
                                                                                    <Ref name="csgSendDSRFlag" />
                                                                                </Parameter>
                                                                                <Parameter name="sgsnCsgSendIDRFlag">
                                                                                    <Ref name="csgSendIDRFlag" />
                                                                                </Parameter>
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>Save csg related data into post commit</Description>
                                                                            <In>
                                                                                <Parameter name="sgsnCsgSendDSRFlag" />
                                                                                <Parameter name="sgsnCsgSendIDRFlag" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="visitedS4SgsnPlmnId" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="csgDataQuery">
                                                                                    <Description>Query the csg data</Description>
                                                                                    <In>
                                                                                        <Parameter name="DN_GsmServiceProfile">
                                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="visitedMmePlmnId">
                                                                                            <Ref name="visitedS4SgsnPlmnId" />
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out>
                                                                                        <Parameter name="csgSubscriptionData" />
                                                                                    </Out>
                                                                                </CallBE>
                                                                                <Set name="csgSubscriptionDataNum">
                                                                                    <Ref name="csgSubscriptionData" defaultValue="occurs" />
                                                                                </Set>
                                                                                <If>
                                                                                    <Condition operator="greater">
                                                                                        <Ref name="csgSubscriptionDataNum" />
                                                                                        <Val>0</Val>
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>Save the related data into postcommit</Description>
                                                                                            <In>
                                                                                                <Parameter name="sgsncsgSubscriptionDataNum">
                                                                                                    <Ref name="csgSubscriptionDataNum" />
                                                                                                </Parameter>
                                                                                                <Parameter name="sgsncsgSubscriptionData">
                                                                                                    <Ref name="csgSubscriptionData" />
                                                                                                </Parameter>
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="mmeIdentity" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="modify">
                                                                            <Description>Create the csg data</Description>
                                                                            <In>
                                                                                <Parameter name="DN_GsmServiceProfile" />
                                                                                <Parameter name="csgContextList" />
                                                                                <Parameter name="visitedMmePlmnId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csgSubscriptionData" />
                                                                                <Parameter name="mmeCsgSendDSRFlag">
                                                                                    <Ref name="csgSendDSRFlag" />
                                                                                </Parameter>
                                                                                <Parameter name="mmeCsgSendIDRFlag">
                                                                                    <Ref name="csgSendIDRFlag" />
                                                                                </Parameter>
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>Save csg related data into post commit</Description>
                                                                            <In>
                                                                                <Parameter name="mmeCsgSendDSRFlag" />
                                                                                <Parameter name="mmeCsgSendIDRFlag" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="setGreater">
                                                                                <Ref name="visitedMmePlmnId" />
                                                                                <Null />
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="csgDataQuery">
                                                                                    <Description>Query the csg data</Description>
                                                                                    <In>
                                                                                        <Parameter name="DN_GsmServiceProfile">
                                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="visitedMmePlmnId" />
                                                                                    </In>
                                                                                    <Out>
                                                                                        <Parameter name="csgSubscriptionData" />
                                                                                    </Out>
                                                                                </CallBE>
                                                                                <Set name="csgSubscriptionDataNum">
                                                                                    <Ref name="csgSubscriptionData" defaultValue="occurs" />
                                                                                </Set>
                                                                                <If>
                                                                                    <Condition operator="greater">
                                                                                        <Ref name="csgSubscriptionDataNum" />
                                                                                        <Val>0</Val>
                                                                                    </Condition>
                                                                                    <Then>
                                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                            <Description>Save the related data into postcommit</Description>
                                                                                            <In>
                                                                                                <Parameter name="csgSubscriptionDataNum" />
                                                                                                <Parameter name="csgSubscriptionData" />
                                                                                            </In>
                                                                                            <Out />
                                                                                        </CallBE>
                                                                                    </Then>
                                                                                </If>
                                                                            </Then>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
<!--/Then>                                                     
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="delete">
                                                            <Description>Create the csg data</Description>
                                                            <In>
                                                                <Parameter name="DN_GsmServiceProfile"/>
                                                            </In>
                                                            <Out/>
                                                        </CallBE>     
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <Description> Save csg related data into post commit </Description>
                                                            <In>
                                                                <Parameter name="csgSendDSRFlag">
                                                                    <Val>true</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out/>
                                                        </CallBE>                                                                                                               
                                                    </Else>
                                                </If-->
<!--    <Else>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="visitedMmePlmnId" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="csgDataQuery">
                                                                    <Description>Query the csg data</Description>
                                                                    <In>
                                                                        <Parameter name="DN_GsmServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                        <Parameter name="visitedMmePlmnId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="csgSubscriptionData" />
                                                                    </Out>
                                                                </CallBE>
                                                                <Set name="csgSubscriptionDataNum">
                                                                    <Ref name="csgSubscriptionData" defaultValue="occurs" />
                                                                </Set>
                                                                <If>
                                                                    <Condition operator="greater">
                                                                        <Ref name="csgSubscriptionDataNum" />
                                                                        <Val>0</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                                            <Description>Save the related data into postcommit</Description>
                                                                            <In>
                                                                                <Parameter name="csgSubscriptionDataNum" />
                                                                                <Parameter name="csgSubscriptionData" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Else> -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="ueMmeLocated">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="ueMmeLocated">
                                                            <Val>false</Val>
                                                        </Set>
                                                    </Else>
                                                </If>
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
<!-- TBD. More change needed in this part for 69061, Yvonne -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="nullIntersection">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                            <Val>Purged_in_S4_SGSN</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="ueS4SgsnLocated">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="ueS4SgsnLocated">
                                                            <Val>false</Val>
                                                        </Set>
                                                    </Else>
                                                </If>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="fEps002" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="ueAaaLocated">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="ueAaaLocated">
                                                            <Val>false</Val>
                                                        </Set>
                                                    </Else>
                                                </If>
<!-- <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="ueMmeLocated" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="mmeUpdateFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="mmeSupportedServices" />
                                                                <Val>TRACE</Val>
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="ueAaaLocated" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="non3gppIpAccRegStatus" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.NetworkTrace.NetworkTrace_OAM_Internal" name="QueryTraceData">
                                                            <Description>Query the trace data</Description>
                                                            <In>
                                                                <Parameter name="DN_GsmServiceProfile">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="traceDataRef" />
                                                                <Parameter name="networkTraceActive" />
                                                                <Parameter name="traceDepth" />
                                                                <Parameter name="traceInterfaceList" />
                                                                <Parameter name="traceNeTypeList" />
                                                                <Parameter name="traceEventList" />
                                                                <Parameter name="omcIdentity" />
                                                                <Parameter name="traceCollectionEntityAddr" />
                                                                <Parameter name="traceCollectionEntityAddrType" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="networkTraceActive" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>Save the related trace data into postcommit</Description>
                                                                    <In>
                                                                        <Parameter name="traceDataRef" />
                                                                        <Parameter name="networkTraceActive" />
                                                                        <Parameter name="traceDepth" />
                                                                        <Parameter name="traceInterfaceList" />
                                                                        <Parameter name="traceNeTypeList" />
                                                                        <Parameter name="traceEventList" />
                                                                        <Parameter name="omcIdentity" />
                                                                        <Parameter name="traceCollectionEntityAddr" />
                                                                        <Parameter name="traceCollectionEntityAddrType" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <Description>Save the related trace data into posrcommit</Description>
                                                                    <In>
                                                                        <Parameter name="traceDataRef" />
                                                                        <Parameter name="networkTraceActive" />
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If> -->
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- Add begin by xiaozhxu for 68733 on 20101207 -->
                                                <If>
                                                    <OR>
                                                        <Condition operator="setGreater">
                                                            <Ref name="notificationToCseFlag" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cfGsmSCF1" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cfGsmSCF2" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cfGsmSCF3" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cbGsmSCF1" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cbGsmSCF2" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="cbGsmSCF3" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="odbGsmSCF1" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="odbGsmSCF2" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="odbGsmSCF3" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="csiGsmSCF1" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="csiGsmSCF2" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="csiGsmSCF3" delta="changed" />
                                                            <Null />
                                                        </Condition>
                                                    </OR>
                                                    <Then>
                                                        <Set name="DN_GsmSuppServiceProfile">
                                                            <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                                        </Set>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cfGsmSCF1" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cfGsmSCF1</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cfGsmSCF1" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF1" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cfGsmSCF1" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF1">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cfGsmSCF2" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cfGsmSCF2</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cfGsmSCF2" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF2" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cfGsmSCF2" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF2">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cfGsmSCF3" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cfGsmSCF3</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cfGsmSCF3" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF3" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cfGsmSCF3" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cfGsmSCF3">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cbGsmSCF1" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cbGsmSCF1</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cbGsmSCF1" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF1" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cbGsmSCF1" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF1">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cbGsmSCF2" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cbGsmSCF2</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cbGsmSCF2" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF2" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cbGsmSCF2" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF2">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="cbGsmSCF3" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>cbGsmSCF3</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="cbGsmSCF3" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF3" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="cbGsmSCF3" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="cbGsmSCF3">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="odbGsmSCF1" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>odbGsmSCF1</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="odbGsmSCF1" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF1" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="odbGsmSCF1" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF1">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="odbGsmSCF2" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>odbGsmSCF2</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="odbGsmSCF2" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF2" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="odbGsmSCF2" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF2">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="odbGsmSCF3" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>odbGsmSCF3</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="odbGsmSCF3" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF3" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="odbGsmSCF3" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="odbGsmSCF3">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="csiGsmSCF1" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>csiGsmSCF1</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="csiGsmSCF1" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF1" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="csiGsmSCF1" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF1">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="csiGsmSCF2" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>csiGsmSCF2</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="csiGsmSCF2" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF2" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="csiGsmSCF2" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF2">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="csiGsmSCF3" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeScpAddress" name="create">
                                                                            <In>
                                                                                <Parameter name="__SOURCE_NAME">
                                                                                    <Val>csiGsmSCF3</Val>
                                                                                </Parameter>
                                                                                <Parameter name="__DESTINATION_NAME">
                                                                                    <Val>countryCodeId</Val>
                                                                                </Parameter>
                                                                                <Parameter name="csiGsmSCF3" />
                                                                                <Parameter name="countryCodeId" />
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF3" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeAutoResource" name="create">
                                                                            <In>
                                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_DN_SYNTAX_NAME">
                                                                                    <Val>CamelServiceControlPoint_Secondary_DN</Val>
                                                                                </Parameter>
                                                                                <Parameter name="SECONDARY_KEY_SYNTAX">
                                                                                    <Val>scpAddress</Val>
                                                                                </Parameter>
                                                                                <Parameter name="scpAddress">
                                                                                    <Ref name="csiGsmSCF3" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csiGsmSCF3">
                                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__PRIMARY_DISTINGUISH_NAME" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>scpStateOfResource_@@_scpAddress</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="scpStateOfResource" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="scpStateOfResource" />
                                                                                <Val>Free</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                                    <In>
                                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                                            <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                                                        </Parameter>
                                                                                        <Parameter name="scpStateOfResource">
                                                                                            <Val>Free</Val>
                                                                                        </Parameter>
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                        </If>
<!--Auto Resource end-->
                                                                    </Then>
                                                                </If>
<!-- After getting all LINK, check this Entry exsits -->
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfile" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="create">
                                                                            <Description>Create the GsmSuppServiceProfile entry</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_GsmSuppServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="notificationToCseFlag" />
                                                                                <Parameter name="cfGsmSCF1" />
                                                                                <Parameter name="cfGsmSCF2" />
                                                                                <Parameter name="cfGsmSCF3" />
                                                                                <Parameter name="cbGsmSCF1" />
                                                                                <Parameter name="cbGsmSCF2" />
                                                                                <Parameter name="cbGsmSCF3" />
                                                                                <Parameter name="odbGsmSCF1" />
                                                                                <Parameter name="odbGsmSCF2" />
                                                                                <Parameter name="odbGsmSCF3" />
                                                                                <Parameter name="csiGsmSCF1" />
                                                                                <Parameter name="csiGsmSCF2" />
                                                                                <Parameter name="csiGsmSCF3" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                    <Else>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>Modify the GsmSuppServiceProfile entry</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_GsmSuppServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="notificationToCseFlag" />
                                                                                <Parameter name="cfGsmSCF1" />
                                                                                <Parameter name="cfGsmSCF2" />
                                                                                <Parameter name="cfGsmSCF3" />
                                                                                <Parameter name="cbGsmSCF1" />
                                                                                <Parameter name="cbGsmSCF2" />
                                                                                <Parameter name="cbGsmSCF3" />
                                                                                <Parameter name="odbGsmSCF1" />
                                                                                <Parameter name="odbGsmSCF2" />
                                                                                <Parameter name="odbGsmSCF3" />
                                                                                <Parameter name="csiGsmSCF1" />
                                                                                <Parameter name="csiGsmSCF2" />
                                                                                <Parameter name="csiGsmSCF3" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Else>
                                                                </If>
                                                            </Then>
<!--FR SDMA01FAG265274 -->
                                                            <Else>
                                                                <ThrowException>
                                                                    <Error ErrorId="14">
                                                                        <Frame FrameId="10050">
                                                                            <StringAttributeType>
                                                                                <Val>notificationToCseFlag or GsmSCF not allowed</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                        <Frame FrameId="10067">
                                                                            <StringAttributeType>
                                                                                <Val>fCA3010</Val>
                                                                            </StringAttributeType>
                                                                        </Frame>
                                                                    </Error>
                                                                </ThrowException>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Add end by xiaozhxu for 68733 on 20101207 -->
<!-- Add begin for 68733, 2010/12/07-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="DN_GsmSuppServiceProfileData">
                                                            <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                                        </Set>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfileData" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_ProcessNSDM" name="SetCheckFlagForNREQ">
                                                                    <In>
                                                                        <Parameter name="DN_GsmSuppServiceProfileData" />
                                                                    </In>
                                                                    <Out>
                                                                        <AllParameters />
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                                    <In>
                                                                        <Parameter name="needCheckCF" />
                                                                        <Parameter name="needCheckCB" />
                                                                        <Parameter name="needCheckODB" />
                                                                        <Parameter name="needCheckCSI" />
                                                                        <Parameter name="notificationToCseFlag" />
<!-- 73251 b -->
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="roam_mobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="roam_mobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="roam_mSubIdentificationNumberId" />
                                                                        </Parameter>
<!-- 73251 e -->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Add end for 68733, 2010/12/07-->
<!-- 
                        ******************************************************************************************
                            2.3.9   Other Parameter
                        *************************************************************************************** -->
<!-- 
                        ******************************************************************************************
                            2.3.9.1   Modify smsRouteViaHNetwRoam
                        *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="smsRouteViaHNetwRoam" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="fSMS104" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="24002">
                                                                <Frame FrameId="10059">
                                                                    <StringAttributeType>
                                                                        <Val>smsRouteViaHNetwRoam</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>true</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>fSMS104</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="smsRouteViaHNetwRoam" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            <Val>SUBSCRIBER</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            <Val>SUBNWKENT</Val>
                                                        </Condition>
<!--beginF71046guowei-->
                                                        <Condition operator="neq">
                                                            <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                                            <Val>SUBNWKENTRLY</Val>
                                                        </Condition>
<!--endF71046guowei-->
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="24002">
                                                                <Frame FrameId="30426">
                                                                    <StringAttributeType>
                                                                        <Val>smsRouteViaHNetwRoam</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>dummyVlrForSmsApplicability</Val>
                                                                    </StringAttributeType>
                                                                    <StringAttributeType>
                                                                        <Val>SUBSCRIBER</Val>
                                                                    </StringAttributeType>
<!--beginF71046guowei-->
                                                                    <StringAttributeType>
                                                                        <Val>SUBNWKENT or SUBNWKENTRLY</Val>
                                                                    </StringAttributeType>
<!--endF71046guowei-->
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                        ******************************************************************************************
                            2.3.9.2  Modify serviceProviderReference
                        *************************************************************************************** -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="fSPS001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                            <Val>false</Val>
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="serviceProviderReference" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="24002">
                                                                <Frame FrameId="10067">
                                                                    <StringAttributeType>
                                                                        <Val>fSPS001</Val>
                                                                    </StringAttributeType>
                                                                </Frame>
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.10   updating Entry BasicSubscription
                                *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                    <Description>Modify Entry BasicSubscription</Description>
                                                    <In>
                                                        <Parameter name="networkAccessMode" />
<!-- add begin by weimingm for F73419 on 21012-12-27 -->
                                                        <Parameter name="deactivatedDomains" />
<!-- add end by weimingm for F73419 on 21012-12-27 -->
                                                        <Parameter name="bscWithoutSN" />
                                                        <Parameter name="vlrSgsnServiceNodeNotification" />
                                                        <Parameter name="plmnServiceNodeNotification" />
<!-- Feature 67386 -->
                                                        <Parameter name="addService" />
                                                        <Parameter name="ccServiceNodeNotification" />
<!-- add for feature 67393 Start -->
                                                        <Parameter name="subscriberType" />
<!-- add for feature 67393 End -->
<!--Add for 71037 qdiao begin-->
                                                        <Parameter name="icsIndicator" />
<!--Add for 71037 qdiao end-->
<!-- R2.3 -->
                                                        <Parameter name="accessRestrictionData" />
<!-- Add for feature (MapScreening) Start -->
                                                        <Parameter name="mapScreeningCategory" />
<!-- Add for feature (MapScreening) End -->
<!-- Add for Feature 67398 Start-->
                                                        <Parameter name="smsRouteViaHNetwRoam" />
<!-- Add for Feature 67398 End-->
<!-- Add for Feature 67435 Start-->
                                                        <Parameter name="serviceProviderReference" />
<!-- Add for Feature 67435 End-->
<!-- add  by qzg for 67452 prepay, 20090227-->
                                                        <Parameter name="prepay" />
                                                        <Parameter name="prepayCommonGroupId" />
                                                    </In>
                                                    <Out>
                                                        <AllParameters />
                                                    </Out>
                                                </CallBE>
<!--Add for SDMA01CAG271493 begin-->
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <In>
                                                        <Parameter name="subscriberType" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!--Add for SDMA01CAG271493 end-->
<!-- Add for feature (MapScreening) Start -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Query on Entry MSubIdentificationNumber</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>vlrIsdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="vlrIsdn" />
                                                    </Out>
                                                </CallBE>
                                                <Set name="OldMapScreeningCategory">
                                                    <Ref name="mapScreeningCategory" delta="old" />
                                                </Set>
                                                <Set name="mapScreeningCategoryChangedFlag">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <OR>
<!--Begin SDMA01FAG241281-->
                                                            <AND>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="OldMapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="neq">
                                                                    <Ref name="mapScreeningCategory" />
                                                                    <Ref name="OldMapScreeningCategory" />
                                                                </Condition>
                                                            </AND>
<!-- End SDMA01FAG241281-->
                                                            <AND>
                                                                <Condition operator="setLessOrEqual">
                                                                    <Ref name="OldMapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="mapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                            </AND>
                                                            <AND>
                                                                <Condition operator="setLessOrEqual">
                                                                    <Ref name="mapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                                <Condition operator="setGreater">
                                                                    <Ref name="OldMapScreeningCategory" />
                                                                    <Null />
                                                                </Condition>
                                                            </AND>
                                                        </OR>
                                                        <Condition operator="eq">
                                                            <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA107" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="vlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="vlrUpdateFlag">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="mapScreeningCategoryChangedFlag">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify on Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                                <Parameter name="vlrUpdateFlag">
                                                                    <Ref name="vlrUpdateFlag" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <Description>Save mapScreeningCategoryChangedFlag</Description>
                                                    <In>
                                                        <Parameter name="mapScreeningCategoryChangedFlag">
                                                            <Ref name="mapScreeningCategoryChangedFlag" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- Add for feature (MapScreening) End -->
<!-- Remove begin for SDMA01FAG250922 by Tan Lihe -->
<!-- Remove end for SDMA01FAG250922 by Tan Lihe -->
<!-- Begin SDMA01FAG250911 by Tan Lihe -->
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
                                                                <Val>GBS20</Val>
                                                            </Condition>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
                                                                <Ref name="BSCofBSG20" defaultValue="force" />
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
                                                                <Val>GBS30</Val>
                                                            </Condition>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="associatedBasicServicesCodeList" />
                                                                <Ref name="BSCofBSG30" defaultValue="force" />
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <ThrowException>
                                                            <Error ErrorId="14">
                                                                <Frame FrameId="12031" />
                                                            </Error>
                                                        </ThrowException>
                                                    </Then>
                                                </If>
<!-- End SDMA01FAG250911 by Tan Lihe -->
<!-- 
                                ***************************************************************************************
                                *   2.3.21  NAM change
                                *************************************************************************************** -->
<!-- 
                                ***************************************************************************************
                                *   2.3.21.1  build CsServiceProfile and PsServiceProfile
                                *************************************************************************************** -->
<!-- ZTX | 2009/08/24 | Updated to reduce one time call DnHandle -->
<!--CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <Description>        extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId       </Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_BasicSubscription"/>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description>         SuMSubscriberProfileId,SumSubscriptionProfileId valorized        </Description>
                                                <Parameter name="suMSubscriberProfileId"/>
                                                <Parameter name="suMSubscriptionProfileId"/>
                                                <Parameter name="gsmServiceProfileId"/>
                                            </Out>
                                        </CallBE-->
<!--CallBE entityName="HSS.SUB.*.DnHandler" name="create"-->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
<!--Parameter name="suMSubscriberProfileId"/>
                                                <Parameter name="suMSubscriptionProfileId"/>
                                                <Parameter name="gsmServiceProfileId"/-->
                                                    </In>
                                                    <Out>
                                                        <Description>DN CsServiceProfile available</Description>
                                                        <Parameter name="DN_CsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!--CallBE entityName="HSS.SUB.*.DnHandler" name="create"-->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                    <Description>DN PsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>PsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
<!--Parameter name="suMSubscriberProfileId"/>
                                                <Parameter name="suMSubscriptionProfileId"/>
                                                <Parameter name="gsmServiceProfileId"/-->
                                                    </In>
                                                    <Out>
                                                        <Description>DN CsServiceProfile available</Description>
                                                        <Parameter name="DN_PsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
<!-- 
                                ***************************************************************************************
                                *   2.3.21.2  call create CsServiceProfile if createGSM true
                                *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="createGSM" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSServiceProfile" name="create">
                                                            <Description>Create Entry CsServiceProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_CsServiceProfile" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>DN CsServiceProfile available</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>PsServiceProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId" />
                                                                        <Parameter name="suMSubscriptionProfileId" />
                                                                        <Parameter name="gsmServiceProfileId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Description>DN PsServiceProfile available</Description>
                                                                        <Parameter name="DN_PsServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                                                    <Description>Be Exist Entry</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_PsServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="existEntry">
                                                                            <Ref name="__BOOL" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>query ROaming Restriction Characteristics for CS</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>psRoamingRestrictionType</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="psRoamingRestrictionType" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>- modify CS Roaming Restriction Characteristics</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_CsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="csRoamingRestrictionType">
                                                                                    <Ref name="psRoamingRestrictionType" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                            <Else>
<!-- Copy PS RoamingRestriction characteristics to Cs RoamingRestriction characteristics NGHLR1FAG167899-->
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>query ROaming Restriction Characteristics for PS</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>psRoamingRestrictionType_@@_psRestrictionListId_@@_psRegRestrictionListId</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="psRoamingRestrictionType" />
                                                                                <Parameter name="psRegRestrictionListId" />
                                                                                <Parameter name="psRestrictionListId" />
                                                                            </Out>
                                                                        </CallBE>
<!--If>
                                                                    <Condition operator="neq">                 
                                                                        <Ref name="psRoamingRestrictionType"/>
                                                                        <Val>ALLPLMN</Val>               
                                                                    </Condition>                              
<Then-->
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>modify on Entry CsServiceProfile</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_CsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="csRoamingRestrictionType">
                                                                                    <MultiValue>
                                                                                        <Ref name="psRoamingRestrictionType" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                                <Parameter name="csRegRestrictionListId">
                                                                                    <MultiValue>
                                                                                        <Ref name="psRegRestrictionListId" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                                <Parameter name="csRestrictionListId">
                                                                                    <MultiValue>
                                                                                        <Ref name="psRestrictionListId" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <AllParameters />
                                                                            </Out>
                                                                        </CallBE>
<!--/Then>
</If-->
                                                                    </Then>
                                                                </If>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- 
                                ***************************************************************************************
                                *   2.3.21.3  call create PsServiceProfile if createGPRS true
                                *************************************************************************************** -->
                                                <Set name="BearerServiceCodeWithoutSN">
                                                    <Val>SMSMTPP</Val>
                                                </Set>
<!--begin SDMA01FAG220643-->
                                                <Set name="BearerServiceCodeWithSN">
                                                    <Val>SMSMTAL</Val>
                                                </Set>
<!--end SDMA01FAG220643-->
                                                <Set name="IsModifyTransferFlag">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="createGPRS" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!-- Begin SDMA01FAG223010 && SDMA01FAG220643  -->
                                                        <If>
<!-- check whether SMSMTPP is subscribed -->
                                                            <OR>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                    <Ref name="BearerServiceWithoutSNList" />
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceCodeWithSN" />
                                                                    <Ref name="BearerServiceNameList" />
                                                                </Condition>
                                                            </OR>
                                                            <Then>
<!-- Inital the  transferOfSmOption-->
                                                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS_internal" name="CheckControlOnTransferOfSmOption">
                                                                    <Description>Check the value of transferOfSmOption</Description>
                                                                    <In>
                                                                        <Parameter name="networkAccessMode" />
                                                                        <Parameter name="IsSMSMTProvided">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                        <Parameter name="transferOfSmOption">
                                                                            <Null />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="transferOfSmOption" />
                                                                    </Out>
                                                                </CallBE>
                                                            </Then>
                                                        </If>
<!-- End SDMA01FAG223010 && SDMA01FAG220643  -->
                                                        <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="create">
                                                            <Description>Create Entry PsServiceProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
                                                                <Parameter name="transferOfSmOption" />
<!-- ZTX | 2009/08/24 | Updated to conside LTE profile, it will be created by default -->
                                                                <Parameter name="epsServiceProfile">
                                                                    <Val>false</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>DN CsServiceProfile available</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>CsServiceProfile_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="suMSubscriberProfileId" />
                                                                        <Parameter name="suMSubscriptionProfileId" />
                                                                        <Parameter name="gsmServiceProfileId" />
                                                                    </In>
                                                                    <Out>
                                                                        <Description>DN CsServiceProfile available</Description>
                                                                        <Parameter name="DN_CsServiceProfile">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                                                    <Description>Be Exist Entry</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="DN_CsServiceProfile" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="existEntry">
                                                                            <Ref name="__BOOL" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existEntry" />
                                                                        <Val>true</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>query ROaming Restriction Characteristics for CS</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_CsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>csRoamingRestrictionType</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csRoamingRestrictionType" />
                                                                            </Out>
                                                                        </CallBE>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>- modify PS Roaming Restriction Characteristics</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psRoamingRestrictionType">
                                                                                    <Ref name="csRoamingRestrictionType" />
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                            <Else>
<!-- Copy CS RoamingRestriction characteristics to Ps RoamingRestriction characteristics NGHLR1FAG167899-->
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                        <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                                    </Condition>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                            <Description>query ROaming Restriction Characteristics for CS</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_CsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                    <Val>csRoamingRestrictionType_@@_csRestrictionListId_@@_csRegRestrictionListId</Val>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <Parameter name="csRoamingRestrictionType" />
                                                                                <Parameter name="csRegRestrictionListId" />
                                                                                <Parameter name="csRestrictionListId" />
                                                                            </Out>
                                                                        </CallBE>
<!--If>
                                                                  <Condition operator="neq">                 
                                                                          <Ref name="csRoamingRestrictionType"/>
                                                                          <Val>ALLPLMN</Val>               
                                                                      </Condition>                              
                                                                      <Then-->
                                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                            <Description>modify on Entry PsServiceProfile</Description>
                                                                            <In>
                                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                                    <Ref name="DN_PsServiceProfile" />
                                                                                </Parameter>
                                                                                <Parameter name="psRoamingRestrictionType">
                                                                                    <MultiValue>
                                                                                        <Ref name="csRoamingRestrictionType" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                                <Parameter name="psRegRestrictionListId">
                                                                                    <MultiValue>
                                                                                        <Ref name="csRegRestrictionListId" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                                <Parameter name="psRestrictionListId">
                                                                                    <MultiValue>
                                                                                        <Ref name="csRestrictionListId" />
                                                                                    </MultiValue>
                                                                                </Parameter>
                                                                            </In>
                                                                            <Out>
                                                                                <AllParameters />
                                                                            </Out>
                                                                        </CallBE>
<!--/Then>
                                                              </If-->
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
<!-- update end for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                                    </Then>
                                                </If>
<!-- Begin SDMA01FAG223010 &&   SDMA01FAG220643 -->
<!-- 1)  From BOTH  to PS,  remove transferOfSmOption if  transferOfSmOption exist;
                                       2)  From PS to BOTH,   then initial transferOfSmOption if SMSMT is provisioned;  
                                       3)  In BOTH, there is need to modify transferOfSmOption according to SMSMT is/not provisioned;
                                 -->
<!-- Case 1: From BOTH  to PS,  remove transferOfSmOption if  transferOfSmOption exist -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Modify Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>transferOfSmOption</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="transferOfSmOption" />
                                                            </Out>
                                                        </CallBE>
                                                        <If>
                                                            <Condition operator="setGreater">
                                                                <Ref name="transferOfSmOption" />
                                                                <Null />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="transferOfSmOption">
                                                                    <Null />
                                                                </Set>
                                                                <Set name="IsModifyTransferFlag">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Case 2 :  From PS to BOTH,   then initial transferOfSmOption if SMSMT is provisioned -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
<!-- If SMSMT is provisioned, then need to initial transferOfSmOption -->
                                                        <If>
                                                            <OR>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                    <Ref name="BearerServiceWithoutSNList" />
                                                                </Condition>
                                                                <Condition operator="notNullIntersection">
                                                                    <Ref name="BearerServiceCodeWithSN" />
                                                                    <Ref name="BearerServiceNameList" />
                                                                </Condition>
                                                            </OR>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS_internal" name="CheckControlOnTransferOfSmOption">
                                                                    <Description>Check the value of transferOfSmOption</Description>
                                                                    <In>
                                                                        <Parameter name="networkAccessMode" />
                                                                        <Parameter name="IsSMSMTProvided">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                        <Parameter name="transferOfSmOption">
                                                                            <Null />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="transferOfSmOption" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="transferOfSmOption" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="IsModifyTransferFlag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Case 3 :  In BOTH, there is need to modify transferOfSmOption according to SMSMT is/not provisioned -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
<!--SMSMT is newly provisioned -->
                                                        <If>
                                                            <OR>
                                                                <AND>
                                                                    <Condition operator="nullIntersection">
                                                                        <Ref name="oldBearerServiceNameList" />
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                    </Condition>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="BearerServiceWithoutSNList" />
                                                                        <Ref name="BearerServiceCodeWithoutSN" />
                                                                    </Condition>
                                                                </AND>
                                                                <AND>
                                                                    <Condition operator="nullIntersection">
                                                                        <Ref name="oldBearerServiceNameList" />
                                                                        <Ref name="BearerServiceCodeWithSN" />
                                                                    </Condition>
                                                                    <Condition operator="notNullIntersection">
                                                                        <Ref name="BearerServiceNameList" />
                                                                        <Ref name="BearerServiceCodeWithSN" />
                                                                    </Condition>
                                                                </AND>
                                                            </OR>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS_internal" name="CheckControlOnTransferOfSmOption">
                                                                    <Description>Check the value of transferOfSmOption</Description>
                                                                    <In>
                                                                        <Parameter name="networkAccessMode" />
                                                                        <Parameter name="IsSMSMTProvided">
                                                                            <Val>true</Val>
                                                                        </Parameter>
                                                                        <Parameter name="transferOfSmOption">
                                                                            <Null />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="transferOfSmOption" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="transferOfSmOption" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="IsModifyTransferFlag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
<!-- SMSMT is removed -->
                                                        <If>
                                                            <AND>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="BearerServiceWithoutSNList" />
                                                                    <Ref name="BearerServiceCodeWithoutSN" />
                                                                </Condition>
                                                                <Condition operator="nullIntersection">
                                                                    <Ref name="BearerServiceNameList" />
                                                                    <Ref name="BearerServiceCodeWithSN" />
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>Modify Entry MSubIdentificationNumber</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedIMSI" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>transferOfSmOption</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="transferOfSmOption" />
                                                                    </Out>
                                                                </CallBE>
                                                                <If>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="transferOfSmOption" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="transferOfSmOption">
                                                                            <Null />
                                                                        </Set>
                                                                        <Set name="IsModifyTransferFlag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- modify the attribute transferOfSmOption-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="IsModifyTransferFlag" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_DNconverter" name="GsmServiceProfileToIMSI">
                                                            <Description>Create then DN of entry MSubIdentificationNumber</Description>
                                                            <In />
                                                            <Out>
                                                                <Parameter name="associatedIMSI">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                            <Description>Modify Entry MSubIdentificationNumber</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                                <Parameter name="transferOfSmOption">
                                                                    <Ref name="transferOfSmOption" />
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
<!--End SDMA01FAG223010 &&   SDMA01FAG220643 -->
<!--***************************************************************************************
                                        *   2.3.21.4  call delete CsServiceProfile if deleteGSM true
                                        *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="deleteGSM" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
<!--SDMA01CAG272598 begin Robin 20111125-->
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="deleteCSProfile">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <Set name="deleteCSProfile">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
<!-- update end for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
<!--SDMA01CAG272598 end Robin 20111125-->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSServiceProfile" name="delete">
                                                            <Description>Delete Entry CsServiceProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_CsServiceProfile" />
                                                                </Parameter>
<!--SDMA01CAG272598 begin Robin 20111125-->
                                                                <Parameter name="deleteCSProfile" />
<!--SDMA01CAG272598 end Robin 20111125-->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--begin for dual logic in F70186-->
<!-- call searchTwinImsi to handle Twin-IMSI cases.  -->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="searchTwinImsi">
                                                            <In>
                                                                <Parameter name="imsi_Start">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="twin_Imsi_List" />
                                                            </Out>
                                                        </CallBE>
                                                        <Foreach name="imsi_Start">
                                                            <MultiValue>
                                                                <Ref name="twin_Imsi_List" />
                                                            </MultiValue>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="neq">
                                                                        <Ref name="Upgradeflag" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="Upgradeflag31" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
<!-- raz GsmSubscriberRoamingData on mSubIdentificationNumber  -->
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <Description>Modify Entry MSubIdentificationNumber</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="imsi_Start" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingRestrictionFlags">
                                                                                <Null />
                                                                            </Parameter>
<!--add for 70200-->
                                                                            <Parameter name="roamingRestrictionFlagsOld">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesOld">
                                                                                <Null />
                                                                            </Parameter>
<!--end add for 70200-->
                                                                            <Parameter name="vlrUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCharactsFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="flagCffPlmn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="supOfLocRegCount">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="locRegSubsPeriod">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhaseOld">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="odbUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="mscIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCbocBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboiBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboehBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="localMobileStationIdentity">
                                                                                <Null />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
                                                                            <Parameter name="gsmNotReachableSMSFlag">
                                                                                <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNotReachableReason">
                                                                                <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="memoryCapacityExceededFlag">
                                                                                <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGsmSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="Upgradeflag" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="Upgradeflag31" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
<!-- raz GsmSubscriberRoamingData on mSubIdentificationNumber  -->
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <Description>Modify Entry MSubIdentificationNumber</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="imsi_Start" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingRestrictionFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCharactsFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="flagCffPlmn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="supOfLocRegCount">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="locRegSubsPeriod">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhaseOld">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="odbUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="mscIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCbocBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboiBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboehBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="localMobileStationIdentity">
                                                                                <Null />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
                                                                            <Parameter name="gsmNotReachableSMSFlag">
                                                                                <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNotReachableReason">
                                                                                <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="memoryCapacityExceededFlag">
                                                                                <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGsmSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="Upgradeflag" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                    <Condition operator="eq">
                                                                        <Ref name="Upgradeflag31" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
<!-- raz GsmSubscriberRoamingData on mSubIdentificationNumber  -->
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <Description>Modify Entry MSubIdentificationNumber</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="imsi_Start" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingRestrictionFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCharactsFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="flagCffPlmn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="supOfLocRegCount">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="locRegSubsPeriod">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="odbUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="mscIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCbocBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboiBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboehBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="localMobileStationIdentity">
                                                                                <Null />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
                                                                            <Parameter name="gsmNotReachableSMSFlag">
                                                                                <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNotReachableReason">
                                                                                <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="memoryCapacityExceededFlag">
                                                                                <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507-->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGsmSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
                                                        </Foreach>
<!--begin for dual logic in F70186-->
                                                    </Then>
                                                </If>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.21.5  call delete PsServiceProfile if deleteGPRS true
                                        *************************************************************************************** -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="deleteGPRS" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
<!-- update begin for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
<!--SDMA01CAG272598 begin Robin 20111125-->
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                                                <Val>psCsRestrictionListProvision</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="deletePSProfile">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <Set name="deletePSProfile">
                                                                    <Val>true</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
<!--SDMA01CAG272598 end Robin 20111125-->
<!-- update end for FR: SDMA01FAG282948 by sun xiaoying on 2013-03-11, add contract data for SDMA01CAG272598-->
                                                        <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="delete">
                                                            <Description>Delete Entry PsServiceProfile</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_PsServiceProfile" />
                                                                </Parameter>
<!--SDMA01CAG272598 begin Robin 20111125-->
                                                                <Parameter name="deletePSProfile" />
<!--SDMA01CAG272598 end Robin 20111125-->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
<!--begin for dual logic by guowei in F70186 -->
<!-- raz GprsSubscriberRoamingData on mSubIdentificationNumber -->
<!-- call searchTwinImsi to handle Twin-IMSI cases.  -->
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="searchTwinImsi">
                                                            <In>
                                                                <Parameter name="imsi_Start">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="twin_Imsi_List" />
                                                            </Out>
                                                        </CallBE>
                                                        <Foreach name="imsi_Start">
                                                            <MultiValue>
                                                                <Ref name="twin_Imsi_List" />
                                                            </MultiValue>
                                                            <If>
                                                                <Condition operator="neq">
                                                                    <Ref name="Upgradeflag31" />
                                                                    <Val>Commit</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <Description>- Modify Entry MSubIdentificationNumber</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="imsi_Start" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCapabilityFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsEnhancementIndicator">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsCamelPhaseOld">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnRoamingRestriction">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNotReachableFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNotReachableReason">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnIp">
                                                                                <Null />
                                                                            </Parameter>
<!--FFRD-72989-316 begin-->
                                                                            <Parameter name="visitedSgsnPlmnId">
                                                                                <Null />
                                                                            </Parameter>
<!--FFRD-72989-316 end-->
                                                                            <Parameter name="transferOfSmOption">
                                                                                <Null />
                                                                            </Parameter>
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGprsSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                                <Else>
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <Description>- Modify Entry MSubIdentificationNumber</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="imsi_Start" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCapabilityFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsEnhancementIndicator">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnRoamingRestriction">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNotReachableFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNotReachableReason">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="sgsnIp">
                                                                                <Null />
                                                                            </Parameter>
<!--FFRD-72989-316 begin-->
                                                                            <Parameter name="visitedSgsnPlmnId">
                                                                                <Null />
                                                                            </Parameter>
<!--FFRD-72989-316 end-->
                                                                            <Parameter name="transferOfSmOption">
                                                                                <Null />
                                                                            </Parameter>
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGprsSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gprsNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Else>
                                                            </If>
                                                        </Foreach>
<!--end for dual logic by guowei in F70186 -->
                                                    </Then>
                                                </If>
<!-- 
                                        ***************************************************************************************
                                        *   2.3.22 NGHLR1FAG169606:each time when BSCs of a subscriber modified
                                        *************************************************************************************** -->
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BSGDeleted" name="modify">
                                                    <Description>SUB_OAM_DeleteGsmServices BearerService</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="oldBearerServiceNameList">
                                                            <Ref name="oldBearerServiceNameList" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                                <CallBE entityName="PostCommitBeContext" name="modify">
                                                    <Description>Save BearerServiceListe</Description>
                                                    <In>
                                                        <Parameter name="oldBearerServiceNameList" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Else>
<!--Add for 73118 qdiao begin 032012-->
                                        </If>
                                    </Else>
<!--Add for 73118 qdiao end 032012-->
                                </If>
                            </Else>
                        </If>
<!-- modify for 68045 begin, add a new condition "isChangeSubKey != true", BPQ, 20090205 -->
<!-- changeSubKey has no need to do following actions -->
                        <If>
                            <Condition operator="neq">
                                <Ref name="isChangeSubKey" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
<!--begin NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                <Set name="associatedBasicServicesCodeList">
                                    <Null />
                                </Set>
<!--end NGHLR1FAG180820 zhang bingfeng 2007/01/10 -->
                                <CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubServicesList" name="create">
                                    <Description>- get associatedBasicServicesCodeList</Description>
                                    <In />
                                    <Out>
                                        <Parameter name="associatedBasicServicesList" />
                                    </Out>
                                </CallBE>
<!-- timeStamp -->
                                <If>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
                                            <Val>BOTH</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.MS_OAM_Subscription_PS_update" name="update">
                                            <In>
                                                <Parameter name="Dn_update">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                                <If>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
                                            <Val>BOTH</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.MS_OAM_GSM_update" name="update">
                                            <In>
                                                <Parameter name="Dn_update">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- timeStamp End -->
                            </Then>
                        </If>
<!-- modify for 68045 end, add a new condition "isChangeSubKey != true", BPQ, 20090205 -->
<!--
                        *******************************************************************************************************************************
                                        *  NGHLR1FAG199372 and NGHLR1FAG199610, remove MSISDN to check the condition to operate the underTestImsi and testNewImsi
                        *******************************************************************************************************************************
                        -->
                        <If>
<!-- modify for 68045 begin, add a new condition "isChangeSubKey != true", BPQ, 20090205 -->
                            <AND>
                                <Condition operator="neq">
                                    <Ref name="typeOfModification" />
                                    <Val>changeIMSI</Val>
                                </Condition>
                                <Condition operator="neq">
                                    <Ref name="isChangeSubKey" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
<!-- modify for 68045 begin, add a new condition "isChangeSubKey != true", BPQ, 20090205 -->
                            <Then>
<!--If>
                                    <whether the interception on subscriber information change event type is globally enabled
                                    <Condition operator="notNullIntersection">
                                        <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception"/>
                                        <Val>SUBS_INFO_CHANGE</Val>
                                    </Condition>-->
<!--get the old MSISDN List-->
<!--
                                        <Set name="oldMSISDNList">
                                            <MultiValue>
                                                <Ref name="mainMSISDN" delta="old"/>
                                                <Ref name="associatedMSISDN" delta="old"/>
                                            </MultiValue>
                                        </Set>-->
<!--The new MSISDN list-->
                                <Set name="newMSISDNList">
                                    <MultiValue>
                                        <Ref name="mainMSISDN" />
                                        <Ref name="associatedMSISDN" />
                                    </MultiValue>
                                </Set>
<!--Compare old MSISDN list and new MSISDN list to get the removed MSISDN list -->
                                <CallBE entityName="HSS.SUB.SupplementaryService.BeExtractFromSet" name="bSUBa">
                                    <Description>- MSISDN change:get removed MSISDN</Description>
                                    <In>
                                        <Parameter name="set_a">
                                            <Ref name="newMSISDNList" />
                                        </Parameter>
                                        <Parameter name="set_b">
                                            <Ref name="oldMSISDNList" />
<!--Ref name="interceptedIdentityList"/-->
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="removedMSISDNList">
                                            <Ref name="set_r" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="removedMSISDNList" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Remove name="interceptedIdentityList">
                                            <Ref name="associatedIMSI" />
                                        </Remove>
                                        <Remove name="interceptedIdentityList">
                                            <Ref name="removedMSISDNList" />
                                        </Remove>
                                        <Set name="msisdnList">
                                            <Ref name="interceptedIdentityList" />
                                        </Set>
<!--If it is the MSISDN removal-->
                                        <If>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="msisdnList" />
                                                <Null />
                                            </Condition>
                                            <Then>
<!--If imsiTargetTypeNotUsed and tagImsiOnMsisdnIntercepted are ture-->
<!--***Begin SDMA01FAG225095***-->
<!-- Comment for 67807 -->
<!--
                                                <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                                                    <Description> Be Exist Entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Val>contractInterceptionId=1,contractDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existContEntry">
                                                            <Ref name="__BOOL"/>
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.ConfigurationData.*.BeGDMI" name="existEntry">
                                                    <Description> Be Exist Entry</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Val>confInterceptionId=1,configurationDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existConfEntry">
                                                            <Ref name="__BOOL"/>
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="existContEntry"/>
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="existConfEntry"/>
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                        <Then>-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="imsiTargetTypeNotUsed" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="tagImsiOnMsisdnInterception" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfInterception" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
<!--Then set the underTestImsi of the associatedIMSI as false-->
                                                    <Then>
                                                        <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                            <Description>- update the IMSI under associatedIMSI</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="associatedIMSI" />
                                                                </Parameter>
                                                                <Parameter name="underTestImsi">
                                                                    <Val>false</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                            <Description>- build linkOldIMSI_DN</Description>
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>AutoImsiChange_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId" />
                                                                </Parameter>
                                                                <Parameter name="mSubIdentificationNumberId">
                                                                    <Ref name="mSubIdentificationNumberId" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>associatedIMSI valorized</Description>
                                                                <Parameter name="linkOldIMSI_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                            <Description>- MSISDN change: Call BeExistEntry.create to know if linkOldIMSI_DN exist</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="linkOldIMSI_DN" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="existEntry">
                                                                    <Ref name="__BOOL" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!--If this active IMSI is involved in an automatic IMSI change procedure-->
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="existEntry" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                    <Description>- query link</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="linkOldIMSI_DN" />
                                                                        </Parameter>
                                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                            <Val>linkToOtherIMSI</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Parameter name="linkToOtherIMSI">
                                                                            <Ref name="linkToOtherIMSI" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>- query mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from linkToOtherImsi</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="linkToOtherIMSI" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Description>- query mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from linkToOtherImsi</Description>
                                                                        <Parameter name="newMobileCountryCodeId">
                                                                            <Ref name="mobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="newMobileNetworkCodeId">
                                                                            <Ref name="mobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="newMSubIdentificationNumberId">
                                                                            <Ref name="mSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                                    <Description>- build linkNewIMSI_DN</Description>
                                                                    <In>
                                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                                            <Val>AutoImsiChange_DN</Val>
                                                                        </Parameter>
                                                                        <Parameter name="mobileCountryCodeId">
                                                                            <Ref name="newMobileCountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mobileNetworkCodeId">
                                                                            <Ref name="newMobileNetworkCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="mSubIdentificationNumberId">
                                                                            <Ref name="newMSubIdentificationNumberId" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Description>associatedIMSI valorized</Description>
                                                                        <Parameter name="linkNewIMSI_DN">
                                                                            <Ref name="__DISTINGUISH_NAME" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
<!--set the testNewImsi as false-->
                                                                <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                    <Description>- update the testNewImsi to false</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="linkNewIMSI_DN" />
                                                                        </Parameter>
                                                                        <Parameter name="testNewImsi">
                                                                            <Val>false</Val>
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
<!-- Comment for 67807
                                                    </Then>
                                                </If>
                                                                                                End of Comment 67807 -->
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- Add begin by fucong for 70018 on 20100729 -->
                        <Set name="removeBOTHSpecificApnFlag">
                            <Val>false</Val>
                        </Set>
                        <Set name="remove3gppSpecificApnFlag">
                            <Val>false</Val>
                        </Set>
                        <Set name="removeNon3gppSpecificApnFlag">
                            <Val>false</Val>
                        </Set>
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="DeactivateSubscriptionFlag" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="IMSI_Change_Mode" />
                                    <Val>MANUAL</Val>
                                </Condition>
                            </OR>
                            <Then>
                                <Set name="removeBOTHSpecificApnFlag">
                                    <Val>true</Val>
                                </Set>
                                <Set name="remove3gppSpecificApnFlag">
                                    <Val>true</Val>
                                </Set>
                                <Set name="removeNon3gppSpecificApnFlag">
                                    <Val>true</Val>
                                </Set>
<!-- Begin: Removed by Yvonne on 2013-01-27. For the two scenarios, all specificApn should be deleted arbitrarily -->
<!--  
                                <If>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <Set name="remove3gppSpecificApnFlag">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="removeNon3gppSpecificApnFlag">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <OR>
                                        <AND>
                                            <Condition operator="eq">
                                                <Ref name="remove3gppSpecificApnFlag" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                        </AND>
                                        <AND>
                                            <Condition operator="eq">
                                                <Ref name="removeNon3gppSpecificApnFlag" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                        </AND>
                                        <AND>
                                            <Condition operator="eq">
                                                <Ref name="removeNon3gppSpecificApnFlag" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="remove3gppSpecificApnFlag" />
                                                <Val>true</Val>
                                            </Condition>
                                        </AND>
                                    </OR>
                                    <Then>
                                        <Set name="removeBOTHSpecificApnFlag">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
-->
<!-- End: Removed by Yvonne on 2013-01-27. For the two scenarios, all specificApn should be deleted arbitrarily -->
                            </Then>
                        </If>
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="remove3gppSpecificApnFlag" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="removeNon3gppSpecificApnFlag" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="removeBOTHSpecificApnFlag" />
                                    <Val>true</Val>
                                </Condition>
                            </OR>
                            <Then>
                                <Set name="DN_EpsServiceProfile">
                                    <Ref name="__DN_HANDLER" dnSyntax="EpsServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                </Set>
                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_EPS_internal" name="DeleteSpecificApnData">
                                    <Description>Delete the specific APN Data</Description>
                                    <In>
                                        <Parameter name="DN_EpsServiceProfile" />
                                        <Parameter name="remove3gppSpecificApnFlag" />
                                        <Parameter name="removeNon3gppSpecificApnFlag" />
                                        <Parameter name="removeBOTHSpecificApnFlag" />
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- add for 66935 begin -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fMCO001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="fMSIM003" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                    <Val>true</Val>
                                </Condition>
                                <OR>
                                    <Condition operator="eq">
                                        <Ref name="deleteGSM" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Condition operator="eq">
                                        <Ref name="deleteGPRS" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Condition operator="eq">
                                        <Ref name="IMSI_Change_Mode" />
                                        <Val>MANUAL</Val>
                                    </Condition>
                                    <Condition operator="eq">
                                        <Ref name="DeactivateSubscriptionFlag" entityName="PostCommitBeContext" />
                                        <Val>true</Val>
                                    </Condition>
                                </OR>
                            </AND>
                            <Then>
                                <Set name="associatedMainMsisdn">
                                    <Ref name="associatedMainMsisdn" entityName="gdmiContext" DN="DN_BasicSubscription" />
                                </Set>
                                <Set name="associatedIMSI">
                                    <Ref name="associatedIMSI" entityName="gdmiContext" DN="associatedMainMsisdn" />
                                </Set>
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                <If>
                                    <Condition operator="setLessOrEqual">
                                        <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="roaming_Imsi">
                                            <Ref name="associatedIMSI" />
                                        </Set>
                                    </Then>
                                    <Else>
                                        <Set name="roaming_Imsi">
                                            <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                        </Set>
                                    </Else>
                                </If>
                                <CallBE entityName="HSS.LOC.Location.LOC_INTERAL_Location" name="checkLocationData">
                                    <In>
                                        <Parameter name="DN_IMSI">
                                            <Ref name="roaming_Imsi" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
<!-- add for 66935 end -->
<!-- begin of 73013 Hans-->
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="mapScreeningCategory" delta="changed" />
                                    <Null />
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" name="contspare7" />
                                    <Val>VLRAffectedLog</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME" />
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>associatedMainMsisdn</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="associatedMainMsisdn" />
                                    </Out>
                                </CallBE>
                                <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="associatedMainMsisdn" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>associatedIMSI</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="associatedIMSI" />
                                    </Out>
                                </CallBE>
                                <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="associatedIMSI" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>vlrIsdn</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="vlrIsdn" />
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="associatedIMSI" />
                                        </Parameter>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MSubIdentificationNumber_DN</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mobileCountryCodeId" />
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="neq">
                                        <Ref name="vlrIsdn" />
                                        <NotExist />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.TRH.*.BeVlrLog" name="handleMapScreeningCategory">
                                            <Description>handleMapScreeningCategory</Description>
                                            <In>
                                                <Parameter name="vlrIsdn" />
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- end of 73013 Hans-->
<!--Add for 71037 qdiao begin-->
                        <If>
                            <Condition operator="neq">
                                <Ref name="isChangeSubKey" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="PrepareFullSetIDRData">
                                    <Description>prepare full set IDR data</Description>
                                    <In>
                                        <Parameter name="DN_GsmServiceProfile">
                                            <Ref name="DN_GsmSUB" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!--Add for 71037 qdiao end-->
<!-- 73282-62 begin -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="supportIpSmGwEnh" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
                            <Then>
<!-- 73282-05 begin -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="scAddress4IPSM" delta="changed" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BeServiceNodeAddress" name="createServiceNode">
                                            <In>
                                                <Parameter name="serverAddress">
                                                    <Ref name="scAddress4IPSM" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="scAddress4IPSMLink">
                                                    <Ref name="__PRIMARY_DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>MSubIdentificationNumber_DN</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out>
                                                <Parameter name="IMSI_DN">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.LOC.*.BeGDMI" name="modify">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="IMSI_DN" />
                                                </Parameter>
                                                <Parameter name="scAddress4IPSMLink" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 73282-05 end -->
                            </Then>
                            <Else>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="IPSMGWRegisterAddress" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="16107">
                                                    <StringAttributeType>
                                                        <Val>IP-SM-GW number</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>supportIpSmGwEnh is not true</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- 73282-05 begin -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="scAddress4IPSM" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="16107">
                                                    <StringAttributeType>
                                                        <Val>scAddress4IPSM</Val>
                                                    </StringAttributeType>
                                                    <StringAttributeType>
                                                        <Val>supportIpSmGwEnh is not true</Val>
                                                    </StringAttributeType>
                                                </Frame>
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
<!-- 73282-05 end -->
                            </Else>
                        </If>
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="supportIpSmGwEnh" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="IPSMGWRegisterAddress" delta="changed" />
                                    <Null />
                                </Condition>
                            </AND>
                            <Then>
                                <If>
                                    <Condition operator="setLessOrEqual">
                                        <Ref name="IPSMGWRegisterAddress" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <ThrowException>
                                            <Error ErrorId="31">
                                                <Frame FrameId="12163" />
                                            </Error>
                                        </ThrowException>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>ExtendedMWD_DN</Val>
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mobileCountryCodeId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_ExtendedMWD">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.LOC.*.BeCommonHandler" name="setEntryArrayValue">
                                    <Description />
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ExtendedMWD" />
                                        </Parameter>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>smscIsdnForExtMWD[12]</Val>
                                        </Parameter>
                                        <Parameter name="__SOURCE_NAME">
                                            <Val>IPSMGWRegisterAddress</Val>
                                        </Parameter>
                                        <Parameter name="IPSMGWRegisterAddress">
                                            <Ref name="IPSMGWRegisterAddress" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- 73282-62 end -->
                        <Result />
                    </Request>
                    <Request name="delete">
                        <Description>
                            <Summary>The delete Operation enables to delete the subscriber in the HLR database. The IMSI and its authentication characteristics are not deleted. They can be deleted by the use of the AuC management Operation.</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
<!--
                        ***************************************************************************************
                        * 3. Delete Request 
                        *   3.0   prepare for postcommit
                        *   3.1   get NAM 
                        *   3.2   Query on  Entry SuMSubscriptionProfile (get associatedMainMsisdn)
                        *   3.3   Query on  Entry SubscriberNumber of mainMSISDN
                        *   3.4   Query on  Entry MSubIdentificationNumber
                        *       3.5   Prepare CREQ message
                        *   3.6   Delete LINK IMSI 
                        *   3.7   Call Roaming deletion
                        *   3.8   Call CAMEL deletion
                        *   3.9   Call Call Barring deletion
                        *   3.10  Call Call Forwarding deletion
                        *   3.11  Call GCS deletion
                        *   3.12  Call CUG deletion
                        *   3.12.1  Call LCS deletion
                        *   3.12.2  Call eMLPP deletion
                        *   3.12.3  Call MdtDomain deletion
                        *   3.13  Delete CsServiceProfile if exists (and associated ODB charac if exist)
                        *   3.14  Delete PsServiceProfile if exists (and associated ODB charac if exist)
                        *   3.15  Delete on  Entry SuMSubscriptionProfile 
                        *   3.16  Modify  Entry MSubIdentificationNumber
                        *   <NGHLR1CAG159458_2>Delete MSubIdentificationNumber instead of modify it
                        *   3.17  Delete on  Entry SubscriberNumber corresponding to assocaitedMSISIDN
                        *   3.18  Delete on  Entry SubscriberNumber corresponding to mainMSISIDN
                        *   3.19  Delete on  Entry BasicSubscription
                        
                        *************************************************************************************** -->
<!-- 
                        ***************************************************************************************
                        *   3.0   prepare for postcommit
                        *************************************************************************************** -->
<!-- Begin for F72874, subscriberType=Shared_PROFILE, by Austin 2012-6-11  -->
<!-- CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                <Description>Get the DN_BasicSubscription</Description>
                                <In />
                                <Out>                                
                                    <Parameter name="DN_BasicSubscription">
                                        <Ref name="__DISTINGUISH_NAME" />
                                    </Parameter>
                                </Out>
                            </CallBE -->
                        <Set name="DN_BasicSubscription">
                            <Ref name="__DISTINGUISH_NAME" />
                        </Set>
                        <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="DN_BasicSubscription" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>subscriberType</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="subscriberType" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="subscriberType" />
                                <Val>Shared_PROFILE</Val>
                            </Condition>
                            <Then>
                                <CallBE name="query" entityName="HSS.SASUB.*.DnHandler">
                                    <Description>- query SASUB</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_BasicSubscription" />
                                        </Parameter>
<!-- Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>suMSubscriberProfileId</Val>
                                          </Parameter -->
                                    </In>
                                    <Out>
                                        <Parameter name="suMSubscriberProfileId" />
                                    </Out>
                                </CallBE>
                                <CallBE name="checkSaSubLinkforBasicSubscription" entityName="HSS.SUB.*.BeSaGpConstr">
                                    <Description>call checkSaSubLinkforBasicSubscription to check if there is SA Sub links to BasicSubscription</Description>
                                    <In>
                                        <Parameter name="suMSubscriberProfileId" />
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- End for F72874, subscriberType=Shared_PROFILE, by Austin 2012-6-11  -->
<!--Add write lock policy for feature 67807 -->
                        <LockPolicy name="Basic" type="writeLock">
<!-- beg SDMA01FAG279379 by Wayne -->
                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                <Description />
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME" />
                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                        <Val>subscriberType_@@_associatedMainMsisdn_@@_multiSimMember</Val>
                                    </Parameter>
                                </In>
                                <Out>
                                    <Parameter name="subscriberType" />
                                    <Parameter name="associatedMainMsisdn" />
                                    <Parameter name="multiSimMember" />
                                </Out>
                            </CallBE>
                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                <Description>Query on Entry MobileStationInternalISDN on associatedMainMsisdn attribute</Description>
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME">
                                        <Ref name="associatedMainMsisdn" />
                                    </Parameter>
                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                        <Val>associatedIMSI</Val>
                                    </Parameter>
                                </In>
                                <Out>
                                    <Parameter name="associatedIMSI" />
                                </Out>
                            </CallBE>
                            <If>
                                <AND>
<!-- beg SDMA01FAG279379 by Wayne -->
                                    <Condition operator="nullIntersection">
                                        <Ref name="subscriberType" />
                                        <Val>SHARED_SUBS</Val>
                                    </Condition>
                                    <Condition operator="nullIntersection">
                                        <Ref name="subscriberType" />
                                        <Val>SHARED_SUBS_SLAVE</Val>
                                    </Condition>
<!-- end SDMA01FAG279379 by Wayne -->
                                    <Condition operator="eq">
                                        <Ref name="multiSimMember" />
                                        <Val>true</Val>
                                    </Condition>
                                </AND>
                                <Then>
                                    <ThrowException>
                                        <Error ErrorId="21">
                                            <Frame FrameId="12019" />
                                        </Error>
                                    </ThrowException>
                                </Then>
                            </If>
                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                <Description />
                                <In>
                                    <Parameter name="__DN_SYNTAX_NAME">
                                        <Val>SuMSubscriberProfile_DN</Val>
                                    </Parameter>
                                </In>
                                <Out>
                                    <Parameter name="DN_SuMSubscriberProfile">
                                        <Ref name="__DISTINGUISH_NAME" />
                                    </Parameter>
                                </Out>
                            </CallBE>
                            <If>
                                <AND>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="__RECEIVED_ATTRIBUTES" />
                                            <NotExist />
                                        </Condition>
                                        <Condition operator="setLessOrEqual">
                                            <Ref name="__RECEIVED_ATTRIBUTES" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="nullIntersection">
                                            <Ref name="__RECEIVED_ATTRIBUTES" />
                                            <Val>call_from_multisimcard</Val>
                                        </Condition>
                                    </OR>
                                    <OR>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS_SLAVE</Val>
                                        </Condition>
                                    </OR>
                                </AND>
                                <Then>
                                    <If>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS_SLAVE</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>- extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                <In />
                                                <Out>
                                                    <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                    <Parameter name="DN_BasicSubscription">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedIMSI" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                                    <Parameter name="mobileCountryCodeId">
                                                        <Ref name="mobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mobileNetworkCodeId">
                                                        <Ref name="mobileNetworkCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mSubIdentificationNumberId">
                                                        <Ref name="mSubIdentificationNumberId" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>1</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember1</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember1</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember1" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember1" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>2</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember2</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember2</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember2" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember2" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>3</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember3</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember3</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember3" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember3" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>4</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember4</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember4</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember4" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember4" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>5</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember5</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember5</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember5" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember5" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>6</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember6</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember6</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember6" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember6" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>7</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember7</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember7</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember7" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember7" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>8</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember8</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember8</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember8" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember8" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>9</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember9</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember9</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember9" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember9" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>10</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember10</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember10</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember10" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember10" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>11</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember11</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember11</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember11" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember11" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>12</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember12</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember12</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember12" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember12" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>13</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember13</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember13</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember13" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember13" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>14</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember14</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember14</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember14" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember14" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>15</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember15</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember15</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember15" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember15" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="suMSubscriptionProfileId" />
                                                    <Val>16</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="__RECEIVED_ATTRIBUTES">
                                                        <Val>MultiSIMMember16</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>MultiSIMMember16</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId-twin_Imsi_Add-nullString</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId" />
                                                            <Parameter name="mobileNetworkCodeId" />
                                                            <Parameter name="mSubIdentificationNumberId" />
                                                            <Parameter name="twin_Imsi_Add">
                                                                <Val>REMOVE</Val>
                                                            </Parameter>
                                                            <Parameter name="nullString">
                                                                <Null />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="MultiSIMMember16" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="modify">
                                                        <Description />
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="MultiSIMMember16" />
                                                        </In>
                                                    </CallBE>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
                                    <If>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="subscriberType" />
                                            <Val>SHARED_SUBS</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                <Description />
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>MultiSimServiceProfile_DN</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_MultiSimServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query Entry SuMSubscriberProfile</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_MultiSimServiceProfile" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>eachMemberList</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="eachMemberList" />
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <OR>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>2</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>3</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>4</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>5</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>6</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>7</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>8</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>9</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>10</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>11</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>12</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>13</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>14</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>15</Val>
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="eachMemberList" />
                                                        <Val>16</Val>
                                                    </Condition>
                                                </OR>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="31">
                                                            <Frame FrameId="12151" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
                                            <CallBE entityName="HSS.SUB.MultiSIMCard.MS_OAM_MultiSIM" name="delete">
                                                <Description />
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_SuMSubscriberProfile" />
                                                    </Parameter>
                                                </In>
                                            </CallBE>
                                        </Then>
                                    </If>
                                </Then>
                                <Else>
<!-- end SDMA01FAG279379 by Wayne -->
<!--begin add for 66935, wangying-->
<!--Initial local variable -->
                                    <Set name="deleteSubscription">
                                        <Val>true</Val>
                                    </Set>
                                    <Set name="requestName">
                                        <Ref name="__CALLED_METHOD_NAME" />
                                    </Set>
<!--check if the  current DN is  DN_By_IMSI_For_Basic or Official_DN_By_IMSI_For_Basic-->
                                    <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                                        <Description>check dnSyntax</Description>
                                        <In>
                                            <Parameter name="__SOURCE_NAME">
                                                <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                            </Parameter>
                                            <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                            <Parameter name="dnSyntax">
                                                <Val>DN_By_IMSI_For_Basic</Val>
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="ret1">
                                                <Ref name="__BOOL" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                                        <Description>check dnSyntax</Description>
                                        <In>
                                            <Parameter name="__SOURCE_NAME">
                                                <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                            </Parameter>
                                            <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                            <Parameter name="dnSyntax">
                                                <Val>Official_DN_By_IMSI_For_Basic</Val>
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="ret2">
                                                <Ref name="__BOOL" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
<!--In case of virtual IMSI DN, check if current operation is delete M2M IMSI -->
                                    <If>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="ret1" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="ret2" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                        <Then>
                                            <Set name="associatedIMSI">
                                                <Ref name="__DN_HANDLER" dnSyntax="MSubIdentificationNumber_DN" DN="__INTERFACE_DISTINGUISH_NAME" />
                                            </Set>
                                            <Set name="mainMSISDN">
                                                <Ref name="mainMSISDN" entityName="gdmiContext" DN="associatedIMSI" />
                                            </Set>
                                            <Set name="associatedIMSINumber">
                                                <Ref name="associatedIMSINumber" entityName="gdmiContext" DN="mainMSISDN" />
                                            </Set>
                                            <Set name="oldAssociatedIMSI">
                                                <Ref name="associatedIMSI" entityName="gdmiContext" DN="mainMSISDN" />
                                            </Set>
                                            <If>
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="associatedIMSINumber" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="greater">
                                                        <Ref name="associatedIMSINumber" />
                                                        <Val>0</Val>
                                                    </Condition>
                                                    <Condition operator="neq">
                                                        <Ref name="associatedIMSI" />
                                                        <Ref name="oldAssociatedIMSI" />
                                                    </Condition>
                                                </AND>
                                                <Then>
<!--Delete M2M Case -->
                                                    <Set name="deleteSubscription">
                                                        <Val>false</Val>
                                                    </Set>
<!--add begin for SDMA01FAG277891 -->
                                                    <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                                        <Description>build EpsServiceProfile dn</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>PsServiceProfile_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="__DISTINGUISH_NAME" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_PsServiceProfile">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_PsServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="query">
                                                                <Description>Query Entry PsServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_PsServiceProfile" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="epsServiceProfile" />
                                                                </Out>
                                                            </CallBE>
                                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                                <Description>Save epsServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="epsServiceProfile" />
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!--end for SDMA01FAG277891-->
                                                    <CallBE entityName="HSS.SUB.*.BeCounter" name="delete">
                                                        <Description>Decrease the counter value by 1</Description>
                                                        <In>
                                                            <Parameter name="__ENTRY_COUNTER">
                                                                <Ref name="associatedIMSINumber" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="associatedIMSINumber">
                                                                <Ref name="__ENTRY_COUNTER" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                        <Description>update associatedIMSINumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="mainMSISDN" />
                                                            </Parameter>
                                                            <Parameter name="associatedIMSINumber" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                        <Description>Save associatedIMSI</Description>
                                                        <In>
                                                            <Parameter name="associatedIMSI" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                        <Description>Save deleteSubscription</Description>
                                        <In>
                                            <Parameter name="deleteSubscription" />
                                            <Parameter name="requestName" />
                                        </In>
                                        <Out />
                                    </CallBE>
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="deleteSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
<!--end add for 66935, wangying-->
<!-- Add for feature 67807, now always load HLRDataProfile-->
<!-- modify for SDMA01FAG279739,use alldataProfile in order to load gsmService 1-16 data -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                <Description>Built DN SuMSubscriberProfile</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>SuMSubscriberProfile_DN</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_SuMSubscriberProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_LoadDataProfile" name="loadprofile">
                                                <Description>- Load profile</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_SuMSubscriberProfile" />
                                                    </Parameter>
                                                    <Parameter name="loadDataName">
                                                        <Val>AllDataProfile</Val>
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
<!-- end of modify for SDMA01FAG279739 -->
<!--add for 70200-->
                                            <CallBE name="getR30upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                                                <Description>build DN from SuMSubscriberProfile entry</Description>
                                                <Out>
                                                    <Parameter name="Upgradeflag" />
                                                </Out>
                                            </CallBE>
<!--end for 70200-->
<!--begin for dual logic by guowei in F70186-->
                                            <CallBE name="getR31upgradeflag" entityName="HSS.HLR.*.BeUpgradeFlag">
                                                <Description>build DN from SuMSubscriberProfile entry</Description>
                                                <Out>
                                                    <Parameter name="Upgradeflag31">
                                                        <Ref name="Upgradeflag" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!--end for dual logic by guowei in F70186-->
<!-- End for feature 67807 -->
                                            <CallBE entityName="HSS.SUB.SupplementaryService.BeInitMediation" name="create" />
<!--CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubServicesList" name="create"/-->
<!-- Add by wupingfan.Query the returnErrorForNoEpsSub for confEpsData.-->
<!-- Update by wupingfan.There is no need check the global data now,comment it.-->
<!-- End by wupingfan.-->
<!--add by zhao nannan for 71037 begin -->
                                            <Set name="DN_MdtDomain">
                                                <Null />
                                            </Set>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_SuMSubscriberProfile" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>networkTraceActive_@@_networkTraceService</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="networkTraceActive" />
                                                    <Parameter name="networkTraceService" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                <In>
                                                    <Parameter name="networkTraceActive" />
                                                    <Parameter name="networkTraceService" />
                                                    <Parameter name="DN_MdtDomain" />
                                                </In>
                                                <Out />
                                            </CallBE>
<!--add by zhao nannan for 71037 end -->
<!--
                        ***************************************************************************************
                        *   3.1   get NAM 
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>- Query on Entry SuMSubscriptionProfile</Description>
                                                <In>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- 73118begin Wayne -->
                                                        <Val>networkAccessMode_@@_subscriberType</Val>
<!-- 73118end Wayne -->
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <AllParameters />
                                                </Out>
                                            </CallBE>
<!-- 
                        ***************************************************************************************
                        *   3.2   Query on  Entry SuMSubscriptionProfile (get associatedMainMsisdn)
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                <In />
                                                <Out>
                                                    <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                    <Parameter name="DN_BasicSubscription">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN suMSubscriptionProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>GsmServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN suMSubscriptionProfile available</Description>
                                                    <Parameter name="DN_SuMSubscriptionProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query on Entry SuMSubscriptionProfile</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_SuMSubscriptionProfile" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>associatedMainMsisdn_@@_multiSimMember</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <AllParameters />
                                                </Out>
                                            </CallBE>
<!--start for feature 73024,zhao nannan,add the delete for LTE SuMSubscriber -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>- Query on Entry SuMSubscriptionProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriptionProfile" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedMainMsisdn</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="associatedMainMsisdn" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedMainMsisdn" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedIMSI_@@_underTracingMsisdn_@@_appListActivateTracingMsisdn</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="associatedIMSI" />
                                                            <Parameter name="underTracingMsisdn" />
                                                            <Parameter name="appListActivateTracingMsisdn" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedIMSI" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>underTracingImsi_@@_appListActivateTracingImsi</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="underTracingImsi" />
                                                            <Parameter name="appListActivateTracingImsi" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedIMSI" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="mobileCountryCodeId">
                                                                <Ref name="mobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
                                                                <Ref name="mobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mSubIdentificationNumberId">
                                                                <Ref name="mSubIdentificationNumberId" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeNSTracing" name="BuildEpsTracingTargetDN">
                                                        <In>
                                                            <Parameter name="mobileCountryCodeId">
                                                                <Ref name="mobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
                                                                <Ref name="mobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mSubIdentificationNumberId">
                                                                <Ref name="mSubIdentificationNumberId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="EpsTracingTargetDN" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                        <Description>build the DN of SuMSubscriberProfile entry</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>SuMSubscriberProfile_DN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_SuMSubscriberProfile">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Get applist of DN_SuMSubscriberProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>appListActivateTracing_@@_underTracing</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="appListActivateTracing" />
                                                            <Parameter name="underTracing" />
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="RT_LTE_Flag">
                                                        <Val>false</Val>
                                                    </Set>
                                                    <Set name="LTE_flag">
                                                        <Val>false</Val>
                                                    </Set>
                                                    <If>
                                                        <OR>
                                                            <Condition operator="eq">
                                                                <Ref name="underTracing" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="underTracingImsi" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="underTracingMsisdn" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </OR>
                                                        <Then>
                                                            <Foreach name="iter_appList">
                                                                <MultiValue>
                                                                    <Ref name="appListActivateTracing" />
                                                                </MultiValue>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="RT_LTE_Flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>RT-LTEHSS</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>OAM-LTEHSS</Val>
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <Set name="LTE_flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                            </Foreach>
                                                            <Foreach name="iter_appList">
                                                                <MultiValue>
                                                                    <Ref name="appListActivateTracingImsi" />
                                                                </MultiValue>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="RT_LTE_Flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>RT-LTEHSS</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>OAM-LTEHSS</Val>
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <Set name="LTE_flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                            </Foreach>
                                                            <Foreach name="iter_appList">
                                                                <MultiValue>
                                                                    <Ref name="appListActivateTracingMsisdn" />
                                                                </MultiValue>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="iter_appList" />
                                                                        <Val>RT-LTEHSS</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="RT_LTE_Flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>RT-LTEHSS</Val>
                                                                        </Condition>
                                                                        <Condition operator="eq">
                                                                            <Ref name="iter_appList" />
                                                                            <Val>OAM-LTEHSS</Val>
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <Set name="LTE_flag">
                                                                            <Val>true</Val>
                                                                        </Set>
                                                                        <Break />
                                                                    </Then>
                                                                </If>
                                                            </Foreach>
                                                        </Then>
                                                    </If>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="LTE_flag" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.ConfigurationData.*.BeGDMI" name="existEntry">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="EpsTracingTargetDN" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="existEntry">
                                                                        <Ref name="__BOOL" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="RT_LTE_Flag" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <Remove name="appListActivateTracingEps" />
                                                                    <Set name="appListActivateTracingEps">
                                                                        <MultiValue>
                                                                            <Val>NONE</Val>
                                                                        </MultiValue>
                                                                    </Set>
                                                                    <Remove name="tracingSubProfileIdEPS" />
                                                                    <Set name="tracingSubProfileIdEPS">
                                                                        <Null />
                                                                    </Set>
                                                                    <Remove name="tracingMSISDN" />
                                                                    <Set name="tracingMSISDN">
                                                                        <Null />
                                                                    </Set>
                                                                    <CallBE name="modify" entityName="HSS.ConfigurationData.*.BeGDMI">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="EpsTracingTargetDN" />
                                                                            </Parameter>
                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                <Val>EpsTracingTarget_DN</Val>
                                                                            </Parameter>
                                                                            <Parameter name="appListActivateTracingEps" />
                                                                            <Parameter name="tracingSubProfileIdEPS" />
                                                                            <Parameter name="tracingMSISDN" />
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                                <Else>
                                                                    <CallBE name="delete" entityName="HSS.ConfigurationData.*.BeGDMI">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="EpsTracingTargetDN" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Else>
                                                            </If>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!--end for feature 73024 -->
<!-- Begin Feature 66933-->
<!--if the subscriber is member of multi-sim, then deletion is not allowed. -->
                                            <If>
                                                <AND>
<!-- beg SDMA01FAG279379 by Wayne -->
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="subscriberType" />
                                                        <Val>SHARED_SUBS</Val>
                                                    </Condition>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="subscriberType" />
                                                        <Val>SHARED_SUBS_SLAVE</Val>
                                                    </Condition>
<!-- end SDMA01FAG279379 by Wayne -->
                                                    <Condition operator="eq">
                                                        <Ref name="multiSimMember" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="21">
                                                            <Frame FrameId="12019" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
<!--End Feature 66933-->
<!-- 
                        ***************************************************************************************
                        *   3.3   Query on  Entry SubscriberNumber of mainMSISDN
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query on Entry SubscriberNumber</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedMainMsisdn" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
<!--begin modify for 66935, wangying-->
                                                        <Val>associatedIMSI_@@_associatedBasicServices_@@_associatedSubscriptionProfile_@@_associatedIMSINumber</Val>
<!--end modify for 66935, wangying-->
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <AllParameters />
                                                </Out>
                                            </CallBE>
<!--begin add for 66935, wangying-->
<!--if associatedIMSINumber has value and greater than 0, throw exception.-->
                                            <If>
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="associatedIMSINumber" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="greater">
                                                        <Ref name="associatedIMSINumber" />
                                                        <Val>0</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <ThrowException>
                                                        <Error ErrorId="31">
                                                            <Frame FrameId="12135" />
                                                        </Error>
                                                    </ThrowException>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
<!--end add for 66935, wangying-->
<!-- 
                        ***************************************************************************************
                        *   3.4   Query on  Entry MSubIdentificationNumber
                        *************************************************************************************** -->
<!-- Add by wupingfan.-->
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                    <If>
                                        <Condition operator="setLessOrEqual">
                                            <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                            <Null />
                                        </Condition>
                                        <Then>
                                            <Set name="roaming_Imsi">
                                                <Ref name="associatedIMSI" />
                                            </Set>
                                        </Then>
                                        <Else>
                                            <Set name="roaming_Imsi">
                                                <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                            </Set>
                                        </Else>
                                    </If>
                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                        <Description>Query on Entry MSubIdentificationNumber</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="roaming_Imsi" />
                                            </Parameter>
                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                <Val>associatedMSISDN_@@_vlrIsdn_@@_sgsnIsdn_@@_aaaIdentity_@@_non3gppIpAccRegStatus_@@_mmeIdentity_@@_uePurgedInMme_@@_localMobileStationIdentity_@@_waitingGgsn_@@_visitedSgsnPlmnId_@@_sgsnIdentity_@@_msStatusInPS_@@_s6aULRFlags_@@_s6dULRFlags</Val>
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
<!--Modify by pomykala for FFRD72989 on 20120404-->
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="associatedMSISDN">
                                                <Ref name="associatedMSISDN" />
                                            </Parameter>
                                            <Parameter name="vlrIsdn">
                                                <Ref name="vlrIsdn" />
                                            </Parameter>
                                            <Parameter name="sgsnIsdn">
                                                <Ref name="sgsnIsdn" />
                                            </Parameter>
                                            <Parameter name="aaaIdentity">
                                                <Ref name="aaaIdentity" />
                                            </Parameter>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                            <Parameter name="non3gppIpAccRegStatus">
                                                <Ref name="non3gppIpAccRegStatus" />
                                            </Parameter>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                            <Parameter name="mmeIdentity">
                                                <Ref name="mmeIdentity" />
                                            </Parameter>
                                            <Parameter name="uePurgedInMme">
                                                <Ref name="uePurgedInMme" />
                                            </Parameter>
                                            <Parameter name="localMobileStationIdentity">
                                                <Ref name="localMobileStationIdentity" />
                                            </Parameter>
                                            <Parameter name="waitingGgsn">
                                                <Ref name="waitingGgsn" />
                                            </Parameter>
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                            <Parameter name="visitedSgsnPlmnId">
                                                <Ref name="visitedSgsnPlmnId" />
                                            </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                            <Parameter name="sgsnIdentity">
                                                <Ref name="sgsnIdentity" />
                                            </Parameter>
                                            <Parameter name="s6aULRFlags">
                                                <Ref name="s6aULRFlags" />
                                            </Parameter>
                                            <Parameter name="s6dULRFlags">
                                                <Ref name="s6dULRFlags" />
                                            </Parameter>
                                            <Parameter name="msStatusInPS">
                                                <Ref name="msStatusInPS" />
                                            </Parameter>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                        </Out>
                                    </CallBE>
<!-- 
                        ***************************************************************************************
                        *   3.5   Prepare CREQ message
                        *************************************************************************************** -->
                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                        <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="associatedIMSI" />
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                            <Parameter name="mobileCountryCodeId">
                                                <Ref name="mobileCountryCodeId" />
                                            </Parameter>
                                            <Parameter name="mobileNetworkCodeId">
                                                <Ref name="mobileNetworkCodeId" />
                                            </Parameter>
                                            <Parameter name="mSubIdentificationNumberId">
                                                <Ref name="mSubIdentificationNumberId" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                        <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link roaming_Imsi</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="roaming_Imsi" />
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                            <Parameter name="roam_mobileCountryCodeId">
                                                <Ref name="mobileCountryCodeId" />
                                            </Parameter>
                                            <Parameter name="roam_mobileNetworkCodeId">
                                                <Ref name="mobileNetworkCodeId" />
                                            </Parameter>
                                            <Parameter name="roam_mSubIdentificationNumberId">
                                                <Ref name="mSubIdentificationNumberId" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
<!-- NGHLR1CAG199081 added queryed parameter in PostCommitBeContext-->
                                    <CallBE name="getInterceptedPara" entityName="HSS.SUB.Subscription.BeSubInterception">
                                        <In>
                                            <Parameter name="queryIMSI">
                                                <Ref name="associatedIMSI" />
                                            </Parameter>
                                        </In>
                                        <Out />
                                    </CallBE>
<!-- NGHLR1CAG199081 end -->
                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                        <Description>Save IMSI</Description>
                                        <In>
                                            <Parameter name="mobileCountryCodeId">
                                                <Ref name="roam_mobileCountryCodeId" />
                                            </Parameter>
                                            <Parameter name="mobileNetworkCodeId">
                                                <Ref name="roam_mobileNetworkCodeId" />
                                            </Parameter>
                                            <Parameter name="mSubIdentificationNumberId">
                                                <Ref name="roam_mSubIdentificationNumberId" />
                                            </Parameter>
                                            <Parameter name="vlrIsdn" />
                                            <Parameter name="sgsnIsdn" />
                                            <Parameter name="aaaIdentity" />
                                            <Parameter name="non3gppIpAccRegStatus" />
<!--Modify by Guangli for SDMA01FAG255718 on 20100521-->
                                            <Parameter name="mmeIdentity" />
                                            <Parameter name="uePurgedInMme" />
                                            <Parameter name="localMobileStationIdentity" />
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                            <Parameter name="visitedSgsnPlmnId" />
<!--Add end by pomykala for FFRD72989 on 20120404-->
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                            <Parameter name="sgsnIdentity" />
                                            <Parameter name="s6aULRFlags" />
                                            <Parameter name="s6dULRFlags" />
                                            <Parameter name="msStatusInPS" />
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                        </In>
                                        <Out />
                                    </CallBE>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
<!-- End by wupingfan.-->
<!-- ***SubInterception  SDMA01FAG216204*** NGHLR1FAG205458 begin for subscriber delete-->
<!--***Begin SDMA01FAG225095***-->
<!-- Comment for 67807 -->
<!--
                        <CallBE entityName="HSS.ContractData.*.BeGDMI" name="existEntry">
                            <Description> Be Exist Entry</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Val>contractInterceptionId=1,contractDataId=1,customizationFunctionId=1,managedElementId=HSS1</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="existEntry">
                                    <Ref name="__BOOL"/>
                                </Parameter>
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="existEntry"/>
                                <Val>true</Val>
                            </Condition>
                            <Then>-->
                                    <If>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="interceptedEventTypes" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractInterception" />
                                            <Val>SUBS_INFO_CHANGE</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getInterceptionIdentity">
                                                <Description>-get all interception identities of the subscriber specified</Description>
                                                <In />
                                                <Out>
                                                    <Parameter name="interceptedIdentityList" />
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="setGreater">
                                                    <Ref name="interceptedIdentityList" />
                                                    <Null />
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getNumberofInterception">
                                                        <In />
                                                        <Out>
                                                            <Parameter name="numberOfInterceptedIdentities">
                                                                <Ref name="numberOfInterceptedIdentities" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="subRemovalList">
                                                        <MultiValue>
                                                            <Ref name="subRemovalList" />
                                                            <Ref name="interceptedIdentityList" />
                                                        </MultiValue>
                                                    </Set>
                                                    <Set name="numberOfSubRemovalList">
                                                        <Ref name="numberOfInterceptedIdentities" />
                                                    </Set>
                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                        <Description>- Put underInterception into postCommitContext</Description>
                                                        <In>
                                                            <Parameter name="underInterception">
                                                                <Val>true</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
<!--            
                                        <Set name="__JUST_AFTER_COMMIT">
                                            <Val>justAfterCommit</Val>
                                        </Set>
                                        -->
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
<!-- Comment for 67807
                            </Then>
                        </If>
                                End of COmment for 67807 -->
<!-- ***SubInterception  SDMA01FAG216204*** NGHLR1FAG205458 end for subscriber delete-->
<!--begin add for 66935, wangying-->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="deleteSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
<!--end add for 66935, wangying-->
<!-- 
                        ***************************************************************************************
                        *   3.6   Delete LINK IMSI 
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>build autoImsiChange-DN</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>AutoImsiChange_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="mobileCountryCodeId">
                                                        <Ref name="mobileCountryCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mobileNetworkCodeId">
                                                        <Ref name="mobileNetworkCodeId" />
                                                    </Parameter>
                                                    <Parameter name="mSubIdentificationNumberId">
                                                        <Ref name="mSubIdentificationNumberId" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Description>associatedIMSI valorized</Description>
                                                    <Parameter name="linkOldIMSI_DN">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if linkOldIMSI_DN exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="linkOldIMSI_DN" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>query linkOldIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="linkOldIMSI_DN" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>imsiStatus_@@_linkToOtherIMSI_@@_dateOfLinkCreation</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="imsiStatus">
                                                                <Ref name="imsiStatus" />
                                                            </Parameter>
                                                            <Parameter name="linkToOtherIMSI">
                                                                <Ref name="linkToOtherIMSI" />
                                                            </Parameter>
                                                            <Parameter name="dateOfLinkCreation">
                                                                <Ref name="dateOfLinkCreation" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>query new imsi</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="linkToOtherIMSI" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="newMobileCountryCodeId">
                                                                <Ref name="mobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="newMobileNetworkCodeId">
                                                                <Ref name="mobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="newMSubIdentificationNumberId">
                                                                <Ref name="mSubIdentificationNumberId" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>build autoImsiChange-DN</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>AutoImsiChange_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId">
                                                                <Ref name="newMobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
                                                                <Ref name="newMobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mSubIdentificationNumberId">
                                                                <Ref name="newMSubIdentificationNumberId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>associatedIMSI valorized</Description>
                                                            <Parameter name="linkNewIMSI_DN">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>build newImsi-DN</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>MSubIdentificationNumber_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="mobileCountryCodeId">
                                                                <Ref name="newMobileCountryCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
                                                                <Ref name="newMobileNetworkCodeId" />
                                                            </Parameter>
                                                            <Parameter name="mSubIdentificationNumberId">
                                                                <Ref name="newMSubIdentificationNumberId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>associatedIMSI valorized</Description>
                                                            <Parameter name="newIMSI_DN">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!-- ***SubInterception SDMA01FAG216204*** NGHLR1FAG205458 begin for subscriber delete-->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>- query the testNewImsi under linkNewIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="linkNewIMSI_DN" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>testNewImsi</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="testNewImsi">
                                                                <Ref name="testNewImsi" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="testNewImsi" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="subRemovalList">
                                                                <MultiValue>
                                                                    <Ref name="subRemovalList" />
                                                                    <Ref name="newIMSI_DN" />
                                                                </MultiValue>
                                                            </Set>
                                                            <Set name="MappingIncrement">
                                                                <Val>1</Val>
                                                            </Set>
                                                            <Set name="MappingOperation">
                                                                <Val>+</Val>
                                                            </Set>
                                                            <CallBE entityName="HSS.SUB.*.BeMapping" name="create">
                                                                <Description>- Incrementation of 1 of MSISDN counter</Description>
                                                                <In>
                                                                    <Parameter name="__SOURCE_NAME">
                                                                        <Val>MappingIncrement</Val>
                                                                    </Parameter>
                                                                    <Parameter name="__DESTINATION_NAME">
                                                                        <Val>numberOfSubRemovalList</Val>
                                                                    </Parameter>
                                                                    <Parameter name="__SYNTAX">
                                                                        <Val>MappingOperation</Val>
                                                                    </Parameter>
                                                                    <Parameter name="numberOfSubRemovalList" />
                                                                    <Parameter name="MappingIncrement" />
                                                                    <Parameter name="MappingOperation" />
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="numberOfSubRemovalList" />
                                                                </Out>
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!-- ***SubInterception SDMA01FAG216204*** NGHLR1FAG205458 end for subscriber delete-->
<!-- SDMA01CAG246501 begin -->
<!-- check the new IMSI DN is under tracing -->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>Get underTracingImsi of newIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="newIMSI_DN" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>underTracingImsi</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="underTracingImsi" />
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="underTracingImsi" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                                <In>
                                                                    <Parameter name="__DESTINATION_NAME">
                                                                        <Val>tracingTargetId</Val>
                                                                    </Parameter>
                                                                    <Parameter name="__SYNTAX">
                                                                        <Val>newMobileCountryCodeId-newMobileNetworkCodeId-newMSubIdentificationNumberId</Val>
                                                                    </Parameter>
                                                                    <Parameter name="newMobileCountryCodeId" />
                                                                    <Parameter name="newMobileNetworkCodeId" />
                                                                    <Parameter name="newMSubIdentificationNumberId" />
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="tracingTargetId" />
                                                                </Out>
                                                            </CallBE>
                                                            <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                <In>
                                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                                        <Val>TracingTarget_DN</Val>
                                                                    </Parameter>
                                                                    <Parameter name="tracingTargetId" />
                                                                    <Parameter name="targetTypeId">
                                                                        <Val>IMSI</Val>
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="removeTracing_DN">
                                                                        <Ref name="__DISTINGUISH_NAME" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                            <Set name="removeTracing">
                                                                <MultiValue>
                                                                    <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                    <Ref name="removeTracing_DN" />
                                                                </MultiValue>
                                                            </Set>
                                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                                <In>
                                                                    <Parameter name="removeTracing" />
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                            <Set name="__JUST_AFTER_COMMIT">
                                                                <Val>justAfterCommit</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
<!-- SDMA01CAG246501 end -->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                        <Description>Delete newIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="newIMSI_DN" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                        <Description>Delete linkOldIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="linkOldIMSI_DN" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                        <Description>Delete linkNewIMSI_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="linkNewIMSI_DN" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!--begin add for 66935, wangying-->
                                        </Then>
                                    </If>
<!--end add for 66935, wangying-->
<!-- ***SubInterception  SDMA01FAG216204*** NGHLR1FAG205458 begin for subscriber delete-->
                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                        <Description>- Put subRemovalList and numberOfSubRemovalList to mediation context</Description>
                                        <In>
                                            <Parameter name="subRemovalList" />
                                            <Parameter name="numberOfSubRemovalList" />
                                        </In>
                                        <Out />
                                    </CallBE>
                                    <Set name="__JUST_AFTER_COMMIT">
                                        <Val>justAfterCommit</Val>
                                    </Set>
<!-- SDMA01CAG246501 begin -->
                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                        <Description>- Put interceptionCommit into postCommitContext</Description>
                                        <In>
                                            <Parameter name="interceptionCommit">
                                                <Val>true</Val>
                                            </Parameter>
                                        </In>
                                        <Out />
                                    </CallBE>
<!-- SDMA01CAG246501 end -->
<!-- ***SubInterception  SDMA01FAG216204*** NGHLR1FAG205458 end for subscriber delete-->
<!--
                        ***************************************************************************************
                        *   set deleteFromBasicflag
                        *************************************************************************************** -->
<!--
                        <Set name="deleteFromBasicflag">
                            <Val>true</Val>
                        </Set>
                        <CallBE entityName="PostCommitBeContext" name="modify">
                            <In>
                                <Parameter name="deleteFromBasicflag">
                                    <Ref name="deleteFromBasicflag"/>
                                </Parameter>
                            </In>
                            <Out/>
                        </CallBE>
                        -->
<!--begin add for 66935, wangying-->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="deleteSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
<!--end add for 66935, wangying-->
<!-- 
                        ***************************************************************************************
                        *   3.7   Call Roaming deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN RoamingGsmServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>RoamingGsmServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN RoamingGsmServiceProfile available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.RoamingRestriction.MS_OAM_RoamingRestriction" name="delete">
                                                <Description>Delete Roaming</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
<!-- 
                        ***************************************************************************************
                        *   3.8   Call CAMEL deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN CamelServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CamelServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CamelServiceProfile available</Description>
                                                    <Parameter name="DN_CamelServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_CamelServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
<!-- NGHLR1FAG203735 modification -->
                                                    <CallBE entityName="HSS.SUB.CAMEL.CamelDeleteForBasic" name="basicDeleteCamel">
                                                        <Description>Delete Entry CamelServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="Dn_Input_CAMEL">
                                                                <Ref name="DN_CamelServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
<!-- NGHLR1FAG203735 end -->
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.9   Call Call Barring deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN CallBarringServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CallBarringServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CallBarringServiceProfile available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.SupplementaryService.BeCallBarringCreateModify" name="deleteBasicBarring">
                                                        <Description>- Delete Entry CallBarringServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.10   Call Call Forwarding deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN CallForwardingServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CallForwardingServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CallForwardingServiceProfile available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.SupplementaryService.BeBuildModifyList" name="deleteBasic">
                                                        <Description>- Delete Entry CallForwardingServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.11  Call GCS deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN GeneralCallServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>GeneralCallServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN GeneralCallServiceProfile available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.SupplementaryService.MS_OAM_SUP_GCS" name="delete">
                                                        <Description>- Delete Entry CallForwardingServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.12  Call CUG deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN ClosedUserGroupProfile_DN available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>ClosedUserGroupProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN ClosedUserGroupProfile_DN available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_Cug" name="delete">
                                                        <Description>- Delete Entry ClosedUserGroupProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.12.1  Call LCS deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN LcsServiceProfile_DN available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>LcsServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN LcsServiceProfile_DN available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.LCS.LCS_OAM_LCSSubscription" name="delete">
                                                        <Description>Delete Entry LcsServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.12.2  Call eMLPP deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>EMLPPServiceProfile_DN available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>EMLPPServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>EMLPPServiceProfile_DN available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_eMLPP" name="delete">
                                                        <Description>Delete Entry eMLPPServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.12.1  Call CallTrace deletion
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN CallTraceServiceProfile_DN available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CallTraceServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CallTraceServiceProfile_DN available</Description>
                                                    <Parameter name="DN_ServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.CallTraceService.MS_OAM_CallTrace" name="delete">
                                                        <Description>Delete Entry CallTraceService</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_ServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!--***************************************************************************************
                        *   4.23  LCN service delete            67394   
                            *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                <Description>LcnService_DN available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>LcnService_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="gsmServiceProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="suMSubscriberProfileId" />
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_LcnService">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_LcnService" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                        <Description>LcnService_DN available</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_LcnService" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- Add begin by fucong for 70018 on 20100729 -->
                                            <Set name="DN_GsmSuppServiceProfile">
                                                <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN">
                                                    <In>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                </Ref>
                                            </Set>
<!--If>
                                        <Condition operator="eq">
                                            <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfile" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then-->
<!--Add for DB roundtrip optimizaiton begin-->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_GsmSuppServiceProfile" />
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
<!--Add for DB roundtrip optimizaiton end-->
                                                    <Set name="csgLinkList">
                                                        <Ref name="csgLinkList" entityName="gdmiContext" DN="DN_GsmSuppServiceProfile" />
                                                    </Set>
                                                    <If>
                                                        <Condition operator="setGreater">
                                                            <Ref name="csgLinkList" />
                                                            <Null />
                                                        </Condition>
                                                        <Then>
                                                            <Foreach name="csgLinkListElement">
                                                                <MultiValue>
                                                                    <Ref name="csgLinkList" />
                                                                </MultiValue>
                                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                    <Description>Delete the current csg service profile</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="csgLinkListElement" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Foreach>
                                                        </Then>
                                                    </If>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                        <Description>Delete the Gsm supp service profile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_GsmSuppServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- Add begin by xiaozhxu for 68733 on 20100729 -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <Set name="DN_GsmSuppServiceProfile">
                                                        <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                                    </Set>
<!---If>
                                                <Condition operator="eq">
                                                    <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfile" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then-->
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_GsmSuppServiceProfile" />
                                                            </Parameter>
                                                            <Parameter name="__NO_DB_EXCHANGE">
                                                                <Val>true</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
<!--Add for DB roundtrip optimizaiton end-->
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete on Entry GsmSuppServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_GsmSuppServiceProfile" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!-- Add end by xiaozhxu for 68733 on 20100729 -->
<!-- 
                        ***************************************************************************************
                        *   3.12.3  Call MdtDomain deletion, add by zhao nannan for 71037 begin 
                        *************************************************************************************** -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="fEPS111" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>DN MdtDomain_DN available</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>MdtDomain_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                            <Parameter name="suMSubscriptionProfileId" />
                                                            <Parameter name="gsmServiceProfileId" />
                                                            <Parameter name="mdtDomainId">
                                                                <Val>EPS</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>DN MdtDomain available</Description>
                                                            <Parameter name="DN_MdtDomain">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MdtDomain" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="delete">
                                                                <Description>Delete Entry MdtDomain</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MdtDomain" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                                <In>
                                                                    <Parameter name="DN_MdtDomain" />
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>DN MdtDomain_DN available</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>MdtDomain_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                            <Parameter name="suMSubscriptionProfileId" />
                                                            <Parameter name="gsmServiceProfileId" />
                                                            <Parameter name="mdtDomainId">
                                                                <Val>PS</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>DN MdtDomain available</Description>
                                                            <Parameter name="DN_MdtDomain">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MdtDomain" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="delete">
                                                                <Description>Delete Entry MdtDomain</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MdtDomain" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>DN MdtDomain_DN available</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>MdtDomain_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                            <Parameter name="suMSubscriptionProfileId" />
                                                            <Parameter name="gsmServiceProfileId" />
                                                            <Parameter name="mdtDomainId">
                                                                <Val>CS</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>DN MdtDomain available</Description>
                                                            <Parameter name="DN_MdtDomain">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_MdtDomain" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existEntry">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="delete">
                                                                <Description>Delete Entry MdtDomain</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_MdtDomain" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
<!--    ***************************************************************************************
                        *   3.13  Delete CsServiceProfile if exists
                        *************************************************************************************** -->
<!--SDMA01CAG272598 begin Robin 20111125-->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>- DN CsServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CsServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <Parameter name="DN_CsServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_CsServiceProfile" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!--SDMA01CAG272598 end Robin 20111125-->
                                            <If>
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                    </Condition>
                                                </OR>
                                                <Then>
<!--begin for dual logic by guowei guowei in F70186 -->
<!--begin SDMA01FAG263726-->
<!-- call searchTwinImsi to update all the IMSIs for Twin-IMSI cases.  -->
                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="searchTwinImsi">
                                                        <In>
                                                            <Parameter name="imsi_Start">
                                                                <Ref name="associatedIMSI" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="twin_Imsi_List" />
                                                        </Out>
                                                    </CallBE>
<!--intg_r41_wayne_bjForeach name="imsi_Start">
                              <MultiValue>
                                  <Ref name="twin_Imsi_List" />
                              </MultiValue-->
                                                    <If>
                                                        <AND>
                                                            <Condition operator="neq">
                                                                <Ref name="Upgradeflag" />
                                                                <Val>Commit</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="Upgradeflag31" />
                                                                <Val>Commit</Val>
                                                            </Condition>
                                                        </AND>
                                                        <Then>
<!-- raz GsmSubscriberRoamingData on mSubIdentificationNumber -->
                                                            <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedIMSI" />
                                                                    </Parameter>
                                                                    <Parameter name="roamingRestrictionFlags">
                                                                        <Null />
                                                                    </Parameter>
<!--add for 70200 -->
                                                                    <Parameter name="roamingRestrictionFlagsOld">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmNegocCamelPhasesOld">
                                                                        <Null />
                                                                    </Parameter>
<!--end add for 70200 -->
                                                                    <Parameter name="vlrUpdateFlag">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="roamingCharactsFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="flagCffPlmn">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="supOfLocRegCount">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="locRegSubsPeriod">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmCamelPhaseOld">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmCamelPhase">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmNegocCamelPhases">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="odbUnsuppFeaturesFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="vlrIsdn">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="mscIsdn">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="inducedCbocBsg">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="inducedCboiBsg">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="inducedCboehBsg">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="localMobileStationIdentity">
                                                                        <Null />
                                                                    </Parameter>
<!-- FR NGHLR1FAG147507 -->
                                                                    <Parameter name="gsmNotReachableSMSFlag">
                                                                        <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                    </Parameter>
                                                                    <Parameter name="gsmNotReachableReason">
                                                                        <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                    </Parameter>
                                                                    <Parameter name="memoryCapacityExceededFlag">
                                                                        <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                    </Parameter>
<!-- FR NGHLR1FAG147507 -->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                    <Parameter name="inducedGsmSMSBAR">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gsmNegocCamelPhasesExt">
                                                                        <Null />
                                                                    </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                        <Else>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="Upgradeflag" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                    <Condition operator="neq">
                                                                        <Ref name="Upgradeflag31" />
                                                                        <Val>Commit</Val>
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="associatedIMSI" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingRestrictionFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCharactsFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="flagCffPlmn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="supOfLocRegCount">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="locRegSubsPeriod">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhaseOld">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="odbUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="mscIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCbocBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboiBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboehBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="localMobileStationIdentity">
                                                                                <Null />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507 -->
                                                                            <Parameter name="gsmNotReachableSMSFlag">
                                                                                <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNotReachableReason">
                                                                                <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="memoryCapacityExceededFlag">
                                                                                <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507 -->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGsmSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                                <Else>
                                                                    <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="associatedIMSI" />
                                                                            </Parameter>
                                                                            <Parameter name="roamingRestrictionFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrUpdateFlag">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="roamingCharactsFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="flagCffPlmn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="supOfLocRegCount">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="locRegSubsPeriod">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmCamelPhase">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhases">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="odbUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrBasServUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrGenUnsuppFeaturesFlags">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="vlrIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="mscIsdn">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCbocBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboiBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="inducedCboehBsg">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="localMobileStationIdentity">
                                                                                <Null />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507 -->
                                                                            <Parameter name="gsmNotReachableSMSFlag">
                                                                                <Ref name="gsmNotReachableSMSFlag" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNotReachableReason">
                                                                                <Ref name="gsmNotReachableReason" defaultValue="force" />
                                                                            </Parameter>
                                                                            <Parameter name="memoryCapacityExceededFlag">
                                                                                <Ref name="memoryCapacityExceededFlag" defaultValue="force" />
                                                                            </Parameter>
<!-- FR NGHLR1FAG147507 -->
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                            <Parameter name="inducedGsmSMSBAR">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmOfferedCAMEL4CSIs">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="gsmNegocCamelPhasesExt">
                                                                                <Null />
                                                                            </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Else>
                                                            </If>
                                                        </Else>
                                                    </If>
<!--intg_r41_wayne_bj/Foreach-->
<!--end SDMA01FAG263726-->
<!--end for dual logic by guowei in F70186 -->
<!--end for 70200-->
<!-- SDMA01CAG272598 
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>- DN CsServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>CsServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <Parameter name="DN_CsServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
            -->
                                                    <Set name="deleteCSProfile">
                                                        <Val>true</Val>
                                                    </Set>
<!-- beg intg_r41_wayne_bj -->
                                                    <If>
                                                        <Condition operator="notNullIntersection">
                                                            <Ref name="subscriberType" />
                                                            <Val>SHARED_SUBS_SLAVE</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE name="delete" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>Delete Entry CSServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_CsServiceProfile" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                        <Else>
                                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSServiceProfile" name="delete">
                                                                <Description>- Delete Entry CsServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_CsServiceProfile" />
                                                                    </Parameter>
<!--SDMA01CAG272598 start Robin 20111125-->
                                                                    <Parameter name="deleteCSProfile" />
<!--SDMA01CAG272598 start Robin 20111125-->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Else>
                                                    </If>
<!-- end intg_r41_wayne_bj -->
                                                </Then>
<!--SDMA01CAG272598 start Robin 20111125-->
                                                <Else>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE name="delete" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>Delete Entry CSServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_CsServiceProfile" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Else>
<!--SDMA01CAG272598 end Robin 20111125-->
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.14  Delete PsServiceProfile if exists
                        *************************************************************************************** -->
<!--SDMA01CAG272598 start Robin 20111125-->
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN PsServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>PsServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN PsServiceProfile available</Description>
                                                    <Parameter name="DN_PsServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_PsServiceProfile" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="existEntry">
                                                        <Ref name="__BOOL" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
<!--SDMA01CAG272598 end Robin 20111125-->
<!--add begin for SDMA01FAG277891 -->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="existEntry" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="query">
                                                        <Description>Query Entry PsServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_PsServiceProfile" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="epsServiceProfile" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                        <Description>Save epsServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="epsServiceProfile" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
                                            </If>
<!--end for SDMA01FAG277891-->
                                            <If>
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                    </Condition>
                                                </OR>
                                                <Then>
<!-- raz GprsSubscriberRoamingData on mSubIdentificationNumber -->
<!--begin for dual logic by guowei in F70186-->
<!-- call searchTwinImsi to update all the IMSIs for Twin-IMSI cases.  -->
                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="searchTwinImsi">
                                                        <In>
                                                            <Parameter name="imsi_Start">
                                                                <Ref name="associatedIMSI" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="twin_Imsi_List" />
                                                        </Out>
                                                    </CallBE>
<!--intg_r41_wayne_bjForeach name="imsi_Start">
                              <MultiValue>
                                  <Ref name="twin_Imsi_List" />
                              </MultiValue-->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="Upgradeflag31" />
                                                            <Val>Commit</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>- Modify Entry MSubIdentificationNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedIMSI" />
                                                                    </Parameter>
                                                                    <Parameter name="roamingCapabilityFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnUpdateFlag">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsEnhancementIndicator">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnGenUnsuppFeaturesFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsCamelPhaseOld">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsCamelPhase">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNegocCamelPhases">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnRoamingRestriction">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNotReachableFlag">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNotReachableReason">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnIsdn">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnIp">
                                                                        <Null />
                                                                    </Parameter>
<!--FFRD-72989-316 begin-->
                                                                    <Parameter name="visitedSgsnPlmnId">
                                                                        <Null />
                                                                    </Parameter>
<!--FFRD-72989-316 end-->
                                                                    <Parameter name="transferOfSmOption">
                                                                        <Null />
                                                                    </Parameter>
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                    <Parameter name="inducedGprsSMSBAR">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsOfferedCAMEL4CSIs">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNegocCamelPhasesExt">
                                                                        <Null />
                                                                    </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                        <Else>
                                                            <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>- Modify Entry MSubIdentificationNumber</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="associatedIMSI" />
                                                                    </Parameter>
                                                                    <Parameter name="roamingCapabilityFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnUpdateFlag">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsEnhancementIndicator">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnGenUnsuppFeaturesFlags">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsCamelPhase">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNegocCamelPhases">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnRoamingRestriction">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNotReachableFlag">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNotReachableReason">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnIsdn">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="sgsnIp">
                                                                        <Null />
                                                                    </Parameter>
<!--FFRD-72989-316 begin-->
                                                                    <Parameter name="visitedSgsnPlmnId">
                                                                        <Null />
                                                                    </Parameter>
<!--FFRD-72989-316 end-->
                                                                    <Parameter name="transferOfSmOption">
                                                                        <Null />
                                                                    </Parameter>
<!-- Start 70186 By ZHANG WEICHAO -->
                                                                    <Parameter name="inducedGprsSMSBAR">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsOfferedCAMEL4CSIs">
                                                                        <Null />
                                                                    </Parameter>
                                                                    <Parameter name="gprsNegocCamelPhasesExt">
                                                                        <Null />
                                                                    </Parameter>
<!-- End 70186 By ZHANG WEICHAO -->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Else>
                                                    </If>
<!--intg_r41_wayne_bj/Foreach-->
<!--end for dual logic by guowei in F70186-->
<!-- SDMA01CAG272598  
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                <Description>DN PsServiceProfile available</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>PsServiceProfile_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="suMSubscriberProfileId" />
                                                    <Parameter name="suMSubscriptionProfileId" />
                                                    <Parameter name="gsmServiceProfileId" />
                                                </In>
                                                <Out>
                                                    <Description>DN PsServiceProfile available</Description>
                                                    <Parameter name="DN_PsServiceProfile">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
            -->
                                                    <Set name="deletePSProfile">
                                                        <Val>true</Val>
                                                    </Set>
                                                    <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="delete">
                                                        <Description>Delete Entry PsServiceProfile</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_PsServiceProfile" />
                                                            </Parameter>
<!--SDMA01CAG272598 start Robin 20111125-->
                                                            <Parameter name="deletePSProfile" />
<!--SDMA01CAG272598 end Robin 20111125-->
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                </Then>
<!--SDMA01CAG272598 start Robin 20111125-->
                                                <Else>
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                <Description>Delete the Entry PSServiceProfile</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_PsServiceProfile" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out>
                                                                    <AllParameters />
                                                                </Out>
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Else>
<!--SDMA01CAG272598 end Robin 20111125-->
                                            </If>
<!-- 
                        ***************************************************************************************
                        *   3.15  Delete on  Entry SuMSubscriptionProfile 
                        *************************************************************************************** -->
<!-- <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                            <Description>        Delete on  Entry SuMSubscriptionProfile       </Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedSubscriptionProfile"/>
                                </Parameter>
                            </In>
                            <Out/>
                        </CallBE> -->
<!--begin add for 66935, wangying-->
                                        </Then>
                                    </If>
<!--end add for 66935, wangying-->
<!-- 
                        ***************************************************************************************
                        *   3.15.1  Delete on  Entry Add Serivce Data (67386) 
                        *************************************************************************************** -->
<!--<CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedIMSI"/>
                                </Parameter>
                            </In>
                            <Out>
                                <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                                <Parameter name="mobileCountryCodeId">
                                    <Ref name="mobileCountryCodeId"/>
                                </Parameter>
                                <Parameter name="mobileNetworkCodeId">
                                    <Ref name="mobileNetworkCodeId"/>
                                </Parameter>
                                <Parameter name="mSubIdentificationNumberId">
                                    <Ref name="mSubIdentificationNumberId"/>
                                </Parameter>
                            </Out>
                        </CallBE> -->
                                    <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                        <Description>- build addServiceData DN</Description>
                                        <In>
                                            <Parameter name="__DN_SYNTAX_NAME">
                                                <Val>AddServiceData_DN</Val>
                                            </Parameter>
                                            <Parameter name="mobileCountryCodeId">
                                                <Ref name="mobileCountryCodeId" />
                                            </Parameter>
                                            <Parameter name="mobileNetworkCodeId">
                                                <Ref name="mobileNetworkCodeId" />
                                            </Parameter>
                                            <Parameter name="mSubIdentificationNumberId">
                                                <Ref name="mSubIdentificationNumberId" />
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="DN_ServiceProfile">
                                                <Ref name="__DISTINGUISH_NAME" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <CallBE entityName="HSS.LOC.*.BeGDMI" name="existEntry">
                                        <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="DN_ServiceProfile" />
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                            <Parameter name="__NO_DB_EXCHANGE">
                                                <Val>true</Val>
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                        </In>
                                        <Out>
                                            <Parameter name="existEntry">
                                                <Ref name="__BOOL" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="existEntry" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.LOC.ADD.LOC_OAM_ADD" name="delete">
                                                <Description>Delete Entry Add Service Data</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ServiceProfile" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
                                        </Then>
                                    </If>
<!-- begin 69781,yunqingg -->
                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                        <Description>- build ExtendedMWD DN</Description>
                                        <In>
                                            <Parameter name="__DN_SYNTAX_NAME">
                                                <Val>ExtendedMWD_DN</Val>
                                            </Parameter>
                                            <Parameter name="mobileCountryCodeId">
                                                <Ref name="mobileCountryCodeId" />
                                            </Parameter>
                                            <Parameter name="mobileNetworkCodeId">
                                                <Ref name="mobileNetworkCodeId" />
                                            </Parameter>
                                            <Parameter name="mSubIdentificationNumberId">
                                                <Ref name="mSubIdentificationNumberId" />
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="DN_ExtendedMWD">
                                                <Ref name="__DISTINGUISH_NAME" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                        <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="DN_ExtendedMWD" />
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                            <Parameter name="__NO_DB_EXCHANGE">
                                                <Val>true</Val>
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                        </In>
                                        <Out>
                                            <Parameter name="existEntry">
                                                <Ref name="__BOOL" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="existEntry" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                <Description>Delete Entry ExtendedMWD</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_ExtendedMWD" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
                                        </Then>
                                    </If>
<!-- end 69781,yunqingg -->
<!-- 
                        ***************************************************************************************
                        *   3.16  Delete  Entry MSubIdentificationNumber
                        *************************************************************************************** -->
<!-- SDMA01CAG246501 begin -->
<!-- check the IMSI DN is under tracing -->
<!-- modified for feature 73337 to query extSubscriberIdLink.   -->
                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                        <Description>Get underTracingImsi of newIMSI_DN</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="associatedIMSI" />
                                            </Parameter>
                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                <Val>underTracingImsi_@@_extSubscriberIdLink</Val>
                                            </Parameter>
                                        </In>
                                        <Out>
                                            <Parameter name="underTracingImsi" />
                                            <Parameter name="extSubscriberIdLink" />
                                        </Out>
                                    </CallBE>
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="underTracingImsi" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                <In>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>tracingTargetId</Val>
                                                    </Parameter>
                                                    <Parameter name="__SYNTAX">
                                                        <Val>mobileCountryCodeId-mobileNetworkCodeId-mSubIdentificationNumberId</Val>
                                                    </Parameter>
                                                    <Parameter name="mobileCountryCodeId" />
                                                    <Parameter name="mobileNetworkCodeId" />
                                                    <Parameter name="mSubIdentificationNumberId" />
                                                </In>
                                                <Out>
                                                    <Parameter name="tracingTargetId" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>TracingTarget_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="tracingTargetId" />
                                                    <Parameter name="targetTypeId">
                                                        <Val>IMSI</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="removeTracing_DN">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <Set name="removeTracing">
                                                <MultiValue>
                                                    <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                    <Ref name="removeTracing_DN" />
                                                </MultiValue>
                                            </Set>
                                            <CallBE entityName="PostCommitBeContext" name="modify">
                                                <In>
                                                    <Parameter name="removeTracing" />
                                                </In>
                                                <Out />
                                            </CallBE>
                                            <Set name="__JUST_AFTER_COMMIT">
                                                <Val>justAfterCommit</Val>
                                            </Set>
                                        </Then>
                                    </If>
<!-- SDMA01CAG246501 end -->
<!-- add begin for feature 73337 -->
                                    <If>
                                        <Condition operator="setGreater">
                                            <Ref name="extSubscriberIdLink" />
                                            <Null />
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_EXTSUBINTERNAL" name="updateIMSILinkList">
                                                <In>
                                                    <Parameter name="oldIMSI_DN">
                                                        <Ref name="associatedIMSI" />
                                                    </Parameter>
                                                    <Parameter name="newIMSI_DN">
                                                        <Null />
                                                    </Parameter>
                                                    <Parameter name="extSubscriberIdLink" />
                                                </In>
                                                <Out />
                                            </CallBE>
                                        </Then>
                                    </If>
<!-- add end for feature 73337 -->
<!--NGHLR1CAG159458_2 Delete MSubIdentificationNumber instead of modify it-->
                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                        <Description>delete Entry MSubIdentificationNumber</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="associatedIMSI" />
                                            </Parameter>
                                        </In>
                                        <Out />
                                    </CallBE>
<!-- SDMA01FAG261379, Shi Qin, 2010-11-09 -->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="isMultiAppSupported" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractOam" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>query mSubIdentificationNumberId from associatedIMSI</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedIMSI" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="mSubIdentificationNumberId" />
                                                    <Parameter name="mobileNetworkCodeId" />
                                                    <Parameter name="mobileCountryCodeId" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeString" name="joinToBeAnInteger">
                                                <Description>join MCC, MNC, MSIN to be an integer type variable : imsi4EisId</Description>
                                                <In>
                                                    <Parameter name="joinParameters">
                                                        <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                    </Parameter>
                                                    <Parameter name="__DESTINATION_NAME">
                                                        <Val>pridImsi</Val>
                                                    </Parameter>
                                                    <Parameter name="mobileCountryCodeId" />
                                                    <Parameter name="mobileNetworkCodeId" />
                                                    <Parameter name="mSubIdentificationNumberId" />
                                                </In>
                                                <Out>
                                                    <Parameter name="pridImsi" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                <Description>build Imsi4Eis_DN via pridImsi</Description>
                                                <In>
                                                    <Parameter name="__DN_SYNTAX_NAME">
                                                        <Val>Imsi4Eis_DN</Val>
                                                    </Parameter>
                                                    <Parameter name="imsi4EisId">
                                                        <Ref name="pridImsi" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="DN_Imsi4Eis">
                                                        <Ref name="__DISTINGUISH_NAME" />
                                                    </Parameter>
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="__EXIST_ENTRY" DN="DN_Imsi4Eis" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>query link attribute pridLink4Eis from Imsi4Eis_DN</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_Imsi4Eis" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>pridLink4Eis</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="pridLink4Eis" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>PridIMSIAssoc_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="pridLink4Eis" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_PridIMSIAssoc">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="__EXIST_ENTRY" DN="DN_PridIMSIAssoc" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="setGreater">
                                                                <Ref name="pridToIMSILink" entityName="gdmiContext" DN="DN_PridIMSIAssoc" />
                                                                <Null />
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <CallBE name="modify" entityName="HSS.SUB.*.BeGDMI">
                                                                <Description>modify PridIMSIAssoc</Description>
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_PridIMSIAssoc" />
                                                                    </Parameter>
                                                                    <Parameter name="pridToIMSILink">
                                                                        <Null />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
<!-- SDMA01FAG261379 End, Shi Qin, 2010-11-09 -->
<!-- NGHLR1FAG191199 ,begin -->
                                    <Foreach name="waitingGgsn_DN">
                                        <MultiValue>
                                            <Ref name="waitingGgsn" />
                                        </MultiValue>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                            <Description>Delete waitingGgsn</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="waitingGgsn_DN" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Foreach>
<!-- NGHLR1FAG191199 ,end -->
<!-- For feature 67401 begin -->
<!-- Delete on  Entry UnsuccessfulLocation -->
<!-- get & check UnsuccessfulLocation_DN -->
                                    <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                        <In>
                                            <Parameter name="__DN_SYNTAX_NAME">
                                                <Val>UnsuccessfulLocation_DN</Val>
                                            </Parameter>
                                            <Parameter name="mSubIdentificationNumberId" />
                                            <Parameter name="mobileNetworkCodeId" />
                                            <Parameter name="mobileCountryCodeId" />
                                        </In>
                                        <Out>
                                            <Parameter name="Unsuccessful_DN">
                                                <Ref name="__DISTINGUISH_NAME" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
                                    <CallBE entityName="HSS.LOC.*.BeGDMI" name="existEntry">
                                        <Description>Call BeExistEntry.create to know if Unsuccessful_DN exist</Description>
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="Unsuccessful_DN" />
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                            <Parameter name="__NO_DB_EXCHANGE">
                                                <Val>true</Val>
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                        </In>
                                        <Out>
                                            <Parameter name="existEntry">
                                                <Ref name="__BOOL" />
                                            </Parameter>
                                        </Out>
                                    </CallBE>
<!-- Delete UnsuccessfulLocation_DN -->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="existEntry" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
                                            <CallBE entityName="HSS.LOC.*.BeGDMI" name="delete">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="Unsuccessful_DN" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
                                        </Then>
                                    </If>
<!-- For feature 67401 end -->
<!--begin add for 66935, wangying-->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="deleteSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
<!--end add for 66935, wangying-->
<!-- 
                        ***************************************************************************************
                        *   3.17  Delete on  Entry SubscriberNumber corresponding to assocaitedMSISIDN
                        *************************************************************************************** -->
<!-- 73118begin Wayne -->
                                            <If>
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="subscriberType" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="subscriberType" />
                                                        <Val>SHARED_SUBS_SLAVE</Val>
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="associatedMSISDN">
                                                        <Null />
                                                    </Set>
                                                </Then>
                                            </If>
<!-- 73118end Wayne -->
                                            <Foreach name="DN_MSISDN">
                                                <MultiValue>
                                                    <Ref name="associatedMSISDN" />
                                                </MultiValue>
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingMsisdn of associatedMSISDNelement -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_MSISDN" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>underTracingMsisdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="underTracingMsisdn" />
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="underTracingMsisdn" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MSISDN" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>countryCodeId_@@_nationalDestinationCodeId_@@_subscriberNumberId</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="countryCodeId" />
                                                                <Parameter name="nationalDestinationCodeId" />
                                                                <Parameter name="subscriberNumberId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                            <In>
                                                                <Parameter name="__DESTINATION_NAME">
                                                                    <Val>tracingTargetId</Val>
                                                                </Parameter>
                                                                <Parameter name="__SYNTAX">
                                                                    <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId</Val>
                                                                </Parameter>
                                                                <Parameter name="countryCodeId" />
                                                                <Parameter name="nationalDestinationCodeId" />
                                                                <Parameter name="subscriberNumberId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="tracingTargetId" />
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="convertTracingTargetId">
                                                            <In>
                                                                <Parameter name="tracingTargetId" />
                                                            </In>
                                                            <Out>
                                                                <Parameter name="tracingTargetId">
                                                                    <Ref name="msdnTracingTargetId" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>TracingTarget_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="tracingTargetId" />
                                                                <Parameter name="targetTypeId">
                                                                    <Val>MSISDN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="removeTracing_DN">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="removeTracing">
                                                            <MultiValue>
                                                                <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                <Ref name="removeTracing_DN" />
                                                            </MultiValue>
                                                        </Set>
                                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                                            <In>
                                                                <Parameter name="removeTracing" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <Set name="__JUST_AFTER_COMMIT">
                                                            <Val>justAfterCommit</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- SDMA01CAG246501 end -->
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                    <Description>Delete on Entry SubscriberNumber</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_MSISDN" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Foreach>
<!-- 
                        ***************************************************************************************
                        *   3.18  Delete on  Entry SubscriberNumber corresponding to mainMSISIDN
                        *************************************************************************************** -->
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracingMsisdn of associatedMainMsisdn -->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedMainMsisdn" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>underTracingMsisdn</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="underTracingMsisdn" />
                                                </Out>
                                            </CallBE>
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="underTracingMsisdn" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedMainMsisdn" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>countryCodeId_@@_nationalDestinationCodeId_@@_subscriberNumberId</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                                        <In>
                                                            <Parameter name="__DESTINATION_NAME">
                                                                <Val>tracingTargetId</Val>
                                                            </Parameter>
                                                            <Parameter name="__SYNTAX">
                                                                <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId</Val>
                                                            </Parameter>
                                                            <Parameter name="countryCodeId" />
                                                            <Parameter name="nationalDestinationCodeId" />
                                                            <Parameter name="subscriberNumberId" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="tracingTargetId" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.Tracing.*.BeTracingRecordComFun" name="convertTracingTargetId">
                                                        <In>
                                                            <Parameter name="tracingTargetId" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="tracingTargetId">
                                                                <Ref name="msdnTracingTargetId" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>TracingTarget_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="tracingTargetId" />
                                                            <Parameter name="targetTypeId">
                                                                <Val>MSISDN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="removeTracing_DN">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <Set name="removeTracing">
                                                        <MultiValue>
                                                            <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                            <Ref name="removeTracing_DN" />
                                                        </MultiValue>
                                                    </Set>
                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                        <In>
                                                            <Parameter name="removeTracing" />
                                                        </In>
                                                        <Out />
                                                    </CallBE>
                                                    <Set name="__JUST_AFTER_COMMIT">
                                                        <Val>justAfterCommit</Val>
                                                    </Set>
                                                </Then>
                                            </If>
<!-- SDMA01CAG246501 end -->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                <Description>Delete on Entry SubscriberNumber</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedMainMsisdn" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
<!-- 
                        ***************************************************************************************
                        *   3.18  Delete on  Entry BasicSubscription
                        *************************************************************************************** -->
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                <Description>Delete on Entry</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_BasicSubscription" />
                                                    </Parameter>
                                                </In>
                                                <Out />
                                            </CallBE>
<!-- add by BPQ begin, 20081225, for 68045 multi app
                        ***************************************************************************************
                        *   3.19  If no other subcription profile exist, delete SuMSubscriberProfile entry
                        *************************************************************************************** -->
<!-- SDMA01FAG244747 begin -->
                                            <If>
                                                <Condition operator="neq">
                                                    <Ref name="multiSIMCardReq" entityName="PostCommitBeContext" />
                                                    <Val>modify</Val>
                                                </Condition>
                                                <Then>
<!-- SDMA01FAG244747 end -->
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>build SuMSubscriberProfile DN according to suMSubscriberProfileId</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>SuMSubscriberProfile_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_SuMSubscriberProfile">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_MultiApp" name="checkSubscriptionProfileExist">
                                                        <Description>check existence of GSM and IMS subscription of the suMSubscriberProfileId</Description>
                                                        <In>
                                                            <Parameter name="DN_SuMSubscriberProfile" />
                                                            <Parameter name="associatedIMSI" />
                                                        </In>
                                                        <Out>
                                                            <Parameter name="existProfile">
                                                                <Ref name="__BOOL" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
<!--  70719, zeyangy, 2010-08-23, begin-->
                                                    <Set name="existEntry">
                                                        <Val>true</Val>
                                                    </Set>
                                                    <CallBE name="getR21upgradeflag" entityName="HSS.SUB.*.BeUpgradeFlag">
                                                        <Description>get getR21upgradeflag</Description>
                                                        <Out>
                                                            <Parameter name="Upgradeflag2" />
                                                        </Out>
                                                    </CallBE>
                                                    <If>
                                                        <OR>
                                                            <Condition operator="eq">
                                                                <Ref name="Upgradeflag2" />
                                                                <Val>Old</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="Upgradeflag2" />
                                                                <Val>Converting</Val>
                                                            </Condition>
                                                        </OR>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                                <In>
                                                                    <Parameter name="__DISTINGUISH_NAME">
                                                                        <Ref name="DN_SuMSubscriberProfile" />
                                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                                        <Val>true</Val>
                                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                                </In>
                                                                <Out>
                                                                    <Parameter name="existEntry">
                                                                        <Ref name="__BOOL" />
                                                                    </Parameter>
                                                                </Out>
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!--  70719, zeyangy, 2010-08-23, end-->
                                                    <If>
<!--  70719, zeyangy, 2010-08-23, begin-->
<!--changed by zhao nannan for feature 73024 start,delete the condition of existProfile   -->
<!--  <AND> -->
<!--  70719, zeyangy, 2010-08-23, end-->
<!--     <Condition operator="eq">
                                                        <Ref name="existProfile" />
                                                        <Val>false</Val>
                                                    </Condition>  -->
<!--  70719, zeyangy, 2010-08-23, begin-->
                                                        <Condition operator="eq">
                                                            <Ref name="existEntry" />
                                                            <Val>true</Val>
                                                        </Condition>
<!--   </AND> -->
<!--  70719, zeyangy, 2010-08-23, end-->
<!-- changed by zhao nannan for feature 73024 end -->
                                                        <Then>
<!-- SDMA01CAG246501 begin -->
<!-- check the underTracing of DN_SuMSubscriberProfile -->
<!--change by zhaonannan for feature 73024, when applist has HSS can't delete the tracingTarget -->
<!-- modified for SDMA01FAG279739, add the check of fCT100 flag -->
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                                        <Description>Get underTracingImsi of associatedMainMsisdn</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                                            </Parameter>
                                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                                <Val>underTracing_@@_appListActivateTracing</Val>
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Parameter name="underTracing" />
                                                                            <Parameter name="appListActivateTracing" />
                                                                        </Out>
                                                                    </CallBE>
                                                                    <Foreach name="iter_appList">
                                                                        <MultiValue>
                                                                            <Ref name="appListActivateTracing" />
                                                                        </MultiValue>
                                                                        <If>
                                                                            <OR>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="iter_appList" />
                                                                                    <Val>RT-HLR</Val>
                                                                                </Condition>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="iter_appList" />
                                                                                    <Val>OAM-HLR</Val>
                                                                                </Condition>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="iter_appList" />
                                                                                    <Val>RT-LTEHSS</Val>
                                                                                </Condition>
                                                                                <Condition operator="eq">
                                                                                    <Ref name="iter_appList" />
                                                                                    <Val>OAM-LTEHSS</Val>
                                                                                </Condition>
                                                                            </OR>
                                                                            <Then>
                                                                                <Remove name="appListActivateTracing">
                                                                                    <MultiValue>
                                                                                        <Ref name="iter_appList" />
                                                                                    </MultiValue>
                                                                                </Remove>
                                                                            </Then>
                                                                        </If>
                                                                    </Foreach>
                                                                    <If>
                                                                        <Condition operator="eq">
                                                                            <Ref name="underTracing" />
                                                                            <Val>true</Val>
                                                                        </Condition>
                                                                        <Then>
                                                                            <If>
                                                                                <Condition operator="setGreater">
                                                                                    <Ref name="appListActivateTracing" />
                                                                                    <Null />
                                                                                </Condition>
                                                                                <Then>
                                                                                    <CallBE entityName="HSS.Tracing.*.BeGDMI" name="modify">
                                                                                        <In>
                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                                                            </Parameter>
                                                                                            <Parameter name="appListActivateTracing">
                                                                                                <Ref name="appListActivateTracing" />
                                                                                            </Parameter>
                                                                                        </In>
                                                                                        <Out />
                                                                                    </CallBE>
                                                                                </Then>
                                                                                <Else>
                                                                                    <CallBE entityName="HSS.Tracing.*.BeGDMI" name="modify">
                                                                                        <In>
                                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                                                            </Parameter>
                                                                                            <Parameter name="underTracing">
                                                                                                <Val>false</Val>
                                                                                            </Parameter>
                                                                                        </In>
                                                                                        <Out />
                                                                                    </CallBE>
                                                                                    <CallBE entityName="HSS.Tracing.*.DnHandler" name="create">
                                                                                        <In>
                                                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                                                <Val>TracingTarget_DN</Val>
                                                                                            </Parameter>
                                                                                            <Parameter name="tracingTargetId">
                                                                                                <Ref name="suMSubscriberProfileId" />
                                                                                            </Parameter>
                                                                                            <Parameter name="targetTypeId">
                                                                                                <Val>SuMSubscriberProfileId</Val>
                                                                                            </Parameter>
                                                                                        </In>
                                                                                        <Out>
                                                                                            <Parameter name="removeTracing_DN">
                                                                                                <Ref name="__DISTINGUISH_NAME" />
                                                                                            </Parameter>
                                                                                        </Out>
                                                                                    </CallBE>
                                                                                    <Set name="removeTracing">
                                                                                        <MultiValue>
                                                                                            <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                                                                            <Ref name="removeTracing_DN" />
                                                                                        </MultiValue>
                                                                                    </Set>
                                                                                    <CallBE entityName="PostCommitBeContext" name="modify">
                                                                                        <In>
                                                                                            <Parameter name="removeTracing" />
                                                                                        </In>
                                                                                        <Out />
                                                                                    </CallBE>
                                                                                    <Set name="__JUST_AFTER_COMMIT">
                                                                                        <Val>justAfterCommit</Val>
                                                                                    </Set>
                                                                                </Else>
                                                                            </If>
                                                                        </Then>
                                                                    </If>
                                                                </Then>
                                                            </If>
<!-- end of modified for SDMA01FAG279739 -->
<!-- SDMA01CAG246501 end -->
<!-- add begin for feature 73337 -->
                                                            <If>
<!--add by zhao nannan,in order to not change the logic of this,need add the condition of existProfile,begin  -->
                                                                <AND>
                                                                    <Condition operator="eq">
                                                                        <Ref name="existProfile" />
                                                                        <Val>false</Val>
                                                                    </Condition>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="extSubscriberIdLink" />
                                                                        <Null />
                                                                    </Condition>
                                                                </AND>
<!--add by zhao nannan end -->
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="modify">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="extSubscriberIdLink" />
                                                                            </Parameter>
                                                                            <Parameter name="suMSubscriberProfileLink">
                                                                                <Null />
                                                                            </Parameter>
                                                                            <Parameter name="IMSILinkList">
                                                                                <Null />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
<!-- add end for feature 73337 -->
<!-- add by zhao nannan for feature 73024 start -->
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="existProfile" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="delete">
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="DN_SuMSubscriberProfile" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out />
                                                                    </CallBE>
                                                                </Then>
                                                            </If>
<!--add by zhao nannan for feature 73024 end -->
                                                        </Then>
                                                    </If>
<!-- add by BPQ end, 20081225, for 68045 multi app -->
                                                </Then>
                                            </If>
<!--begin add for 66935, wangying-->
                                        </Then>
                                    </If>
<!--end add for 66935, wangying-->
<!-- For feature 69834 begin -->
                                    <If>
                                        <Condition operator="eq">
                                            <Ref name="fSA110" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Then>
<!-- delete current auc -->
                                            <CallBE name="checkToDelAuc" entityName="HSS.SUB.Subscription.SUB_OAM_MultiApp">
                                                <Description>delete Auc</Description>
                                                <In>
                                                    <Parameter name="mSubIdentificationNumberId" />
                                                    <Parameter name="mobileNetworkCodeId" />
                                                    <Parameter name="mobileCountryCodeId" />
                                                </In>
                                                <Out />
                                            </CallBE>
<!--begin add for 66935, wangying-->
                                            <If>
                                                <Condition operator="eq">
                                                    <Ref name="deleteSubscription" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Then>
<!--end add for 66935, wangying-->
<!-- delete auc for linkToOtherIMSI -->
                                                    <If>
                                                        <Condition operator="setGreater">
                                                            <Ref name="linkToOtherIMSI" />
                                                            <Null />
                                                        </Condition>
                                                        <Then>
                                                            <CallBE name="checkToDelAuc" entityName="HSS.SUB.Subscription.SUB_OAM_MultiApp">
                                                                <Description>delete linkToOtherIMSI</Description>
                                                                <In>
                                                                    <Parameter name="mSubIdentificationNumberId">
                                                                        <Ref name="newMSubIdentificationNumberId" />
                                                                    </Parameter>
                                                                    <Parameter name="mobileNetworkCodeId">
                                                                        <Ref name="newMobileNetworkCodeId" />
                                                                    </Parameter>
                                                                    <Parameter name="mobileCountryCodeId">
                                                                        <Ref name="newMobileCountryCodeId" />
                                                                    </Parameter>
                                                                </In>
                                                                <Out />
                                                            </CallBE>
                                                        </Then>
                                                    </If>
<!--begin add for 66935, wangying-->
                                                </Then>
                                            </If>
<!--end add for 66935, wangying-->
                                        </Then>
                                    </If>
<!-- For feature 69834 end -->
<!-- beg SDMA01FAG279379 by Wayne -->
                                </Else>
                            </If>
<!-- end SDMA01FAG279379 by Wayne -->
                        </LockPolicy>
                        <Result />
                    </Request>
                    <Request name="query">
                        <Description>
                            <Summary>The query Operation enables to query a subscriber with common subscription characteristics to a CSService and/or PSService subscription if any, and optionally specific CSService characteristics, a PSService subscription, a CAMEL subscription, a Supplementary Service subscription, .....</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
<!--
                        ***************************************************************************************
                        * 4. Query Request 
                        *   4.1   Query on  Entry SuMSubscriptionProfile (get associatedMainMsisdn)
                        *   4.2   Query on  DN of Entry SubscriberNumber of mainMSISDN to get countryCodeId, nationalDestinationCodeId and subscriberNumberId
                        *   4.3   Query on  Entry SubscriberNumber of mainMSISDN
                        *   4.4   Build MainSNwithBearerService 
                        *   4.5   Query on  DN of Entry MSubIdentificationNumber  of  associatedIMSI to get mobileCountryCodeId, mobileNetworkCodeId and mSubIdentificationNumberId
                        *   4.6   Query on Entry MSubIdentificationNumber
                        *   4.7   Build SNwithBearerServiceList from associatedMSISDN
                        *   4.8   Query on Entry BasicSubscription
                        *   4.9   Build BearerServiceWithoutSNList from bscWithoutSN 
                        *   4.10  Build ServiceNodeNotificationList  
                        *   4.11  extract fields  of link associatedIMSI
                        *   4.12  Query CsServiceProfile
                        *   4.13  Query PsServiceProfile
                        *   4.14  Query CAMEL 
                        *   4.15  Query RoamingRestriction
                        *   4.16  Query ODB 
                        *   4.17  Query CallBarring 
                        *   4.18  Query CallForwrding 
                        *   4.19  Query GCS
                        *   4.20  Query CUG
                        *   4.21  Change IMSI query
                        *   4.22  Query LCS
                        *   4.23 Query eMLPP
                        *   4.24  Query MdtDomain add for 71037
                        *************************************************************************************** -->
                        <ReqParameters>
                            <Optional name="mobileCountryCodeId" />
                            <Optional name="mobileNetworkCodeId" />
                            <Optional name="mSubIdentificationNumberId" />
                            <Optional name="networkAccessMode" />
                            <Optional name="MainSNwithBearerService" />
                            <Optional name="SNwithBearerServiceList" />
                            <Optional name="BearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 begin-->
                            <Optional name="ExtendedBearerServiceWithoutSNList" />
<!--Add for SDMA01CAG271493 end-->
                            <Optional name="ServiceNodeNotificationList" />
                            <Optional name="accessRestrictionData" />
                            <Optional name="prepayCommonGroupId" />
                            <Optional name="prepay" />
<!-- ZTX | 2009/08/24 | Added for 69596/69597 EPS ServiceProfile Part -->
<!--EPS ServiceProfile parameters -->
                            <Optional name="epsServiceProfile" />
                            <Optional name="epsApnContextSetList" />
                            <Optional name="framedPoolSetList" />
                            <Optional name="subIPV6AddrSetList" />
                            <Optional name="maxRequestedBandwidthDL" />
                            <Optional name="maxRequestedBandwidthUL" />
<!-- Add begin by nian for 72989 on 20120229 -->
                            <Optional name="selfActivationStatus" />
<!-- Add end by nian for 72989 on 20120229 -->
                            <Optional name="sqn4AAAIPv6" />
                            <Optional name="epsAccessSubscriptionType" />
                            <Optional name="apnOiReplacement" />
                            <Optional name="stnSrData" />
                            <Optional name="ratFreqSelectPriorityId" />
<!-- Add begin by nian for 72989 on 20120614 -->
                            <Optional name="S6aRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
<!--Begin added by F71037, Austin, 2012-11-27 -->
                            <Optional name="s6aRegRestrictionList" />
                            <Optional name="mpsPriority" />
                            <Optional name="relayNodeIndicator" />
<!--End added by F71037, Austin, 2012-11-27 -->
                            <Optional name="RauTauTimer" />
                            <Optional name="authLipaVplmnId" />
                            <Optional name="mdtUserConsent" />
                            <Optional name="roamRstrD2UFeat" />
<!-- Add begin by qigangx for 4.2 f73801 on 20121210 -->
                            <Optional name="eps3gppRestrictionListNum" />
<!-- Add end by qigangx for 4.2 f73801 on 20121210 -->
<!-- Add begin by Guangli for 69915 on 20100201-->
                            <Optional name="non3gppApnOiReplacement" />
<!-- Add end by Guangli for 69915 on 20100201-->
                            <Optional name="non3gppAccessRestrictionData" />
                            <Optional name="non3gppAuthenSesTimeout" />
                            <Optional name="non3gppIpAccess" />
                            <Optional name="non3gppIpAccessApn" />
                            <Optional name="chargingGatewayFuncHost" />
                            <Optional name="chargingGroup" />
                            <Optional name="non3gppGwMobileIpCapability" />
                            <Optional name="authVisitedNIDIdx" />
                            <Optional name="specificApnContextList" />
<!-- Add for 71910 begin, Liu, Yang W 20121204 -->
                            <Optional name="pprIpAddress" />
                            <Optional name="gmlcIpAddress" />
<!-- Add for 71910 end, Liu, Yang W 20121204 -->
<!-- Add begin by qigangx for 4.2 f73246 on 20130107 -->
                            <Optional name="allowMmeTableId" />
                            <Optional name="allowSgsnTableId" />
<!-- Add end by qigangx for 4.2 f73246 on 20130107 -->
<!-- Add for D55, SQ, 2007/11/17 -->
<!-- Add for Feature 67398 Start-->
                            <Optional name="smsRouteViaHNetwRoam" />
<!-- Add for Feature 67398 End-->
<!-- Add for Feature 67435 Start -->
                            <Optional name="serviceProviderReference" />
<!-- Add for Feature 67435 End -->
<!-- add for feature 67393 Start-->
                            <Optional name="subscriberType" />
<!-- add for feature 67393 End-->
<!--Add for 71037 qdiao begin-->
                            <Optional name="icsIndicator" />
<!--Add for 71037 qdiao end-->
<!-- timeStamp -->
                            <Optional name="deactivatedSubscription" />
                            <Optional name="subscriptionCreationTime" />
<!-- Feature 67386 -->
                            <Optional name="addService" />
                            <Optional name="subscriptionStateChangeTime" />
                            <Optional name="subscriptionPurchaseTime" />
<!-- Change IMSI -->
                            <Optional name="newMobileCountryCodeId" />
                            <Optional name="newMobileNetworkCodeId" />
                            <Optional name="newMSubIdentificationNumberId" />
                            <Optional name="IMSI_Change_Mode" />
                            <Optional name="typeOfModification" />
                            <Optional name="imsiStatus" />
                            <Optional name="dateOfLinkCreation" />
                            <Optional name="linkToOtherIMSI" />
<!-- CS parameters -->
                            <Optional name="msCategory" />
                            <Optional name="opSpecificCategory" />
                            <Optional name="singleNumbering" />
                            <Optional name="IpreferedCarrier" />
                            <Optional name="csAllocationRetentionPriority" />
<!-- timeStamp -->
                            <Optional name="csLastUpdateTime" />
<!--PS parameters-->
                            <Optional name="transferOfSmOption" />
                            <Optional name="packetMsAddressList" />
                            <Optional name="chargingCharacteristics" />
<!-- Add begin by Guangli for 69915 on 20100201-->
                            <Optional name="authVisitedPlmnNIDId" />
<!-- Add end by Guangli for 69915 on 20100201-->
<!-- timeStamp -->
                            <Optional name="psLastUpdateTime" />
<!-- Roaming parameters -->
                            <Optional name="RoamingServiceProfile" />
                            <Optional name="RoamingRestrictionType" />
                            <Optional name="csRestrictionListNum" />
                            <Optional name="psRestrictionListNum" />
                            <Optional name="regSubscriptionListId" />
<!-- General CAMEL parameters -->
                            <Optional name="CamelServiceProfile" />
                            <Optional name="camelLocationRequestFlag" />
                            <Optional name="camelStatusRequestFlag" />
                            <Optional name="camelMarkActivationRoamers" />
                            <Optional name="camelMarkInhibitionRoamersCs" />
<!--***O_CSI parameters***-->
                            <Optional name="OcsiServiceProfile" />
                            <Optional name="ocsiCamelSubState" />
                            <Optional name="ocsiCamelCapabilityHandling" />
                            <Optional name="ocsiCamelVlrNotSuppDfltHandl" />
                            <Optional name="ocsiCamelGmscNotSuppDfltHdl" />
                            <Optional name="tifcsiTransformationInformFlag" />
                            <Optional name="ocsiCollectedInfoTdpServKey" />
                            <Optional name="ocsiCollectedInfoTdpScpIsdn" />
                            <Optional name="ocsiCollectedInfoTdpDfltCalH" />
                            <Optional name="callTypeCriteria" />
                            <Optional name="destinationNumberCritList" />
                            <Optional name="matchType" />
                            <Optional name="destNbLengthCriteriaList" />
                            <Optional name="originBscCritList" />
                            <Optional name="originBsgCritList" />
                            <Optional name="ocsiRouteSelectFailTdpServKey" />
                            <Optional name="ocsiRouteSelectFailTdpScpIsdn" />
                            <Optional name="ocsiRouteSelectFailTdpDfltCalH" />
                            <Optional name="routeSelectFailTdpCauVCritList" />
                            <Optional name="oickKey" />
<!--***T_CSI parameters***-->
                            <Optional name="TcsiServiceProfile" />
                            <Optional name="tcsiCamelSubState" />
                            <Optional name="tcsiCamelCapabilityHandling" />
                            <Optional name="tcsiCamelGmscNotSuppDfltHandl" />
                            <Optional name="tcsiTermAttemptTdpServKey" />
                            <Optional name="tcsiTermAttemptTdpScpIsdn" />
                            <Optional name="tcsiTermAttemptTdpDfltCalH" />
                            <Optional name="terminBscCritList" />
                            <Optional name="terminBsgCritList" />
                            <Optional name="tcsiTBusyTdpServKey" />
                            <Optional name="tcsiTBusyTdpScpIsdn" />
                            <Optional name="tcsiTBusyTdpDfltCalH" />
                            <Optional name="tbusyTdpCauseValueCritList" />
                            <Optional name="tcsiTNoAnswTdpServKey" />
                            <Optional name="tcsiTNoAnswTdpScpIsdn" />
                            <Optional name="tcsiTNoAnswTdpDfltCalH" />
                            <Optional name="tnoAnswTdpCauseValueCritList" />
                            <Optional name="homeTickKey" />
                            <Optional name="roamTickKey" />
<!--***M_CSI parameters***-->
                            <Optional name="McsiServiceProfile" />
                            <Optional name="mobilityTriggers" />
                            <Optional name="mcsiServKey" />
                            <Optional name="mcsiScpIsdn" />
                            <Optional name="mcsiCamelSubState" />
                            <Optional name="mcsiCamelVlrNotSuppDfltHdl" />
<!--***SS_CSI parameters***-->
                            <Optional name="SscsiServiceProfile" />
                            <Optional name="sscsiScpIsdn" />
                            <Optional name="sscsiCheckSSindicator" />
                            <Optional name="sscsiCamelSubState" />
                            <Optional name="sscsiCamelVlrNotSuppDfltHdl" />
<!--***U_CSI parameters***-->
                            <Optional name="UcsiServiceProfile" />
                            <Optional name="ucsiCamelServiceList" />
<!--***SMO_CSI parameters***-->
                            <Optional name="SmocsiServiceProfile" />
                            <Optional name="smocsiCamelSubState" />
                            <Optional name="smocsiCamelCapabilityHandling" />
                            <Optional name="smocsiCamelNotSuppDfltHdl" />
                            <Optional name="smocsiCollectedInfoTdpServKey" />
                            <Optional name="smocsiCollectedInfoTdpScpIsdn" />
                            <Optional name="smocsiCollectedInfoTdpDfltCalH" />
<!-- begin 70186guowei -->
<!--***SMT_CSI parameters*** -->
                            <Optional name="SmtcsiServiceProfile" />
                            <Optional name="smtcsiCamelSubState" />
                            <Optional name="smtcsiCamelCapabilityHandling" />
                            <Optional name="smtcsiCamelNotSuppDfltHdl" />
                            <Optional name="smtcsiDeliveryReqTdpServKey" />
                            <Optional name="smtcsiDeliveryReqTdpScpIsdn" />
                            <Optional name="smtcsiDeliveryReqTdpDfltSmsHdl" />
                            <Optional name="smtcsiTpduSmsDelivCrit" />
                            <Optional name="smtcsiTpduSmsStatusRepCrit" />
<!-- begin 70186guowei -->
<!--***GPRS_CSI parameters***-->
                            <Optional name="GprscsiServiceProfile" />
                            <Optional name="gprscsiCamelSubState" />
                            <Optional name="gprscsiCamelCapabilityHandling" />
                            <Optional name="gprscsiCamelSgsnNotSuppDfltHdl" />
                            <Optional name="camelMarkInhibitionRoamersPs" />
                            <Optional name="gprscsiPdpConChgPosTdpServKey" />
                            <Optional name="gprscsiPdpConChgPosTdpScpIsdn" />
                            <Optional name="gprscsiPdpConChgPosTdpDfltCalH" />
                            <Optional name="gprscsiAttachProcTdpServKey" />
                            <Optional name="gprscsiAttachProcTdpScpIsdn" />
                            <Optional name="gprscsiAttachProcTdpDfltCalH" />
                            <Optional name="gprscsiChgPositionTdpServKey" />
                            <Optional name="gprscsiChgPositionTdpScpIsdn" />
                            <Optional name="gprscsiChgPositionTdpDfltCalH" />
                            <Optional name="gprscsiPdpConEstabTdpServKey" />
                            <Optional name="gprscsiPdpConEstabTdpScpIsdn" />
                            <Optional name="gprscsiPdpConEstabTdpDfltCalH" />
                            <Optional name="gprscsiPdpConEstAckTdpServKey" />
                            <Optional name="gprscsiPdpConEstAckTdpScpIsdn" />
                            <Optional name="gprscsiPdpConEstAckTdpDfltCalH" />
<!-- D_CSI parameters -->
                            <Optional name="DcsiServiceProfile" />
                            <Optional name="dcsiCamelSubState" />
                            <Optional name="dcsiCamelCapabilityHandling" />
                            <Optional name="dcsiCamelVlrNotSuppDfltHandl" />
                            <Optional name="dcsiCamelGmscNotSuppDfltHdl" />
                            <Optional name="dcsiCamelServiceList" />
<!-- VT_CSI parameters -->
                            <Optional name="VTcsiServiceProfile" />
                            <Optional name="vtcsiCamelSubState" />
                            <Optional name="vtcsiCamelCapabilityHandling" />
                            <Optional name="vtcsiCamelVlrNotSuppDfltHandl" />
<!-- Parameters relative to vtcsiTermAttemptTdp  -->
                            <Optional name="vtcsiTermAttemptTdpServKey" />
                            <Optional name="vtcsiTermAttemptTdpScpIsdn" />
                            <Optional name="vtcsiTermAttemptTdpDfltCalH" />
                            <Optional name="vterminBscCritList" />
                            <Optional name="vterminBsgCritList" />
<!--Parameters relative to vtcsiTBusyTdp   -->
                            <Optional name="vtcsiTBusyTdpServKey" />
                            <Optional name="vtcsiTBusyTdpScpIsdn" />
                            <Optional name="vtcsiTBusyTdpDfltCalH" />
                            <Optional name="vtbusyTdpCauseValueCritList" />
<!--Parameters relative to vtcsiTNoAnswTdp    -->
                            <Optional name="vtcsiTNoAnswTdpServKey" />
                            <Optional name="vtcsiTNoAnswTdpScpIsdn" />
                            <Optional name="vtcsiTNoAnswTdpDfltCalH" />
                            <Optional name="vtnoAnswTdpCauseValueCritList" />
<!-- Odb parameters ********** -->
                            <Optional name="OdbServiceProfile" />
                            <Optional name="odbOutgoingCalls" />
                            <Optional name="odbIncomingCalls" />
                            <Optional name="odbRoaming" />
                            <Optional name="odbSpecificHPLMN" />
                            <Optional name="barringForLockingReason" />
                            <Optional name="odbPremiumRateCalls" />
                            <Optional name="odbSuplServiceMngt" />
                            <Optional name="odbCfFTNRegistration" />
                            <Optional name="odbECTInvocation" />
                            <Optional name="odbECTDoublyChargeable" />
                            <Optional name="odbMultipleECT" />
                            <Optional name="odbSpecificToPs" />
                            <Optional name="odbPrepayIcBar" />
<!-- begin 67390 ODB by qzg 20090403 -->
                            <Optional name="odbCustoSmsCalls" />
                            <Optional name="odbCustoPremRateCalls" />
                            <Optional name="odbRouteToSPBar" />
<!-- end 67390 20090403 -->
<!-- Call Barring parameters -->
                            <Optional name="CallBarringServiceProfile" />
                            <Optional name="barOutCallProv" />
                            <Optional name="barOutInterCallProv" />
                            <Optional name="barOutIntCallExceptToHplmnProv" />
                            <Optional name="barIncCallProvisioned" />
                            <Optional name="barIncCallRoamFCountryProv" />
                            <Optional name="BSGofBAOClist" />
                            <Optional name="BSGofBOIClist" />
                            <Optional name="BSGofBOICEXHClist" />
                            <Optional name="BSGofBAIClist" />
                            <Optional name="BSGofBICROAMlist" />
                            <Optional name="msCbAbility" />
                            <Optional name="callBarringPassword" />
<!-- Call Forwarding parameters -->
<!--Add for Feature 67398 Start-->
                            <Optional name="specificCfType" />
<!--Add for Feature 67398 End-->
<!-- NGHLR1FAG203631 -->
                            <Optional name="typeCallForwardingNumberActivationList" />
<!-- NGHLR1FAG203631 end -->
                            <Optional name="CallForwardingServiceProfile" />
                            <Optional name="typeOfCallForwardingList" />
                            <Optional name="msCfNoAbility" />
                            <Optional name="destinationProfile" />
                            <Optional name="cfuCallForwardingNumberList" />
                            <Optional name="cfbusyCallForwardingNumberList" />
                            <Optional name="cfnreplyCallForwardingNumberList" />
                            <Optional name="cfnreachCallForwardingNumberList" />
                            <Optional name="cfdCallForwardingNumberList" />
                            <Optional name="cfdcfbusyCallForwardingNumberList" />
                            <Optional name="cfdcfnreplyCallForwardingNumberList" />
                            <Optional name="cfdcfnreachCallForwardingNumberList" />
                            <Optional name="cfuNotifToFwdPartyFlag" />
                            <Optional name="cfbusyNotifToFwdPartyFlag" />
                            <Optional name="cfnreplyNotifToFwdPartyFlag" />
                            <Optional name="cfnreachNotifToFwdPartyFlag" />
                            <Optional name="cfuNotifToCallingPartyFlag" />
                            <Optional name="cfbusyNotifToCallingPartyFlag" />
                            <Optional name="cfnreplyNotifToCallingPartFlag" />
                            <Optional name="cfnreachNotifToCallingPartFlag" />
<!-- GCS parameters -->
                            <Optional name="GcsServiceProfile" />
                            <Optional name="colpProvisionedFlag" />
                            <Optional name="colpOverrideCategoryState" />
                            <Optional name="clipProvisionedFlag" />
                            <Optional name="clipOverrideCategoryState" />
                            <Optional name="clirProvisionedFlag" />
                            <Optional name="presentationMode" />
<!-- Begin SDMA01FAG222609 -->
                            <Optional name="cnapProvisionedFlag" />
                            <Optional name="cnapOverrideCategoryState" />
<!-- End SDMA01FAG222609 -->
                            <Optional name="callHoldProvisionedFlag" />
                            <Optional name="mptyProvisionedFlag" />
                            <Optional name="aoccProvisionedFlag" />
                            <Optional name="aociProvisionedFlag" />
                            <Optional name="callTransferProvisionedFlag" />
                            <Optional name="maliciousCallProvisionedFlag" />
                            <Optional name="colrProvisionedFlag" />
                            <Optional name="osss1ProvisionedFlag" />
                            <Optional name="osss1ActivationFlag" />
                            <Optional name="osss2ProvisionedFlag" />
                            <Optional name="osss2ActivationFlag" />
                            <Optional name="osss3ProvisionedFlag" />
                            <Optional name="osss3ActivationFlag" />
                            <Optional name="osss4ProvisionedFlag" />
                            <Optional name="osss4ActivationFlag" />
                            <Optional name="osss5ProvisionedFlag" />
                            <Optional name="osss5ActivationFlag" />
                            <Optional name="osss6ProvisionedFlag" />
                            <Optional name="osss6ActivationFlag" />
                            <Optional name="osss7ProvisionedFlag" />
                            <Optional name="osss7ActivationFlag" />
                            <Optional name="osss8ProvisionedFlag" />
                            <Optional name="osss8ActivationFlag" />
                            <Optional name="osss9ProvisionedFlag" />
                            <Optional name="osss9ActivationFlag" />
                            <Optional name="osss10ProvisionedFlag" />
                            <Optional name="osss10ActivationFlag" />
                            <Optional name="osss11ProvisionedFlag" />
                            <Optional name="osss11ActivationFlag" />
                            <Optional name="osss12ProvisionedFlag" />
                            <Optional name="osss12ActivationFlag" />
                            <Optional name="osss13ProvisionedFlag" />
                            <Optional name="osss13ActivationFlag" />
                            <Optional name="osss14ProvisionedFlag" />
                            <Optional name="osss14ActivationFlag" />
                            <Optional name="osss15ProvisionedFlag" />
                            <Optional name="osss15ActivationFlag" />
                            <Optional name="callWaitingProvisionedFlag" />
                            <Optional name="cwTSSpeechActivationFlag" />
                            <Optional name="cwTSFaxActivationFlag" />
                            <Optional name="cwBSG20ActivationFlag" />
                            <Optional name="cwBSG30ActivationFlag" />
<!-- Add for 67396 start -->
                            <Optional name="acrProvisionedFlag" />
                            <Optional name="acrActivationFlag" />
<!-- Add for 67396 end -->
<!-- CUG parameters -->
                            <Optional name="ClosedUserGroupProfile" />
                            <Optional name="cugInterlockCodeInd1" />
                            <Optional name="cugInterlockCodeInd2" />
                            <Optional name="cugInterlockCodeInd3" />
                            <Optional name="cugInterlockCodeInd4" />
                            <Optional name="cugInterlockCodeInd5" />
                            <Optional name="cugInterlockCodeInd6" />
                            <Optional name="cugInterlockCodeInd7" />
                            <Optional name="cugInterlockCodeInd8" />
                            <Optional name="cugInterlockCodeInd9" />
                            <Optional name="cugInterlockCodeInd10" />
                            <Optional name="intraCugOptionInd1" />
                            <Optional name="intraCugOptionInd2" />
                            <Optional name="intraCugOptionInd3" />
                            <Optional name="intraCugOptionInd4" />
                            <Optional name="intraCugOptionInd5" />
                            <Optional name="intraCugOptionInd6" />
                            <Optional name="intraCugOptionInd7" />
                            <Optional name="intraCugOptionInd8" />
                            <Optional name="intraCugOptionInd9" />
                            <Optional name="intraCugOptionInd10" />
                            <Optional name="AllassociatedBsgString1" />
                            <Optional name="AllassociatedBsgString2" />
                            <Optional name="AllassociatedBsgString3" />
                            <Optional name="AllassociatedBsgString4" />
                            <Optional name="AllassociatedBsgString5" />
                            <Optional name="AllassociatedBsgString6" />
                            <Optional name="AllassociatedBsgString7" />
                            <Optional name="AllassociatedBsgString8" />
                            <Optional name="AllassociatedBsgString9" />
                            <Optional name="AllassociatedBsgString10" />
<!--Object Class = ClosedUserGroup-->
                            <Optional name="prefCugIndexForSpeech" />
                            <Optional name="prefCugIndexForFax" />
                            <Optional name="prefCugIndexForBsg20" />
                            <Optional name="prefCugIndexForBsg30" />
                            <Optional name="interCugRestForSpeech" />
                            <Optional name="interCugRestForFax" />
                            <Optional name="interCugRestForBsg20" />
                            <Optional name="interCugRestForBsg30" />
<!-- LCS  query parameters added by zhx,2006-6-5 -->
                            <Optional name="LcsServiceProfile" />
<!-- Begin for feature:67403
                                                             Comment: Add two parameters: pai and paiControl
                                                             Author: Shen Xin
                                                             Date: 2009/3/13
                                                        -->
                            <Optional name="pai" />
                            <Optional name="paiControl" />
<!-- End for feature:67403-->
                            <Optional name="originatingLcs" />
                            <Optional name="terminatingLcs" />
                            <Optional name="callRelatedNotification" />
                            <Optional name="callUnrelatedNotification" />
                            <Optional name="externalClientProfileId" />
                            <Optional name="plmnClientList" />
<!-- eMLPP -->
                            <Optional name="eMLPPServiceProfile" />
                            <Optional name="emlppMaxEntitledPriority" />
                            <Optional name="emlppDefaultPriority" />
                            <Optional name="emlppProvisionedFlag" />
<!-- NGHLR1FAG189700 -->
                            <Optional name="suMSubscriberProfileId" />
                            <Optional name="suMSubscriptionProfileId" />
                            <Optional name="gsmServiceProfileId" />
<!-- Add for feature (MapScreening) Start -->
                            <Optional name="mapScreeningCategory" />
<!-- Add for feature (MapScreening) End -->
<!-- Add for feature (MultiSIMCard) Start -->
                            <Optional name="multiSimMember" />
                            <Optional name="roleInMultiSim" />
                            <Optional name="ProfileStatus" />
                            <Optional name="MSIMMemberPublicCC" />
                            <Optional name="MSIMMemberPublicNDC" />
                            <Optional name="MSIMMemberPublicSN" />
<!-- Add for feature (MultiSIMCard) End -->
<!--Add for 67394-->
                            <Optional name="lcnCallingNumber" />
                            <Optional name="lcnCallingNumberPres" />
                            <Optional name="lcnPresentationNumberPres" />
                            <Optional name="lcnPresentationNumber" />
                            <Optional name="lcnBS" />
                            <Optional name="lcnSRIStatus" />
                            <Optional name="lcnDate" />
                            <Optional name="lcnEraseFlag" />
<!-- For feature 67401 begin -->
                            <Optional name="cfDestinationProfileList" />
                            <Optional name="specificCfType" />
<!-- For feature 67401 end -->
<!-- For feature 67441 begin -->
                            <Optional name="voiceMailIndex" />
<!-- For feature 67441 end -->
<!-- For feature 67488 begin -->
                            <Optional name="underTracing" />
                            <Optional name="underTracingImsi" />
                            <Optional name="underTracingMsisdn" />
<!-- For feature 67488 end -->
<!--add for feature 73024 begin -->
                            <Optional name="appListActivateTracing" />
<!--add for feature 73024 end-->
<!-- Add for feature 69834 start -->
                            <Optional name="dateOfLinkExpiry" />
                            <Optional name="localMobileStationIdentity" />
                            <Optional name="vlrIsdn" />
                            <Optional name="mscIsdn" />
                            <Optional name="roamingRestrictionFlags" />
                            <Optional name="vlrUpdateFlag" />
                            <Optional name="roamingCharactsFlags" />
                            <Optional name="flagCffPlmn" />
                            <Optional name="supOfLocRegCount" />
                            <Optional name="locRegSubsPeriod" />
                            <Optional name="gsmCamelPhase" />
                            <Optional name="gsmNegocCamelPhases" />
                            <Optional name="odbUnsuppFeaturesFlags" />
                            <Optional name="vlrBasServUnsuppFeaturesFlags" />
                            <Optional name="vlrGenUnsuppFeaturesFlags" />
                            <Optional name="inducedCbocBsg" />
                            <Optional name="inducedCboiBsg" />
                            <Optional name="inducedCboehBsg" />
                            <Optional name="vlrLastGlobalUpdateTime" />
                            <Optional name="currentMapScreeningProfile" />
                            <Optional name="inducedCbicBsg" />
                            <Optional name="inducedCbicroamBsg" />
                            <Optional name="roamingCapabilityFlags" />
                            <Optional name="sgsnUpdateFlag" />
                            <Optional name="gprsEnhancementIndicator" />
                            <Optional name="sgsnGenUnsuppFeaturesFlags" />
                            <Optional name="sgsnIsdn" />
                            <Optional name="sgsnIp" />
                            <Optional name="gprsCamelPhase" />
                            <Optional name="gprsNegocCamelPhases" />
                            <Optional name="sgsnRoamingRestriction" />
                            <Optional name="gprsNotReachableFlag" />
                            <Optional name="gprsNotReachableReason" />
                            <Optional name="sgsnLastGlobalUpdateTime" />
                            <Optional name="smscIsdn" />
                            <Optional name="gsmNotReachableSMSFlag" />
                            <Optional name="gsmNotReachableReason" />
                            <Optional name="memoryCapacityExceededFlag" />
                            <Optional name="timeStampWaitingSms" />
                            <Optional name="voiceMailOrigin" />
<!-- 73282-05,62 begin -->
                            <Optional name="scAddress4IPSM" />
                            <Optional name="IPSMGWRegisterAddress" />
<!-- 73282-05,62 end -->
                            <Optional name="smscIsdnForExtMWD" />
                            <Optional name="timeStampWaitingSmsForExtMWD" />
                            <Optional name="voiceMailOriginForExtMWD" />
                            <Optional name="addSource" />
                            <Optional name="addRecache" />
                            <Optional name="addCsCurrent" />
                            <Optional name="addPsCurrent" />
                            <Optional name="addImeiSv" />
<!--69915 begin-->
                            <Optional name="add3gpp2Meid" />
                            <Optional name="addEpsMMECurrent" />
                            <Optional name="addEpsAAACurrent" />
<!--69915 end-->
                            <Optional name="addTimeStamp" />
                            <Optional name="cbPwdSuccErroneousAttempts" />
                            <Optional name="mmeIdentity" />
                            <Optional name="uePurgedInMme" />
                            <Optional name="mmeUpdateFlag" />
                            <Optional name="mmeLastGlobalUpdateTime" />
                            <Optional name="aaaIdentity" />
                            <Optional name="non3gppIpAccRegStatus" />
                            <Optional name="aaaUpdateFlag" />
                            <Optional name="aaaLastGlobalUpdateTime" />
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                            <Optional name="sgsnIdentity" />
                            <Optional name="s6aULRFlags" />
                            <Optional name="s6dULRFlags" />
                            <Optional name="s4sgsnIsdn" />
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
<!-- Add for feature 69834 end -->
<!-- begin feature 69582, zeyangy, 2010-03-17 -->
                            <Optional name="msStatusInCS" />
                            <Optional name="msStatusInPS" />
<!-- end feature 69582, zeyangy, 2010-03-17 -->
<!-- Add for 70018, Shi Qin, 2010-06-18-->
                            <Optional name="urrpMmeFlag" />
                            <Optional name="visitedMmePlmnId" />
<!-- Add for 70018 End, Shi Qin, 2010-06-18-->
<!-- Add for 72989, nian, 2012-02-29-->
                            <Optional name="visitedSgsnPlmnId" />
                            <Optional name="subRoaming" />
<!-- Add for 72989 End, nian, 2012-02-29-->
<!-- Add begin by fucong for 70018 on 20100729 -->
                            <Optional name="pcscfServerName" />
<!-- Add begin by nian for 72989 on 20120614 -->
                            <Optional name="SWxRoamingRestrictionType" />
<!-- Add end by nian for 72989 on 20120614 -->
                            <Optional name="csgContextList" />
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- begin 70186guowei -->
                            <Optional name="gsmNegocCamelPhasesExt" />
                            <Optional name="gprsNegocCamelPhasesExt" />
                            <Optional name="gsmOfferedCAMEL4CSIs" />
                            <Optional name="gprsOfferedCAMEL4CSIs" />
                            <Optional name="inducedGsmSMSBAR" />
                            <Optional name="inducedGprsSMSBAR" />
<!-- begin 70186guowei -->
<!-- SDMA01CAG258860 begin -->
                            <Optional name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
<!-- Add begin by xiaozhxu for 68733 on 20101207 -->
                            <Optional name="notificationToCseFlag" />
                            <Optional name="cfGsmSCF1" />
                            <Optional name="cfGsmSCF2" />
                            <Optional name="cfGsmSCF3" />
                            <Optional name="cbGsmSCF1" />
                            <Optional name="cbGsmSCF2" />
                            <Optional name="cbGsmSCF3" />
                            <Optional name="odbGsmSCF1" />
                            <Optional name="odbGsmSCF2" />
                            <Optional name="odbGsmSCF3" />
                            <Optional name="csiGsmSCF1" />
                            <Optional name="csiGsmSCF2" />
                            <Optional name="csiGsmSCF3" />
<!-- Add end by xiaozhxu for 68733 on 20101207 -->
<!-- add begin by weimingm for F73419 on 2012-12-17 -->
                            <Optional name="deactivatedDomains" />
<!-- add end by weimingm for F73419 on 2012-12-17 -->
<!--add by zhao nannan for 71037 begin-->
                            <Optional name="jobTypeEps" />
                            <Optional name="areaScopeEps" />
                            <Optional name="eutranCGIStrListEps" />
                            <Optional name="lteTAStrListEps" />
                            <Optional name="listMeasurement4LteEps" />
                            <Optional name="reportingTriggerEps" />
                            <Optional name="reportIntervalEps" />
                            <Optional name="reportAmountEps" />
                            <Optional name="eventThresholdRSRPEps" />
                            <Optional name="eventThresholdRSRQEps" />
                            <Optional name="loggingIntervalEps" />
                            <Optional name="loggingDurationEps" />
                            <Optional name="jobTypePs" />
                            <Optional name="areaScopePs" />
                            <Optional name="eutranCGIStrListPs" />
                            <Optional name="lteTAStrListPs" />
                            <Optional name="listMeasurement4LtePs" />
                            <Optional name="reportingTriggerPs" />
                            <Optional name="reportIntervalPs" />
                            <Optional name="reportAmountPs" />
                            <Optional name="eventThresholdRSRPPs" />
                            <Optional name="eventThresholdRSRQPs" />
                            <Optional name="loggingIntervalPs" />
                            <Optional name="loggingDurationPs" />
                            <Optional name="jobTypeCs" />
                            <Optional name="areaScopeCs" />
                            <Optional name="eutranCGIStrListCs" />
                            <Optional name="lteTAStrListCs" />
                            <Optional name="listMeasurement4LteCs" />
                            <Optional name="reportingTriggerCs" />
                            <Optional name="reportIntervalCs" />
                            <Optional name="reportAmountCs" />
                            <Optional name="eventThresholdRSRPCs" />
                            <Optional name="eventThresholdRSRQCs" />
                            <Optional name="loggingIntervalCs" />
                            <Optional name="loggingDurationCs" />
<!--add by zhao nannan for 71037 end -->
                        </ReqParameters>
<!-- Wayne -->
                        <Proc>
                            <Description>- wayne3</Description>
                            <In />
                            <Out />
                        </Proc>
<!-- Wayne -->
<!-- Add for 72989 begin, nian, 2012-02-29-->
                        <If>
                            <Condition operator="eq">
                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" name="fEps105" />
                                <Val>false</Val>
                            </Condition>
                            <Then>
                                <Remove name="selfActivationStatus" />
                                <Remove name="visitedSgsnPlmnId" />
                                <Remove name="framedPoolSetList" />
                                <Remove name="subIPV6AddrSetList" />
                            </Then>
                        </If>
<!-- Add for 72989 End, nian, 2012-02-29-->
<!-- Add for 72989 begin, nian, 2012-07-17-->
                        <If>
                            <Condition operator="eq">
                                <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" name="fSAApp" />
                                <Val>false</Val>
                            </Condition>
                            <Then>
                                <Remove name="selfActivationStatus" />
                            </Then>
                        </If>
<!-- Add for 72989 End, nian, 2012-02-29-->
<!-- SDMA01CAG220111 begin edit loaddata by __INTERNAL_REQUEST_NAME-->
<!-- Comment by feature 67807, always load GlobalDataProfile-->
<!--
                                                        <If>
                                <Condition operator="neq">
                                <Ref name="__INTERNAL_REQUEST_NAME"/>
                                <Val>PRE_REQUEST_MODIFY</Val>
                                </Condition>
                                <Then>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_LoadDataProfile" name="loadprofile">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME"/>
                                    </In>
                                    <Out/>
                                </CallBE>
                                </Then>
                                <Else>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_LoadDataProfile" name="loadprofile">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME"/>
                                        <Parameter name="loadDataName">
                                            <Val>SampleBasicDataProfile</Val>
                                        </Parameter>
                                    </In>
                                    <Out/>
                                </CallBE>
                                </Else>
                                </If>-->
<!-- Comment by feature 67807-->
<!-- Add for feature 67807, now always load HLRDataProfile-->
                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_LoadDataProfile" name="loadprofile">
                            <In>
                                <Parameter name="__DISTINGUISH_NAME" />
                                <Parameter name="loadDataName">
                                    <Val>HLRDataProfile</Val>
                                </Parameter>
                            </In>
                            <Out />
                        </CallBE>
<!-- End for feature 67807 -->
<!-- SDMA01CAG220111 end -->
<!-- 
                        ***************************************************************************************
                        *   4.1   Query on  Entry SuMSubscriptionProfile (get associatedMainMsisdn)
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>- extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                            <In />
                            <Out>
                                <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                <Parameter name="suMSubscriberProfileId" />
                                <Parameter name="suMSubscriptionProfileId" />
                                <Parameter name="gsmServiceProfileId" />
                                <Parameter name="DN_BasicSubscription">
                                    <Ref name="__DISTINGUISH_NAME" />
                                </Parameter>
                            </Out>
                        </CallBE>
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                            <Description>- DN suMSubscriptionProfile available</Description>
                            <In>
                                <Parameter name="__DN_SYNTAX_NAME">
                                    <Val>GsmServiceProfile_DN</Val>
                                </Parameter>
                                <Parameter name="suMSubscriberProfileId" />
                                <Parameter name="suMSubscriptionProfileId" />
                                <Parameter name="gsmServiceProfileId" />
                            </In>
                            <Out>
                                <Description>DN suMSubscriptionProfile available</Description>
                                <Parameter name="DN_SuMSubscriptionProfile">
                                    <Ref name="__DISTINGUISH_NAME" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!--NGHLR1FAG171653 BEGIN-->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                            <Description>- Call BeExistEntry.create to know if Dn_Input exist</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME" />
<!--Add for DB roundtrip optimizaiton begin-->
                                <Parameter name="__NO_DB_EXCHANGE">
                                    <Val>true</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                            </In>
                            <Out>
                                <Parameter name="existEntry">
                                    <Ref name="__BOOL" />
                                </Parameter>
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="neq">
                                <Ref name="existEntry" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <ThrowException>
                                    <Error ErrorId="1">
                                        <Frame FrameId="10117">
                                            <StringAttributeType>
                                                <Ref name="suMSubscriberProfileId" />
                                            </StringAttributeType>
                                            <StringAttributeType>
                                                <Val>Basic Subscription</Val>
                                            </StringAttributeType>
                                        </Frame>
                                    </Error>
                                </ThrowException>
                            </Then>
                        </If>
<!--NGHLR1FAG171653 end-->
<!-- beg SDMA01FAG279379 by Wayne -->
<!-- begin73118 Wayne -->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>- Query on Entry SuMSubscriptionProfile</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="DN_SuMSubscriptionProfile" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>subscriberType_@@_associatedMainMsisdn_@@_icsIndicator</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="subscriberType" />
                                <Parameter name="associatedMainMsisdn" />
<!--Add for 71037 qdiao begin-->
                                <Parameter name="icsIndicator" />
<!--Add for 71037 qdiao end-->
                            </Out>
                        </CallBE>
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>Query on Entry MobileStationInternalISDN on associatedMainMsisdn attribute</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedMainMsisdn" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>associatedIMSI</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="associatedIMSI" />
                            </Out>
                        </CallBE>
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedIMSI" />
                                </Parameter>
                            </In>
                            <Out>
                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                <Parameter name="mobileCountryCodeId">
                                    <Ref name="mobileCountryCodeId" />
                                </Parameter>
                                <Parameter name="mobileNetworkCodeId">
                                    <Ref name="mobileNetworkCodeId" />
                                </Parameter>
                                <Parameter name="mSubIdentificationNumberId">
                                    <Ref name="mSubIdentificationNumberId" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!--check if the  current DN is  DN_By_IMSI_For_Basic or Official_DN_By_IMSI_For_Basic-->
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>DN_By_IMSI_For_Basic</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="ret1">
                                    <Ref name="__BOOL" />
                                </Parameter>
                            </Out>
                        </CallBE>
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>Official_DN_By_IMSI_For_Basic</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="ret2">
                                    <Ref name="__BOOL" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!-- begin for Daniel 73436 GlobalQuery-->
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>wholeIMSI_DN</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="__BOOL" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="__BOOL" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="ret1">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>wholeMSISDN_DN</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="__BOOL" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="__BOOL" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="ret1">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>wholesuMSubscriberProfile_DN</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="__BOOL" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="__BOOL" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="ret1">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>wholeExtendedSubscriber_DN</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="__BOOL" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="__BOOL" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="ret1">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
                        <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="checkDnSyntax">
                            <Description>check dnSyntax</Description>
                            <In>
                                <Parameter name="__SOURCE_NAME">
                                    <Val>__INTERFACE_DISTINGUISH_NAME</Val>
                                </Parameter>
                                <Parameter name="__INTERFACE_DISTINGUISH_NAME" />
                                <Parameter name="dnSyntax">
                                    <Val>wholeExtSubscriber2nd_DN</Val>
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="__BOOL" />
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="eq">
                                <Ref name="__BOOL" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="ret1">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
<!-- end for Daniel 73436 GlobalQuery-->
<!-- subscriberType is not SHARED_SUBS_SLAVE -->
<!-- Begin Wrap all the following query part -->
<!-- end73118 Wayne -->
<!-- end SDMA01FAG279379 by Wayne -->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>- Query on Entry SuMSubscriptionProfile</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="DN_SuMSubscriptionProfile" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
                                    <Val>deactivatedDomains_@@_associatedMainMsisdn_@@_multiSimMember_@@_roleInMultiSim_@@_deactivatedSubscription_@@_msimPublicMsisdn</Val>
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                <Parameter name="__NO_DB_EXCHANGE">
                                    <Val>true</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                            </In>
                            <Out>
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
                                <Parameter name="deactivatedDomains" />
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                                <Parameter name="associatedMainMsisdn" />
                                <Parameter name="multiSimMember" />
                                <Parameter name="roleInMultiSim" />
                                <Parameter name="deactivatedSubscription" />
                                <Parameter name="msimPublicMsisdn" />
                            </Out>
                        </CallBE>
<!--Begin Feature MultiSIMCard -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSA025" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="multiSimMember" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="msimPublicMsisdn" />
                                            <Null />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                            <Description>extract fields of link msimPublicMsisdn</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="msimPublicMsisdn" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Description />
                                                <Parameter name="MSIMMemberPublicCC">
                                                    <Ref name="countryCodeId" />
                                                </Parameter>
                                                <Parameter name="MSIMMemberPublicNDC">
                                                    <Ref name="nationalDestinationCodeId" />
                                                </Parameter>
                                                <Parameter name="MSIMMemberPublicSN">
                                                    <Ref name="subscriberNumberId" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
<!-- SDMA01FAG219550 2008-8-12 12:55 -->
                            <Else>
                                <Remove name="multiSimMember" />
                                <Remove name="roleInMultiSim" />
                                <Remove name="msimPublicMsisdn" />
                            </Else>
<!-- SDMA01FAG219550 2008-8-12 12:55 -->
                        </If>
<!-- set ProfileStatus -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="deactivatedSubscription" />
                                <Val>false</Val>
                            </Condition>
                            <Then>
                                <Set name="ProfileStatus">
                                    <Val>ACT</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ProfileStatus">
                                    <Val>INACT</Val>
                                </Set>
                            </Else>
                        </If>
<!--Begin Feature MultiSIMCard -->
<!-- 
                        ***************************************************************************************
                        *   4.2   Query on  DN of Entry SubscriberNumber of mainMSISDN to get countryCodeId, nationalDestinationCodeId and subscriberNumberId
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>extract fields of link associatedMainMsisdn</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedMainMsisdn" />
                                </Parameter>
                            </In>
                            <Out>
                                <Description />
                                <Parameter name="countryCodeId" />
                                <Parameter name="nationalDestinationCodeId" />
                                <Parameter name="subscriberNumberId" />
                            </Out>
                        </CallBE>
<!--
                         
                        ***************************************************************************************
                        * Query on  Entry BasicSubscription to get attribute networkAccessMode
                        * feature723320 add by qiangfw 
                        *************************************************************************************** -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                    <Description>qdiao:Query on Entry BasicSubscription with DN_BasicSubscription (input DN)</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_BasicSubscription" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
                                            <Val>deactivatedDomains_@@_addService_@@_deactivatedSubscription_@@_subscriptionCreationTime_@@_subscriptionStateChangeTime_@@_subscriptionPurchaseTime_@@_networkAccessMode_@@_bscWithoutSN_@@_vlrSgsnServiceNodeNotification_@@_plmnServiceNodeNotification_@@_ccServiceNodeNotification_@@_accessRestrictionData_@@_mapScreeningCategory_@@_prepay_@@_prepayCommonGroupId_@@_smsRouteViaHNetwRoam_@@_serviceProviderReference_@@_subscriberType</Val>
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <AllParameters>
                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                        </AllParameters>
                                    </Out>
                                </CallBE>
                            </Then>
                        </If>
<!-- 
                        ***************************************************************************************
                        *   4.3   Query on  Entry SubscriberNumber of mainMSISDN
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>Query on Entry MobileStationInternalISDN on associatedMainMsisdn attribute</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedMainMsisdn" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>associatedBasicServices_@@_associatedIMSI_@@_underTracingMsisdn_@@_portoutFlag</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                <Parameter name="__NO_DB_EXCHANGE">
                                    <Val>true</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                            </In>
                            <Out>
                                <Parameter name="associatedBasicServices" />
                                <Parameter name="associatedIMSI" />
<!--  For feature 67488 begin -->
                                <Parameter name="underTracingMsisdn" />
<!--  For feature 67488 end -->
<!-- SDMA01CAG258860 begin -->
                                <Parameter name="portoutFlag" />
<!-- SDMA01CAG258860 end -->
                            </Out>
                        </CallBE>
<!-- 
                        ***************************************************************************************
                        *   4.4   Build MainSNwithBearerService
                        *************************************************************************************** -->
<!--Feature723320 begin, added by qiangfw, 20110603-->
                        <Set name="IsFindMainSNwithBearerService">
                            <Val>false</Val>
                        </Set>
                        <Remove name="newSNwithBearerServiceList" />
<!--Feature723320 end, added by qiangfw, 20110603-->
                        <Foreach name="DN_BSC">
                            <MultiValue>
                                <Ref name="associatedBasicServices" />
                            </MultiValue>
                            <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId</Description>
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME">
                                        <Ref name="DN_BSC" />
                                    </Parameter>
                                </In>
                                <Out>
                                    <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId</Description>
                                    <Parameter name="mobileCountryCodeId">
                                        <Ref name="mobileCountryCodeId" />
                                    </Parameter>
                                    <Parameter name="mobileNetworkCodeId">
                                        <Ref name="mobileNetworkCodeId" />
                                    </Parameter>
                                    <Parameter name="basicServiceGroupId">
                                        <Val>SPEECH</Val>
                                    </Parameter>
                                    <Parameter name="basicServiceCodeId">
                                        <Ref name="basicServiceCodeId" />
                                    </Parameter>
                                    <Parameter name="BearerCapabilityName">
                                        <Ref name="serviceCodeMnemonicId" />
                                    </Parameter>
                                </Out>
                            </CallBE>
                            <CallBE entityName="HSS.SUB.*.BeString" name="create">
                                <Description />
                                <In>
                                    <Parameter name="__DESTINATION_NAME">
                                        <Val>MainSNwithBearerServiceElement</Val>
                                    </Parameter>
                                    <Parameter name="__SYNTAX">
                                        <Val>countryCodeId-nationalDestinationCodeId-subscriberNumberId:BearerCapabilityName</Val>
                                    </Parameter>
                                    <Parameter name="countryCodeId" />
                                    <Parameter name="nationalDestinationCodeId" />
                                    <Parameter name="subscriberNumberId" />
                                    <Parameter name="BearerCapabilityName" />
                                </In>
                                <Out>
                                    <Parameter name="MainSNwithBearerServiceElement" />
                                </Out>
                            </CallBE>
                            <Set name="MainSNwithBearerService">
                                <MultiValue>
                                    <Ref name="MainSNwithBearerService" />
                                    <Ref name="MainSNwithBearerServiceElement" />
                                </MultiValue>
                            </Set>
<!--Feature723320 begin, added by qiangfw, 20110603-->
                            <If>
                                <Condition operator="eq">
                                    <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                    <Val>true</Val>
                                </Condition>
                                <Then>
                                    <If>
                                        <AND>
                                            <Condition operator="eq">
                                                <Ref name="networkAccessMode" />
                                                <Val>BOTH</Val>
                                            </Condition>
                                            <Condition operator="neq">
                                                <Ref name="BearerCapabilityName" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                        </AND>
                                        <Then>
                                            <Set name="newSNwithBearerServiceList">
                                                <MultiValue>
                                                    <Ref name="MainSNwithBearerServiceElement" />
                                                    <Ref name="newSNwithBearerServiceList" />
<!--Ref name="MainSNwithBearerServiceElement"/-->
                                                </MultiValue>
                                            </Set>
                                            <Set name="IsFindMainSNwithBearerService">
                                                <Val>true</Val>
                                            </Set>
                                        </Then>
                                    </If>
                                </Then>
                            </If>
<!--Feature723320 end, added by qiangfw, 20110603-->
                        </Foreach>
<!--Feature723320 begin, added by qiangfw, 20110603-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="IsFindMainSNwithBearerService" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="newSNwithBearerServiceList">
                                            <MultiValue>
                                                <Ref name="MainSNwithBearerService" />
                                                <Ref name="newSNwithBearerServiceList" />
<!--Ref name="MainSNwithBearerServiceElement"/-->
                                            </MultiValue>
                                        </Set>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!--Feature723320 end, added by qiangfw, 20110603-->
<!-- 
                        ***************************************************************************************
                        *   4.5   Query on  DN of Entry MSubIdentificationNumber  of  associatedIMSI to get mobileCountryCodeId, mobileNetworkCodeId and mSubIdentificationNumberId
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedIMSI" />
                                </Parameter>
                            </In>
                            <Out>
                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link associatedIMSI</Description>
                                <Parameter name="mobileCountryCodeId">
                                    <Ref name="mobileCountryCodeId" />
                                </Parameter>
                                <Parameter name="mobileNetworkCodeId">
                                    <Ref name="mobileNetworkCodeId" />
                                </Parameter>
                                <Parameter name="mSubIdentificationNumberId">
                                    <Ref name="mSubIdentificationNumberId" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!-- 
                        ***************************************************************************************
                        *   4.6   Query on Entry MSubIdentificationNumber
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>Query on Entry MSubIdentificationNumber on associatedIMSI attribute</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedIMSI" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                    <Val>associatedMSISDN_@@_underTracingImsi</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                <Parameter name="__NO_DB_EXCHANGE">
                                    <Val>true</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                            </In>
                            <Out>
                                <Parameter name="associatedMSISDN">
                                    <Ref name="associatedMSISDN" />
                                </Parameter>
<!--  For feature 67488 begin -->
                                <Parameter name="underTracingImsi" />
<!-- For feature 67488 end -->
                            </Out>
                        </CallBE>
<!-- 
                        ***************************************************************************************
                        *   4.7   Build SNwithBearerServiceList from associatedMSISDN
                        *************************************************************************************** -->
                        <Foreach name="DN_MSISDN">
                            <MultiValue>
                                <Ref name="associatedMSISDN" />
                            </MultiValue>
                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME">
                                        <Ref name="DN_MSISDN" />
                                    </Parameter>
                                </In>
                                <Out>
                                    <Description>Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN</Description>
                                    <Parameter name="countryCodeId" />
                                    <Parameter name="nationalDestinationCodeId" />
                                    <Parameter name="subscriberNumberId" />
                                </Out>
                            </CallBE>
                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                <Description>Query on Entry MsisdnCharacteristics on one associatedMSISDN attribute</Description>
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME">
                                        <Ref name="DN_MSISDN" />
                                    </Parameter>
                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                        <Val>associatedIMSI_@@_associatedBasicServices</Val>
                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                    <Parameter name="__NO_DB_EXCHANGE">
                                        <Val>true</Val>
                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                </In>
                                <Out>
                                    <Parameter name="associatedIMSI" />
                                    <Parameter name="associatedBasicServices" />
                                </Out>
                            </CallBE>
<!-- NGHLR1FAG186920 begin -->
                            <If>
                                <Condition operator="eq">
                                    <Ref name="nationalDestinationCodeId" />
                                    <NotExist />
                                </Condition>
                                <Then>
                                    <Set name="nationalDestinationCodeId">
                                        <Val />
                                    </Set>
                                </Then>
                            </If>
<!-- NGHLR1FAG186920 end-->
                            <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="create">
                                <In>
                                    <Parameter name="associatedBasicServices" />
                                    <Parameter name="countryCodeId" />
                                    <Parameter name="nationalDestinationCodeId" />
                                    <Parameter name="subscriberNumberId" />
                                    <Parameter name="BearerCapabilityName" />
                                </In>
                                <Out>
                                    <Parameter name="SNwithBearerServiceQuery" />
                                </Out>
                            </CallBE>
                            <Set name="SNwithBearerServiceList">
                                <MultiValue>
                                    <Ref name="SNwithBearerServiceList" />
                                    <Ref name="SNwithBearerServiceQuery" />
                                </MultiValue>
                            </Set>
                        </Foreach>
<!--Feature723320 begin, added by qiangfw, 20110603-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSA114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
<!--Add for FR SDMA01FAG279044 begin-->
                                <Set name="newSNwithBearerServiceList">
                                    <MultiValue>
                                        <Ref name="newSNwithBearerServiceList" />
                                        <Ref name="SNwithBearerServiceList" />
                                    </MultiValue>
                                </Set>
                                <Remove name="SNwithBearerServiceList" />
                                <Set name="SNwithBearerServiceList">
                                    <MultiValue>
                                        <Ref name="newSNwithBearerServiceList" />
<!--Ref name="SNwithBearerServiceList"/-->
<!--Ref name="newSNwithBearerServiceList"/-->
                                    </MultiValue>
                                </Set>
<!--Add for FR SDMA01FAG279044 end-->
                                <Remove name="MainSNwithBearerService" />
                            </Then>
                        </If>
<!--Feature723320 end, added by qiangfw, 20110603-->
<!-- 
                        ***************************************************************************************
                        *   4.8   Query on Entry BasicSubscription
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                            <Description>Query on Entry BasicSubscription with DN_BasicSubscription (input DN)</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="DN_BasicSubscription" />
                                </Parameter>
                                <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- R2.3 -->
<!-- timeStamp -->
<!-- Add for feature (MapScreening) <mapScreeningCategory> -->
<!--Feature 67386-->
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
                                    <Val>deactivatedDomains_@@_addService_@@_deactivatedSubscription_@@_subscriptionCreationTime_@@_subscriptionStateChangeTime_@@_subscriptionPurchaseTime_@@_networkAccessMode_@@_bscWithoutSN_@@_vlrSgsnServiceNodeNotification_@@_plmnServiceNodeNotification_@@_ccServiceNodeNotification_@@_accessRestrictionData_@@_mapScreeningCategory_@@_prepay_@@_prepayCommonGroupId_@@_smsRouteViaHNetwRoam_@@_serviceProviderReference_@@_subscriberType</Val>
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                <Parameter name="__NO_DB_EXCHANGE">
                                    <Val>true</Val>
                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                            </In>
                            <Out>
                                <AllParameters>
                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                </AllParameters>
                            </Out>
                        </CallBE>
                        <If>
                            <Condition operator="neq">
                                <Ref name="fSS110" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractAuc" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Remove name="subscriberType">
                                    <MultiValue>
                                        <Val>FMC</Val>
                                    </MultiValue>
                                </Remove>
                            </Then>
                        </If>
<!-- Add for Feature 67398  Start-->
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="fSMS104" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                    <Val>false</Val>
                                </Condition>
                                <AND>
                                    <Condition operator="neq">
                                        <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        <Val>SUBSCRIBER</Val>
                                    </Condition>
                                    <Condition operator="neq">
                                        <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        <Val>SUBNWKENT</Val>
                                    </Condition>
<!--beginF71046guowei-->
                                    <Condition operator="neq">
                                        <Ref name="dummyVlrForSmsApplicability" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
                                        <Val>SUBNWKENTRLY</Val>
                                    </Condition>
<!--endF71046guowei-->
                                </AND>
                            </OR>
                            <Then>
                                <Remove name="smsRouteViaHNetwRoam" />
                            </Then>
                        </If>
<!-- Add for Feature 67398 End-->
<!-- Add for Feature 67435 Start-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSPS001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>false</Val>
                            </Condition>
                            <Then>
                                <Remove name="serviceProviderReference" />
                            </Then>
                        </If>
<!-- Add for Feature 67435 End-->
<!-- Add for feature (MapScreening) Start -->
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="mapScreeningCategory" />
                                    <Null />
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" name="fSA023" />
                                    <Val>false</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR046" />
                                    <Val>false</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR045" />
                                    <Val>false</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR049" />
                                    <Val>false</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref entityName="HSS.ContractData.ContractData.Cont_OAM_ContractLocationSecurity" name="fLR050" />
                                    <Val>false</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="mapScreeningCategory">
                                    <Null />
                                </Set>
                            </Then>
                        </If>
<!-- Add for feature (MapScreening) End -->
<!-- timeStamp -->
                        <If>
                            <Condition operator="neq">
                                <Ref name="fSA102" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Remove name="deactivatedSubscription" />
                                <Remove name="subscriptionCreationTime" />
                                <Remove name="subscriptionStateChangeTime" />
                                <Remove name="subscriptionPurchaseTime" />
                            </Then>
                        </If>
<!-- timeStamp End -->
<!-- 
                        ***************************************************************************************
                        *   4.9   Build BearerServiceWithoutSNList from bscWithoutSN
                        *************************************************************************************** -->
                        <Foreach name="DN_BSC">
                            <MultiValue>
                                <Ref name="bscWithoutSN" />
                            </MultiValue>
                            <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId,serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                <In>
                                    <Parameter name="__DISTINGUISH_NAME">
                                        <Ref name="DN_BSC" />
                                    </Parameter>
                                </In>
                                <Out>
                                    <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId,serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                    <Parameter name="mobileCountryCodeId" />
                                    <Parameter name="mobileNetworkCodeId" />
                                    <Parameter name="basicServiceGroupId" />
                                    <Parameter name="basicServiceCodeId" />
                                    <Parameter name="BearerCapabilityName">
                                        <Ref name="serviceCodeMnemonicId" />
                                    </Parameter>
                                </Out>
                            </CallBE>
                            <Set name="BearerServiceWithoutSNList">
                                <MultiValue>
                                    <Ref name="BearerServiceWithoutSNList" />
                                    <Ref name="BearerCapabilityName" />
                                </MultiValue>
                            </Set>
                        </Foreach>
<!--***************************************************************************************
            * Add for SDMA01CAG271493 begin build ExtendedBearerServiceWithoutSNList
            *************************************************************************************** -->
                        <If>
                            <Condition operator="notNullIntersection">
                                <Ref name="contspare7" entityName="HSS.ContractData.ContractData.Cont_OAM_ContSpareData" />
                                <Val>fSA115</Val>
                            </Condition>
                            <Then>
                                <Foreach name="ExtendedBearerServiceWithoutSN">
                                    <MultiValue>
<!--Ref name="AllowedExtendedBearerServiceWithoutSNList" /-->
                                        <Ref name="BSCofBSG20" defaultValue="force" />
                                    </MultiValue>
                                    <If>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                            <Ref name="subscriberType" />
                                        </Condition>
                                        <Then>
                                            <Set name="ExtendedBearerServiceWithoutSNList">
                                                <MultiValue>
                                                    <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                </MultiValue>
                                            </Set>
                                            <Remove name="subscriberType">
                                                <MultiValue>
                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                </MultiValue>
                                            </Remove>
                                        </Then>
                                    </If>
                                </Foreach>
                            </Then>
                            <Else>
                                <Foreach name="ExtendedBearerServiceWithoutSN">
                                    <MultiValue>
                                        <Ref name="BSCofBSG20" defaultValue="force" />
                                    </MultiValue>
                                    <If>
                                        <Condition operator="notNullIntersection">
                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                            <Ref name="subscriberType" />
                                        </Condition>
                                        <Then>
                                            <Remove name="subscriberType">
                                                <Ref name="ExtendedBearerServiceWithoutSN" />
                                            </Remove>
                                        </Then>
                                    </If>
                                </Foreach>
                            </Else>
                        </If>
<!--
                        ***************************************************************************************
                        *   4.10  build ServiceNodeNotificationList
                        *************************************************************************************** -->
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="vlrSgsnServiceNodeNotification" />
                                    <Null />
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="vlrSgsnServiceNodeNotification" />
                                    <Ref name="plmnServiceNodeNotification" />
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="vlrSgsnServiceNodeNotification" />
                                    <Ref name="ccServiceNodeNotification" />
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="trigger">
                                    <Val>ALL</Val>
                                </Set>
                                <LockPolicy name="sharedResource" type="noLock">
                                    <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                        <In>
                                            <Parameter name="__DISTINGUISH_NAME">
                                                <Ref name="vlrSgsnServiceNodeNotification" />
                                            </Parameter>
                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                <Val>serverAddress</Val>
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                            <Parameter name="__NO_DB_EXCHANGE">
                                                <Val>true</Val>
                                            </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                        </In>
                                        <Out>
                                            <AllParameters>
                                                <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                            </AllParameters>
                                        </Out>
                                    </CallBE>
                                </LockPolicy>
                                <Set name="SNaddress">
                                    <Ref name="serverAddress" />
                                </Set>
                                <CallBE name="create" entityName="HSS.SUB.*.BeString">
                                    <Description>Build string including countryCodeId,nationalDestinationCodeId,subscriberNumberId:basicServiceCodeId based on one value of associatedMSISDNand one value of associatedBasicServices</Description>
                                    <In>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>ServiceNodeNotification</Val>
                                        </Parameter>
                                        <Parameter name="__SYNTAX">
                                            <Val>trigger-SNaddress</Val>
                                        </Parameter>
                                        <Parameter name="trigger" />
                                        <Parameter name="SNaddress" />
                                    </In>
                                    <Out>
                                        <Description>SNwithBearerService is valorized</Description>
                                        <Parameter name="ServiceNodeNotification" />
                                    </Out>
                                </CallBE>
                                <Set name="ServiceNodeNotificationList">
                                    <MultiValue>
                                        <Ref name="ServiceNodeNotificationList" />
                                        <Ref name="ServiceNodeNotification" />
                                    </MultiValue>
                                </Set>
                            </Then>
                            <Else>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="vlrSgsnServiceNodeNotification" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="trigger">
                                            <Val>VLRSGSN</Val>
                                        </Set>
                                        <LockPolicy name="sharedResource" type="noLock">
                                            <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="vlrSgsnServiceNodeNotification" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>serverAddress</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <AllParameters>
                                                        <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                    </AllParameters>
                                                </Out>
                                            </CallBE>
                                        </LockPolicy>
                                        <Set name="SNaddress">
                                            <Ref name="serverAddress" />
                                        </Set>
                                        <CallBE name="create" entityName="HSS.SUB.*.BeString">
                                            <Description>Build string including countryCodeId,nationalDestinationCodeId,subscriberNumberId:basicServiceCodeId based on one value of associatedMSISDNand one value of associatedBasicServices</Description>
                                            <In>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>ServiceNodeNotification</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>trigger-SNaddress</Val>
                                                </Parameter>
                                                <Parameter name="trigger" />
                                                <Parameter name="SNaddress" />
                                            </In>
                                            <Out>
                                                <Description>SNwithBearerService is valorized</Description>
                                                <Parameter name="ServiceNodeNotification" />
                                            </Out>
                                        </CallBE>
                                        <Set name="ServiceNodeNotificationList">
                                            <MultiValue>
                                                <Ref name="ServiceNodeNotificationList" />
                                                <Ref name="ServiceNodeNotification" />
                                            </MultiValue>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="plmnServiceNodeNotification" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="trigger">
                                            <Val>PLMN</Val>
                                        </Set>
                                        <LockPolicy name="sharedResource" type="noLock">
                                            <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="plmnServiceNodeNotification" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>serverAddress</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <AllParameters>
                                                        <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                    </AllParameters>
                                                </Out>
                                            </CallBE>
                                        </LockPolicy>
                                        <Set name="SNaddress">
                                            <Ref name="serverAddress" />
                                        </Set>
                                        <CallBE name="create" entityName="HSS.SUB.*.BeString">
                                            <Description>Build string including countryCodeId,nationalDestinationCodeId,subscriberNumberId:basicServiceCodeId based on one value of associatedMSISDNand one value of associatedBasicServices</Description>
                                            <In>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>ServiceNodeNotification</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>trigger-SNaddress</Val>
                                                </Parameter>
                                                <Parameter name="trigger" />
                                                <Parameter name="SNaddress" />
                                            </In>
                                            <Out>
                                                <Description>SNwithBearerService is valorized</Description>
                                                <Parameter name="ServiceNodeNotification" />
                                            </Out>
                                        </CallBE>
                                        <Set name="ServiceNodeNotificationList">
                                            <MultiValue>
                                                <Ref name="ServiceNodeNotificationList" />
                                                <Ref name="ServiceNodeNotification" />
                                            </MultiValue>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="ccServiceNodeNotification" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <Set name="trigger">
                                            <Val>COUNTRY</Val>
                                        </Set>
                                        <LockPolicy name="sharedResource" type="noLock">
                                            <CallBE name="query" entityName="HSS.SUB.*.BeGDMI">
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="ccServiceNodeNotification" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>serverAddress</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                    <Parameter name="__NO_DB_EXCHANGE">
                                                        <Val>true</Val>
                                                    </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                                </In>
                                                <Out>
                                                    <AllParameters>
                                                        <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                    </AllParameters>
                                                </Out>
                                            </CallBE>
                                        </LockPolicy>
                                        <Set name="SNaddress">
                                            <Ref name="serverAddress" />
                                        </Set>
                                        <CallBE name="create" entityName="HSS.SUB.*.BeString">
                                            <Description>Build string including countryCodeId,nationalDestinationCodeId,subscriberNumberId:basicServiceCodeId based on one value of associatedMSISDNand one value of associatedBasicServices</Description>
                                            <In>
                                                <Parameter name="__DESTINATION_NAME">
                                                    <Val>ServiceNodeNotification</Val>
                                                </Parameter>
                                                <Parameter name="__SYNTAX">
                                                    <Val>trigger-SNaddress</Val>
                                                </Parameter>
                                                <Parameter name="trigger" />
                                                <Parameter name="SNaddress" />
                                            </In>
                                            <Out>
                                                <Description>SNwithBearerService is valorized</Description>
                                                <Parameter name="ServiceNodeNotification" />
                                            </Out>
                                        </CallBE>
                                        <Set name="ServiceNodeNotificationList">
                                            <MultiValue>
                                                <Ref name="ServiceNodeNotificationList" />
                                                <Ref name="ServiceNodeNotification" />
                                            </MultiValue>
                                        </Set>
                                    </Then>
                                </If>
                            </Else>
                        </If>
<!-- 
                        ***************************************************************************************
                        *   4.11  extract fields  of link associatedIMSI
                        *************************************************************************************** -->
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                            <Description>extract fields of link associatedIMSI</Description>
                            <In>
                                <Parameter name="__DISTINGUISH_NAME">
                                    <Ref name="associatedIMSI" />
                                </Parameter>
                            </In>
                            <Out>
                                <Parameter name="mobileCountryCodeId">
                                    <Ref name="mobileCountryCodeId" />
                                </Parameter>
                                <Parameter name="mobileNetworkCodeId">
                                    <Ref name="mobileNetworkCodeId" />
                                </Parameter>
                                <Parameter name="mSubIdentificationNumberId">
                                    <Ref name="mSubIdentificationNumberId" />
                                </Parameter>
                            </Out>
                        </CallBE>
<!-- 
                        ***************************************************************************************
                        *   4.12  Query CsServiceProfile
                        *************************************************************************************** -->
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="networkAccessMode" />
                                    <Val>BOTH</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                    <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                </Condition>
                            </OR>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN CsServiceProfile available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>CsServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN CsServiceProfile available</Description>
                                        <Parameter name="DN_CsServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSServiceProfile" name="query">
                                    <Description>Query Entry CsServiceProfile</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_CsServiceProfile" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>msCategory_@@_opSpecificCategory_@@_singleNumbering_@@_csAllocationRetentionPriority_@@_IpreferedCarrier_@@_csLastUpdateTime</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <AllParameters>
                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                        </AllParameters>
                                    </Out>
                                </CallBE>
                            </Then>
                        </If>
<!-- 
                        ***************************************************************************************
                        *   4.13  Query PsServiceProfile
                        *************************************************************************************** -->
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="networkAccessMode" />
                                    <Val>BOTH</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                    <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                </Condition>
                            </OR>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN PsServiceProfile available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>PsServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN PsServiceProfile available</Description>
                                        <Parameter name="DN_PsServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.Subscription_GPRS.MS_OAM_Subscription_GPRS" name="query">
                                    <Description>Query Entry PsServiceProfile</Description>
<!-- ZTX | 2009/08/24 | Add for LTE (69596/69597), EpsServiceProfile related attr introduced -->
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_PsServiceProfile" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- Modify begin by fucong for 70018 on 20100729 -->
<!--Val>transferOfSmOption_@@_packetMsAddressList_@@_chargingCharacteristics_@@_psLastUpdateTime</Val-->
<!-- Modify begin by Guangli for 69915 on 20100201-->
<!-- added eps3gppRestrictionListNum for 4.2 f73801 by qigangx for 4.2 f73801 on 20121210-->
<!-- added allowMmeTableId and allowSgsnTableId for 4.2 f73246 by ranli on 20130221-->
<!--Val>transferOfSmOption_@@_packetMsAddressList_@@_chargingCharacteristics_@@_psLastUpdateTime_@@_epsServiceProfile_@@_epsApnContextSetList_@@_maxRequestedBandwidthDL_@@maxRequestedBandwidthUL_@@selfActivationStatus_@@_epsAccessSubscriptionType_@@_apnOiReplacement_@@_stnSrData_@@_ratFreqSelectPriorityId_@@_non3gppAccessRestrictionData_@@_non3gppAuthenSesTimeout_@@_non3gppIpAccess_@@_non3gppIpAccessApn_@@_chargingGatewayFuncHost_@@_chargingGroup_@@_non3gppGwMobileIpCapability_@@_authVisitedNIDIdx_@@_specificApnContextList_@@_S6aRoamingRestrictionType</Val-->
                                            <Val>transferOfSmOption_@@_packetMsAddressList_@@_chargingCharacteristics_@@_authVisitedPlmnNIDId_@@_psLastUpdateTime_@@_epsServiceProfile_@@_epsApnContextSetList_@@_framedPoolSetList_@@_subIPV6AddrSetList_@@_maxRequestedBandwidthDL_@@_maxRequestedBandwidthUL_@@_selfActivationStatus_@@_epsAccessSubscriptionType_@@_apnOiReplacement_@@_stnSrData_@@_ratFreqSelectPriorityId_@@_non3gppApnOiReplacement_@@_non3gppAccessRestrictionData_@@_non3gppAuthenSesTimeout_@@_non3gppIpAccess_@@_non3gppIpAccessApn_@@_chargingGatewayFuncHost_@@_chargingGroup_@@_non3gppGwMobileIpCapability_@@_authVisitedNIDIdx_@@_specificApnContextList_@@_pcscfServerName_@@_S6aRoamingRestrictionType_@@_s6aRegRestrictionList_@@_SWxRoamingRestrictionType_@@_pprIpAddress_@@_gmlcIpAddress_@@_RauTauTimer_@@_authLipaVplmnId_@@_eps3gppRestrictionListNum_@@_mdtUserConsent_@@_roamRstrD2UFeat_@@_allowMmeTableId_@@_allowSgsnTableId</Val>
<!-- Modify end by Guangli for 69915 on 20100201-->
<!-- Modify end by fucong for 70018 on 20100729 -->
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <AllParameters>
                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                        </AllParameters>
                                    </Out>
                                </CallBE>
                            </Then>
                        </If>
<!-- 
                        ***************************************************************************************
                        *   4.14  CAMEL query
                        *************************************************************************************** -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                            <In>
                                <Parameter name="__DN_SYNTAX_NAME">
                                    <Val>GsmServiceProfile_DN</Val>
                                </Parameter>
                                <Parameter name="suMSubscriberProfileId" />
                                <Parameter name="suMSubscriptionProfileId" />
                                <Parameter name="gsmServiceProfileId" />
                            </In>
                            <Out>
                                <Parameter name="DN_GsmServiceProfile">
                                    <Ref name="__DISTINGUISH_NAME" />
                                </Parameter>
                            </Out>
                        </CallBE>
                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_CSG_Internal" name="queryCsg">
                            <Description>- query out the csgContextList</Description>
                            <In>
                                <Parameter name="DN_GsmServiceProfile" />
                            </In>
                            <Out>
                                <Parameter name="csgContextList" />
                                <Parameter name="__RECEIVED_ATTRIBUTES_VALUE" />
                            </Out>
                        </CallBE>
<!-- Add end by fucong for 70018 on 20100729 -->
<!-- Add begin by xiaozhxu for 68733 on 20100729 -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="DN_GsmSuppServiceProfile">
                                    <Ref name="__DN_HANDLER" dnSyntax="GsmSuppServiceProfile_DN" DN="__DISTINGUISH_NAME" />
                                </Set>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="__EXIST_ENTRY" DN="DN_GsmSuppServiceProfile" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_GsmSuppServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>notificationToCseFlag_@@_cfGsmSCF1_@@_cfGsmSCF2_@@_cfGsmSCF3_@@_cbGsmSCF1_@@_cbGsmSCF2_@@_cbGsmSCF3_@@_odbGsmSCF1_@@_odbGsmSCF2_@@_odbGsmSCF3_@@_csiGsmSCF1_@@_csiGsmSCF2_@@_csiGsmSCF3</Val>
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                <Parameter name="__NO_DB_EXCHANGE">
                                                    <Val>true</Val>
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                            </In>
                                            <Out>
                                                <Parameter name="notificationToCseFlag" />
                                                <Parameter name="cfGsmSCF1" />
                                                <Parameter name="cfGsmSCF2" />
                                                <Parameter name="cfGsmSCF3" />
                                                <Parameter name="cbGsmSCF1" />
                                                <Parameter name="cbGsmSCF2" />
                                                <Parameter name="cbGsmSCF3" />
                                                <Parameter name="odbGsmSCF1" />
                                                <Parameter name="odbGsmSCF2" />
                                                <Parameter name="odbGsmSCF3" />
                                                <Parameter name="csiGsmSCF1" />
                                                <Parameter name="csiGsmSCF2" />
                                                <Parameter name="csiGsmSCF3" />
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cfGsmSCF1" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cfGsmSCF1" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cfGsmSCF1">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cfGsmSCF2" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cfGsmSCF2" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cfGsmSCF2">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cfGsmSCF3" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cfGsmSCF3" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cfGsmSCF3">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cbGsmSCF1" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cbGsmSCF1" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cbGsmSCF1">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cbGsmSCF2" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cbGsmSCF2" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cbGsmSCF2">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="cbGsmSCF3" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="cbGsmSCF3" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="cbGsmSCF3">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="odbGsmSCF1" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="odbGsmSCF1" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="odbGsmSCF1">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="odbGsmSCF2" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="odbGsmSCF2" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="odbGsmSCF2">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="odbGsmSCF3" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="odbGsmSCF3" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="odbGsmSCF3">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="csiGsmSCF1" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="csiGsmSCF1" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="csiGsmSCF1">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="csiGsmSCF2" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="csiGsmSCF2" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="csiGsmSCF2">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="csiGsmSCF3" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.CAMEL.BeReserverScpCamel" name="create">
                                                    <In>
                                                        <Parameter name="dn_existing_camel">
                                                            <Ref name="csiGsmSCF3" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="csiGsmSCF3">
                                                            <Ref name="scpAddress" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- Add end by xiaozhxu for 68733 on 20100729 -->
<!-- add if SDMA01CAG220111 -->
                        <If>
                            <Condition operator="neq">
                                <Ref name="__INTERNAL_REQUEST_NAME" />
                                <Val>PRE_REQUEST_MODIFY</Val>
                            </Condition>
                            <Then>
<!-- end SDMA01CAG220111-->
                                <If>
<!--nghlr1fag181951 begin-->
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="fCA001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="fIN100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSupplementaryService" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="fIN101" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSupplementaryService" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>DN CamelServiceProfile available</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>CamelServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>DN CamelServiceProfile available</Description>
                                                <Parameter name="DN_CamelServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_CamelServiceProfile" />
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                <Parameter name="__NO_DB_EXCHANGE">
                                                    <Val>true</Val>
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="CamelServiceProfile">
                                                    <Val>1</Val>
                                                </Set>
                                                <CallBE entityName="HSS.SUB.CAMEL.GENERAL_CAMEL" name="query">
                                                    <Description>Query Entry CamelServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_CamelServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>
                                                            OcsiServiceProfile_@@_TcsiServiceProfile_@@_McsiServiceProfile_@@_SscsiServiceProfile_@@_UcsiServiceProfile_@@_SmocsiServiceProfile_@@_SmtcsiServiceProfile_@@_GprscsiServiceProfile_@@_DcsiServiceProfile_@@_VTcsiServiceProfile_@@_camelLocationRequestFlag_@@_camelStatusRequestFlag_@@_camelMarkActivationRoamers_@@_camelMarkInhibitionRoamersCs_@@_ocsiCamelSubState_@@_ocsiCamelCapabilityHandling_@@_ocsiCamelVlrNotSuppDfltHandl_@@_ocsiCamelGmscNotSuppDfltHdl_@@_tifcsiTransformationInformFlag_@@_ocsiCollectedInfoTdpServKey_@@_ocsiCollectedInfoTdpScpIsdn_@@_ocsiCollectedInfoTdpDfltCalH_@@_callTypeCriteria_@@_destinationNumberCritList_@@_matchType_@@_destNbLengthCriteriaList_@@_originBscCritList_@@_originBsgCritList_@@_ocsiRouteSelectFailTdpServKey_@@_ocsiRouteSelectFailTdpScpIsdn_@@_ocsiRouteSelectFailTdpDfltCalH_@@_routeSelectFailTdpCauVCritList_@@_oickKey_@@_tcsiCamelSubState_@@_tcsiCamelCapabilityHandling_@@_tcsiCamelGmscNotSuppDfltHandl_@@_tcsiTermAttemptTdpServKey_@@_tcsiTermAttemptTdpScpIsdn_@@_tcsiTermAttemptTdpDfltCalH_@@_terminBscCritList_@@_terminBsgCritList_@@_tcsiTBusyTdpServKey_@@_tcsiTBusyTdpScpIsdn_@@_tcsiTBusyTdpDfltCalH_@@_tbusyTdpCauseValueCritList_@@_tcsiTNoAnswTdpServKey_@@_tcsiTNoAnswTdpScpIsdn_@@_tcsiTNoAnswTdpDfltCalH_@@_tnoAnswTdpCauseValueCritList_@@_homeTickKey_@@_roamTickKey_@@_mobilityTriggers_@@_mcsiServKey_@@_mcsiScpIsdn_@@_mcsiCamelSubState_@@_mcsiCamelVlrNotSuppDfltHdl_@@_sscsiScpIsdn_@@_sscsiCheckSSindicator_@@_sscsiCamelSubState_@@_sscsiCamelVlrNotSuppDfltHdl_@@_ucsiCamelServiceList_@@_smocsiCamelSubState_@@_smocsiCamelCapabilityHandling_@@_smocsiCamelNotSuppDfltHdl_@@_smocsiCollectedInfoTdpServKey_@@_smocsiCollectedInfoTdpScpIsdn_@@_smocsiCollectedInfoTdpDfltCalH_@@_smtcsiCamelSubState_@@_smtcsiCamelCapabilityHandling_@@_smtcsiCamelNotSuppDfltHdl_@@_smtcsiDeliveryReqTdpServKey_@@_smtcsiDeliveryReqTdpScpIsdn_@@_smtcsiDeliveryReqTdpDfltSmsHdl_@@_smtcsiTpduSmsDelivCrit_@@_smtcsiTpduSmsStatusRepCrit_@@_gprscsiCamelSubState_@@_gprscsiCamelCapabilityHandling_@@_gprscsiCamelSgsnNotSuppDfltHdl_@@_camelMarkInhibitionRoamersPs_@@_gprscsiPdpConChgPosTdpServKey_@@_gprscsiPdpConChgPosTdpScpIsdn_@@_gprscsiPdpConChgPosTdpDfltCalH_@@_gprscsiAttachProcTdpServKey_@@_gprscsiAttachProcTdpScpIsdn_@@_gprscsiAttachProcTdpDfltCalH_@@_gprscsiChgPositionTdpServKey_@@_gprscsiChgPositionTdpScpIsdn_@@_gprscsiChgPositionTdpDfltCalH_@@_gprscsiPdpConEstabTdpServKey_@@_gprscsiPdpConEstabTdpScpIsdn_@@_gprscsiPdpConEstabTdpDfltCalH_@@_gprscsiPdpConEstAckTdpServKey_@@_gprscsiPdpConEstAckTdpScpIsdn_@@_gprscsiPdpConEstAckTdpDfltCalH_@@_dcsiCamelSubState_@@_dcsiCamelCapabilityHandling_@@_dcsiCamelGmscNotSuppDfltHdl_@@_dcsiCamelServiceList_@@_dcsiCamelVlrNotSuppDfltHandl_@@_vtcsiCamelSubState_@@_vtcsiCamelCapabilityHandling_@@_vtcsiCamelVlrNotSuppDfltHandl_@@_vtcsiTermAttemptTdpServKey_@@_vtcsiTermAttemptTdpScpIsdn_@@_vtcsiTermAttemptTdpDfltCalH_@@_vterminBscCritList_@@_vterminBsgCritList_@@_vtcsiTBusyTdpServKey_@@_vtcsiTBusyTdpScpIsdn_@@_vtcsiTBusyTdpDfltCalH_@@_vtbusyTdpCauseValueCritList_@@_vtcsiTNoAnswTdpServKey_@@_vtcsiTNoAnswTdpScpIsdn_@@_vtcsiTNoAnswTdpDfltCalH_@@_vtnoAnswTdpCauseValueCritList</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <AllParameters>
                                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                        </AllParameters>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!--nghlr1fag181951 end-->
<!-- 
                        ***************************************************************************************
                        *   4.15  RoamingRestriction query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN RoamingGsmServiceProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>RoamingGsmServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN RoamingGsmServiceProfile available</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.RoamingRestriction.MS_OAM_RoamingRestriction" name="query">
                                    <Description>Query Entry Roaming</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>RoamingRestrictionType_@@_csRestrictionListNum_@@_psRestrictionListNum_@@_regSubscriptionListId</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
<!-- 73338 -->
                                        <Parameter name="__SPECIAL_LOGICNAME_MAPPING">
                                            <Ref name="__SPECIAL_LOGICNAME_MAPPING" />
                                        </Parameter>
                                        <AllParameters>
                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                        </AllParameters>
                                    </Out>
                                </CallBE>
                                <If>
                                    <OR>
                                        <Condition operator="setGreater">
                                            <Ref name="RoamingRestrictionType" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="csRestrictionListNum" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="psRestrictionListNum" />
                                            <Null />
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <Set name="RoamingServiceProfile">
                                            <Val>1</Val>
                                        </Set>
                                    </Then>
                                </If>
<!-- 
                        ***************************************************************************************
                        *   4.16  ODB query
                        *************************************************************************************** -->
<!-- NGHLR1FAG191506 -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                    <Description>- 2.1:build DN_GsmServiceProfile from OdbServiceProfile_DN</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>GsmServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_GsmServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                    <Description>- 2.3:query on ENTRY GsmServiceProfile (networkAccessMode)</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_GsmServiceProfile" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>odbGlobalServiceProfile</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="odbGlobalServiceProfile" />
                                    </Out>
                                </CallBE>
<!-- NGHLR1FAG191506 end -->
<!--nghlr1fag181951 begin -->
                                <If>
<!-- NGHLR1FAG191506  -->
<!-- SDMA01FAG258763 begin -->
<!--AND-->
<!-- NGHLR1FAG191506 end -->
<!--Condition operator="eq">
                                    <Ref name="fODB001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSupplementaryService"/>
                                    <Val>true</Val>
                                </Condition-->
<!-- NGHLR1FAG191506 -->
                                    <Condition operator="eq">
                                        <Ref name="odbGlobalServiceProfile" />
                                        <Val>true</Val>
                                    </Condition>
<!--/AND-->
<!-- SDMA01FAG258763 end -->
<!-- NGHLR1FAG191506 end -->
                                    <Then>
<!--nghlr1fag181951 end -->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>DN OdbServiceProfile_DN available</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>OdbServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>DN OdbServiceProfile available</Description>
                                                <Parameter name="DN_ServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.ODB.MS_OAM_ODB" name="query">
                                            <Description>Query Entry CamelServiceProfile</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
<!--WA for upgrading>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>odbOutgoingCalls_@@_odbIncomingCalls_@@_odbRoaming_@@_odbSpecificHPLMN_@@_barringForLockingReason_@@_odbPremiumRateCalls_@@_odbSuplServiceMngt_@@_odbCfFTNRegistration_@@_odbECTInvocation_@@_odbECTDoublyChargeable_@@_odbMultipleECT_@@_odbSpecificToPs_@@_odbPrepayIcBar_@@_odbCustoSmsCalls_@@_odbCustoPremRateCalls_@@_odbRouteToSPBar</Val>
                                        </Parameter>
                                        -->
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>odbOutgoingCalls_@@_odbIncomingCalls_@@_odbRoaming_@@_odbSpecificHPLMN_@@_barringForLockingReason_@@_odbPremiumRateCalls_@@_odbSuplServiceMngt_@@_odbCfFTNRegistration_@@_odbECTInvocation_@@_odbECTDoublyChargeable_@@_odbMultipleECT_@@_odbSpecificToPs_@@_odbPrepayIcBar_@@_odbCustoSmsCalls_@@_odbCustoPremRateCalls_@@_odbRouteToSPBar</Val>
                                                </Parameter>
<!--end for WA-->
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <OR>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbOutgoingCalls" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbIncomingCalls" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbRoaming" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbSpecificHPLMN" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="barringForLockingReason" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbPremiumRateCalls" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbSuplServiceMngt" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbCfFTNRegistration" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbECTInvocation" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbECTDoublyChargeable" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbMultipleECT" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbSpecificToPs" />
                                                    <Null />
                                                </Condition>
<!--add by qzg for 67452 -->
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="odbPrepayIcBar" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="odbPrepayIcBar" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
<!--add begin for 67390 ODB by qzg,20090403-->
                                                <Condition operator="setGreater">
                                                    <Ref name="odbCustoSmsCalls" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbCustoPremRateCalls" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="odbRouteToSPBar" />
                                                    <Null />
                                                </Condition>
<!--add end for 67390 ODB by qzg,20090403-->
                                            </OR>
                                            <Then>
                                                <Set name="OdbServiceProfile">
                                                    <Val>1</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
<!--nghlr1fag181951 begin-->
                                </If>
<!--nghlr1fag181951 end-->
<!-- 
                        ***************************************************************************************
                        *   4.17  CallBarring query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN CallBarringServiceProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>CallBarringServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN CallBarringServiceProfile_DN available</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if CB exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="CallBarringServiceProfile">
                                            <Val>1</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_CallBarring" name="query">
                                            <Description>Query Entry Callbarring</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>barOutCallProv_@@_barOutInterCallProv_@@_barOutIntCallExceptToHplmnProv_@@_barIncCallProvisioned_@@_barIncCallRoamFCountryProv_@@_BSGofBAOClist_@@_BSGofBOIClist_@@_BSGofBOICEXHClist_@@_BSGofBAIClist_@@_BSGofBICROAMlist_@@_msCbAbility_@@_callBarringPassword</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!--***************************************************************************************
                        *   4.23  LCN service query         67394   
                            *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                    <Description>LcnService_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>LcnService_DN</Val>
                                        </Parameter>
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="suMSubscriberProfileId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_LcnService">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_LcnService" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE name="query" entityName="HSS.SUB.CustomerizedService.MS_OAM_CustomService_LCN">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_LcnService" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>lcnCallingNumber_@@_lcnBS_@@_lcnSRIStatus_@@_lcnDate_@@_lcnEraseFlag_@@_lcnCallingNumberPres_@@_lcnPresentationNumberPres_@@_lcnPresentationNumber</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="lcnCallingNumber" />
                                                <Parameter name="lcnCallingNumberPres" />
                                                <Parameter name="lcnPresentationNumberPres" />
                                                <Parameter name="lcnPresentationNumber" />
                                                <Parameter name="lcnBS" />
                                                <Parameter name="lcnSRIStatus" />
                                                <Parameter name="lcnDate" />
                                                <Parameter name="lcnEraseFlag" />
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 
                        ***************************************************************************************
                        *   4.18  CallForwarding query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN CallForwardingServiceProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>CallForwardingServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN CallForwardingServiceProfile_DN available</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if CF exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="CallForwardingServiceProfile">
                                            <Val>1</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_CallForwarding" name="query">
                                            <Description>Query Entry CallForwarding</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- Modify for feature 67401 and 67441 begin -->
                                                    <Val>typeCallForwardingNumberActivationList_@@_typeOfCallForwardingList_@@_msCfNoAbility_@@_destinationProfile_@@_cfuCallForwardingNumberList_@@_cfbusyCallForwardingNumberList_@@_cfnreplyCallForwardingNumberList_@@_cfnreachCallForwardingNumberList_@@_cfdCallForwardingNumberList_@@_cfdcfbusyCallForwardingNumberList_@@_cfdcfnreplyCallForwardingNumberList_@@_cfdcfnreachCallForwardingNumberList_@@_cfuNotifToFwdPartyFlag_@@_cfbusyNotifToFwdPartyFlag_@@_cfnreplyNotifToFwdPartyFlag_@@_cfnreachNotifToFwdPartyFlag_@@_cfuNotifToCallingPartyFlag_@@_cfbusyNotifToCallingPartyFlag_@@_cfnreplyNotifToCallingPartFlag_@@_cfnreachNotifToCallingPartFlag_@@_cfDestinationProfileList_@@_specificCfType_@@_voiceMailIndex</Val>
<!-- Modify for feature 67401 and 67441 end -->
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 
                        ***************************************************************************************
                        *   4.19  GCS query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN GeneralCallServiceProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>GeneralCallServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN GeneralCallServiceProfile_DN available</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if GCS exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="GcsServiceProfile">
                                            <Val>1</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.MS_OAM_SUP_GCS" name="query">
                                            <Description>Query Entry GCSServiceProfile</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
<!--  Begin SDMA01FAG222609 -->
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>
                                                    colpProvisionedFlag_@@_colpOverrideCategoryState_@@_clipProvisionedFlag_@@_clipOverrideCategoryState_@@_clirProvisionedFlag_@@_presentationMode_@@_callHoldProvisionedFlag_@@_mptyProvisionedFlag_@@_aoccProvisionedFlag_@@_aociProvisionedFlag_@@_callTransferProvisionedFlag_@@_maliciousCallProvisionedFlag_@@_colrProvisionedFlag_@@_osss1ProvisionedFlag_@@_osss1ActivationFlag_@@_osss2ProvisionedFlag_@@_osss2ActivationFlag_@@_osss3ProvisionedFlag_@@_osss3ActivationFlag_@@_osss4ProvisionedFlag_@@_osss4ActivationFlag_@@_osss5ProvisionedFlag_@@_osss5ActivationFlag_@@_osss6ProvisionedFlag_@@_osss6ActivationFlag_@@_osss7ProvisionedFlag_@@_osss7ActivationFlag_@@_osss8ProvisionedFlag_@@_osss8ActivationFlag_@@_osss9ProvisionedFlag_@@_osss9ActivationFlag_@@_osss10ProvisionedFlag_@@_osss10ActivationFlag_@@_osss11ProvisionedFlag_@@_osss11ActivationFlag_@@_osss12ProvisionedFlag_@@_osss12ActivationFlag_@@_osss13ProvisionedFlag_@@_osss13ActivationFlag_@@_osss14ProvisionedFlag_@@_osss14ActivationFlag_@@_osss15ProvisionedFlag_@@_osss15ActivationFlag_@@_callWaitingProvisionedFlag_@@_cwTSSpeechActivationFlag_@@_cwTSFaxActivationFlag_@@_cwBSG20ActivationFlag_@@_cwBSG30ActivationFlag_@@_cnapProvisionedFlag_@@_cnapOverrideCategoryState_@@_acrProvisionedFlag_@@_acrActivationFlag</Val>
                                                </Parameter>
<!--  End SDMA01FAG222609 -->
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 
                        ***************************************************************************************
                        *   4.20  CUG query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN ClosedUserGroupProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>ClosedUserGroupProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>DN ClosedUserGroupProfile_DN available</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if CUG exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="ClosedUserGroupProfile">
                                            <Val>1</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_Cug" name="query">
                                            <Description>Query Entry ClosedUserGroupProfile</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>prefCugIndexForSpeech_@@_prefCugIndexForFax_@@_prefCugIndexForBsg20_@@_prefCugIndexForBsg30_@@_interCugRestForSpeech_@@_interCugRestForFax_@@_interCugRestForBsg20_@@_interCugRestForBsg30_@@_cugInterlockCodeInd1_@@_intraCugOptionInd1_@@_AllassociatedBsgString1_@@_cugInterlockCodeInd2_@@_intraCugOptionInd2_@@_AllassociatedBsgString2_@@_cugInterlockCodeInd3_@@_intraCugOptionInd3_@@_AllassociatedBsgString3_@@_cugInterlockCodeInd4_@@_intraCugOptionInd4_@@_AllassociatedBsgString4_@@_cugInterlockCodeInd5_@@_intraCugOptionInd5_@@_AllassociatedBsgString5_@@_cugInterlockCodeInd6_@@_intraCugOptionInd6_@@_AllassociatedBsgString6_@@_cugInterlockCodeInd7_@@_intraCugOptionInd7_@@_AllassociatedBsgString7_@@_cugInterlockCodeInd8_@@_intraCugOptionInd8_@@_AllassociatedBsgString8_@@_cugInterlockCodeInd9_@@_intraCugOptionInd9_@@_AllassociatedBsgString9_@@_cugInterlockCodeInd10_@@_intraCugOptionInd10_@@_AllassociatedBsgString10</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- 
                        ***************************************************************************************
                        *   4.21  Change IMSI query
                        *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>build autoImsiChange-DN</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>AutoImsiChange_DN</Val>
                                        </Parameter>
                                        <Parameter name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" />
                                        </Parameter>
                                        <Parameter name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" />
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>associatedIMSI valorized</Description>
                                        <Parameter name="linkOldIMSI_DN">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if linkOldIMSI_DN exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="linkOldIMSI_DN" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <Description>Query Entry linkOldIMSI_DN</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="linkOldIMSI_DN" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- Add for feature 69834 start -->
                                                    <Val>imsiStatus_@@_linkToOtherIMSI_@@_dateOfLinkCreation_@@_dateOfLinkExpiry</Val>
<!-- Add for feature 69834 end -->
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="imsiStatus" />
                                                <Parameter name="linkToOtherIMSI" />
                                                <Parameter name="dateOfLinkCreation" />
<!-- Add for feature 69834 start -->
                                                <Parameter name="dateOfLinkExpiry" />
<!-- Add for feature 69834 end -->
<!--Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val>mobileCountryCodeId_@@_mobileNetworkCodeId_@@_mSubIdentificationNumberId_@@_MainSNwithBearerService_@@_SNwithBearerServiceList_@@_BearerServiceWithoutSNList_@@_ServiceNodeNotificationList_@@_networkAccessMode_@@_msCategory_@@_opSpecificCategory_@@_singleNumbering_@@_IpreferedCarrier_@@_csAllocationRetentionPriority_@@_transferOfSmOption_@@_packetMsAddressList_@@_chargingCharacteristics_@@_OcsiServiceProfile_@@_TcsiServiceProfile_@@_camelLocationRequestFlag_@@_camelStatusRequestFlag_@@_camelMarkActivationRoamers_@@_camelMarkInhibitionRoamersCs_@@_ocsiCamelSubState_@@_ocsiCamelCapabilityHandling_@@_ocsiCamelVlrNotSuppDfltHandl_@@_ocsiCamelGmscNotSuppDfltHdl_@@_tifcsiTransformationInformFlag_@@_ocsiCollectedInfoTdpServKey_@@_ocsiCollectedInfoTdpScpIsdn_@@_ocsiCollectedInfoTdpDfltCalH_@@_callTypeCriteria_@@_destinationNumberCritList_@@_matchType_@@_destNbLengthCriteriaList_@@_originBscCritList_@@_originBsgCritList_@@_ocsiRouteSelectFailTdpServKey_@@_ocsiRouteSelectFailTdpScpIsdn_@@_ocsiRouteSelectFailTdpDfltCalH_@@_routeSelectFailTdpCauVCritList_@@_tcsiCamelSubState_@@_tcsiCamelCapabilityHandling_@@_tcsiCamelGmscNotSuppDfltHandl_@@_tcsiTermAttemptTdpServKey_@@_tcsiTermAttemptTdpScpIsdn_@@_tcsiTermAttemptTdpDfltCalH_@@_terminBscCritList_@@_terminBsgCritList_@@_tcsiTBusyTdpServKey_@@_tcsiTBusyTdpScpIsdn_@@_tcsiTBusyTdpDfltCalH_@@_tbusyTdpCauseValueCritList_@@_tcsiTNoAnswTdpServKey_@@_tcsiTNoAnswTdpScpIsdn_@@_tcsiTNoAnswTdpDfltCalH_@@_tnoAnswTdpCauseValueCritList_@@_imsiStatus_@@_linkToOtherIMSI_@@_dateOfLinkCreation</Val>
                                        </Parameter-->
                                            </Out>
                                        </CallBE>
<!-- Add for feature 69834 start -->
<!-- if flag not allowed, remove it -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="fSA111" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                <Val>false</Val>
                                            </Condition>
                                            <Then>
                                                <Remove name="dateOfLinkExpiry" />
                                            </Then>
                                        </If>
<!-- Add for feature 69834 end -->
                                    </Then>
                                </If>
<!-- add by zhx,2006-6-6,for LCS                            ***************************************************************************************
                        *   4.22 LCS  query
                                                *************************************************************************************** -->
                                <If>
<!--nghlr1fag181951 begin-->
                                    <Condition operator="eq">
                                        <Ref name="fLCS001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
<!--nghlr1fag181951 end-->
                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                            <Description>DN LcsServiceProfile_DN available</Description>
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>LcsServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="suMSubscriberProfileId" />
                                                <Parameter name="suMSubscriptionProfileId" />
                                                <Parameter name="gsmServiceProfileId" />
                                            </In>
                                            <Out>
                                                <Description>DN LcsServiceProfile_DN available</Description>
                                                <Parameter name="DN_ServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                            <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                                <Parameter name="__NO_DB_EXCHANGE">
                                                    <Val>true</Val>
                                                </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                            </In>
                                            <Out>
                                                <Parameter name="existEntry">
                                                    <Ref name="__BOOL" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="existEntry" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="LcsServiceProfile">
                                                    <Val>1</Val>
                                                </Set>
                                                <CallBE entityName="HSS.SUB.LCS.LCS_OAM_LCSSubscription" name="query">
                                                    <Description>Query Entry LcsServiceProfile</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_ServiceProfile" />
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
<!-- Begin for feature:67403
                                                                                                     Comment: Add two parameters: pai and paiControl
                                                                                                     Author: Shen Xin
                                                                                                     Date: 2009/3/13
                                                                                                -->
                                                            <Val>pai_@@_paiControl_@@_originatingLcs_@@_terminatingLcs_@@_callRelatedNotification_@@_callUnrelatedNotification_@@_externalClientProfileId_@@_plmnClientList</Val>
<!-- End for feature:67403-->
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <AllParameters>
                                                            <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                        </AllParameters>
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
<!--nghlr1fag181951 begin-->
                                </If>
<!--nghlr1fag181951 end -->
<!-- end of query-->
<!--***************************************************************************************
                        *   4.23 eMLPP  query                       *************************************************************************************** -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>EMLPPServiceProfile_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>EMLPPServiceProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                    </In>
                                    <Out>
                                        <Description>EMLPPServiceProfile_DNavailable</Description>
                                        <Parameter name="DN_ServiceProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_ServiceProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
                                        <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="eMLPPServiceProfile">
                                            <Val>1</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.SUB_OAM_SupplementaryService_eMLPP" name="query">
                                            <Description>Query Entry eMLPPServiceProfile</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_ServiceProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>emlppMaxEntitledPriority_@@_emlppDefaultPriority_@@_emlppProvisionedFlag</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <AllParameters>
                                                    <ExceptParameter name="__ATTRIBUTE_NAME_LIST" />
                                                </AllParameters>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
<!-- SDMA01CAG220111 add end of If -->
                            </Then>
                        </If>
<!-- end SDMA01CAG220111-->
<!-- start to modify for feature 67488 tracing, zhao jun, 20090831 -->
<!--add appList for feature 73024-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fCT100" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
<!-- This will be an additional DB query for SumSubscriberProfile entry. -->
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>create SuMSubscriberProfile DN</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>SuMSubscriberProfile_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                    </In>
                                    <Out>
                                        <Parameter name="DN_SuMSubscriberProfile">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <Description>Call BeExistEntry.create to know if Dn_Input exist</Description>
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_SuMSubscriberProfile" />
                                        </Parameter>
<!--Add for DB roundtrip optimizaiton begin-->
<!--    <Parameter name="__NO_DB_EXCHANGE">
                                            <Val>true</Val>
                                    </Parameter> -->
<!--Add for DB roundtrip optimizaiton end-->
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_SuMSubscriberProfile" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>underTracing_@@_appListActivateTracing</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="underTracing" />
                                                <Parameter name="appListActivateTracing" />
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                            <Else>
                                <Remove name="underTracing" />
                                <Remove name="underTracingImsi" />
                                <Remove name="underTracingMsisdn" />
                            </Else>
                        </If>
<!-- end to modify for feature 67488 tracing, zhao jun, 20090831 -->
<!--Add for feature 69834 begin-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fSA109" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                    <In>
                                        <Parameter name="mSubIdentificationNumberId" />
                                        <Parameter name="mobileNetworkCodeId" />
                                        <Parameter name="mobileCountryCodeId" />
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>Virtual_INSERTION_DN</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="DN_LocationInsert">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.LOC.Location.LOC_OAM_Location_Insertion" name="query">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_LocationInsert" />
                                        </Parameter>
                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                            <Val />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="localMobileStationIdentity" />
                                        <Parameter name="vlrIsdn" />
                                        <Parameter name="mscIsdn" />
                                        <Parameter name="roamingRestrictionFlags" />
                                        <Parameter name="vlrUpdateFlag" />
                                        <Parameter name="roamingCharactsFlags" />
                                        <Parameter name="flagCffPlmn" />
                                        <Parameter name="supOfLocRegCount" />
                                        <Parameter name="locRegSubsPeriod" />
                                        <Parameter name="gsmCamelPhase" />
                                        <Parameter name="gsmNegocCamelPhases" />
                                        <Parameter name="odbUnsuppFeaturesFlags" />
                                        <Parameter name="vlrBasServUnsuppFeaturesFlags" />
                                        <Parameter name="vlrGenUnsuppFeaturesFlags" />
                                        <Parameter name="inducedCbocBsg" />
                                        <Parameter name="inducedCboiBsg" />
                                        <Parameter name="inducedCboehBsg" />
                                        <Parameter name="vlrLastGlobalUpdateTime" />
                                        <Parameter name="currentMapScreeningProfile" />
                                        <Parameter name="inducedCbicBsg" />
                                        <Parameter name="inducedCbicroamBsg" />
                                        <Parameter name="roamingCapabilityFlags" />
                                        <Parameter name="sgsnUpdateFlag" />
                                        <Parameter name="gprsEnhancementIndicator" />
                                        <Parameter name="sgsnGenUnsuppFeaturesFlags" />
                                        <Parameter name="sgsnIsdn" />
                                        <Parameter name="sgsnIp" />
                                        <Parameter name="gprsCamelPhase" />
                                        <Parameter name="gprsNegocCamelPhases" />
                                        <Parameter name="sgsnRoamingRestriction" />
                                        <Parameter name="gprsNotReachableFlag" />
                                        <Parameter name="gprsNotReachableReason" />
                                        <Parameter name="sgsnLastGlobalUpdateTime" />
                                        <Parameter name="smscIsdn" />
                                        <Parameter name="gsmNotReachableSMSFlag" />
                                        <Parameter name="gsmNotReachableReason" />
                                        <Parameter name="memoryCapacityExceededFlag" />
                                        <Parameter name="timeStampWaitingSms" />
                                        <Parameter name="voiceMailOrigin" />
<!-- 73282-05 begin -->
                                        <Parameter name="scAddress4IPSMLink" />
<!-- 73282-05 end -->
                                        <Parameter name="smscIsdnForExtMWD" />
                                        <Parameter name="timeStampWaitingSmsForExtMWD" />
                                        <Parameter name="voiceMailOriginForExtMWD" />
                                        <Parameter name="addSource" />
                                        <Parameter name="addRecache" />
                                        <Parameter name="addCsCurrent" />
                                        <Parameter name="addPsCurrent" />
                                        <Parameter name="addImeiSv" />
<!--69915 begin-->
                                        <Parameter name="add3gpp2Meid" />
                                        <Parameter name="addEpsMMECurrent" />
                                        <Parameter name="addEpsAAACurrent" />
<!--69915 end-->
                                        <Parameter name="addTimeStamp" />
                                        <Parameter name="cbPwdSuccErroneousAttempts" />
                                        <Parameter name="mmeIdentity" />
                                        <Parameter name="uePurgedInMme" />
                                        <Parameter name="mmeUpdateFlag" />
                                        <Parameter name="mmeLastGlobalUpdateTime" />
                                        <Parameter name="aaaIdentity" />
                                        <Parameter name="non3gppIpAccRegStatus" />
                                        <Parameter name="aaaUpdateFlag" />
                                        <Parameter name="aaaLastGlobalUpdateTime" />
<!-- begin feature 69582, zeyangy, 2010-03-17 -->
                                        <Parameter name="msStatusInCS" />
                                        <Parameter name="msStatusInPS" />
<!-- end feature 69582, zeyangy, 2010-03-17 -->
<!-- Add for 70018, Shi Qin, 2010-06-18-->
                                        <Parameter name="urrpMmeFlag" />
                                        <Parameter name="visitedMmePlmnId" />
<!-- Add for 70018 End, Shi Qin, 2010-06-18-->
<!-- Add for 72989 begin, nian, 2012-02-29-->
                                        <Parameter name="visitedSgsnPlmnId" />
                                        <Parameter name="subRoaming" />
<!-- Add for 72989 end, nian, 2012-02-29-->
<!-- begin 70186guowei -->
                                        <Parameter name="gsmNegocCamelPhasesExt" />
                                        <Parameter name="gprsNegocCamelPhasesExt" />
                                        <Parameter name="gsmOfferedCAMEL4CSIs" />
                                        <Parameter name="gprsOfferedCAMEL4CSIs" />
                                        <Parameter name="inducedGsmSMSBAR" />
                                        <Parameter name="inducedGprsSMSBAR" />
<!-- begin 70186guowei -->
                                    </Out>
                                </CallBE>
<!-- 73282-05,62 begin -->
<!-- Convert scAddress4IPSMLink to scAddress4IPSM -->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="scAddress4IPSMLink" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="scAddress4IPSMLink" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val>serverAddress</Val>
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="scAddress4IPSM">
                                                    <Ref name="serverAddress" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="smscIsdnForExtMWD" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.LOC.*.DnHandler" name="create">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>ExtendedMWD_DN</Val>
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId" />
                                                <Parameter name="mobileNetworkCodeId" />
                                                <Parameter name="mobileCountryCodeId" />
                                            </In>
                                            <Out>
                                                <Parameter name="DN_ExtendedMWD">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE name="getValuefromMultivalue" entityName="HSS.LOC.*.BeCommonHandler">
                                            <Description>?qdiao: 100 "getDatafromMultivalue"</Description>
                                            <In>
                                                <Parameter name="source_Multivalue_Name">
                                                    <Val>smscIsdnForExtMWD</Val>
                                                </Parameter>
                                                <Parameter name="source_EntryDn">
                                                    <Ref name="DN_ExtendedMWD" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="IPSMGWRegisterAddress">
                                                    <Ref name="resultData" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="fSMS114" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSms" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="setGreater">
                                                    <Ref name="IPSMGWRegisterAddress" />
                                                    <Null />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Remove name="smscIsdnForExtMWD">
                                                    <Ref name="IPSMGWRegisterAddress" />
                                                </Remove>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- 73282-05,62 end -->
                            </Then>
                        </If>
<!--Add for feature 69834 end-->
<!-- 
                        ***************************************************************************************
                        *   4.24  Query  MdtDomain,  add by zhao nannan for 71037 begin
                        *************************************************************************************** -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fEPS111" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Val>EPS</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="query">
                                            <Description>Delete Entry MdtDomain</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="jobTypeEps">
                                                    <Ref name="jobType" />
                                                </Parameter>
                                                <Parameter name="areaScopeEps">
                                                    <Ref name="areaScope" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrListEps">
                                                    <Ref name="eutranCGIStrList" />
                                                </Parameter>
                                                <Parameter name="lteTAStrListEps">
                                                    <Ref name="lteTAStrList" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4LteEps">
                                                    <Ref name="listMeasurement4Lte" />
                                                </Parameter>
                                                <Parameter name="reportingTriggerEps">
                                                    <Ref name="reportingTrigger" />
                                                </Parameter>
                                                <Parameter name="reportIntervalEps">
                                                    <Ref name="reportInterval" />
                                                </Parameter>
                                                <Parameter name="reportAmountEps">
                                                    <Ref name="reportAmount" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRPEps">
                                                    <Ref name="eventThresholdRSRP" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQEps">
                                                    <Ref name="eventThresholdRSRQ" />
                                                </Parameter>
                                                <Parameter name="loggingIntervalEps">
                                                    <Ref name="loggingInterval" />
                                                </Parameter>
                                                <Parameter name="loggingDurationEps">
                                                    <Ref name="loggingDuration" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Val>PS</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="query">
                                            <Description>Delete Entry MdtDomain</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="jobTypePs">
                                                    <Ref name="jobType" />
                                                </Parameter>
                                                <Parameter name="areaScopePs">
                                                    <Ref name="areaScope" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrListPs">
                                                    <Ref name="eutranCGIStrList" />
                                                </Parameter>
                                                <Parameter name="lteTAStrListPs">
                                                    <Ref name="lteTAStrList" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4LtePs">
                                                    <Ref name="listMeasurement4Lte" />
                                                </Parameter>
                                                <Parameter name="reportingTriggerPs">
                                                    <Ref name="reportingTrigger" />
                                                </Parameter>
                                                <Parameter name="reportIntervalPs">
                                                    <Ref name="reportInterval" />
                                                </Parameter>
                                                <Parameter name="reportAmountPs">
                                                    <Ref name="reportAmount" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRPPs">
                                                    <Ref name="eventThresholdRSRP" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQPs">
                                                    <Ref name="eventThresholdRSRQ" />
                                                </Parameter>
                                                <Parameter name="loggingIntervalPs">
                                                    <Ref name="loggingInterval" />
                                                </Parameter>
                                                <Parameter name="loggingDurationPs">
                                                    <Ref name="loggingDuration" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                    <Description>DN MdtDomain_DN available</Description>
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MdtDomain_DN</Val>
                                        </Parameter>
                                        <Parameter name="suMSubscriberProfileId" />
                                        <Parameter name="suMSubscriptionProfileId" />
                                        <Parameter name="gsmServiceProfileId" />
                                        <Parameter name="mdtDomainId">
                                            <Val>CS</Val>
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Description>DN MdtDomain available</Description>
                                        <Parameter name="DN_MdtDomain">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                    <In>
                                        <Parameter name="__DISTINGUISH_NAME">
                                            <Ref name="DN_MdtDomain" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="existEntry">
                                            <Ref name="__BOOL" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="existEntry" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.SUB_OAM_MdtDomain" name="query">
                                            <Description>Delete Entry MdtDomain</Description>
                                            <In>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_MdtDomain" />
                                                </Parameter>
                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                    <Val />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="jobTypeCs">
                                                    <Ref name="jobType" />
                                                </Parameter>
                                                <Parameter name="areaScopeCs">
                                                    <Ref name="areaScope" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrListCs">
                                                    <Ref name="eutranCGIStrList" />
                                                </Parameter>
                                                <Parameter name="lteTAStrListCs">
                                                    <Ref name="lteTAStrList" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4LteCs">
                                                    <Ref name="listMeasurement4Lte" />
                                                </Parameter>
                                                <Parameter name="reportingTriggerCs">
                                                    <Ref name="reportingTrigger" />
                                                </Parameter>
                                                <Parameter name="reportIntervalCs">
                                                    <Ref name="reportInterval" />
                                                </Parameter>
                                                <Parameter name="reportAmountCs">
                                                    <Ref name="reportAmount" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRPCs">
                                                    <Ref name="eventThresholdRSRP" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQCs">
                                                    <Ref name="eventThresholdRSRQ" />
                                                </Parameter>
                                                <Parameter name="loggingIntervalCs">
                                                    <Ref name="loggingInterval" />
                                                </Parameter>
                                                <Parameter name="loggingDurationCs">
                                                    <Ref name="loggingDuration" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- begin73118 Wayne -->
<!-- End Wrap all the following query part -->
<!-- subscriberType is SHARED_SUBS_SLAVE -->
<!-- 73251 b-->
                        <If>
                            <Condition operator="notNullIntersection">
                                <Ref name="subscriberType" />
                                <Val>SHARED_SUBS_SLAVE</Val>
                            </Condition>
                            <Then>
                                <Remove name="subscriberType" />
                                <Remove name="networkAccessMode" />
                                <If>
                                    <Condition operator="neq">
                                        <Ref name="__INTERNAL_REQUEST_NAME" />
                                        <Val>PRE_REQUEST_MODIFY</Val>
                                    </Condition>
                                    <Then>
                                        <Remove name="MainSNwithBearerService" />
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="fMSIMSubsBySlaveIMSI" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Remove name="notificationToCseFlag" />
                                        <Remove name="cfGsmSCF1" />
                                        <Remove name="cfGsmSCF2" />
                                        <Remove name="cfGsmSCF3" />
                                        <Remove name="cbGsmSCF1" />
                                        <Remove name="cbGsmSCF2" />
                                        <Remove name="cbGsmSCF3" />
                                        <Remove name="odbGsmSCF1" />
                                        <Remove name="odbGsmSCF2" />
                                        <Remove name="odbGsmSCF3" />
                                        <Remove name="csiGsmSCF1" />
                                        <Remove name="csiGsmSCF2" />
                                        <Remove name="csiGsmSCF3" />
                                        <Remove name="CamelServiceProfile" />
                                        <Remove name="camelLocationRequestFlag" />
                                        <Remove name="camelStatusRequestFlag" />
                                        <Remove name="camelMarkActivationRoamers" />
                                        <Remove name="camelMarkInhibitionRoamersCs" />
                                        <Remove name="OcsiServiceProfile" />
                                        <Remove name="ocsiCamelSubState" />
                                        <Remove name="ocsiCamelCapabilityHandling" />
                                        <Remove name="ocsiCamelVlrNotSuppDfltHandl" />
                                        <Remove name="ocsiCamelGmscNotSuppDfltHdl" />
                                        <Remove name="tifcsiTransformationInformFlag" />
                                        <Remove name="ocsiCollectedInfoTdpServKey" />
                                        <Remove name="ocsiCollectedInfoTdpScpIsdn" />
                                        <Remove name="ocsiCollectedInfoTdpDfltCalH" />
                                        <Remove name="callTypeCriteria" />
                                        <Remove name="destinationNumberCritList" />
                                        <Remove name="matchType" />
                                        <Remove name="destNbLengthCriteriaList" />
                                        <Remove name="originBscCritList" />
                                        <Remove name="originBsgCritList" />
                                        <Remove name="ocsiRouteSelectFailTdpServKey" />
                                        <Remove name="ocsiRouteSelectFailTdpScpIsdn" />
                                        <Remove name="ocsiRouteSelectFailTdpDfltCalH" />
                                        <Remove name="routeSelectFailTdpCauVCritList" />
                                        <Remove name="oickKey" />
                                        <Remove name="multiSimMember" />
                                        <Remove name="roleInMultiSim" />
                                        <Remove name="ProfileStatus" />
                                        <Remove name="MSIMMemberPublicCC" />
                                        <Remove name="MSIMMemberPublicNDC" />
                                        <Remove name="MSIMMemberPublicSN" />
                                        <Remove name="msCategory" />
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- 73251 e-->
<!-- end73118 Wayne -->
                        <Result />
                    </Request>
                    <Request name="postCommit" notAtInterface="true">
                        <Description>
                            <Summary>Send CREQ, IREQ messages</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
<!-- IREQ Message for members of multi-sim subscriber -->
                        <Set name="modifyOtherMemberFlag">
                            <Ref name="modifyOtherMemberFlag" entityName="PostCommitBeContext" />
                        </Set>
<!--add by FRSDMA01FAG278750 -->
                        <Set name="DN_GSMSUB">
                            <Ref name="__DISTINGUISH_NAME" />
                        </Set>
<!--add  end FRSDMA01FAG278750 -->
<!--Add for 71037 qdiao begin-->
                        <If>
                            <AND>
                                <Condition operator="setGreater">
                                    <Ref name="icsIndicator" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="icsIndicator">
                                    <Ref name="icsIndicator" entityName="PostCommitBeContext" />
                                </Set>
                            </Then>
                        </If>
<!--Add for 71037 qdiao end-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="modifyOtherMemberFlag" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Foreach name="DN_By_Profile">
                                    <MultiValue>
                                        <Ref name="_DN_LIST" delta="modified" entityName="HistoryBeGDMI" />
                                    </MultiValue>
                                    <Remove name="destinationEntity" />
<!--According to DN get the corresponding DNSyntax-->
                                    <CallBE entityName="HSS.SUB.*.BeCommonHandler" name="getDNSyntaxNameByDN">
                                        <Description>convert string to int</Description>
                                        <In>
                                            <Parameter name="__SOURCE_NAME">
                                                <Val>DN_By_Profile</Val>
                                            </Parameter>
                                            <Parameter name="__DESTINATION_NAME">
                                                <Val>DN_Syntax</Val>
                                            </Parameter>
                                            <Parameter name="DN_By_Profile" />
                                        </In>
                                        <Out>
                                            <Parameter name="DN_Syntax" />
                                        </Out>
                                    </CallBE>
                                    <If>
                                        <AND>
                                            <Condition operator="eq">
                                                <Ref name="DN_Syntax" />
                                                <Val>GsmServiceProfile_DN</Val>
                                            </Condition>
                                            <Condition operator="setGreater">
                                                <Ref name="msimPublicMsisdn" delta="changed" DN="DN_By_Profile" entityName="HistoryBeGDMI" />
                                                <Null />
                                            </Condition>
                                        </AND>
                                        <Then>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query Entry GsmServiceProfile</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="DN_By_Profile" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>msimPublicMsisdn_@@_associatedMainMsisdn</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="msimPublicMsisdn" />
                                                    <Parameter name="associatedMainMsisdn" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query to obtain associatedIMSI</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="associatedMainMsisdn" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="associatedIMSI" />
                                                </Out>
                                            </CallBE>
<!-- Modify begin for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
                                            <If>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                    <Null />
                                                </Condition>
                                                <Then>
                                                    <Set name="roaming_Imsi">
                                                        <Ref name="associatedIMSI" />
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <Set name="roaming_Imsi">
                                                        <Ref name="activeTwinImsi" entityName="PostCommitBeContext" />
                                                    </Set>
                                                </Else>
                                            </If>
                                            <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <Description>extract mcc mnc and msin from associatedIMSI</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="roaming_Imsi" />
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Description>extract mcc mnc and msin from associatedIMSI</Description>
                                                    <Parameter name="mobileCountryCodeId" />
                                                    <Parameter name="mobileNetworkCodeId" />
                                                    <Parameter name="mSubIdentificationNumberId" />
                                                </Out>
                                            </CallBE>
                                            <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                <Description>Query vlrIsdn and sgsnIsdn</Description>
                                                <In>
                                                    <Parameter name="__DISTINGUISH_NAME">
                                                        <Ref name="roaming_Imsi" />
                                                    </Parameter>
                                                    <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                        <Val>sgsnIsdn_@@_vlrIsdn_@@_localMobileStationIdentity</Val>
                                                    </Parameter>
                                                </In>
                                                <Out>
                                                    <Parameter name="sgsnIsdn" />
                                                    <Parameter name="vlrIsdn" />
                                                    <Parameter name="localMobileStationIdentity" />
                                                </Out>
                                            </CallBE>
<!-- Modify end for 73118 Twin-IMSI PUP to use activeTwinImsi to access IMSI roaming data if activeTwinImsi is not Null. -->
<!--   define the value of DestinationEntity -->
                                            <If>
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="vlrIsdn" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="setGreater">
                                                        <Ref name="sgsnIsdn" />
                                                        <Null />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="destinationEntity">
                                                        <Val>BOTH</Val>
                                                    </Set>
                                                </Then>
                                                <Else>
                                                    <If>
                                                        <AND>
                                                            <Condition operator="setGreater">
                                                                <Ref name="vlrIsdn" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="setLessOrEqual">
                                                                <Ref name="sgsnIsdn" />
                                                                <Null />
                                                            </Condition>
                                                        </AND>
                                                        <Then>
                                                            <Set name="destinationEntity">
                                                                <Val>noGPRS</Val>
                                                            </Set>
                                                        </Then>
                                                        <Else>
                                                            <If>
                                                                <AND>
                                                                    <Condition operator="setLessOrEqual">
                                                                        <Ref name="vlrIsdn" />
                                                                        <Null />
                                                                    </Condition>
                                                                    <Condition operator="setGreater">
                                                                        <Ref name="sgsnIsdn" />
                                                                        <Null />
                                                                    </Condition>
                                                                </AND>
                                                                <Then>
                                                                    <Set name="destinationEntity">
                                                                        <Val>GPRSonly</Val>
                                                                    </Set>
                                                                </Then>
                                                            </If>
                                                        </Else>
                                                    </If>
                                                </Else>
                                            </If>
<!--  decide how to organize the IREQ message -->
                                            <If>
                                                <Condition operator="setGreater">
                                                    <Ref name="destinationEntity" />
                                                    <Null />
                                                </Condition>
                                                <Then>
                                                    <If>
                                                        <Condition operator="setGreater">
                                                            <Ref name="msimPublicMsisdn" delta="" DN="DN_By_Profile" entityName="HistoryBeGDMI" />
                                                            <Null />
                                                        </Condition>
                                                        <Then>
                                                            <If>
                                                                <Condition operator="eq">
                                                                    <Ref name="fCF035" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                    <Val>true</Val>
                                                                </Condition>
                                                                <Then>
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                        <Description>extract cc ndc and sn from msimPublicMsisdn</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="msimPublicMsisdn" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Description>extract cc ndc and sn from msimPublicMsisdn</Description>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                </Then>
                                                                <Else>
                                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                        <Description>extract cc ndc and sn from associatedMainMsisdn</Description>
                                                                        <In>
                                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                                <Ref name="associatedMainMsisdn" />
                                                                            </Parameter>
                                                                        </In>
                                                                        <Out>
                                                                            <Description>extract cc ndc and sn from associatedMainMsisdn</Description>
                                                                            <Parameter name="countryCodeId" />
                                                                            <Parameter name="nationalDestinationCodeId" />
                                                                            <Parameter name="subscriberNumberId" />
                                                                        </Out>
                                                                    </CallBE>
                                                                </Else>
                                                            </If>
                                                        </Then>
                                                    </If>
<!--Case fSA012 =on, nationalDestinationCodeId must be inclued in VISDN, otherwise cannot be included in VISDN -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="fSA012" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Then>
                                                            <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendIreq">
                                                                <Description>create the msg IREQ</Description>
                                                                <In>
                                                                    <Parameter name="mSubIdentificationNumberId" />
                                                                    <Parameter name="mobileNetworkCodeId" />
                                                                    <Parameter name="mobileCountryCodeId" />
                                                                    <Parameter name="destinationEntity" />
                                                                    <Parameter name="vlrIsdn" />
                                                                    <Parameter name="sgsnIsdn" />
                                                                    <Parameter name="localMobileStationIdentity" />
                                                                    <Parameter name="subscriberNumberId" />
                                                                    <Parameter name="nationalDestinationCodeId" />
                                                                    <Parameter name="TwinFlag">
                                                                        <Val>1</Val>
                                                                    </Parameter>
<!--Add for 71037 qdiao begin-->
                                                                    <Parameter name="icsIndicator">
                                                                        <Ref name="icsIndicator" />
                                                                    </Parameter>
                                                                    <Parameter name="isIcsIndicatorChanged">
                                                                        <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                                    </Parameter>
<!--Add for 71037 qdiao end-->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
<!--Add for 71037 qdiao begin-->
                                                            <Set name="sendPUP4IcsIndicator">
                                                                <Val>true</Val>
                                                            </Set>
<!--Add for 71037 qdiao end-->
                                                        </Then>
                                                        <Else>
                                                            <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendIreq">
                                                                <Description>create the msg IREQ</Description>
                                                                <In>
                                                                    <Parameter name="mSubIdentificationNumberId" />
                                                                    <Parameter name="mobileNetworkCodeId" />
                                                                    <Parameter name="mobileCountryCodeId" />
                                                                    <Parameter name="destinationEntity" />
                                                                    <Parameter name="vlrIsdn" />
                                                                    <Parameter name="sgsnIsdn" />
                                                                    <Parameter name="localMobileStationIdentity" />
                                                                    <Parameter name="subscriberNumberId" />
                                                                    <Parameter name="TwinFlag">
                                                                        <Val>1</Val>
                                                                    </Parameter>
<!--Add for 71037 qdiao begin-->
                                                                    <Parameter name="icsIndicator">
                                                                        <Ref name="icsIndicator" />
                                                                    </Parameter>
                                                                    <Parameter name="isIcsIndicatorChanged">
                                                                        <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                                    </Parameter>
<!--Add for 71037 qdiao end-->
                                                                </In>
                                                                <Out />
                                                            </CallBE>
<!--Add for 71037 qdiao begin-->
                                                            <Set name="sendPUP4IcsIndicator">
                                                                <Val>true</Val>
                                                            </Set>
<!--Add for 71037 qdiao end-->
                                                        </Else>
                                                    </If>
                                                </Then>
                                            </If>
                                        </Then>
                                    </If>
                                </Foreach>
                            </Then>
                        </If>
<!--
                        ***************************************************************************************
                        * 5. PostCommit Request 
                        *   5.1   NAM change or delete subscriber 
                        *       5.1.1   NAM change
                        *       5.1.2   Delete subscriber
                        *   5.2 Update mainMSISDN
                        *   5.3 Update BearerService
                        *   5.4 Update msCategory and csAllocationRetentionPriority
                        *   5.5 MEDIATION Send Cancel Request or Insert request
                        *************************************************************************************** -->
                        <Set name="requestName">
                            <Ref name="requestName" entityName="PostCommitBeContext" />
                        </Set>
<!-- timeStamp -->
                        <Set name="DeactivateSubscriptionFlag">
                            <Ref name="DeactivateSubscriptionFlag" entityName="PostCommitBeContext" />
                        </Set>
<!-- Add for feature (MapScreening) Start -->
                        <Set name="mapScreeningCategoryChangedFlag">
                            <Ref name="mapScreeningCategoryChangedFlag" entityName="PostCommitBeContext" />
                        </Set>
<!-- Add by wupingfan for LTE PUP.2009/09/16.-->
<!-- Now check if sub is located and not purged in MME -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                                <Condition operator="neq">
                                    <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="ueMmeLocated">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ueMmeLocated">
                                    <Val>false</Val>
                                </Set>
                            </Else>
                        </If>
<!-- add begin by weimingm for F73419 on 2012-12-17 -->
<!-- Check if sub is located at S4SGSN.-->
<!-- judge whether sgsnIdentity is not Null and fEps001 is ture then set ueS4SgsnLocated to be true -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                                <Condition operator="nullIntersection">
                                    <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                    <Val>Purged_in_S4_SGSN</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="ueS4SgsnLocated">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ueS4SgsnLocated">
                                    <Val>false</Val>
                                </Set>
                            </Else>
                        </If>
<!-- Check if sub is located at AAA.-->
<!-- add end by weimingm for F73419 on 2012-12-17 -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fEps002" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="ueAaaLocated">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ueAaaLocated">
                                    <Val>false</Val>
                                </Set>
                            </Else>
                        </If>
<!-- update begin by weimingm for F73419 on 2012-12-11 -->
<!-- Begin: Added for 69091 by Yvonne He on 2013-01-27 -->
<!-- Check if the IMSI is registered on MME (not considering the purge status). -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="ueMmeExist">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ueMmeExist">
                                    <Val>false</Val>
                                </Set>
                            </Else>
                        </If>
<!-- Check if the IMSI is registered on S4-SGSN (not considering the purge status). -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                            </AND>
                            <Then>
                                <Set name="ueS4SgsnExist">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                            <Else>
                                <Set name="ueS4SgsnExist">
                                    <Val>false</Val>
                                </Set>
                            </Else>
                        </If>
                        <Set name="isTscSmsmoInIdr">
                            <Val>false</Val>
                        </Set>
                        <Set name="isTscSmsmoInDsr">
                            <Val>false</Val>
                        </Set>
<!-- End: Added for 69091 by Yvonne He on 2013-01-27 -->
                        <Set name="sendComIdrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendComClrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendComDsrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendClrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendDsrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendS4sgsnIdrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendS4sgsnClrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendS4sgsnDsrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sgsnUpdateFlag">
                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                        </Set>
                        <If>
                            <Condition operator="setLessOrEqual">
                                <Ref name="sgsnUpdateFlag" />
                                <Null />
                            </Condition>
                            <Then>
                                <Set name="sgsnUpdateFlag">
                                    <Val>false</Val>
                                </Set>
                            </Then>
                        </If>
<!-- update end by weimingm for F73419 on 2012-12-11 -->
                        <Set name="sendIdrMsg">
                            <Val>false</Val>
                        </Set>
<!-- + Added for 69061 by fengziz on 20130214 -->
                        <Set name="sendS4sgsnIdrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendMmeIdrMsg">
                            <Val>false</Val>
                        </Set>
<!-- - Added for 69061 by fengziz on 20130214 -->
<!-- Add for SWx.-->
                        <Set name="sendRtrMsg">
                            <Val>false</Val>
                        </Set>
                        <Set name="sendPprMsg">
                            <Val>false</Val>
                        </Set>
<!--add by zhao nannan begin  -->
                        <Set name="sendDsrMsg">
                            <Val>false</Val>
                        </Set>
<!--add by zhao nannan end -->
                        <Set name="aaaUpdateFlag">
                            <Ref name="aaaUpdateFlag" entityName="PostCommitBeContext" />
                        </Set>
                        <If>
                            <Condition operator="setLessOrEqual">
                                <Ref name="aaaUpdateFlag" />
                                <Null />
                            </Condition>
                            <Then>
                                <Set name="aaaUpdateFlag">
                                    <Val>false</Val>
                                </Set>
                            </Then>
                        </If>
<!-- End for SWx.-->
                        <Set name="mmeUpdateFlag">
                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                        </Set>
                        <If>
                            <Condition operator="setLessOrEqual">
                                <Ref name="mmeUpdateFlag" />
                                <Null />
                            </Condition>
                            <Then>
                                <Set name="mmeUpdateFlag">
                                    <Val>false</Val>
                                </Set>
                            </Then>
                        </If>
<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                          BeString::join is used to get string-format IMSI with MCC+MNC+MSIN as the input parameter.
                                                 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- begin to add a condition to avoid exception for create request, BPQ, 20100708 -->
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="ueMmeExist" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="ueS4SgsnExist" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="ueAaaLocated" />
                                    <Val>true</Val>
                                </Condition>
                            </OR>
                            <Then>
                                <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                    <In>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>userName</Val>
                                        </Parameter>
                                        <Parameter name="joinParameters">
                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                        </Parameter>
                                        <Parameter name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="userName" />
                                    </Out>
                                </CallBE>
<!-- End by wupingfan.-->
<!-- add begin for 70267, BPQ, 20100329 -->
                                <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                    <In>
                                        <Parameter name="__DN_SYNTAX_NAME">
                                            <Val>MSubIdentificationNumber_DN</Val>
                                        </Parameter>
                                        <Parameter name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="DN_MSubIdentificationNumber">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
<!-- add end for 70267, BPQ, 20100329 -->
                            </Then>
                        </If>
<!-- end to add a condition to avoid exception for create request, BPQ, 20100708 -->
<!-- Add for feature (MapScreening) End -->
<!-- add begin by weimingm for F73419 on 2012-12-11 -->
<!-- begin checking whether deactivatedDomains contains noCS -->
                        <If>
                            <Condition operator="notNullIntersection">
                                <Ref name="deactivatedDomains" delta="added" entityName="HistoryBeGDMI" />
                                <Val>noCS</Val>
                            </Condition>
                            <Then>
                                <Set name="vlrIsdn">
                                    <Ref name="vlrIsdn" entityName="PostCommitBeContext" />
                                </Set>
                                <Remove name="creqDestinationEntity" />
                                <If>
                                    <Condition operator="neq">
                                        <Ref name="vlrIsdn" />
                                        <NotExist />
                                    </Condition>
                                    <Then>
                                        <Set name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="localMobileStationIdentity">
                                            <Ref name="localMobileStationIdentity" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="creqDestinationEntity">
                                            <Val>noGPRS</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getUnderTestIdentity">
                                            <In />
                                            <Out>
                                                <Parameter name="flagObservedImsi">
                                                    <Ref name="isInterceptedFlag" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendCreq">
                                            <Description>create the msg CREQ</Description>
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="creqDestinationEntity">
                                                    <Ref name="creqDestinationEntity" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" />
                                                </Parameter>
                                                <Parameter name="vlrIsdn">
                                                    <Ref name="vlrIsdn" />
                                                </Parameter>
                                                <Parameter name="flagObservedImsi" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- end checking whether deactivatedDomains contains noCS -->
<!-- begin checking whether deactivatedDomains contains noPS -->
                        <If>
                            <Condition operator="notNullIntersection">
                                <Ref name="deactivatedDomains" delta="added" entityName="HistoryBeGDMI" />
                                <Val>noPS</Val>
                            </Condition>
                            <Then>
                                <Set name="sgsnIsdn">
                                    <Ref name="sgsnIsdn" entityName="PostCommitBeContext" />
                                </Set>
                                <Remove name="creqDestinationEntity" />
                                <If>
                                    <Condition operator="neq">
                                        <Ref name="sgsnIsdn" />
                                        <NotExist />
                                    </Condition>
                                    <Then>
                                        <Set name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="localMobileStationIdentity">
                                            <Ref name="localMobileStationIdentity" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="creqDestinationEntity">
                                            <Val>GPRSonly</Val>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getUnderTestIdentity">
                                            <In />
                                            <Out>
                                                <Parameter name="flagObservedImsi">
                                                    <Ref name="isInterceptedFlag" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendCreq">
                                            <Description>create the msg CREQ</Description>
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="creqDestinationEntity">
                                                    <Ref name="creqDestinationEntity" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" />
                                                </Parameter>
                                                <Parameter name="sgsnIsdn">
                                                    <Ref name="sgsnIsdn" />
                                                </Parameter>
                                                <Parameter name="flagObservedImsi" />
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- end checking whether deactivatedDomains contains noPS -->
<!-- begin checking whether deactivatedDomains contains noEPS -->
                        <If>
                            <Condition operator="notNullIntersection">
                                <Ref name="deactivatedDomains" delta="added" entityName="HistoryBeGDMI" />
                                <Val>noEPS</Val>
                            </Condition>
                            <Then>
<!-- judge whether aaaIdentity is located, if true send Rtr msg. -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueAaaLocated" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendRtrMsg">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- end weimingm checking whether deactivatedDomains contains noEPS -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="DeactivateSubscriptionFlag" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="mSubIdentificationNumberId">
                                    <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                </Set>
                                <Set name="mobileNetworkCodeId">
                                    <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                </Set>
                                <Set name="mobileCountryCodeId">
                                    <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                </Set>
                                <Set name="localMobileStationIdentity">
                                    <Ref name="localMobileStationIdentity" entityName="PostCommitBeContext" />
                                </Set>
                                <Set name="vlrIsdn">
                                    <Ref name="vlrIsdn" entityName="PostCommitBeContext" />
                                </Set>
                                <Set name="sgsnIsdn">
                                    <Ref name="sgsnIsdn" entityName="PostCommitBeContext" />
                                </Set>
<!--2008-9-8 18:24 initialize the creqDestinationEntity-->
                                <Remove name="creqDestinationEntity" />
                                <If>
                                    <AND>
                                        <Condition operator="neq">
                                            <Ref name="vlrIsdn" />
                                            <NotExist />
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="sgsnIsdn" />
                                            <NotExist />
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <Set name="creqDestinationEntity">
                                            <Val>BOTH</Val>
                                        </Set>
                                    </Then>
                                    <Else>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="vlrIsdn" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="creqDestinationEntity">
                                                    <Val>noGPRS</Val>
                                                </Set>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="sgsnIsdn" />
                                                        <NotExist />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>GPRSonly</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
                                    </Else>
                                </If>
                                <If>
                                    <OR>
                                        <Condition operator="neq">
                                            <Ref name="vlrIsdn" />
                                            <NotExist />
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="sgsnIsdn" />
                                            <NotExist />
                                        </Condition>
                                    </OR>
                                    <Then>
<!-- NGHLR1CAG199081 get flagObservedImsi-->
                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getUnderTestIdentity">
                                            <In />
                                            <Out>
                                                <Parameter name="flagObservedImsi">
                                                    <Ref name="isInterceptedFlag" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- NGHLR1CAG199081 end -->
                                        <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendCreq">
                                            <Description>create the msg CREQ</Description>
                                            <In>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" />
                                                </Parameter>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" />
                                                </Parameter>
                                                <Parameter name="creqDestinationEntity">
                                                    <Ref name="creqDestinationEntity" />
                                                </Parameter>
                                                <Parameter name="localMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" />
                                                </Parameter>
                                                <Parameter name="vlrIsdn">
                                                    <Ref name="vlrIsdn" />
                                                </Parameter>
                                                <Parameter name="sgsnIsdn">
                                                    <Ref name="sgsnIsdn" />
                                                </Parameter>
<!-- NGHLR1CAG199081 add flagObservedImsi in creq-->
                                                <Parameter name="flagObservedImsi" />
<!-- NGHLR1CAG199081 end -->
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- Update by wupingfan. If deactivatedSubscribtion changed from false to true.The CLR/RTR will be triggered.-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueMmeExist" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendClrMsg">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
<!-- Begin: add for 69061 by Yvonne He on 2013-01-27 -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueS4SgsnExist" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendS4sgsnClrMsg">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
<!-- End: add for 69061 by Yvonne He on 2013-01-27 -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueAaaLocated" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendRtrMsg">
                                            <Val>true</Val>
                                        </Set>
                                    </Then>
                                </If>
<!-- End by wupingfan.-->
                            </Then>
                        </If>
                        <If>
<!-- begin weimingm F73419 -->
                            <Condition operator="neq">
                                <Ref name="DeactivateSubscriptionFlag" />
                                <Val>true</Val>
                            </Condition>
<!-- end weimingm F73419 -->
                            <Then>
<!-- timeStamp end -->
                                <If>
                                    <Condition operator="neq">
                                        <Ref name="requestName" />
                                        <Val>create</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="DN_BasicSubscription">
                                            <Ref name="__DISTINGUISH_NAME" />
                                        </Set>
                                        <Set name="ChangeNAM">
                                            <Val>None</Val>
                                        </Set>
                                        <Set name="ChangeSN">
                                            <Val>false</Val>
                                        </Set>
                                        <Set name="ChangeBS">
                                            <Val>None</Val>
                                        </Set>
                                        <Set name="ChangeARD">
                                            <Val>false</Val>
                                        </Set>
<!-- Update by wupingfan.-->
                                        <Set name="ChangeRAT">
                                            <Val>false</Val>
                                        </Set>
<!-- End by wupingfan.-->
<!-- 
                                        ***************************************************************************************
                                        *   5.0 accessRestrictionData change (R2.3)
                                        *************************************************************************************** -->
<!-- ZTX | 2009/11/17 | Add for LTE extend accessRestrictionData to be multi-value attribute -->
<!--Set name="accessRestrictionData">
                                            <Ref name="accessRestrictionData" delta="" entityName="HistoryBeGDMI"/>
                                        </Set-->
                                        <Set name="accessRestrictionData">
                                            <MultiValue>
                                                <Ref name="accessRestrictionData" delta="" entityName="HistoryBeGDMI" />
                                            </MultiValue>
                                        </Set>
<!-- ZTX | 2009/11/17 | End of Add for LTE extend accessRestrictionData to be multi-value attribute -->
<!-- ZTX | 2009/11/17 | Add for LTE extend accessRestrictionData to be multi-value attribute -->
<!--Set name="oldaccessRestrictionData">
                                            <Ref name="accessRestrictionData" delta="old" entityName="HistoryBeGDMI"/>
                                        </Set-->
                                        <Set name="oldaccessRestrictionData">
                                            <MultiValue>
                                                <Ref name="accessRestrictionData" delta="old" entityName="HistoryBeGDMI" />
                                            </MultiValue>
                                        </Set>
<!-- Add by wupingfan.Define local data for PPR.-->
<!--Set name="tempAccessRestrictionData">
                                            <Ref name="accessRestrictionData"/>
                                        </Set-->
                                        <Set name="tempAccessRestrictionData">
                                            <MultiValue>
                                                <Ref name="accessRestrictionData" />
                                            </MultiValue>
                                        </Set>
<!--Set name="changedARD">
                                            <Ref name="accessRestrictionData" delta="changed" entityName="HistoryBeGDMI"/>
                                        </Set-->
                                        <Set name="changedARD">
                                            <MultiValue>
                                                <Ref name="accessRestrictionData" delta="changed" entityName="HistoryBeGDMI" />
                                            </MultiValue>
                                        </Set>
<!-- ZTX | 2009/11/17 | End of Add for LTE extend accessRestrictionData to be multi-value attribute -->
<!-- BPQ | 2009/12/10 | Begin of fix FR SDMA01FAG247629, accessRestrictionData related mediation is incorrect due to NORES  -->
                                        <Remove name="changedARD">
                                            <MultiValue>
                                                <Val>NORES</Val>
                                            </MultiValue>
                                        </Remove>
<!-- BPQ | 2009/12/10 | End of fix FR SDMA01FAG247629, accessRestrictionData related mediation is incorrect due to NORES  -->
                                        <If>
                                            <AND>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="changedARD" />
                                                    <Val>HONON3GPPNA</Val>
                                                </Condition>
                                                <OR>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                                        <Val>CDMANA</Val>
                                                    </Condition>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                                        <Val>HRPDNA</Val>
                                                    </Condition>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                                        <Val>UMBNA</Val>
                                                    </Condition>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                                        <Val>WLANNA</Val>
                                                    </Condition>
                                                </OR>
                                            </AND>
                                            <Then>
                                                <Set name="ChangeRAT">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                        <Remove name="changedARD">
                                            <MultiValue>
                                                <Val>HONON3GPPNA</Val>
                                            </MultiValue>
                                        </Remove>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="changedARD" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="ChangeRAT">
                                                    <Val>true</Val>
                                                </Set>
<!-- BPQ | 2009/12/10 | Begin of fix FR SDMA01FAG247629, remark incorrect code  -->
<!--
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="changedARD"/>
                                                        <Val>NORES</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="ChangeRAT">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Remove name="tempAccessRestrictionData"/>
                                                    </Then>
                                                </If>
                                                -->
<!-- BPQ | 2009/12/10 | Begin of fix FR SDMA01FAG247629, remark incorrect code  -->
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="accessRestrictionData" />
                                                <Val>NORES</Val>
                                            </Condition>
                                            <Then>
<!-- BPQ | 2009/12/10 | Begin of fix FR SDMA01FAG247629, accessRestrictionData related mediation is incorrect due to NORES  -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="setGreater">
                                                            <Ref name="accessRestrictionData" delta="changed" entityName="HistoryBeGDMI" />
                                                            <Null />
                                                        </Condition>
                                                        <Condition operator="setGreater">
                                                            <Ref name="accessRestrictionData" delta="old" entityName="HistoryBeGDMI" />
                                                            <Null />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="tempAccessRestrictionData">
                                                            <Null />
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Remove name="tempAccessRestrictionData" />
                                                    </Else>
                                                </If>
<!-- BPQ | 2009/12/10 | End of fix FR SDMA01FAG247629, accessRestrictionData related mediation is incorrect due to NORES  -->
                                            </Then>
                                        </If>
                                        <Set name="non3gppAccessRestrictionData">
                                            <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                        </Set>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext" />
                                                <Val>NORES</Val>
                                            </Condition>
                                            <Then>
                                                <Remove name="non3gppAccessRestrictionData" />
                                            </Then>
                                        </If>
<!-- End by wupingfan.-->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="accessRestrictionData" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="accessRestrictionData" />
                                                    <Ref name="oldaccessRestrictionData" />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="ChangeARD">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldSgsnIsdn">
                                                    <Ref name="oldSgsnIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldVlrIsdn">
                                                    <Ref name="oldVlrIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldLocalMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" entityName="PostCommitBeContext" />
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="oldVlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldSgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="destinationEntity">
                                                            <Val>BOTH</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="oldVlrIsdn" />
                                                                <NotExist />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="destinationEntity">
                                                                    <Val>noGPRS</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldSgsnIsdn" />
                                                                        <NotExist />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="destinationEntity">
                                                                            <Val>GPRSonly</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                            <Else>
                                                <Remove name="accessRestrictionData" />
                                            </Else>
                                        </If>
<!-- 
                                        ***************************************************************************************
                                        *   5.1 NAM change or delete subscriber
                                        *************************************************************************************** -->
                                        <Set name="networkAccessMode">
                                            <Ref name="networkAccessMode" delta="" entityName="HistoryBeGDMI" />
                                        </Set>
                                        <Set name="oldNetworkAccessMode">
                                            <Ref name="networkAccessMode" delta="old" entityName="HistoryBeGDMI" />
                                        </Set>
<!-- Add by wupingfan.-->
                                        <Set name="newNetworkAccessMode">
                                            <Null />
                                        </Set>
<!-- End by wupingfan.-->
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="oldNetworkAccessMode" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="deleteGSM">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="createGPRS">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="deleteGPRS">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="createGSM">
                                                    <Val>false</Val>
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="createGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>noBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="createGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="destinationEntity">
                                                            <Val>noGPRS</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>newBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="createGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>noBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="createGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="destinationEntity">
                                                            <Val>GPRSonly</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>newBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGPRS">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>oldBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="deleteGSM">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="ChangeNAM">
                                                            <Val>oldBOTH</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- 
                                            ***************************************************************************************
                                            *   5.1.1   NAM change
                                            *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="networkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="oldNetworkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                            </AND>
                                            <Then>
<!-- begin SDMA01FAG215729 sining.wang -->
                                                <Set name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                </Set>
<!-- end SDMA01FAG215729 sining.wang -->
<!--NGHLR1FAG172563_Begin_1 -->
<!--CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>        extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId       </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription"/>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>         SuMSubscriberProfileId,SumSubscriptionProfileId valorized        </Description>
                                                        <Parameter name="suMSubscriberProfileId"/>
                                                        <Parameter name="suMSubscriptionProfileId"/>
                                                        <Parameter name="gsmServiceProfileId"/>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>         DN suMSubscriptionProfile available        </Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>GsmServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId"/>
                                                        <Parameter name="suMSubscriptionProfileId"/>
                                                        <Parameter name="gsmServiceProfileId"/>
                                                    </In>
                                                    <Out>
                                                        <Description>         DN suMSubscriptionProfile available        </Description>
                                                        <Parameter name="DN_SuMSubscriptionProfile">
                                                            <Ref name="__DISTINGUISH_NAME"/>
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>        Query  on  Entry SuMSubscriptionProfile       </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_SuMSubscriptionProfile"/>
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedMainMsisdn</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="associatedMainMsisdn"/>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>        Query Entry Main SubscriberNumber       </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedMainMsisdn"/>
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedSubscriptionProfile_@@_associatedIMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <AllParameters/>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI"/>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId"/>
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId"/>
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId"/>
                                                        </Parameter>
                                                    </Out>
                                                </CallBE-->
<!--NGHLR1FAG172563_End_1 -->
                                                <Set name="oldSgsnIsdn">
                                                    <Ref name="oldSgsnIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldVlrIsdn">
                                                    <Ref name="oldVlrIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldLocalMobileStationIdentity">
                                                    <Ref name="oldLocalMobileStationIdentity" entityName="PostCommitBeContext" />
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGSM" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldVlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>noGPRS</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldSgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>GPRSonly</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="destinationEntity">
                                                            <Val>noGPRS</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="oldNetworkAccessMode" />
                                                            <Val>BOTH</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                            <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="destinationEntity">
                                                            <Val>GPRSonly</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- Add by wupingfan. If NAM changed from BOTH OR GPRSonly to noGPRS,CLR/RTR will be triggered.-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="ueMmeExist" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="sendClrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- Begin: add for 69061 by Yvonne He on 2013-01-26 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="ueS4SgsnExist" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="sendS4sgsnClrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- End: add for 69061 by Yvonne He on 2013-01-26 -->
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="ueAaaLocated" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="deleteGPRS" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="sendRtrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- End by wupingfan.-->
                                            </Then>
                                        </If>
<!-- Add by wupingfan.Check the networkAccessMode whether changed.-->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="networkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="oldNetworkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="networkAccessMode" />
                                                    <Ref name="oldNetworkAccessMode" />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="newNetworkAccessMode">
                                                    <Ref name="networkAccessMode" />
                                                </Set>
                                            </Then>
                                            <Else>
                                                <Remove name="newNetworkAccessMode" />
                                            </Else>
                                        </If>
<!-- End by wupingfan.-->
<!-- 
                                            ***************************************************************************************
                                            *   5.1.2   Delete subscriber
                                            *************************************************************************************** -->
                                        <Set name="IMSI_Change_Mode">
                                            <Ref name="IMSI_Change_Mode" entityName="PostCommitBeContext" />
                                        </Set>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="networkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="IMSI_Change_Mode" />
                                                    <Val>MANUAL</Val>
                                                </Condition>
<!--Begin FFRD 66935 -->
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="deleteSubscription" entityName="PostCommitBeContext" />
                                                        <Val>false</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="requestName" />
                                                        <Val>delete</Val>
                                                    </Condition>
                                                </AND>
<!--End FFRD 66935 -->
                                            </OR>
                                            <Then>
                                                <Set name="ChangeNAM">
                                                    <Val>noBOTH</Val>
                                                </Set>
                                                <Set name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldSgsnIsdn">
                                                    <Ref name="sgsnIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldVlrIsdn">
                                                    <Ref name="vlrIsdn" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="oldLocalMobileStationIdentity">
                                                    <Ref name="localMobileStationIdentity" entityName="PostCommitBeContext" />
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="oldVlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldSgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="creqDestinationEntity">
                                                            <Val>BOTH</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="oldVlrIsdn" />
                                                                <NotExist />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="creqDestinationEntity">
                                                                    <Val>noGPRS</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldSgsnIsdn" />
                                                                        <NotExist />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="creqDestinationEntity">
                                                                            <Val>GPRSonly</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
<!-- Add by wupingfan, delete the basic sub will trigger CLR.-->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="ueMmeExist" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendClrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- Begin: add for 69061 by Yvonne He on 2013-01-27 -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="ueS4SgsnExist" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendS4sgsnClrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- End: add for 69061 by Yvonne He on 2013-01-27 -->
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="ueAaaLocated" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendRtrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- End by wupingfan.-->
                                            </Then>
                                        </If>
<!-- 
                                            ***************************************************************************************
                                            *   5.2 Update mainMSISDN
                                            *************************************************************************************** -->
<!--Begin FFRD 66935 -->
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="deleteSubscription" entityName="PostCommitBeContext" />
                                                <Val>false</Val>
                                            </Condition>
                                            <Then>
<!--End FFRD 66935 -->
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_BasicSubscription" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>SuMSubscriberProfileId,SumSubscriptionProfileId valorized</Description>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN suMSubscriptionProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>GsmServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN suMSubscriptionProfile available</Description>
                                                        <Parameter name="DN_SuMSubscriptionProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <Set name="associatedMainMsisdn">
                                                    <Ref name="associatedMainMsisdn" delta="" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                </Set>
                                                <Set name="oldMainMSISDN">
                                                    <Ref name="associatedMainMsisdn" delta="old" entityName="HistoryBeGDMI" DN="DN_SuMSubscriptionProfile" />
                                                </Set>
                                                <If>
                                                    <Condition operator="setLessOrEqual">
                                                        <Ref name="associatedMainMsisdn" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <Set name="nowMainMsisdn">
                                                            <Ref name="oldMainMSISDN" />
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <Set name="nowMainMsisdn">
                                                            <Ref name="associatedMainMsisdn" />
                                                        </Set>
                                                    </Else>
                                                </If>
<!-- Add by wupingfan.2009/09/16.-->
                                                <Set name="newMainMSISDN">
                                                    <Null />
                                                </Set>
<!-- Add by wupingfan,To obtain the updated newMainMSISDN.-->
                                                <CallBE name="query" entityName="HSS.SUB.*.DnHandler">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="nowMainMsisdn" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="nowcountryCodeId">
                                                            <Ref name="countryCodeId" />
                                                        </Parameter>
                                                        <Parameter name="nownationalDestinationCodeId">
                                                            <Ref name="nationalDestinationCodeId" />
                                                        </Parameter>
                                                        <Parameter name="nowsubscriberNumberId">
                                                            <Ref name="subscriberNumberId" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeString" name="join">
                                                    <Description>combine main MSISDN's 3 sub-fields into string formt</Description>
                                                    <In>
                                                        <Parameter name="joinParameters">
                                                            <Val>nowcountryCodeId,nownationalDestinationCodeId,nowsubscriberNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>newMainMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="nowcountryCodeId" />
                                                        <Parameter name="nownationalDestinationCodeId" />
                                                        <Parameter name="nowsubscriberNumberId" />
                                                    </In>
                                                    <Out>
                                                        <Parameter name="newMainMSISDN" />
                                                    </Out>
                                                </CallBE>
                                                <Set name="tempMainMSISDN">
                                                    <Ref name="newMainMSISDN" />
                                                </Set>
<!-- End by wupingfan.-->
<!--Add for 71037 dead lock issue begin-->
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="oldMainMSISDN" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="associatedMainMsisdn" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="associatedMainMsisdn" />
                                                            <Ref name="oldMainMSISDN" />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="ChangeSN">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <OR>
                                                        <Condition operator="eq">
                                                            <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="ChangeSN" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </OR>
                                                    <Then>
<!-- Add by wupingfan,To obtain the updated newMainMSISDN.-->
<!--
                                                <CallBE name="query" entityName="HSS.SUB.*.DnHandler">
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedMainMsisdn"/>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="countryCodeId"/>
                                                        <Parameter name="nationalDestinationCodeId"/>
                                                        <Parameter name="subscriberNumberId"/>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.BeString" name="join">
                                                    <Description> combine main MSISDN's 3  sub-fields into string formt </Description>
                                                    <In>
                                                        <Parameter name="joinParameters">
                                                            <Val>countryCodeId,nationalDestinationCodeId,subscriberNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>newMainMSISDN</Val>
                                                        </Parameter>
                                                        <Parameter name="countryCodeId"/>
                                                        <Parameter name="nationalDestinationCodeId"/>
                                                        <Parameter name="subscriberNumberId"/>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="newMainMSISDN"/>
                                                    </Out>
                                                </CallBE>
                                                -->
<!-- End by wupingfan.-->
<!--NGHLR1FAG172563_Begin_2 -->
                                                        <Set name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="subscriberNumberId">
                                                            <Ref name="subscriberNumberId" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="fSA012" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>Extract subscriberNumberId,nationalDestinationCodeId</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedMainMsisdn" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Description>Extract mobileCountryCodeId,nationalDestinationCodeId</Description>
                                                                        <Parameter name="subscriberNumberId">
                                                                            <Ref name="subscriberNumberId" />
                                                                        </Parameter>
                                                                        <Parameter name="nationalDestinationCodeId">
                                                                            <Ref name="nationalDestinationCodeId" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                                    <Description>Extract subscriberNumberId,nationalDestinationCodeId</Description>
                                                                    <In>
                                                                        <Parameter name="__DISTINGUISH_NAME">
                                                                            <Ref name="associatedMainMsisdn" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out>
                                                                        <Description>Extract mobileCountryCodeId,nationalDestinationCodeId</Description>
                                                                        <Parameter name="subscriberNumberId">
                                                                            <Ref name="subscriberNumberId" />
                                                                        </Parameter>
                                                                    </Out>
                                                                </CallBE>
                                                            </Else>
                                                        </If>
<!-- CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                    <Description>        Query Entry Main SubscriberNumber       </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedMainMsisdn"/>
                                                        </Parameter>
                                                        <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                            <Val>associatedSubscriptionProfile_@@_associatedIMSI</Val>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <AllParameters/>
                                                    </Out>
                                                </CallBE>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                    <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="associatedIMSI"/>
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId from link  associatedIMSI         </Description>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId"/>
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId"/>
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId"/>
                                                        </Parameter>
                                                    </Out>
                                                </CallBE-->
<!--NGHLR1FAG172563_End_2 -->
                                                        <Set name="oldSgsnIsdn">
                                                            <Ref name="oldSgsnIsdn" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="oldVlrIsdn">
                                                            <Ref name="oldVlrIsdn" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="oldLocalMobileStationIdentity">
                                                            <Ref name="oldLocalMobileStationIdentity" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="neq">
                                                                    <Ref name="oldVlrIsdn" />
                                                                    <NotExist />
                                                                </Condition>
                                                                <Condition operator="neq">
                                                                    <Ref name="oldSgsnIsdn" />
                                                                    <NotExist />
                                                                </Condition>
                                                            </AND>
                                                            <Then>
                                                                <Set name="destinationEntity">
                                                                    <Val>BOTH</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldVlrIsdn" />
                                                                        <NotExist />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="destinationEntity">
                                                                            <Val>noGPRS</Val>
                                                                        </Set>
                                                                    </Then>
                                                                    <Else>
                                                                        <If>
                                                                            <Condition operator="neq">
                                                                                <Ref name="oldSgsnIsdn" />
                                                                                <NotExist />
                                                                            </Condition>
                                                                            <Then>
                                                                                <Set name="destinationEntity">
                                                                                    <Val>GPRSonly</Val>
                                                                                </Set>
                                                                            </Then>
                                                                        </If>
                                                                    </Else>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Then>
<!-- Add by wupingfan.-->
                                                    <Else>
                                                        <Remove name="newMainMSISDN" />
                                                    </Else>
<!-- End by wupingfan.-->
                                                </If>
<!--Begin FFRD 66935 -->
                                            </Then>
                                        </If>
<!--End FFRD 66935 -->
<!-- 
                                            ***************************************************************************************
                                            *   5.3 Update BearerService
                                            *************************************************************************************** -->
                                        <Set name="oldBearerServiceNameList">
                                            <Ref name="oldBearerServiceNameList" entityName="PostCommitBeContext" />
                                        </Set>
<!--Add for SDMA01CAG271493 begin-->
                                        <Set name="subscriberType">
                                            <Ref name="subscriberType" entityName="PostCommitBeContext" />
                                        </Set>
<!--Add for SDMA01CAG271493 end-->
<!-- 
                                            ***************************************************************************************
                                            *     get newBearerServiceNameList
                                            *************************************************************************************** -->
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="networkAccessMode" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Proc>
                                                    <Description>+ read mainMSISDN on IMSI to check if available</Description>
                                                    <In>
                                                        <Parameter name="DN_BasicSubscription" />
                                                    </In>
<!-- begin SDMA01FAG215729 sining.wang -->
                                                    <Set name="associatedBasicServicesList">
                                                        <Ref name="associatedBasicServicesList" entityName="PostCommitBeContext" />
                                                    </Set>
<!-- end SDMA01FAG215729 sining.wang -->
<!--NGHLR1FAG172563_Begin_3 -->
<!--CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>         Query on Entry BasicSubscription with DN_BasicSubscription (input DN)        </Description>
                                                        <In>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>bscWithoutSN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="bscWithoutSN">
                                                                <Ref name="bscWithoutSN"/>
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE-->
                                                    <Foreach name="DN_BSC">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServicesList" />
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                                            <Description>Extract serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BSC" />
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId,serviceCodeMnemonicId from one of link bscWithoutSN</Description>
                                                                <Parameter name="BearerCapabilityName">
                                                                    <Ref name="serviceCodeMnemonicId" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="newBearerServiceNameList">
                                                            <MultiValue>
                                                                <Ref name="newBearerServiceNameList" />
                                                                <Ref name="BearerCapabilityName" />
                                                            </MultiValue>
                                                        </Set>
                                                    </Foreach>
<!-- CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>        extract fields from input DN BasicSubscription : SuMSubscriberProfileId,SumSubscriptionProfileId       </Description>
                                                        <In/>
                                                        <Out>
                                                            <Description>         SuMSubscriberProfileId,SumSubscriptionProfileId valorized        </Description>
                                                            <Parameter name="suMSubscriberProfileId"/>
                                                            <Parameter name="suMSubscriptionProfileId"/>
                                                            <Parameter name="gsmServiceProfileId"/>
                                                            <Parameter name="DN_BasicSubscription">
                                                                <Ref name="__DISTINGUISH_NAME"/>
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                        <Description>         DN suMSubscriptionProfile available        </Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>GsmServiceProfile_DN</Val>
                                                            </Parameter>
                                                            <Parameter name="suMSubscriberProfileId"/>
                                                            <Parameter name="suMSubscriptionProfileId"/>
                                                            <Parameter name="gsmServiceProfileId"/>
                                                        </In>
                                                        <Out>
                                                            <Description>         DN suMSubscriptionProfile available        </Description>
                                                            <Parameter name="DN_SuMSubscriptionProfile">
                                                                <Ref name="__DISTINGUISH_NAME"/>
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>        Query  on  Entry SuMSubscriptionProfile       </Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_SuMSubscriptionProfile"/>
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedMainMsisdn</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <AllParameters/>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>        Query on Entry MobileStationInternalISDN on  associatedMainMsisdn  attribute       </Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedMainMsisdn"/>
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedBasicServices_@@_associatedIMSI</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <AllParameters/>
                                                        </Out>
                                                    </CallBE>
                                                    <Foreach name="DN_BSC">
                                                        <MultiValue>
                                                            <Ref name="associatedBasicServices"/>
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.PMH.*.DnHandler" name="query">
                                                            <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId  from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId         </Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_BSC"/>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>         Extract mobileCountryCodeId,mobileNetworkCodeId,basicServiceGroupId,basicServiceCodeId  from DN associatedBasicServices, built ouput MainBearerCapabilityNameBSC with basicServiceCodeId         </Description>
                                                                <Parameter name="mobileCountryCodeId">
                                                                    <Ref name="mobileCountryCodeId"/>
                                                                </Parameter>
                                                                <Parameter name="mobileNetworkCodeId">
                                                                    <Ref name="mobileNetworkCodeId"/>
                                                                </Parameter>
                                                                <Parameter name="basicServiceGroupId">
                                                                    <Val>SPEECH</Val>
                                                                </Parameter>
                                                                <Parameter name="basicServiceCodeId">
                                                                    <Ref name="basicServiceCodeId"/>
                                                                </Parameter>
                                                                <Parameter name="BearerCapabilityName">
                                                                    <Ref name="serviceCodeMnemonicId"/>
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="newBearerServiceNameList">
                                                            <MultiValue>
                                                                <Ref name="newBearerServiceNameList"/>
                                                                <Ref name="BearerCapabilityName"/>
                                                            </MultiValue>
                                                        </Set>
                                                    </Foreach>
                                                    <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                        <Description>        Query on Entry MSubIdentificationNumber  on  associatedIMSI  attribute       </Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="associatedIMSI"/>
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>associatedMSISDN</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="associatedMSISDN">
                                                                <Ref name="associatedMSISDN"/>
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <Foreach name="DN_MSISDN">
                                                        <MultiValue>
                                                            <Ref name="associatedMSISDN"/>
                                                        </MultiValue>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                            <Description>         Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN         </Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MSISDN"/>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Description>         Extract countryCodeId,nationalDestinationCodeId,subscriberNumberId from DN associatedMSISDN         </Description>
                                                                <Parameter name="countryCodeId"/>
                                                                <Parameter name="nationalDestinationCodeId"/>
                                                                <Parameter name="subscriberNumberId"/>
                                                            </Out>
                                                        </CallBE>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>         Query on Entry MsisdnCharacteristics on  one associatedMSISDN attribute        </Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_MSISDN"/>
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>associatedIMSI_@@_associatedBasicServices</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <AllParameters/>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="intBearerServiceNameList">
                                                            <Ref name="newBearerServiceNameList"/>
                                                        </Set>
                                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Build_SNwithBSC" name="modify">
                                                            <In>
                                                                <Parameter name="associatedBasicServices"/>
                                                                <Parameter name="intBearerServiceNameList"/>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="intBearerServiceNameList"/>
                                                            </Out>
                                                        </CallBE>
                                                        <Set name="newBearerServiceNameList">
                                                            <Ref name="intBearerServiceNameList"/>
                                                        </Set>
                                                    </Foreach-->
                                                    <Out>
                                                        <Parameter name="newBearerServiceNameList" />
                                                    </Out>
                                                </Proc>
                                            </Then>
                                        </If>
                                        <Foreach name="BearerCapabilityName">
                                            <MultiValue>
                                                <Ref name="newBearerServiceNameList" />
                                            </MultiValue>
                                            <If>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="oldBearerServiceNameList" />
                                                    <Ref name="BearerCapabilityName" />
                                                </Condition>
                                                <Then>
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN  -->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" entityName="PostCommitBeContext" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                            <Parameter name="plmnFunctionId">
                                                                <Ref name="plmnFunctionId" />
                                                            </Parameter>
                                                            <Parameter name="managedElementId">
                                                                <Ref name="managedElementId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query Entry Main SubscriberNumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="belongToBscLink" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>extract field belongToBscLink</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="belongToBscLink" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>suMSubscriberProfileId,suMSubscriptionProfileId valorized</Description>
                                                            <Parameter name="basicServiceCodeId" />
                                                        </Out>
                                                    </CallBE>
<!--NGHLR1FAG172563_End_3 -->
<!-- basicServiceCodeListIreq = GPRS is not include -->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="basicServiceCodeListIreq">
                                                                <MultiValue>
                                                                    <Ref name="basicServiceCodeListIreq" />
                                                                    <Ref name="basicServiceCodeId" />
                                                                </MultiValue>
                                                            </Set>
                                                            <Set name="ChangeBS">
                                                                <Val>Insert</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
<!--  Begin: Added for 69061 by Yvonne, 2013/3/19. If SMSMO is a new BSC, send IDR to S4sgsn or Combined MME/SGSN -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>SMSMO</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="isTscSmsmoInIdr">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
<!--  Begin: Added for 69061 by Yvonne, 2013/3/19. If SMSMO is a new BSC, send IDR to S4sgsn or Combined MME/SGSN -->
                                                </Then>
                                            </If>
                                        </Foreach>
<!--Add for SDMA01CAG271493 begin-->
                                        <Set name="oldsubscriberType">
                                            <Ref name="subscriberType" entityName="HistoryBeGDMI" DN="DN_SuMSubscriptionProfile" delta="old" />
                                        </Set>
                                        <Foreach name="ExtendedBearerServiceWithoutSN">
                                            <MultiValue>
                                                <Ref name="BSCofBSG20" defaultValue="force" />
                                            </MultiValue>
                                            <If>
                                                <AND>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="ExtendedBearerServiceWithoutSN" />
                                                        <Ref name="subscriberType" />
                                                    </Condition>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="ExtendedBearerServiceWithoutSN" />
                                                        <Ref name="oldsubscriberType" />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="basicServiceCodeId">
                                                        <Ref name="ExtendedBearerServiceWithoutSN" />
                                                    </Set>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="basicServiceCodeListIreq">
                                                                <MultiValue>
                                                                    <Ref name="basicServiceCodeListIreq" />
                                                                    <Ref name="basicServiceCodeId" />
                                                                </MultiValue>
                                                            </Set>
                                                            <Set name="ChangeBS">
                                                                <Val>Insert</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
                                        </Foreach>
<!--Add for SDMA01CAG271493 end-->
                                        <Foreach name="BearerCapabilityName">
                                            <MultiValue>
                                                <Ref name="oldBearerServiceNameList" />
                                            </MultiValue>
                                            <If>
                                                <AND>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="newBearerServiceNameList" />
                                                        <Ref name="BearerCapabilityName" />
                                                    </Condition>
<!--Add for SDMA01CAG271493 begin-->
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="BSCofBSG20" defaultValue="force" />
                                                        <Ref name="BearerCapabilityName" />
                                                    </Condition>
<!--Add for SDMA01CAG271493 end-->
                                                </AND>
                                                <Then>
                                                    <CallBE entityName="HSS.PMH.*.DnHandler" name="create">
                                                        <Description>build associatedBasicServices of the MainBearerCapabilityName</Description>
                                                        <In>
                                                            <Parameter name="__DN_SYNTAX_NAME">
                                                                <Val>ServiceCodeMnemonic_DN</Val>
                                                            </Parameter>
<!-- multiPLMN link, link to master HPLMN-->
                                                            <Parameter name="mobileCountryCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMCC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileCountryCodeId" entityName="PostCommitBeContext" />
                                                            </Parameter>
                                                            <Parameter name="mobileNetworkCodeId">
<!--modify by yyang006, 67405-->
<!--Ref name="masterMNC" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractGlobalHlrData"/-->
                                                                <Ref name="mvnomobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                            </Parameter>
                                                            <Parameter name="serviceCodeMnemonicId">
                                                                <Ref name="BearerCapabilityName" />
                                                            </Parameter>
                                                            <Parameter name="plmnFunctionId">
                                                                <Ref name="plmnFunctionId" />
                                                            </Parameter>
                                                            <Parameter name="managedElementId">
                                                                <Ref name="managedElementId" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="DN_BSC">
                                                                <Ref name="__DISTINGUISH_NAME" />
                                                            </Parameter>
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.PMH.*.BeGDMI" name="query">
                                                        <Description>Query Entry Main SubscriberNumber</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="DN_BSC" />
                                                            </Parameter>
                                                            <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                <Val>belongToBscLink</Val>
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Parameter name="belongToBscLink" />
                                                        </Out>
                                                    </CallBE>
                                                    <CallBE entityName="HSS.SUB.*.DnHandler" name="query">
                                                        <Description>extract field belongToBscLink</Description>
                                                        <In>
                                                            <Parameter name="__DISTINGUISH_NAME">
                                                                <Ref name="belongToBscLink" />
                                                            </Parameter>
                                                        </In>
                                                        <Out>
                                                            <Description>suMSubscriberProfileId,suMSubscriptionProfileId valorized</Description>
                                                            <Parameter name="basicServiceCodeId" />
                                                        </Out>
                                                    </CallBE>
<!-- basicServiceCodeListIreq = GPRS is not include -->
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="basicServiceCodeListDreq">
                                                                <MultiValue>
                                                                    <Ref name="basicServiceCodeListDreq" />
                                                                    <Ref name="basicServiceCodeId" />
                                                                </MultiValue>
                                                            </Set>
                                                            <If>
                                                                <Condition operator="neq">
                                                                    <Ref name="basicServiceCodeListIreq" />
                                                                    <NotExist />
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="ChangeBS">
                                                                        <Val>All</Val>
                                                                    </Set>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="ChangeBS">
                                                                        <Val>Delete</Val>
                                                                    </Set>
                                                                </Else>
                                                            </If>
                                                        </Then>
                                                    </If>
<!--  Begin: Added for 69061 by Yvonne, 2013/3/19. If SMSMO is deleted, send DSR to S4sgsn or Combined MME/SGSN -->
                                                    <If>
                                                        <Condition operator="eq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>SMSMO</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="isTscSmsmoInDsr">
                                                                <Val>true</Val>
                                                            </Set>
                                                        </Then>
                                                    </If>
<!--  Begin: Added for 69061 by Yvonne, 2013/3/19. If If SMSMO is deleted, send DSR to S4sgsn or Combined MME/SGSN -->
                                                </Then>
                                            </If>
                                        </Foreach>
<!--Add for SDMA01CAG271493 begin-->
                                        <Foreach name="ExtendedBearerServiceWithoutSN">
                                            <MultiValue>
                                                <Ref name="BSCofBSG20" defaultValue="force" />
                                            </MultiValue>
                                            <If>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="ExtendedBearerServiceWithoutSN" />
                                                    <Ref name="oldsubscriberType" />
                                                </Condition>
                                                <Then>
                                                    <Set name="ExtendedBearerServiceWithoutSNList">
                                                        <MultiValue>
                                                            <Ref name="ExtendedBearerServiceWithoutSNList" />
                                                            <Ref name="ExtendedBearerServiceWithoutSN" />
                                                        </MultiValue>
                                                    </Set>
                                                </Then>
                                            </If>
                                        </Foreach>
                                        <Foreach name="BearerCapabilityName">
                                            <MultiValue>
                                                <Ref name="ExtendedBearerServiceWithoutSNList" />
                                            </MultiValue>
                                            <If>
                                                <AND>
                                                    <Condition operator="nullIntersection">
                                                        <Ref name="subscriberType" />
                                                        <Ref name="BearerCapabilityName" />
                                                    </Condition>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="BSCofBSG20" defaultValue="force" />
                                                        <Ref name="BearerCapabilityName" />
                                                    </Condition>
                                                </AND>
                                                <Then>
                                                    <Set name="basicServiceCodeId">
                                                        <Ref name="BearerCapabilityName" />
                                                    </Set>
                                                    <If>
                                                        <Condition operator="neq">
                                                            <Ref name="basicServiceCodeId" />
                                                            <Val>GPRS</Val>
                                                        </Condition>
                                                        <Then>
                                                            <Set name="basicServiceCodeListDreq">
                                                                <MultiValue>
                                                                    <Ref name="basicServiceCodeListDreq" />
                                                                    <Ref name="basicServiceCodeId" />
                                                                </MultiValue>
                                                            </Set>
                                                            <If>
                                                                <Condition operator="neq">
                                                                    <Ref name="basicServiceCodeListIreq" />
                                                                    <NotExist />
                                                                </Condition>
                                                                <Then>
                                                                    <Set name="ChangeBS">
                                                                        <Val>All</Val>
                                                                    </Set>
                                                                </Then>
                                                                <Else>
                                                                    <Set name="ChangeBS">
                                                                        <Val>Delete</Val>
                                                                    </Set>
                                                                </Else>
                                                            </If>
                                                        </Then>
                                                    </If>
                                                </Then>
                                            </If>
                                        </Foreach>
<!--Add for SDMA01CAG271493 end-->
<!-- SDMA01FAG250921, begin, 2010-6-17, zeyangy -->
<!-- Send SS change when BSG is removed -->
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="basicServiceCodeListDreq" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_BSGDeleted" name="SSMediation">
                                                    <In />
                                                    <Out>
                                                        <Parameter name="suppServicesListIreq" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                        </If>
<!-- SDMA01FAG250921, end, 2010-6-17, zeyangy -->
<!-- 
                                            ***************************************************************************************
                                            *   5.4 Update msCategory and csAllocationRetentionPriority
                                            *************************************************************************************** -->
                                        <If>
                                            <OR>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="oldNetworkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                    </Condition>
                                                </AND>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="oldNetworkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                </AND>
                                            </OR>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.DnHandler" name="create">
                                                    <Description>DN CsServiceProfile available</Description>
                                                    <In>
                                                        <Parameter name="__DN_SYNTAX_NAME">
                                                            <Val>CsServiceProfile_DN</Val>
                                                        </Parameter>
                                                        <Parameter name="suMSubscriberProfileId" />
                                                        <Parameter name="suMSubscriptionProfileId" />
                                                        <Parameter name="gsmServiceProfileId" />
                                                    </In>
                                                    <Out>
                                                        <Description>DN CsServiceProfile available</Description>
                                                        <Parameter name="DN_CsServiceProfile">
                                                            <Ref name="__DISTINGUISH_NAME" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="fLR023" entityName="HSS.SystemData.SystemData.Sys_OAM_SysLocationSecurity" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="newCsAllocationRetentionPriority">
                                                            <Ref name="csAllocationRetentionPriority" delta="" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                        </Set>
                                                        <Set name="oldCsAllocationRetentionPriority">
                                                            <Ref name="csAllocationRetentionPriority" delta="old" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                        </Set>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="newCsAllocationRetentionPriority" />
                                                                <Ref name="oldCsAllocationRetentionPriority" />
                                                            </Condition>
                                                            <Then>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldCsAllocationRetentionPriority" />
                                                                        <NotExist />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="csAllocationRetentionPriority">
                                                                            <Ref name="oldCsAllocationRetentionPriority" />
                                                                        </Set>
                                                                    </Then>
                                                                    <Else>
                                                                        <Set name="csAllocationRetentionPriority">
                                                                            <Ref name="newCsAllocationRetentionPriority" />
                                                                        </Set>
                                                                    </Else>
                                                                </If>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                                <Set name="newMsCategory">
                                                    <Ref name="msCategory" delta="" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                </Set>
                                                <Set name="oldMsCategory">
                                                    <Ref name="msCategory" delta="old" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                </Set>
                                                <If>
                                                    <Condition operator="neq">
                                                        <Ref name="newMsCategory" />
                                                        <Ref name="oldMsCategory" />
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="oldMsCategory" />
                                                                <NotExist />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="msCategory">
                                                                    <Ref name="oldMsCategory" />
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <Set name="msCategory">
                                                                    <Ref name="newMsCategory" />
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
                                                <Set name="newopSpecificCategory">
                                                    <Ref name="opSpecificCategory" delta="" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                </Set>
                                                <Set name="oldopSpecificCategory">
                                                    <Ref name="opSpecificCategory" delta="old" entityName="HistoryBeGDMI" DN="DN_CsServiceProfile" />
                                                </Set>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="newMsCategory" />
                                                            <Ref name="oldMsCategory" />
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="newMsCategory" />
                                                            <Val>OPSPEC</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="newopSpecificCategory" />
                                                                <Ref name="oldopSpecificCategory" />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="msCategory">
                                                                    <Val>OPSPEC</Val>
                                                                </Set>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- 
                                            ***************************************************************************************
                                            *   5.5 MEDIATION Send Cancel Request or Insert request
                                            *************************************************************************************** -->
                                        <If>
                                            <AND>
                                                <Condition operator="neq">
                                                    <Ref name="ChangeBS" />
                                                    <Val>None</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeNAM" />
                                                    <Val>None</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeSN" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <If>
                                                    <AND>
                                                        <Condition operator="neq">
                                                            <Ref name="oldVlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="oldSgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="destinationEntity">
                                                            <Val>BOTH</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="neq">
                                                                <Ref name="oldVlrIsdn" />
                                                                <NotExist />
                                                            </Condition>
                                                            <Then>
                                                                <Set name="destinationEntity">
                                                                    <Val>noGPRS</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="neq">
                                                                        <Ref name="oldSgsnIsdn" />
                                                                        <NotExist />
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="destinationEntity">
                                                                            <Val>GPRSonly</Val>
                                                                        </Set>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
<!-- Add for feature (MapScreening) Start -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="mapScreeningCategoryChangedFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="destinationEntity" />
                                                    <NotExist />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="destinationEntity">
                                                    <Val>noGPRS</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="mapScreeningCategoryChangedFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="destinationEntity" />
                                                    <Val>GPRSonly</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="destinationEntity">
                                                    <Val>BOTH</Val>
                                                </Set>
                                            </Then>
                                        </If>
<!-- Add for feature (MapScreening) End -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeNAM" />
                                                    <Val>None</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="oldNetworkAccessMode" />
                                                    <NotExist />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Remove name="oldNetworkAccessMode" />
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeNAM" />
                                                    <Val>noBOTH</Val>
                                                </Condition>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="oldNetworkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="oldVlrIsdn" />
                                                        <NotExist />
                                                    </Condition>
                                                </AND>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="oldNetworkAccessMode" />
                                                        <Val>BOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                        <Ref name="namPsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>GPRSonly</Val-->
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="oldSgsnIsdn" />
                                                        <NotExist />
                                                    </Condition>
                                                </AND>
                                            </OR>
                                            <Then>
                                                <Set name="vlrIsdn">
                                                    <Ref name="oldVlrIsdn" />
                                                </Set>
                                                <Set name="localMobileStationIdentity">
                                                    <Ref name="oldLocalMobileStationIdentity" />
                                                </Set>
                                                <Set name="sgsnIsdn">
                                                    <Ref name="oldSgsnIsdn" />
                                                </Set>
                                                <If>
                                                    <OR>
                                                        <Condition operator="neq">
                                                            <Ref name="vlrIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                        <Condition operator="neq">
                                                            <Ref name="sgsnIsdn" />
                                                            <NotExist />
                                                        </Condition>
                                                    </OR>
                                                    <Then>
<!-- NGHLR1CAG199081 get flagObservedImsi-->
                                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="getUnderTestIdentity">
                                                            <In />
                                                            <Out>
                                                                <Parameter name="flagObservedImsi">
                                                                    <Ref name="isInterceptedFlag" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
<!-- NGHLR1CAG199081 end -->
                                                        <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendCreq">
                                                            <Description>create the msg CREQ</Description>
                                                            <In>
                                                                <Parameter name="mSubIdentificationNumberId" />
                                                                <Parameter name="mobileNetworkCodeId" />
                                                                <Parameter name="mobileCountryCodeId" />
                                                                <Parameter name="creqDestinationEntity" />
                                                                <Parameter name="localMobileStationIdentity" />
                                                                <Parameter name="vlrIsdn" />
                                                                <Parameter name="sgsnIsdn" />
<!-- NGHLR1CAG199081 add flagObservedImsi in creq-->
                                                                <Parameter name="flagObservedImsi" />
<!-- NGHLR1CAG199081 end -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeSN" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeNAM" />
                                                                <Val>newBOTH</Val>
                                                            </Condition>
                                                            <OR>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeBS" />
                                                                    <Val>Insert</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeBS" />
                                                                    <Val>None</Val>
                                                                </Condition>
                                                            </OR>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeSN" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeNAM" />
                                                                <Val>None</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeBS" />
                                                                <Val>Insert</Val>
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="oldNetworkAccessMode" />
                                                                <Val>BOTH</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="networkAccessMode" />
<!-- ZTX | 2009/08/24 | Update to ref Contract (69596) -->
                                                                <Ref name="namCsKey" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfGlobalHlrData" />
<!--Val>noGPRS</Val-->
                                                            </Condition>
                                                            <OR>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeBS" />
                                                                    <Val>Insert</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeBS" />
                                                                    <Val>None</Val>
                                                                </Condition>
                                                            </OR>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeSN" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeARD" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="ChangeBS" />
                                                                <Val>Delete</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="ChangeBS" />
                                                                <Val>All</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeSN" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
<!-- Add for feature (MapScreening) Start -->
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="mapScreeningCategoryChangedFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="ChangeBS" />
                                                                <Val>Delete</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="ChangeBS" />
                                                                <Val>All</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="ChangeSN" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                        </AND>
<!-- Add for feature (MapScreening) End -->
<!--Add for 71037 qdiao begin-->
                                                        <AND>
                                                            <Condition operator="setGreater">
                                                                <Ref name="icsIndicator" />
                                                                <Null />
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="neq">
                                                                <Ref name="sendPUP4IcsIndicator" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
<!--Add for 71037 qdiao end-->
                                                    </OR>
                                                    <Then>
                                                        <Set name="vlrIsdn">
                                                            <Ref name="oldVlrIsdn" />
                                                        </Set>
                                                        <Set name="localMobileStationIdentity">
                                                            <Ref name="oldLocalMobileStationIdentity" />
                                                        </Set>
                                                        <Set name="sgsnIsdn">
                                                            <Ref name="oldSgsnIsdn" />
                                                        </Set>
                                                        <If>
                                                            <OR>
                                                                <Condition operator="neq">
                                                                    <Ref name="vlrIsdn" />
                                                                    <NotExist />
                                                                </Condition>
                                                                <Condition operator="neq">
                                                                    <Ref name="sgsnIsdn" />
                                                                    <NotExist />
                                                                </Condition>
                                                            </OR>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendIreq">
                                                                    <Description>create the msg IREQ</Description>
                                                                    <In>
                                                                        <Parameter name="mSubIdentificationNumberId" />
                                                                        <Parameter name="mobileNetworkCodeId" />
                                                                        <Parameter name="mobileCountryCodeId" />
                                                                        <Parameter name="creqDestinationEntity" />
                                                                        <Parameter name="destinationEntity" />
                                                                        <Parameter name="oldNetworkAccessMode" />
                                                                        <Parameter name="basicServiceCodeListIreq" />
                                                                        <Parameter name="localMobileStationIdentity" />
                                                                        <Parameter name="vlrIsdn" />
                                                                        <Parameter name="sgsnIsdn" />
                                                                        <Parameter name="msCategory" />
                                                                        <Parameter name="csAllocationRetentionPriority" />
                                                                        <Parameter name="accessRestrictionData" />
<!--Add for 71037 qdiao begin-->
                                                                        <Parameter name="icsIndicator">
                                                                            <Ref name="icsIndicator" />
                                                                        </Parameter>
                                                                        <Parameter name="isIcsIndicatorChanged">
                                                                            <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                                        </Parameter>
<!--Add for 71037 qdiao end-->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                        </If>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <AND>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeNAM" />
                                                                    <Val>None</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeBS" />
                                                                    <Val>Delete</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeSN" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Condition operator="eq">
                                                                    <Ref name="ChangeARD" />
                                                                    <Val>false</Val>
                                                                </Condition>
                                                                <Condition operator="neq">
                                                                    <Ref name="mapScreeningCategoryChangedFlag" />
                                                                    <Val>true</Val>
                                                                </Condition>
<!-- SDMA01FAG250921, begin, 2010-6-17, zeyangy -->
                                                                <Condition operator="setLessOrEqual">
                                                                    <Ref name="suppServicesListIreq" />
                                                                    <Null />
                                                                </Condition>
<!-- SDMA01FAG250921, end, 2010-6-17, zeyangy -->
                                                            </AND>
                                                            <Then>
                                                                <Set name="vlrIsdn">
                                                                    <Ref name="oldVlrIsdn" />
                                                                </Set>
                                                                <Set name="localMobileStationIdentity">
                                                                    <Ref name="oldLocalMobileStationIdentity" />
                                                                </Set>
                                                                <Set name="sgsnIsdn">
                                                                    <Ref name="oldSgsnIsdn" />
                                                                </Set>
                                                                <If>
                                                                    <OR>
                                                                        <Condition operator="neq">
                                                                            <Ref name="vlrIsdn" />
                                                                            <NotExist />
                                                                        </Condition>
                                                                        <Condition operator="neq">
                                                                            <Ref name="sgsnIsdn" />
                                                                            <NotExist />
                                                                        </Condition>
                                                                    </OR>
                                                                    <Then>
                                                                        <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendDreq">
                                                                            <Description>create the msg DREQ</Description>
                                                                            <In>
                                                                                <Parameter name="mSubIdentificationNumberId" />
                                                                                <Parameter name="mobileNetworkCodeId" />
                                                                                <Parameter name="mobileCountryCodeId" />
                                                                                <Parameter name="creqDestinationEntity" />
                                                                                <Parameter name="destinationEntity" />
                                                                                <Parameter name="oldNetworkAccessMode" />
                                                                                <Parameter name="basicServiceCodeListDreq" />
                                                                                <Parameter name="localMobileStationIdentity" />
                                                                                <Parameter name="vlrIsdn" />
                                                                                <Parameter name="sgsnIsdn" />
                                                                            </In>
                                                                            <Out />
                                                                        </CallBE>
                                                                    </Then>
                                                                </If>
                                                            </Then>
                                                            <Else>
                                                                <Set name="vlrIsdn">
                                                                    <Ref name="oldVlrIsdn" />
                                                                </Set>
                                                                <Set name="localMobileStationIdentity">
                                                                    <Ref name="oldLocalMobileStationIdentity" />
                                                                </Set>
                                                                <Set name="sgsnIsdn">
                                                                    <Ref name="oldSgsnIsdn" />
                                                                </Set>
                                                                <If>
                                                                    <AND>
                                                                        <OR>
                                                                            <Condition operator="neq">
                                                                                <Ref name="vlrIsdn" />
                                                                                <NotExist />
                                                                            </Condition>
                                                                            <Condition operator="neq">
                                                                                <Ref name="sgsnIsdn" />
                                                                                <NotExist />
                                                                            </Condition>
                                                                        </OR>
<!--modified by 68733 FR SDMA01FAG265874 -->
                                                                        <Condition operator="neq">
                                                                            <Ref name="destinationEntity" />
                                                                            <NotExist />
                                                                        </Condition>
                                                                    </AND>
                                                                    <Then>
<!-- modify begin by BPQ when deliver LTE 69596, NDC will send in UREQ only if fSA012=true -->
                                                                        <If>
                                                                            <Condition operator="eq">
                                                                                <Ref name="fSA012" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractSubscription" />
                                                                                <Val>true</Val>
                                                                            </Condition>
                                                                            <Then>
                                                                                <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendUreq">
                                                                                    <Description>create the msg UREQ</Description>
                                                                                    <In>
                                                                                        <Parameter name="mSubIdentificationNumberId" />
                                                                                        <Parameter name="mobileNetworkCodeId" />
                                                                                        <Parameter name="mobileCountryCodeId" />
                                                                                        <Parameter name="creqDestinationEntity" />
                                                                                        <Parameter name="destinationEntity" />
                                                                                        <Parameter name="oldNetworkAccessMode" />
                                                                                        <Parameter name="localMobileStationIdentity" />
                                                                                        <Parameter name="vlrIsdn" />
                                                                                        <Parameter name="sgsnIsdn" />
                                                                                        <Parameter name="subscriberNumberId" />
                                                                                        <Parameter name="nationalDestinationCodeId" />
                                                                                        <Parameter name="basicServiceCodeListIreq" />
                                                                                        <Parameter name="basicServiceCodeListDreq" />
                                                                                        <Parameter name="msCategory" />
                                                                                        <Parameter name="csAllocationRetentionPriority" />
                                                                                        <Parameter name="accessRestrictionData" />
<!-- SDMA01FAG250921, begin, 2010-6-17, zeyangy -->
                                                                                        <Parameter name="suppServicesListIreq" />
<!-- SDMA01FAG250921, end, 2010-6-17, zeyangy -->
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Then>
                                                                            <Else>
                                                                                <CallBE entityName="HSS.SUB.*.BeOamHlt" name="createSendUreq">
                                                                                    <Description>create the msg UREQ</Description>
                                                                                    <In>
                                                                                        <Parameter name="mSubIdentificationNumberId" />
                                                                                        <Parameter name="mobileNetworkCodeId" />
                                                                                        <Parameter name="mobileCountryCodeId" />
                                                                                        <Parameter name="creqDestinationEntity" />
                                                                                        <Parameter name="destinationEntity" />
                                                                                        <Parameter name="oldNetworkAccessMode" />
                                                                                        <Parameter name="localMobileStationIdentity" />
                                                                                        <Parameter name="vlrIsdn" />
                                                                                        <Parameter name="sgsnIsdn" />
                                                                                        <Parameter name="subscriberNumberId" />
                                                                                        <Parameter name="basicServiceCodeListIreq" />
                                                                                        <Parameter name="basicServiceCodeListDreq" />
                                                                                        <Parameter name="msCategory" />
                                                                                        <Parameter name="csAllocationRetentionPriority" />
                                                                                        <Parameter name="accessRestrictionData" />
<!-- SDMA01FAG250921, begin, 2010-6-17, zeyangy -->
                                                                                        <Parameter name="suppServicesListIreq" />
<!-- SDMA01FAG250921, end, 2010-6-17, zeyangy -->
                                                                                    </In>
                                                                                    <Out />
                                                                                </CallBE>
                                                                            </Else>
                                                                        </If>
                                                                    </Then>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Else>
                                        </If>
<!--add by zhao nannan for 71037 begin to get the mdtSendIDRFlag -->
<!--first need to build the DN of DN_EpsServiceProfile, if mdtDomainId=EPS is exist,will have been put in postCommitContext  -->
                                        <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>EpsServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_GSMSUB" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_EpsServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.NetworkTrace.OAM_MdtDomain_DSD_internal" name="CheckMdtIDR">
                                            <In>
                                                <Parameter name="DN_MdtDomain">
                                                    <Ref name="DN_MdtDomain" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="DN_EpsServiceProfile" />
                                            </In>
                                            <Out>
                                                <Parameter name="mdtSendIDRFlag" />
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="PostCommitBeContext" name="modify">
                                            <Description>Save mdt related data into post commit</Description>
                                            <In>
                                                <Parameter name="mdtSendIDRFlag" />
                                            </In>
                                            <Out />
                                        </CallBE>
<!--add by zhao nannan for 71037 end to get the mdtSendIDRFlag -->
<!-- Add by wupingfan.If ARD/mainMSISDN/NAM changed,IDR will be triggered.-->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeARD" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeSN" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="ChangeNAM" />
                                                        <Val>newBOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="createGSM" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
                                                <AND>
                                                    <Condition operator="eq">
                                                        <Ref name="ChangeNAM" />
                                                        <Val>oldBOTH</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="deleteGSM" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
<!-- Add begin by fucong for 70018 on 20100729 -->
<!-- Add end by fucong for 70018 on 20100729 -->
<!--Add for 71037 qdiao begin-->
                                                <AND>
                                                    <Condition operator="setGreater">
                                                        <Ref name="icsIndicator" />
                                                        <Null />
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="isIcsIndicatorChanged" entityName="PostCommitBeContext" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </AND>
<!--Add for 71037 qdiao end-->
<!-- add by zhao nannan for 71037 begin -->
                                                <Condition operator="eq">
                                                    <Ref name="mdtSendIDRFlag" entityName="PostCommitBeContext" />
                                                    <Val>true</Val>
                                                </Condition>
<!-- add by zhao nannan for 71037 end-->
                                            </OR>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="ueMmeLocated" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
<!-- + Added for 69061 by fengziz on 20130214 -->
                                                <Set name="sendS4sgsnIdrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="sendMmeIdrMsg">
                                                    <Val>true</Val>
                                                </Set>
<!-- - Added for 69061 by fengziz on 20130214 -->
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="csgSendIDRFlag" entityName="PostCommitBeContext" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnIdrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="sendMmeIdrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="csgSubscriptionDataNum">
                                                    <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="csgSubscriptionData">
                                                    <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="mmeCsgSendIDRFlag" entityName="PostCommitBeContext" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendMmeIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="sgsnCsgSendIDRFlag" entityName="PostCommitBeContext" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="sendS4sgsnIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sgsncsgSubscriptionDataNum">
                                                            <Ref name="sgsncsgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Set>
                                                        <Set name="sgsncsgSubscriptionData">
                                                            <Ref name="sgsncsgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
<!-- Add begin by fucong for 70018 on 20100729 -->
<!-- Begin: Added for 69061 by Yvonne on 2013/03/19. -->
                                        <Set name="mmeSupportedServices">
                                            <Null />
                                        </Set>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        <Val>NODE_TYPE_IND</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>EquipmentIdentity_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="equipmentIdentityId">
                                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="equipmentTypeId">
                                                                    <Val>MMESGSN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_EquipmentIdentity">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                    </Then>
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.*.DnHandler" name="buildDN">
                                                            <In>
                                                                <Parameter name="__DN_SYNTAX_NAME">
                                                                    <Val>EquipmentIdentity_DN</Val>
                                                                </Parameter>
                                                                <Parameter name="equipmentIdentityId">
                                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="equipmentTypeId">
                                                                    <Val>S4SGSN</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="DN_EquipmentIdentity">
                                                                    <Ref name="__DISTINGUISH_NAME" />
                                                                </Parameter>
                                                            </Out>
                                                        </CallBE>
                                                    </Else>
                                                </If>
                                                <CallBE entityName="HSS.SUB.*.BeGDMI" name="existEntry">
                                                    <Description>check existence of MME data</Description>
                                                    <In>
                                                        <Parameter name="__DISTINGUISH_NAME">
                                                            <Ref name="DN_EquipmentIdentity" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="existEntry">
                                                            <Ref name="__BOOL" />
                                                        </Parameter>
                                                    </Out>
                                                </CallBE>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="existEntry" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.*.BeGDMI" name="query">
                                                            <Description>Query mmeSupportedServices</Description>
                                                            <In>
                                                                <Parameter name="__DISTINGUISH_NAME">
                                                                    <Ref name="DN_EquipmentIdentity" />
                                                                </Parameter>
                                                                <Parameter name="__ATTRIBUTE_NAME_LIST">
                                                                    <Val>mmeSupportedServices</Val>
                                                                </Parameter>
                                                            </In>
                                                            <Out>
                                                                <Parameter name="mmeSupportedServices" />
                                                            </Out>
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
                                        <If>
                                            <OR>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="mmeSupportedServices" />
                                                    <Val>SMMOPP</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ueS4SgsnLocated" />
                                                    <Val>false</Val>
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <Set name="isTscSmsmoInIdr">
                                                    <Val>false</Val>
                                                </Set>
                                                <Set name="isTscSmsmoInDsr">
                                                    <Val>false</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isTscSmsmoInIdr" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnIdrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
<!-- End: Added for 69061 by Yvonne on 2013/03/19.  -->
<!--Check DSR condition-->
<!--modified by zhao nannan for 71037 begin -->
<!--  <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="csgSendDSRFlag" entityName="PostCommitBeContext" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ueMmeLocated" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <Set name="sendDsrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="csgDeleted">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If> -->
<!-- Add end by fucong for 70018 on 20100729 -->
<!--modified by zhao nannan for 71037 end -->
<!-- + Added for 69061 by fengziz on 20130216 -->
                                        <If>
                                            <AND>
                                                <Condition operator="eq">
                                                    <Ref name="csgSendDSRFlag" entityName="PostCommitBeContext" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <OR>
                                                    <Condition operator="eq">
                                                        <Ref name="ueMmeLocated" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Condition operator="eq">
                                                        <Ref name="ueS4SgsnLocated" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                </OR>
                                            </AND>
                                            <Then>
                                                <Set name="csgDeleted">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="sendS4sgsnDsrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                                <Set name="sendMmeDsrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="mmeCsgSendDSRFlag" entityName="PostCommitBeContext" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="ueMmeLocated" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="mmecsgDeleted">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sendMmeDsrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="sgsnCsgSendDSRFlag" entityName="PostCommitBeContext" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="ueS4SgsnLocated" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
                                                    <Then>
                                                        <Set name="sendS4sgsnDsrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sgsncsgDeleted">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
<!-- - Added for 69061 by fengziz on 20130216 -->
<!-- Check the PPR condition.-->
                                        <If>
                                            <OR>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeRAT" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="ChangeSN" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </OR>
                                            <Then>
                                                <If>
<!--Modify begin by Guangli for SDMA01FAG255718 on 20100521-->
                                                    <AND>
                                                        <Condition operator="eq">
                                                            <Ref name="ueAaaLocated" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                        <Condition operator="eq">
                                                            <Ref name="non3gppIpAccRegStatus" entityName="PostCommitBeContext" />
                                                            <Val>true</Val>
                                                        </Condition>
                                                    </AND>
<!--Modify end by Guangli for SDMA01FAG255718 on 20100521-->
                                                    <Then>
                                                        <Set name="sendPprMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
<!-- End by wupingfan.-->
<!-- Begin: Added for 69061 by Yvonne on 2013/03/19. -->
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isTscSmsmoInDsr" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnDsrMsg">
                                                    <Val>true</Val>
                                                </Set>
                                            </Then>
                                        </If>
<!-- End: Added for 69061 by Yvonne on 2013/03/19.  -->
                                    </Then>
                                </If>
<!-- timeStamp -->
                            </Then>
                        </If>
<!-- timeStamp end -->
<!-- Add by wupingfan.Call send() to send RTR/PPR/CLR/IDR/DDR.-->
<!--Begin added by F71037, Austin for check if need to send CLR by changing the Sa6 Regional Restriction related data, 2013-1-22 -->
                        <If>
                            <OR>
                                <Condition operator="eq">
                                    <Ref name="sendCLRforNoExistPlmnCode" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="sendCLRforNoMatchPlmnCode" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="sendCLRforBarRoaming" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                            </OR>
                            <Then>
                                <Set name="sendClrMsg">
                                    <Val>true</Val>
                                </Set>
                            </Then>
                        </If>
<!--End added by F71037, Austin for check if need to send CLR by changing the Sa6 Regional Restriction related data, 2013-1-22 -->
<!-- Begin: modified for 69061 by Yvonne He on 2013-01-27 -->
<!-- Send CLR to MME or combined MME/S4-SGSN -->
<!-- + Added for 69061 by fengziz on 20130322. To use sendMmeClrMsg instead of sendClrMsg for cancel location of MME. It will be easier to understand the meaning. -->
                        <Set name="sendMmeClrMsg">
                            <Ref name="sendClrMsg" />
                        </Set>
<!-- - Added for 69061 by fengziz on 20130322. To use sendMmeClrMsg instead of sendClrMsg for cancel location of MME. It will be easier to understand the meaning. -->
                        <If>
                            <Condition operator="eq">
                                <Ref name="sendMmeClrMsg" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                        <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                            <Description>create the message LTECLR</Description>
                                            <In>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsnIdentity">
                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="cancellationType">
                                                    <Val>2</Val>
                                                </Parameter>
                                                <Parameter name="s6aULRFlags">
                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="s6dULRFlags">
                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                    <Else>
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                            <Description>create the message LTECLR</Description>
                                            <In>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="cancellationType">
                                                    <Val>2</Val>
                                                </Parameter>
                                                <Parameter name="s6aULRFlags">
                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Else>
                                </If>
                            </Then>
                        </If>
<!-- Send CLR to S4-SGSN -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="sendS4sgsnClrMsg" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="neq">
                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                </Condition>
                            </AND>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                    <Description>create the message LTECLR</Description>
                                    <In>
                                        <Parameter name="sgsnIdentity">
                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="userName" />
                                        <Parameter name="cancellationType">
                                            <Val>2</Val>
                                        </Parameter>
                                        <Parameter name="s6dULRFlags">
                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- End: modified for 69061 by Yvonne He on 2013-01-27 -->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="sendS4sgsnClrMsg" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="sendMmeClrMsg" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
                            <Then>
<!-- Added for 69061 by fengziz on 20130322. MME and S4SGSN are CLRed. Don't need to send IDR and DSR. -->
                            </Then>
                            <Else>
<!-- + Added for 69061 by fengziz on 20130108 -->
                                <Set name="sendS4sgsnFullIdrMsg">
                                    <Val>false</Val>
                                </Set>
                                <Set name="sendMmeFullIdrMsg">
                                    <Val>false</Val>
                                </Set>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendS4sgsnClrMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="ueS4SgsnLocated">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendMmeClrMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="ueMmeLocated">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueS4SgsnLocated" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendS4sgsnIdrMsg">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueMmeLocated" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendMmeIdrMsg">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendMmeIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="sendS4sgsnIdrMsg" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="sgsnUpdateFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="sendMmeIdrMsg" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="mmeUpdateFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <Set name="sendS4sgsnFullIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sendMmeFullIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
<!-- It's a combined node and one of the update flag is true. Need to send full IDR , it won't be handled here. -->
                                                        <Set name="sendS4sgsnIdrMsg">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Set name="sendMmeIdrMsg">
                                                            <Val>false</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                            <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                            <In>
                                                                <Parameter name="mmeIdentity">
                                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="sgsnIdentity">
                                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="userName" />
                                                                <Parameter name="mainMSISDN">
                                                                    <Ref name="newMainMSISDN" />
                                                                </Parameter>
                                                                <Parameter name="accessRestrictionData" />
                                                                <Parameter name="networkAccessMode">
                                                                    <Ref name="newNetworkAccessMode" />
                                                                </Parameter>
                                                                <Parameter name="mmeUpdateFlag" />
                                                                <Parameter name="sgsnUpdateFlag" />
                                                                <Parameter name="ccInMsIsdn">
                                                                    <Ref name="nowcountryCodeId" />
                                                                </Parameter>
                                                                <Parameter name="DN_MSubIdentificationNumber" />
                                                                <Parameter name="csgSubscriptionDataNum" />
                                                                <Parameter name="csgSubscriptionData" />
                                                                <Parameter name="s6aULRFlags">
                                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="s6dULRFlags">
                                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                                </Parameter>
<!--Add for 71037 qdiao begin-->
                                                                <Parameter name="icsIndicator">
                                                                    <Ref name="icsIndicator" />
                                                                </Parameter>
<!--Add for 71037 qdiao end-->
<!--Begin: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                <Parameter name="isTscSmsmoInIdr" />
<!--End: Added for 69061 by Yvonne on 2013/03/19 -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                        <Set name="sendS4sgsnIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sendMmeIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                    </Else>
                                                </If>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="sendS4sgsnIdrMsg" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="sgsnUpdateFlag" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                                    <In>
                                                                        <Parameter name="sgsnIdentity">
                                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                        </Parameter>
                                                                        <Parameter name="userName" />
                                                                        <Parameter name="mainMSISDN">
                                                                            <Ref name="newMainMSISDN" />
                                                                        </Parameter>
                                                                        <Parameter name="accessRestrictionData" />
                                                                        <Parameter name="networkAccessMode">
                                                                            <Ref name="newNetworkAccessMode" />
                                                                        </Parameter>
                                                                        <Parameter name="sgsnUpdateFlag" />
                                                                        <Parameter name="ccInMsIsdn">
                                                                            <Ref name="nowcountryCodeId" />
                                                                        </Parameter>
                                                                        <Parameter name="DN_MSubIdentificationNumber" />
                                                                        <Parameter name="csgSubscriptionDataNum">
                                                                            <Ref name="sgsncsgSubscriptionDataNum" />
                                                                        </Parameter>
                                                                        <Parameter name="csgSubscriptionData">
                                                                            <Ref name="sgsncsgSubscriptionData" />
                                                                        </Parameter>
                                                                        <Parameter name="s6dULRFlags">
                                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                                        </Parameter>
<!--Add for 71037 qdiao begin-->
                                                                        <Parameter name="icsIndicator">
                                                                            <Ref name="icsIndicator" />
                                                                        </Parameter>
<!--Add for 71037 qdiao end-->
<!--Begin: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                        <Parameter name="isTscSmsmoInIdr" />
<!--End: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <Set name="sendS4sgsnFullIdrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <Set name="sendS4sgsnIdrMsg">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="sendMmeIdrMsg" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="mmeUpdateFlag" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                                    <In>
                                                                        <Parameter name="mmeIdentity">
                                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                                        </Parameter>
                                                                        <Parameter name="userName" />
                                                                        <Parameter name="mainMSISDN">
                                                                            <Ref name="newMainMSISDN" />
                                                                        </Parameter>
                                                                        <Parameter name="accessRestrictionData" />
                                                                        <Parameter name="networkAccessMode">
                                                                            <Ref name="newNetworkAccessMode" />
                                                                        </Parameter>
                                                                        <Parameter name="mmeUpdateFlag" />
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                                        <Parameter name="ccInMsIsdn">
                                                                            <Ref name="nowcountryCodeId" />
                                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                                        <Parameter name="DN_MSubIdentificationNumber" />
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                                        <Parameter name="csgSubscriptionDataNum" />
                                                                        <Parameter name="csgSubscriptionData" />
<!-- Add end by fucong for 70018 on 20100729 -->
                                                                        <Parameter name="s6aULRFlags">
                                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                                        </Parameter>
<!--Add for 71037 qdiao begin-->
                                                                        <Parameter name="icsIndicator">
                                                                            <Ref name="icsIndicator" />
                                                                        </Parameter>
<!--Add for 71037 qdiao end-->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <Set name="sendMmeFullIdrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <Set name="sendMmeIdrMsg">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
                                    </Then>
                                </If>
<!-- Add end for 68733, 2010/12/07 -->
<!-- + Added for 69091 by fengziz on 20130219 -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueS4SgsnLocated" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendS4sgsnDsrMsg">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueMmeLocated" />
                                        <Val>false</Val>
                                    </Condition>
                                    <Then>
                                        <Set name="sendMmeDsrMsg">
                                            <Val>false</Val>
                                        </Set>
                                    </Then>
                                </If>
                                <If>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendMmeDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <OR>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="sendS4sgsnDsrMsg" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="sgsnUpdateFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
                                                        <AND>
                                                            <Condition operator="eq">
                                                                <Ref name="sendMmeDsrMsg" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                            <Condition operator="eq">
                                                                <Ref name="mmeUpdateFlag" />
                                                                <Val>true</Val>
                                                            </Condition>
                                                        </AND>
                                                    </OR>
                                                    <Then>
                                                        <Set name="sendS4sgsnFullIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
                                                        <Set name="sendMmeFullIdrMsg">
                                                            <Val>true</Val>
                                                        </Set>
<!-- It's a combined node and one of the update flag is true. Need to send full IDR , it won't be handled here. -->
                                                        <Set name="sendS4sgsnDsrMsg">
                                                            <Val>false</Val>
                                                        </Set>
                                                        <Set name="sendMmeDsrMsg">
                                                            <Val>false</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                            <Description>create the message LTEDSR due to 3GPP EPS Subscription removal</Description>
                                                            <In>
                                                                <Parameter name="mmeIdentity">
                                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="sgsnIdentity">
                                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="userName" />
                                                                <Parameter name="DN_MSubIdentificationNumber" />
                                                                <Parameter name="csgDeleted" />
                                                                <Parameter name="s6aULRFlags">
                                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                                </Parameter>
                                                                <Parameter name="s6dULRFlags">
                                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                                </Parameter>
<!--Begin: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                <Parameter name="isTscSmsmoInDsr" />
<!--End: Added for 69061 by Yvonne on 2013/03/19 -->
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Else>
                                                </If>
                                            </Then>
                                            <Else>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="sendS4sgsnDsrMsg" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="sgsnUpdateFlag" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                                    <Description>create the message LTEDSR due to 3GPP EPS Subscription removal</Description>
                                                                    <In>
                                                                        <Parameter name="sgsnIdentity">
                                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                                        </Parameter>
                                                                        <Parameter name="userName" />
                                                                        <Parameter name="DN_MSubIdentificationNumber" />
                                                                        <Parameter name="csgDeleted">
                                                                            <Ref name="sgsncsgDeleted" />
                                                                        </Parameter>
                                                                        <Parameter name="s6dULRFlags">
                                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                                        </Parameter>
<!--Begin: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                        <Parameter name="isTscSmsmoInDsr" />
<!--End: Added for 69061 by Yvonne on 2013/03/19 -->
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <Set name="sendS4sgsnFullIdrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <Set name="sendS4sgsnIdrMsg">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="sendMmeDsrMsg" />
                                                        <Val>true</Val>
                                                    </Condition>
                                                    <Then>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="mmeUpdateFlag" />
                                                                <Val>false</Val>
                                                            </Condition>
                                                            <Then>
                                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                                    <Description>create the message LTEDSR due to 3GPP EPS Subscription removal</Description>
                                                                    <In>
                                                                        <Parameter name="mmeIdentity">
                                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                                        </Parameter>
                                                                        <Parameter name="userName" />
                                                                        <Parameter name="DN_MSubIdentificationNumber" />
                                                                        <Parameter name="csgDeleted">
                                                                            <Ref name="mmecsgDeleted" />
                                                                        </Parameter>
                                                                        <Parameter name="s6aULRFlags">
                                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                                        </Parameter>
                                                                    </In>
                                                                    <Out />
                                                                </CallBE>
                                                            </Then>
                                                            <Else>
                                                                <Set name="sendMmeFullIdrMsg">
                                                                    <Val>true</Val>
                                                                </Set>
                                                                <Set name="sendMmeIdrMsg">
                                                                    <Val>false</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Then>
                                                </If>
                                            </Else>
                                        </If>
                                    </Then>
                                </If>
<!-- - Added for 69091 by fengziz on 20130219 -->
<!--  Prepare Diameter UserName AVP data in case PUP message will be triggered -->
<!--  Join MCC+MNC+MSIN into string-format IMSI. -->
<!-- add by SDMA01FAG279264-->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="epsServiceProfile" entityName="PostCommitBeContext" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="isSubCreate" entityName="PostCommitBeContext" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                    <Description>- CheckFor3gppIDR HSS.SUB.*.BeString</Description>
                                                    <In>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>userName</Val>
                                                        </Parameter>
                                                        <Parameter name="joinParameters">
                                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="mobileCountryCodeId_create" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="mobileNetworkCodeId_create" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="mSubIdentificationNumberId_create" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="userName" />
                                                    </Out>
                                                </CallBE>
                                            </Then>
                                            <Else>
                                                <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                                    <Description>- CheckFor3gppIDR HSS.SUB.*.BeString</Description>
                                                    <In>
                                                        <Parameter name="__DESTINATION_NAME">
                                                            <Val>userName</Val>
                                                        </Parameter>
                                                        <Parameter name="joinParameters">
                                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                                        </Parameter>
                                                        <Parameter name="mobileCountryCodeId">
                                                            <Ref name="submobileCountryCodeId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mobileNetworkCodeId">
                                                            <Ref name="submobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mSubIdentificationNumberId">
                                                            <Ref name="submSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out>
                                                        <Parameter name="userName" />
                                                    </Out>
                                                </CallBE>
                                            </Else>
                                        </If>
<!-- Build DN_EpsServiceProfile and DN_GsmServiceProfile with dnPSServiceProfile -->
                                        <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>EpsServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_GSMSUB" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_EpsServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE name="buildDN" entityName="HSS.SUB.*.DnHandler">
                                            <In>
                                                <Parameter name="__DN_SYNTAX_NAME">
                                                    <Val>GsmServiceProfile_DN</Val>
                                                </Parameter>
                                                <Parameter name="__DISTINGUISH_NAME">
                                                    <Ref name="DN_GSMSUB" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="DN_GsmServiceProfile">
                                                    <Ref name="__DISTINGUISH_NAME" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
<!-- Begin 72880 - send PPR to HSS RT when chargingGroupChanged -->
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="chargingGroupLink" entityName="HistoryBeGDMI" DN="DN_EpsServiceProfile" delta="changed" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="chargingGroupChanged">
                                                    <Val>true</Val>
                                                </Set>
                                                <CallBE entityName="HSS.SUB.*.BeEncapXMLMedMsg" name="BuildXMLMedMsg">
                                                    <Description>Call BuildXMLMedMsg to encode the charging group change into XML mediation msg</Description>
                                                    <In>
                                                        <Parameter name="userName" />
                                                        <Parameter name="chargingGroup">
                                                            <Ref name="chargingGroup" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingGroupChanged" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
<!-- Send the messages-->
                                                <CallBE entityName="HSS.SUB.*.BeHssOamRT" name="send">
                                                    <Description>send the messages</Description>
                                                    <In />
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- End 72880 - send PPR to HSS RT when chargingGroupChanged -->
<!-- If mmeUpdateFlag=true,complete profile will be included in IDR,If any parameter
                                                     is null or not exist,empty AVP will include in IDR also.-->
<!-- <If>
                                    <AND>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="sendIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="sendDsrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                        <Condition operator="eq">
                                            <Ref name="mmeUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <Set name="subscriberStatus">
                                            <Null />
                                        </Set>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                <Val>ODBPS</Val>
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="notNullIntersection">
                                                        <Ref name="mmeSupportedServices" entityName="PostCommitBeContext" />
                                                        <Val>ODBALLIP</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="subscriberStatus">
                                                            <Val>1</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="eq">
                                                                <Ref name="actForNotSupOdbAllPacket" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfEpsData" />
                                                                <Val>BarRoaming</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="subscriberStatus">
                                                                    <Null />
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <Set name="subscriberStatus">
                                                                    <Val>0</Val>
                                                                </Set>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                <Val>ODBPSHR</Val>
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        <Val>false</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="subscriberStatus">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="mmeSupportedServices" entityName="PostCommitBeContext" />
                                                                <Val>ODBHPLMNAPN</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="subscriberStatus">
                                                                    <Val>1</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="actForNotSupOdbHplmnApn" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfEpsData" />
                                                                        <Val>BarRoaming</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="subscriberStatus">
                                                                            <Null />
                                                                        </Set>
                                                                    </Then>
                                                                    <Else>
                                                                        <Set name="subscriberStatus">
                                                                            <Val>0</Val>
                                                                        </Set>
                                                                    </Else>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                <Val>ODBPSVR</Val>
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        <Val>false</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="subscriberStatus">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                    <Else>
                                                        <If>
                                                            <Condition operator="notNullIntersection">
                                                                <Ref name="mmeSupportedServices" entityName="PostCommitBeContext" />
                                                                <Val>ODBVPLMNAPN</Val>
                                                            </Condition>
                                                            <Then>
                                                                <Set name="subscriberStatus">
                                                                    <Val>1</Val>
                                                                </Set>
                                                            </Then>
                                                            <Else>
                                                                <If>
                                                                    <Condition operator="eq">
                                                                        <Ref name="actForNotSupOdbVplmnApn" entityName="HSS.ConfigurationData.ConfigurationData.Conf_OAM_ConfEpsData" />
                                                                        <Val>BarRoaming</Val>
                                                                    </Condition>
                                                                    <Then>
                                                                        <Set name="subscriberStatus">
                                                                            <Null />
                                                                        </Set>
                                                                    </Then>
                                                                    <Else>
                                                                        <Set name="subscriberStatus">
                                                                            <Val>0</Val>
                                                                        </Set>
                                                                    </Else>
                                                                </If>
                                                            </Else>
                                                        </If>
                                                    </Else>
                                                </If>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setLessOrEqual">
                                                <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="subscriberStatus">
                                                    <Val>0</Val>
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If> -->
<!-- Add end by Guangli for 69894 on 20100316 -->
                                <If>
                                    <AND>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="sendS4sgsnFullIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="sendMmeFullIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                    </AND>
                                    <Then>
                                        <Set name="fullIdrNeeded">
                                            <Val>true</Val>
                                        </Set>
                                        <Set name="all3gppApnContextIncluded">
                                            <Val>true</Val>
                                        </Set>
                                        <Set name="threegppEpsApnContextSetList">
                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="updApnNum">
                                            <Ref name="threegppEpsApnContextSetList" defaultValue="occurs" />
                                        </Set>
<!-- Add for D55, SQ, 2009/11/17 -->
                                        <Set name="specificApn3gppStrList">
                                            <MultiValue>
                                                <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                            </MultiValue>
                                        </Set>
                                        <Set name="specificApn3gppNum">
                                            <Ref name="specificApn3gppStrList" defaultValue="occurs" />
                                        </Set>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                        <set name="all3gppPdpContextIncluded">
                                            <Val>true</Val>
                                        </set>
                                        <set name="pdpContextSetList">
                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                        </set>
                                        <set name="updPdpNum">
                                            <Ref name="pdpContextSetList" defaultValue="occurs" />
                                        </set>
<!--Modify for 71037 qdiao full set IDR refactor -->
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEFullSetIDR">
                                            <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                            <In>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsnIdentity">
                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="mmeUpdateFlag" />
                                                <Parameter name="sgsnUpdateFlag" />
                                                <Parameter name="sgsnSubRoaming">
                                                    <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="subRoaming">
                                                    <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="uePurgedInMme">
                                                    <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="msStatusInPS">
                                                    <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="fullIdrNeeded" />
                                                <Parameter name="odbSpecificToPs">
                                                    <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="chargingCharacteristics">
                                                    <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="stnSrData">
                                                    <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="maxRequestedBandwidthDL">
                                                    <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="maxRequestedBandwidthUL">
                                                    <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="ratFreqSelectPriorityId">
                                                    <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="selfActivationStatus">
                                                    <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="subscriberStatus" />
                                                <Parameter name="sgsnSubscriberStatus">
                                                    <Ref name="sgsnSubscriberStatus" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="apnOiReplacement">
                                                    <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="accessRestrictionData">
                                                    <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                </Parameter>
                                                <Parameter name="networkAccessMode">
                                                    <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                </Parameter>
                                                <Parameter name="DN_MSubIdentificationNumber" />
                                                <Parameter name="mainMSISDN">
                                                    <Ref name="tempMainMSISDN" />
                                                </Parameter>
                                                <Parameter name="ccInMsIsdn">
                                                    <Ref name="nowcountryCodeId" />
                                                </Parameter>
                                                <Parameter name="traceDataRef" />
                                                <Parameter name="traceDepth" />
                                                <Parameter name="traceNeTypeList" />
                                                <Parameter name="traceInterfaceList" />
                                                <Parameter name="traceEventList" />
                                                <Parameter name="omcIdentity" />
                                                <Parameter name="traceCollectionEntityAddr" />
                                                <Parameter name="traceCollectionEntityAddrType" />
                                                <Parameter name="visitedMmePlmnId">
                                                    <Ref name="visitedMmePlmnId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="visitedS4SgsnPlmnId">
                                                    <Ref name="visitedS4SgsnPlmnId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="lipaAllowed">
                                                    <Ref name="lipaAllowed" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsnLipaAllowed">
                                                    <Ref name="sgsnLipaAllowed" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="csgSubscriptionDataNum">
                                                    <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="csgSubscriptionData">
                                                    <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsncsgSubscriptionDataNum">
                                                    <Ref name="sgsncsgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsncsgSubscriptionData">
                                                    <Ref name="sgsncsgSubscriptionData" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="epsAccessSubscriptionType">
                                                    <Ref name="epsAccessSubscriptionType" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="all3gppApnContextIncluded" />
                                                <Parameter name="updApnNum" />
                                                <Parameter name="threegppEpsApnContextSetList" />
                                                <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                    <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="specificApn3gppNum" />
                                                <Parameter name="specificApn3gppStrList" />
                                                <Parameter name="all3gppPdpContextIncluded" />
                                                <Parameter name="updPdpNum" />
                                                <Parameter name="pdpContextSetList" />
                                                <Parameter name="deactivatedDomains">
                                                    <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="s6aULRFlags">
                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="s6dULRFlags">
                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="icsIndicator">
                                                    <Ref name="icsIndicator" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="RauTauTimer">
                                                    <Ref name="RauTauTimer" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="gmlcAddressList">
                                                    <Ref name="gmlcAddressList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="originatingLcs">
                                                    <Ref name="originatingLcs" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mpsPriority">
                                                    <Ref name="mpsPriority" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="relayNodeIndicator">
                                                    <Ref name="relayNodeIndicator" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="roamRstrD2UFeat">
                                                    <Ref name="roamRstrD2UFeat" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="zoneCode">
                                                    <Ref name="zoneCode" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="epsPlmnCodes">
                                                    <Ref name="epsPlmnCodes" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="epsMobileNetworkCodeIds">
                                                    <Ref name="epsMobileNetworkCodeIds" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="epsMobileCountryCodeIds">
                                                    <Ref name="epsMobileCountryCodeIds" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mdtUserConsent">
                                                    <Ref name="mdtUserConsent" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mdtDomainId">
                                                    <Ref name="mdtDomainId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="jobType">
                                                    <Ref name="jobType" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="areaScope">
                                                    <Ref name="areaScope" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="eutranCGIStrList">
                                                    <Ref name="eutranCGIStrList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="lteTAStrList">
                                                    <Ref name="lteTAStrList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="listMeasurement4Lte">
                                                    <Ref name="listMeasurement4Lte" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="reportingTrigger">
                                                    <Ref name="reportingTrigger" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="reportInterval">
                                                    <Ref name="reportInterval" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="reportAmount">
                                                    <Ref name="reportAmount" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRP">
                                                    <Ref name="eventThresholdRSRP" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="eventThresholdRSRQ">
                                                    <Ref name="eventThresholdRSRQ" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="loggingInterval">
                                                    <Ref name="loggingInterval" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="loggingDuration">
                                                    <Ref name="loggingDuration" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sendS4sgsnFullIdrMsg" />
                                                <Parameter name="sendMmeFullIdrMsg" />
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                <Parameter name="isTscSmsmoInIdr">
                                                    <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- - Added for 69061 by fengziz on 20130108 -->
                            </Else>
                        </If>
                        <If>
                            <Condition operator="eq">
                                <Ref name="sendRtrMsg" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <Set name="sqn4AAAIPv6">
                                    <Ref name="sqn4AAAIPv6" entityName="PostCommitBeContext" />
                                </Set>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sqn4AAAIPv6" />
                                        <NotExist />
                                    </Condition>
                                    <Then>
                                        <Set name="sqn4AAAIPv6">
                                            <Null />
                                        </Set>
                                    </Then>
                                </If>
                                <Set name="none3gppEpsApnContextSetList">
                                    <Null />
                                </Set>
                                <If>
                                    <AND>
                                        <Condition operator="setGreater">
                                            <Ref name="sqn4AAAIPv6" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="greater">
                                            <Ref name="sqn4AAAIPv6" />
                                            <Val>0</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="Non3gppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="none3gppEpsApnContextSetList">
                                                    <MultiValue>
                                                        <Ref name="Non3gppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                    </MultiValue>
                                                </Set>
<!-- compute the number of APN modified-->
                                                <Set name="updApnNum">
                                                    <Ref name="none3gppEpsApnContextSetList" defaultValue="occurs" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTERTR">
                                    <Description>- create the message LTERTR due to subscriber deletion</Description>
                                    <In>
                                        <Parameter name="aaaIdentity">
                                            <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="userName" />
                                        <Parameter name="deregReasonId">
                                            <Val>0</Val>
                                        </Parameter>
                                        <Parameter name="updApnNum" />
                                        <Parameter name="none3gppEpsApnContextSetList" />
                                        <Parameter name="sqn4AAAIPv6" />
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
<!-- If aaaUpdateFlag=true,complete profile will be included in PPR,If any parameter
                                                     is null or not exist,empty AVP will include in PPR also.-->
                            <Else>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendPprMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="non3gppIpAccess" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="non3gppIpAccess" entityName="PostCommitBeContext" />
                                                        <Val>Non3gppSubAllowed</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="non3gpp_IpAccess">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="non3gppIpAccess" entityName="PostCommitBeContext" />
                                                        <Val>Non3gppSubBarred</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="non3gpp_IpAccess">
                                                            <Val>1</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Then>
                                            <Else>
                                                <Set name="non3gpp_IpAccess">
                                                    <Val>0</Val>
                                                </Set>
                                            </Else>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="non3gppIpAccessApn" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="non3gppIpAccessApn" entityName="PostCommitBeContext" />
                                                        <Val>Non3gppApnsEnable</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="non3gpp_IpAccessApn">
                                                            <Val>0</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                                <If>
                                                    <Condition operator="eq">
                                                        <Ref name="non3gppIpAccessApn" entityName="PostCommitBeContext" />
                                                        <Val>Non3gppApnsDisable</Val>
                                                    </Condition>
                                                    <Then>
                                                        <Set name="non3gpp_IpAccessApn">
                                                            <Val>1</Val>
                                                        </Set>
                                                    </Then>
                                                </If>
                                            </Then>
                                            <Else>
                                                <Set name="non3gpp_IpAccessApn">
                                                    <Val>0</Val>
                                                </Set>
                                            </Else>
                                        </If>
                                        <Set name="Non3gppEpsApnContextSetList">
                                            <Ref name="Non3gppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                        </Set>
                                        <Set name="updApnNum">
                                            <Ref name="Non3gppEpsApnContextSetList" defaultValue="occurs" />
                                        </Set>
<!-- Add for D55, SQ, 2009/11/17 -->
                                        <Set name="specificApnNon3gppStrList">
                                            <MultiValue>
                                                <Ref name="specificApnNon3gppStrList" entityName="PostCommitBeContext" />
                                            </MultiValue>
                                        </Set>
                                        <Set name="specificApnNon3gppNum">
                                            <Ref name="specificApnNon3gppStrList" defaultValue="occurs" />
                                        </Set>
<!-- Add for D55 End, SQ, 2009/11/17 -->
<!-- Add begin for 70018 by fucong on 20100910 -->
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="traceActive">
                                                    <Ref name="networkTraceActive" entityName="PostCommitBeContext" />
                                                </Set>
                                                <Set name="traceDataRef">
                                                    <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                            <Else>
                                                <Remove name="traceActive" />
                                                <Remove name="traceDataRef" />
                                            </Else>
                                        </If>
<!-- Add end for 70018 by fucong on 20100910 -->
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEPPR">
                                            <Description>- create the message LTEPPR due to non-3GPP data changes</Description>
                                            <In>
                                                <Parameter name="aaaIdentity">
                                                    <Ref name="aaaIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="chargingCharacteristics">
                                                    <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="chargingGatewayFuncHost">
                                                    <Ref name="chargingGatewayFuncHost" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="chargingGroup">
                                                    <Ref name="chargingGroup" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mainMSISDN">
                                                    <Ref name="tempMainMSISDN" />
                                                </Parameter>
                                                <Parameter name="accessRestrictionData">
                                                    <Ref name="tempAccessRestrictionData" />
                                                </Parameter>
<!--Add begin by Guangli for 69915 on 20100201-->
                                                <Parameter name="non3gppApnOiReplacement">
                                                    <Ref name="non3gppApnOiReplacement" entityName="PostCommitBeContext" />
                                                </Parameter>
<!--Add end by Guangli for 69915 on 20100201-->
                                                <Parameter name="non3gppAccessRestrictionData" />
<!--
                                                    <Ref name="non3gppAccessRestrictionData" entityName="PostCommitBeContext"/>
                                                </Parameter>
-->
                                                <Parameter name="non3gppAuthenSesTimeout">
                                                    <Ref name="non3gppAuthenSesTimeout" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="non3gppGwMobileIpCapability">
                                                    <Ref name="non3gppGwMobileIpCapability" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="non3gpp_IpAccess" />
                                                <Parameter name="non3gpp_IpAccessApn" />
                                                <Parameter name="maxRequestedBandwidthDL">
                                                    <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="maxRequestedBandwidthUL">
                                                    <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                <Parameter name="selfActivationStatus">
                                                    <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
<!--Add begin by pomykala for FFRD72989 on 20120404-->
                                                <Parameter name="visitedSgsnPlmnId">
                                                    <Ref name="visitedSgsnPlmnId" entityName="PostCommitBeContext" />
                                                </Parameter>
<!--Add end by pomykala for FFRD72989 on 20120404-->
                                                <Parameter name="dfltNon3gppEpsApnContextSetIdx">
                                                    <Ref name="dfltNon3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                <Parameter name="specificApnNon3gppStrList" />
                                                <Parameter name="specificApnNon3gppNum" />
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                <Parameter name="updApnNum" />
                                                <Parameter name="Non3gppEpsApnContextSetList" />
                                                <Parameter name="aaaUpdateFlag" />
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                <Parameter name="DN_MSubIdentificationNumber" />
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!--Add begin by fucong for 70018 on 20100729-->
                                                <Parameter name="traceActive" />
                                                <Parameter name="traceDataRef" />
                                                <Parameter name="traceDepth">
                                                    <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="traceNeTypeList">
                                                    <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="traceInterfaceList">
                                                    <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="traceEventList">
                                                    <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="omcIdentity">
                                                    <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="traceCollectionEntityAddr">
                                                    <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="traceCollectionEntityAddrType">
                                                    <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="pcscfServerName">
                                                    <Ref name="pcscfServerName" entityName="PostCommitBeContext" />
                                                </Parameter>
<!--Add end by fucong for 70018 on 20100729-->
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                            </Else>
                        </If>
<!-- begin weimingm F73419, add for deactivatedDomain specially -->
                        <If>
                            <Or>
                                <Condition operator="notNullIntersection">
                                    <Ref name="deactivatedDomains" delta="added" entityName="HistoryBeGDMI" />
                                    <Val>noPS</Val>
                                </Condition>
                                <Condition operator="notNullIntersection">
                                    <Ref name="deactivatedDomains" delta="added" entityName="HistoryBeGDMI" />
                                    <Val>noEPS</Val>
                                </Condition>
                                <Condition operator="notNullIntersection">
                                    <Ref name="deactivatedDomains" delta="removed" entityName="HistoryBeGDMI" />
                                    <Val>noPS</Val>
                                </Condition>
                                <Condition operator="notNullIntersection">
                                    <Ref name="deactivatedDomains" delta="removed" entityName="HistoryBeGDMI" />
                                    <Val>noEPS</Val>
                                </Condition>
                            </Or>
                            <Then>
                                <Set name="DN_BasicSubscription">
                                    <Ref name="__DISTINGUISH_NAME" />
                                </Set>
<!-- get sendClrMsg and sendDsrMsg and sendIdrMsg flag -->
<!-- sendDsrMsg and sendIdrMsg contains scenario standlone MME or combined MME and SGSN -->
                                <If>
                                    <And>
                                        <Condition operator="setGreater">
                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="setGreater">
                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                            <Null />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="fEps001" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractEps" />
                                            <Val>true</Val>
                                        </Condition>
                                    </And>
                                    <Then>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendComIdrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendComIdrMsg">
                                                    <Ref name="sendComIdrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendComDsrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendComDsrMsg">
                                                    <Ref name="sendComDsrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendComClrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendComClrMsg">
                                                    <Ref name="sendComClrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueMmeLocated" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendIdrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendIdrMsg">
                                                    <Ref name="sendIdrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendDsrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendDsrMsg">
                                                    <Ref name="sendDsrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueMmeExist" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendClrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendClrMsg">
                                                    <Ref name="sendClrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- get sendS4sgsnClrMsg and sendS4sgsnDsrMsg flag -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueS4SgsnLocated" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendS4sgsnDsrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnDsrMsg">
                                                    <Ref name="sendS4sgsnDsrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendS4sgsnIdrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnIdrMsg">
                                                    <Ref name="sendS4sgsnIdrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="ueS4SgsnExist" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <If>
                                            <Condition operator="neq">
                                                <Ref name="sendS4sgsnClrMsg" entityName="PostCommitBeContext" />
                                                <NotExist />
                                            </Condition>
                                            <Then>
                                                <Set name="sendS4sgsnClrMsg">
                                                    <Ref name="sendS4sgsnClrMsg" entityName="PostCommitBeContext" />
                                                </Set>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
<!-- prepare FullSet Idr -->
                                <If>
                                    <Or>
                                        <Condition operator="eq">
                                            <Ref name="sendComIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendComDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                    </Or>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="PrepareFullSetIDRData">
                                            <Description>prepare full set IDR data</Description>
                                            <In>
                                                <Parameter name="DN_GsmServiceProfile">
                                                    <Ref name="DN_GSMSUB" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- send CLR msg -->
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendComClrMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                            <Description>create the message LTECLR</Description>
                                            <In>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="sgsnIdentity">
                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="cancellationType">
                                                    <Val>2</Val>
                                                </Parameter>
                                                <Parameter name="s6aULRFlags">
                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="s6dULRFlags">
                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendClrMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                            <Description>create the message LTECLR</Description>
                                            <In>
                                                <Parameter name="mmeIdentity">
                                                    <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="cancellationType">
                                                    <Val>2</Val>
                                                </Parameter>
                                                <Parameter name="s6aULRFlags">
                                                    <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                                <If>
                                    <Condition operator="eq">
                                        <Ref name="sendS4sgsnClrMsg" />
                                        <Val>true</Val>
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTECLR">
                                            <Description>create the message LTECLR</Description>
                                            <In>
                                                <Parameter name="sgsnIdentity">
                                                    <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="userName" />
                                                <Parameter name="cancellationType">
                                                    <Val>2</Val>
                                                </Parameter>
                                                <Parameter name="s6dULRFlags">
                                                    <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="sendComIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="sendComDsrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                        <Or>
                                            <And>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                            <And>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="eq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                        </Or>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Or>
                                                <Condition operator="eq">
                                                    <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                    <Null />
                                                </Condition>
                                            </Or>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendComIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Or>
                                            <And>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                            <And>
                                                <Condition operator="eq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                            <And>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                        </Or>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertComDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertComDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="visitedMmePlmnId">
                                                            <Ref name="visitedMmePlmnId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="visitedSgsnPlmnId">
                                                            <Ref name="visitedSgsnPlmnId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendComDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Or>
                                            <And>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="notNullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                            <And>
                                                <Condition operator="eq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                            <And>
                                                <Condition operator="neq">
                                                    <Ref name="uePurgedInMme" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="nullIntersection">
                                                    <Ref name="msStatusInPS" />
                                                    <Val>Purged_in_S4_SGSN</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="sgsnUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="mmeUpdateFlag" />
                                                    <Val>true</Val>
                                                </Condition>
                                            </And>
                                        </Or>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="completePdpContextDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteComDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="complete3gppApnDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="sendIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="sendDsrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                        <Condition operator="eq">
                                            <Ref name="mmeUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Or>
                                                <Condition operator="eq">
                                                    <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                    <Null />
                                                </Condition>
                                            </Or>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
                                                        <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="csgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="csgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="uePurgedInMme">
                                                            <Ref name="uePurgedInMme" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="mmeUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mmeUpdateFlag">
                                                            <Ref name="mmeUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="visitedMmePlmnId">
                                                            <Ref name="visitedMmePlmnId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="mmeUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="completePdpContextDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteMMEDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="mmeIdentity">
                                                            <Ref name="mmeIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="complete3gppApnDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6aULRFlags">
                                                            <Ref name="s6aULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <OR>
                                            <Condition operator="eq">
                                                <Ref name="sendS4sgsnIdrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                            <Condition operator="eq">
                                                <Ref name="sendS4sgsnDsrMsg" />
                                                <Val>true</Val>
                                            </Condition>
                                        </OR>
                                        <Condition operator="eq">
                                            <Ref name="sgsnUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
<!--     <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>  -->
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="sgsncsgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="sgsncsgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
<!-- <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>  -->
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="sgsncsgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="sgsncsgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Or>
                                                <Condition operator="eq">
                                                    <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                    <NotExist />
                                                </Condition>
                                                <Condition operator="setLessOrEqual">
                                                    <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                    <Null />
                                                </Condition>
                                            </Or>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_Prepare4FullSetIDR" name="createLTEIDR">
<!--CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR"-->
                                                    <Description>- call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
<!-- Add begin by Guangli for 69894 on 20100310 -->
                                                        <Parameter name="odbSpecificToPs">
                                                            <Ref name="odbSpecificToPs" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="subscriberStatus">
                                                            <Ref name="subscriberStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by Guangli for 69894 on 20100310 -->
<!-- Add begin by nian for 72989 on 20120612 -->
<!-- <Parameter name="subRoaming">
                                                            <Ref name="subRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>  -->
<!-- Add end by nian for 72989 on 20120612 -->
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="stnSrData">
                                                            <Ref name="stnSrData" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="apnOiReplacement">
                                                            <Ref name="apnOiReplacement" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="chargingCharacteristics">
                                                            <Ref name="chargingCharacteristics" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthDL">
                                                            <Ref name="maxRequestedBandwidthDL" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="maxRequestedBandwidthUL">
                                                            <Ref name="maxRequestedBandwidthUL" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add begin by nian for 72989 on 20120229 -->
                                                        <Parameter name="selfActivationStatus">
                                                            <Ref name="selfActivationStatus" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by nian for 72989 on 20120229 -->
                                                        <Parameter name="ratFreqSelectPriorityId">
                                                            <Ref name="ratFreqSelectPriorityId" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="mainMSISDN">
                                                            <Ref name="mainMSISDN" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="accessRestrictionData">
                                                            <Ref name="accessRestrictionData" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="networkAccessMode">
                                                            <Ref name="networkAccessMode" entityName="HistoryBeGDMI" DN="DN_BasicSubscription" />
                                                        </Parameter>
                                                        <Parameter name="all3gppApnContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updApnNum">
                                                            <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="threegppEpsApnContextSetList">
                                                            <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                            <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55, SQ, 2009/11/17 -->
                                                        <Parameter name="specificApn3gppStrList">
                                                            <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="specificApn3gppNum">
                                                            <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add for D55 End, SQ, 2009/11/17 -->
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="fullIdrNeeded">
                                                            <Val>true</Val>
                                                        </Parameter>
<!-- add begin by shshi for SDMA01CAG249271 -->
                                                        <Parameter name="ccInMsIsdn">
                                                            <Ref name="ccInMsIsdn" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- add end by shshi for SDMA01CAG249271 -->
<!-- For 70267, Shi Qin, 2010-03-12 -->
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!--For 70267 End, Shi Qin, 2010-03-12 -->
<!-- Add begin by fucong for 70018 on 20100729 -->
                                                        <Parameter name="traceDataRef">
                                                            <Ref name="traceDataRef" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceDepth">
                                                            <Ref name="traceDepth" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceNeTypeList">
                                                            <Ref name="traceNeTypeList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceInterfaceList">
                                                            <Ref name="traceInterfaceList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceEventList">
                                                            <Ref name="traceEventList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="omcIdentity">
                                                            <Ref name="omcIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddr">
                                                            <Ref name="traceCollectionEntityAddr" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="traceCollectionEntityAddrType">
                                                            <Ref name="traceCollectionEntityAddrType" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionDataNum">
                                                            <Ref name="sgsncsgSubscriptionDataNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="csgSubscriptionData">
                                                            <Ref name="sgsncsgSubscriptionData" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- Add end by fucong for 70018 on 20100729 -->
<!---Add begin by LIU Yang for 69061 on 20130318-->
                                                        <Parameter name="sgsnSubRoaming">
                                                            <Ref name="sgsnSubRoaming" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="msStatusInPS">
                                                            <Ref name="msStatusInPS" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="deactivatedDomains">
                                                            <Ref name="deactivatedDomains" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!---Add end by LIU Yang for 69061 on 20130318-->
<!-- Begin: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                        <Parameter name="isTscSmsmoInIdr">
                                                            <Ref name="isTscSmsmoInIdr" entityName="PostCommitBeContext" />
                                                        </Parameter>
<!-- End: Added for 69061 to support tscode SMSMO in full IDR by Yvonne, 2013-3-27 -->
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnIdrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="neq">
                                            <Ref name="sgsnUpdateFlag" />
                                            <Val>true</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="all3gppPdpContextIncluded">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="updPdpNum">
                                                            <Ref name="updPdpNum" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="pdpContextSetList">
                                                            <Ref name="pdpContextSetList" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="sgsnUpdateFlag">
                                                            <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="insertS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEIDR">
                                                    <Description>? - call Mediation BE's createLTEIDR to create LTEIDR message</Description>
                                                    <In>
                                                    <Parameter name="sgsnIdentity">
                                                        <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="userName">
                                                        <Ref name="userName" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="all3gppApnContextIncluded">
                                                        <Val>true</Val>
                                                    </Parameter>
                                                    <Parameter name="updApnNum">
                                                        <Ref name="updApnNum" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="threegppEpsApnContextSetList">
                                                        <Ref name="threegppEpsApnContextSetList" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="dflt3gppEpsApnContextSetIdx">
                                                        <Ref name="dflt3gppEpsApnContextSetIdx" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="sgsnUpdateFlag">
                                                        <Ref name="sgsnUpdateFlag" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="DN_MSubIdentificationNumber">
                                                        <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="s6dULRFlags">
                                                        <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="specificApn3gppStrList">
                                                        <Ref name="specificApn3gppStrList" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="specificApn3gppNum">
                                                        <Ref name="specificApn3gppNum" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    <Parameter name="visitedSgsnPlmnId">
                                                        <Ref name="visitedSgsnPlmnId" entityName="PostCommitBeContext" />
                                                    </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                                <If>
                                    <AND>
                                        <Condition operator="eq">
                                            <Ref name="sendS4sgsnDsrMsg" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="sgsnUpdateFlag" />
                                            <Val>false</Val>
                                        </Condition>
                                    </AND>
                                    <Then>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>GPRS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="completePdpContextDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="notNullIntersection">
                                                <Ref name="deleteS4sgsnDataType" entityName="PostCommitBeContext" />
                                                <Val>EPS</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.*.BeOamLtt" name="createLTEDSR">
                                                    <Description>- call Mediation BE's createLTEDSR to create LTEDSR message</Description>
                                                    <In>
                                                        <Parameter name="sgsnIdentity">
                                                            <Ref name="sgsnIdentity" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="userName">
                                                            <Ref name="userName" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="complete3gppApnDeleted">
                                                            <Val>true</Val>
                                                        </Parameter>
                                                        <Parameter name="DN_MSubIdentificationNumber">
                                                            <Ref name="DN_MSubIdentificationNumber" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                        <Parameter name="s6dULRFlags">
                                                            <Ref name="s6dULRFlags" entityName="PostCommitBeContext" />
                                                        </Parameter>
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- end weimingm F73419, add for deactivatedDomain specially -->
                        <CallBE entityName="HSS.SUB.*.BeOamLtt" name="send">
                            <Description>send PUP messages to RT PDLS</Description>
                            <In />
                            <Out />
                        </CallBE>
<!-- End by wupingfan.-->
<!-- Add begin for 68733, 2010/12/07-->
                        <If>
                            <Condition operator="eq">
                                <Ref name="fCA3010" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractCamel" />
                                <Val>true</Val>
                            </Condition>
                            <Then>
                                <If>
                                    <OR>
                                        <Condition operator="eq">
                                            <Ref name="needCheckCF" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="needCheckCB" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="needCheckODB" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                        <Condition operator="eq">
                                            <Ref name="needCheckCSI" entityName="PostCommitBeContext" />
                                            <Val>true</Val>
                                        </Condition>
                                    </OR>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.SUB_OAM_ProcessNSDM" name="AnalyzeDataChange">
                                            <In>
                                                <Parameter name="mobileCountryCodeId">
                                                    <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mobileNetworkCodeId">
                                                    <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="mSubIdentificationNumberId">
                                                    <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="needCheckCF">
                                                    <Ref name="needCheckCF" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="needCheckCB">
                                                    <Ref name="needCheckCB" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="needCheckODB">
                                                    <Ref name="needCheckODB" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="needCheckCSI">
                                                    <Ref name="needCheckCSI" entityName="PostCommitBeContext" />
                                                </Parameter>
                                                <Parameter name="notificationToCseFlag">
                                                    <Ref name="notificationToCseFlag" entityName="PostCommitBeContext" />
                                                </Parameter>
                                            </In>
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
                            </Then>
                        </If>
<!-- Add end for 68733, 2010/12/07 -->
<!--73282-76 begin-->
                        <If>
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="supportIMEIInSh" entityName="HSS.ContractData.ContractData.Cont_OAM_CommonContractData" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="setGreater">
                                    <Ref name="imsSubNum4IMEI" entityName="PostCommitBeContext" />
                                    <Null />
                                </Condition>
                                <Condition operator="greater">
                                    <Ref name="imsSubNum4IMEI" entityName="PostCommitBeContext" />
                                    <Val>0</Val>
                                </Condition>
                            </AND>
                            <Then>
                                <CallBE name="join" entityName="HSS.SUB.*.BeString">
                                    <In>
                                        <Parameter name="__DESTINATION_NAME">
                                            <Val>userName</Val>
                                        </Parameter>
                                        <Parameter name="joinParameters">
                                            <Val>mobileCountryCodeId,mobileNetworkCodeId,mSubIdentificationNumberId</Val>
                                        </Parameter>
                                        <Parameter name="mobileCountryCodeId">
                                            <Ref name="mobileCountryCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mobileNetworkCodeId">
                                            <Ref name="mobileNetworkCodeId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="mSubIdentificationNumberId">
                                            <Ref name="mSubIdentificationNumberId" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out>
                                        <Parameter name="userName" />
                                    </Out>
                                </CallBE>
                                <Set name="requestName">
                                    <Ref name="requestName" entityName="PostCommitBeContext" />
                                </Set>
                                <CallBE entityName="HSS.SUB.*.BeEncapXMLMedMsg" name="BuildXMLMedMsg">
                                    <Description>Call BuildXMLMedMsg to encode XML mediation msg</Description>
                                    <In>
                                        <Parameter name="userName" />
                                        <Parameter name="requestName" />
                                        <Parameter name="add3gpp2Meid">
                                            <Ref name="add3gpp2Meid" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="addImeiSv">
                                            <Ref name="addImeiSv" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="sqn4IMEI">
                                            <Ref name="sqn4IMEI" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="imsSubNum4IMEI">
                                            <Ref name="imsSubNum4IMEI" entityName="PostCommitBeContext" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeHssOamRT" name="send">
                                    <Description>send the messages</Description>
                                    <In />
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!--73282-76 end-->
                        <Result />
                    </Request>
                    <Request name="justAfterCommit" notAtInterface="true">
                        <Description>
                            <Summary>excuted between db transaction commit and postcommit</Summary>
                            <Context>BasicSubscription management</Context>
                            <Actor>OAM-MS</Actor>
                        </Description>
                        <ReqParameters />
                        <If>
<!-- SDMA01CAG246501 begin -->
                            <AND>
                                <Condition operator="eq">
                                    <Ref name="interceptionCommit" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                                <Condition operator="eq">
                                    <Ref name="underInterception" entityName="PostCommitBeContext" />
                                    <Val>true</Val>
                                </Condition>
                            </AND>
<!-- SDMA01CAG246501 end -->
                            <Then>
                                <Set name="IMSI_Change_Mode">
                                    <Ref name="IMSI_Change_Mode" entityName="PostCommitBeContext" />
                                </Set>
<!-- ***SubInterception SDMA01FAG216204 *** NGHLR1FAG205458 begin for subscriber delete-->
                                <Set name="subRemovalList">
                                    <Ref name="subRemovalList" entityName="PostCommitBeContext" />
                                </Set>
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="subRemovalList" />
                                        <Null />
                                    </Condition>
                                    <Then>
                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="subscriptionRemoved">
                                            <Description>callBe to remove subscription</Description>
                                            <In />
                                            <Out />
                                        </CallBE>
                                    </Then>
                                </If>
<!-- ***SubInterception  SDMA01FAG216204*** NGHLR1FAG205458 end for subscriber delete-->
                                <If>
                                    <Condition operator="setGreater">
                                        <Ref name="IMSI_Change_Mode" />
                                        <Null />
                                    </Condition>
<!--IMSI Change-->
                                    <Then>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="IMSI_Change_Mode" />
                                                <Val>MANUAL</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="imsiReplacement">
                                                    <Description>- callBe to do imsi replacement</Description>
                                                    <In />
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="IMSI_Change_Mode" />
                                                <Val>AUTOCRE</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="imsiAutoReplacement">
                                                    <Description>- callBe to do imsi auto replacement</Description>
                                                    <In />
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="eq">
                                                <Ref name="IMSI_Change_Mode" />
                                                <Val>AUTODEL</Val>
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="imsiRemoval">
                                                    <Description>- callBe to do imsi removal</Description>
                                                    <In />
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Then>
                                    <Else>
<!--NAM change-->
                                        <Set name="networkAccessMode">
                                            <Ref name="networkAccessMode" delta="" entityName="HistoryBeGDMI" />
                                        </Set>
                                        <Set name="oldNetworkAccessMode">
                                            <Ref name="networkAccessMode" delta="old" entityName="HistoryBeGDMI" />
                                        </Set>
                                        <If>
                                            <AND>
                                                <Condition operator="setGreater">
                                                    <Ref name="networkAccessMode" />
                                                    <Null />
                                                </Condition>
                                                <Condition operator="neq">
                                                    <Ref name="networkAccessMode" />
                                                    <Ref name="oldNetworkAccessMode" />
                                                </Condition>
                                            </AND>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="changeNAM">
                                                    <In />
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
<!--MSISDN change-->
                                        <CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubIMSI" name="create">
                                            <Description>- MSISDN change:get the associatedIMSI</Description>
                                            <In />
                                            <Out>
                                                <Parameter name="associatedIMSI" />
                                            </Out>
                                        </CallBE>
                                        <Set name="newMSISDNList">
                                            <MultiValue>
                                                <Ref name="newMSISDNList" />
                                                <Ref name="mainMSISDN" delta="" entityName="HistoryBeGDMI" DN="associatedIMSI" />
                                                <Ref name="associatedMSISDN" delta="" entityName="HistoryBeGDMI" DN="associatedIMSI" />
                                            </MultiValue>
                                        </Set>
                                        <Set name="oldMSISDNList">
                                            <MultiValue>
                                                <Ref name="oldMSISDNList" />
                                                <Ref name="mainMSISDN" delta="old" entityName="HistoryBeGDMI" DN="associatedIMSI" />
                                                <Ref name="associatedMSISDN" delta="old" entityName="HistoryBeGDMI" DN="associatedIMSI" />
                                            </MultiValue>
                                        </Set>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.BeExtractFromSet" name="aSUBb">
                                            <Description>- MSISDN change:get added MSISDN</Description>
                                            <In>
                                                <Parameter name="set_a">
                                                    <Ref name="newMSISDNList" />
                                                </Parameter>
                                                <Parameter name="set_b">
                                                    <Ref name="oldMSISDNList" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="addedMSISDNList">
                                                    <Ref name="set_r" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <CallBE entityName="HSS.SUB.SupplementaryService.BeExtractFromSet" name="bSUBa">
                                            <Description>- MSISDN change:get removed MSISDN</Description>
                                            <In>
                                                <Parameter name="set_a">
                                                    <Ref name="newMSISDNList" />
                                                </Parameter>
                                                <Parameter name="set_b">
                                                    <Ref name="oldMSISDNList" />
                                                </Parameter>
                                            </In>
                                            <Out>
                                                <Parameter name="removedMSISDNList">
                                                    <Ref name="set_r" />
                                                </Parameter>
                                            </Out>
                                        </CallBE>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="addedMSISDNList" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <Set name="interceptedIdentityList">
                                                    <Ref name="interceptedIdentityList" entityName="PostCommitBeContext" />
                                                </Set>
                                                <CallBE entityName="HSS.SUB.SupplementaryService.BeGetSubIMSI" name="create">
                                                    <Description>- get associatedIMSI, mainMSISDN and associatedMSISDN(7)</Description>
                                                    <In />
                                                    <Out>
                                                        <Parameter name="associatedIMSI" />
                                                    </Out>
                                                </CallBE>
<!--NGHLR1FAG199285 Begin-->
                                                <Remove name="interceptedIdentityList">
                                                    <Ref name="associatedIMSI" />
                                                </Remove>
<!--NGHLR1FAG199285 End-->
                                                <Set name="msisdnList">
                                                    <Ref name="interceptedIdentityList" />
                                                </Set>
                                                <If>
                                                    <Condition operator="setGreater">
                                                        <Ref name="msisdnList" />
                                                        <Null />
                                                    </Condition>
                                                    <Then>
                                                        <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="msisdnAddition">
                                                            <Description>- MSISDN change:call msisdnAddition LI</Description>
                                                            <In>
                                                                <Parameter name="addedMSISDNList" />
                                                            </In>
                                                            <Out />
                                                        </CallBE>
                                                    </Then>
                                                </If>
                                            </Then>
                                        </If>
                                        <If>
                                            <Condition operator="setGreater">
                                                <Ref name="removedMSISDNList" />
                                                <Null />
                                            </Condition>
                                            <Then>
                                                <CallBE entityName="HSS.SUB.Subscription.BeSubInterception" name="msisdnRemoval">
                                                    <Description>- MSISDN change:call msisdnRemoval LI</Description>
                                                    <In>
                                                        <Parameter name="removedMSISDNList" />
                                                    </In>
                                                    <Out />
                                                </CallBE>
                                            </Then>
                                        </If>
                                    </Else>
                                </If>
                            </Then>
                        </If>
<!-- SDMA01CAG246501 begin -->
                        <If>
<!-- change setGreaterOrEqual to setGreater, BPQ, SDMA01FAG258026 -->
                            <Condition operator="setGreater">
<!-- change setGreaterOrEqual to setGreater, BPQ, SDMA01FAG258026 -->
                                <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                <Null />
                            </Condition>
                            <Then>
                                <CallBE entityName="HSS.SUB.*.BeDate" name="query">
                                    <Description>+ Query Current Time</Description>
                                    <In />
                                    <Out>
                                        <Parameter name="CurrentTime">
                                            <Ref name="date" />
                                        </Parameter>
                                    </Out>
                                </CallBE>
                                <CallBE entityName="HSS.SUB.*.BeNSTracing" name="DeleteTracingTarget">
                                    <In>
                                        <Parameter name="removeTracing">
                                            <Ref name="removeTracing" entityName="PostCommitBeContext" />
                                        </Parameter>
                                        <Parameter name="CurrentTime" />
                                        <Parameter name="tracingStopCause">
                                            <Val>SUBSTOP</Val>
                                        </Parameter>
                                        <Parameter name="NrgKey">
                                            <Ref name="nrgNumberForTracingDB" entityName="HSS.ContractData.ContractData.Cont_OAM_ContractNonStandardSubTracing" />
                                        </Parameter>
                                    </In>
                                    <Out />
                                </CallBE>
                            </Then>
                        </If>
<!-- SDMA01CAG246501 end -->
                        <Result />
                    </Request>
                </BusinessEntity>
            </SubDomain>
        </Domain>
    </Application>
</OAM>
